webpackJsonp([9,226,238,268],{10012:function(e,t){(function(){TS.registerModule("ui.validation",{completed_sig:new signals.Signal,onStart:function e(){o();$("body").on("input.validation paste.validation change.validation","[data-validation]",TS.utility.debounce(function(e){$(e.target).is(".ql-editor")||$(e.target).is(".ql-clipboard")?c($(e.target).closest(".ql-container"),{},e):c($(e.target),{},e)},500));TS.boot_data.feature_lazy_channels&&$("body").on("input.channel-name-validation paste.channel-name-validation change.channel-name-validation",'[data-validation*="channel_name"]',function(e){var t=$(e.target);if(!t.is('input[type="text"]'))return;var n={query:K(t),count:1};TS.interop.channels.fetchAndUpsertChannelsWithQuery(n)});$("body").on("submit.validation","form[data-validation-form]",function(e){var t=$(e.target);var n=TS.ui.validation.validate(t);n||e.preventDefault();TS.ui.validation.completed_sig.dispatch(t,{event:e,passed:n})})},validate:function e(t,n){n=n||{};var r=document;if(t){if(t.is("[data-validation]")){if(1===t.length)return c(t,n);return t.toArray().every(function(e){return c($(e),n)})}r=t.get(0)}var i=Array.prototype.slice.call(r.querySelectorAll("[data-validation]"));if(n&&n.fast)return i.every(function(e){return c($(e),n)});if(n&&n.verbose){var a={};i.forEach(function(e){a[e.name]=c($(e),n)});return a}return i.reduce(function(e,t){return c($(t),n)&&e},true)},register:function e(t,n){if(d[t]){TS.warn(t+" cannot be registered because that key is already in use.");return}if("function"!==typeof n){TS.warn("Only functions can be registered as validators.");return}d[t]=n},showCustomValidation:function e(t,n,r,i){j(t,r.error_message||n,r.class,r,i)},getErrorMessage:function e(t,n){switch(t){case"invalid_name_required":return r.required;case"invalid_name_punctuation":return r.punctuation;case"invalid_name_maxlength":return r.maxlength;case"invalid_name_specials":return r.specials;case"name_taken":return r.name_taken({name:n.name});case"restricted_action":return s.restricted_action;case"name_invalid_name_required":return a.required;case"invalid_starts_with_at":return a.at_sign;case"name_invalid_name_maxlength":case"too_long":return a.maxlength;case"invalid_reserved_word":return a.reserved;case"name_invalid_name_specials":return a.specials;case"invalid_emoji_not_allowed":return V(n.name||"");case"display_name_not_allowed":return a.sso_display_name;case"invalid_email":return l.invalid;case"url_in_message":return u.url_in_message;default:return TS.interop.i18n.t("For some weird reason, that didn\u2019t work. Please try again to continue.","ui_validation")()}},maybeConvertNameErrorCode:function e(t){if("invalid_name_specials"===t)return"name_invalid_name_specials";if("invalid_name_maxlength"===t)return"name_invalid_name_maxlength";if("invalid_name_required"===t)return"name_invalid_name_required";return t},showError:function e(t,n,r,i){j(t,r.error_message||n,"validation_error",r,i)},showWarning:function e(t,n,r,i){j(t,r.warning_message||n,"validation_warning",r,i)},showSuccess:function e(t,n,r,i){j(t,r.success_message||n,"validation_success",r,i)},test:function e(){return{validations:d}}});var e=80;var t=21;var n=21;var r={name_taken:TS.interop.i18n.t("{name} is already taken by a channel, username, or user group.","ui_validation"),lowercase:TS.interop.i18n.t("Channel names must be all lowercase. Try again?","ui_validation")(),maxlength:TS.interop.i18n.t("Blerg, that\u2019s a bit too long! Channel names must be fewer than {max_length_plus_one} characters.","ui_validation")({max_length_plus_one:t+1}),required:TS.interop.i18n.t("Don\u2019t forget to name your channel.","ui_validation")(),specials:TS.interop.i18n.t("Channel names can\u2019t contain spaces, periods, or most punctuation. Try again?","ui_validation")(),punctuation:TS.interop.i18n.t("Names can\u2019t consist solely of punctuation. Please elaborate!","ui_validation")()};var i={firstalphanumeric:TS.interop.i18n.t("Usernames must start with a letter or number. Sorry about that!","ui_validation")(),lowercase:TS.interop.i18n.t("Sorry, usernames must be lowercase!","ui_validation")(),maxlength:TS.interop.i18n.t("Sorry, that\u2019s a bit too long! Usernames must be fewer than {max_length_plus_one} characters.","ui_validation")({max_length_plus_one:n+1}),required:TS.interop.i18n.t("Please fill in a username.","ui_validation")(),specials:TS.interop.i18n.t("Usernames can\u2019t contain special characters. Sorry about that!","ui_validation")()};var a={required:TS.interop.i18n.t("Unfortunately, you can\u2019t leave this blank.","ui_validation")(),at_sign:TS.interop.i18n.t("Names can\u2019t start with the @ sign \u2014\xa0that\u2019s how your teammates will mention you in conversation.","ui_validation")(),maxlength:TS.interop.i18n.t("Unfortunately, names can\u2019t be longer than {maxlength} characters.","ui_validation")({maxlength:e}),reserved:TS.interop.i18n.t("That name\u2019s already being used by Slack.","ui_validation")(),specials:TS.interop.i18n.t("Mostly, names can\u2019t contain punctuation. (Apostrophes, spaces, and periods are fine.)","ui_validation")(),emoji:TS.interop.i18n.t("For all manner of complex reasons, names simply cannot contain emoji. Try again?","ui_validation")(),sso_display_name:TS.interop.i18n.t("Display names are automatically set by your organization.","ui_validation")()};var s={};var o=function e(){s={restricted_action:TS.interop.i18n.t("Sorry! An admin in your workspace has restricted who can create private channels.","ui_validation")()}};var l={invalid:TS.interop.i18n.t("This doesn\u2019t seem like an email address. Sorry!","ui_validation")()};var u={url_in_message:TS.interop.i18n.t("Unfortunately, custom messages can\u2019t contain URLs.","ui_validation")()};var d={dateandformat:x,firstalphanumeric:I,hasnourl:S,isurl:g,lowercase:C,maxcsv:w,maxlength:v,mincsv:y,minlength:T,nospace:M,required:f,reservedwords:p,keywords:h,username:A,channel_name:P,team_name:F,is_email:O,membername:E};var c=function e(t,n,r){n=n||{};t.is("[data-validation-for]")&&(n.custom_for=t.attr("data-validation-for"));n.success_message=TS.interop.i18n.t("Nice, thanks!","ui_validation")();t.is("[data-validation-success]")&&(n.success_message=t.attr("data-validation-success"));t.is("[data-validation-warning]")&&(n.warning_message=t.attr("data-validation-warning"));t.is("[data-validation-error]")&&(n.error_message=t.attr("data-validation-error"));G(t)&&q(t,n);var i=m(t).every(function(e){if(-1===e.indexOf("="))return d[e.trim()](t,n);var r=e.split("=");return d[r[0]](t,n,r[1])});TS.ui.validation.completed_sig.dispatch(t,{event:r,passed:i});B(t,i,n)&&TS.ui.validation.showSuccess(t,n.success_message,n,3e3);t.attr("aria-invalid",!i);return i};var m=function e(t){if(t.is("[data-validation]"))return _.compact(t.attr("data-validation").replace(/\s*(,|=)\s*/g,"$1").split(/\s+/));return[]};function f(e,t){if(e.is('input[type="radio"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select an option","ui_validation")(),t)}else if(e.is('input[type="checkbox"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select at least one option","ui_validation")(),t)}else if(e.is("select")){if(e.val())return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select an option","ui_validation")(),t)}else if(G(e)){if(W(e).trim())return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field can\u2019t be empty","ui_validation")(),t)}else TS.error("Error: cannot validate")}function p(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var r=W(e).trim().toLowerCase();var i=n.split(",");if(-1===i.indexOf(r))return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t('"{word}" is a reserved word. Try something else!',"ui_validation")({word:TS.interop.i18n.safeString(_.escape(r))}),t)}else TS.error("WTF: cannot validate")}function h(e,t){return p(e,t,TS.model.RESERVED_KEYWORDS.join(","))}function g(e,t,n){var r=W(e);var i=TS.interop.i18n.t("This doesn\u2019t seem like a proper link. Sorry!","ui_validation")();var a;var s=false;var o=false;if(!r)return true;if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!G(e)){TS.error("Error: cannot validate");return}if(n){a=n.split(",");-1!=a.indexOf("https")&&(i=TS.interop.i18n.t("Please use https (for security).","ui_validation")());-1!=a.indexOf("http")&&-1==a.indexOf("https")&&a.push("https");for(var l=0;l<a.length;l+=1)0===r.indexOf(a[l]+"://")&&(s=true)}else{s=true;-1==r.indexOf("://")&&(r="http://"+r)}o=TS.interop.url.simpleIsUrl(r);if(o&&s)return true;TS.ui.validation.showWarning(e,i,t)}function S(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var n=W(e);if(!n)return true;if(!TS.interop.url.findUrlsInString(n).length)return true;TS.ui.validation.showWarning(e,u.url_in_message,t)}else TS.error("Error: cannot validate")}function T(e,t,n,r){return b(e,"minlength",t,n,r)}function v(e,t,n,r){return b(e,"maxlength",t,n,r)}function b(e,t,n,r,i){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var a=W(e);r=+r;if(void 0===a||isNaN(r)){TS.error("Error: no length to validate");return}if("minlength"===t){if(TS.interop.utility.getStringLength(a)>=r)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t be less than {minlength, plural, =1{# character}other{# characters}}","ui_validation")({minlength:r}),n)}else if("maxlength"===t){i||N(e,a.length,r,n);if(TS.interop.utility.getStringLength(a)<=r)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t be more than {maxlength, plural, =1{# character}other{# characters}}","ui_validation")({maxlength:r}),n)}}else TS.error("Error: cannot validate")}function y(e,t,n){return k(e,"mincsv",t,n)}function w(e,t,n){return k(e,"maxcsv",t,n)}function k(e,t,n,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var i=W(e).trim();r=+r;if(void 0===i||isNaN(r)){TS.error("Error: no length to validate");return}if("mincsv"===t){if(i.split(/\s*,\s*/).length>=r)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t have less than {minlength, plural, =1{# value}other{# values}}","ui_validation")({minlength:r}),n)}else if("maxcsv"===t){if(i.split(/\s*,\s*/).length<=r)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t have more than {maxlength, plural, =1{# value}other{# values}}","ui_validation")({maxlength:r}),n)}}else TS.error("Error: cannot validate")}function x(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var r=W(e).trim();if(!r)return true;var i;var a;var s;var o;switch(n){case"Y-m-d":i="YYYY-MM-DD";a=r.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/);s=a&&1===a.length&&a[0]===r;s&&(o=H(r+"T00:00:00.000Z"));break;case"m-d":i="MM-DD";a=r.match(/^[0-9]{2}-[0-9]{2}$/);s=a&&1===a.length&&a[0]===r;s&&(o=H("0000-"+r+"T00:00:00.000Z"));break;default:TS.error("Error: cannot validate");return}if(s&&o)return true;s?o||TS.ui.validation.showWarning(e,TS.interop.i18n.t("{value} doesn\u2019t appear to be a valid date. Sorry!","ui_validation")({value:TS.interop.i18n.safeString(_.escape(r))}),t):TS.ui.validation.showWarning(e,TS.interop.i18n.t("This needs to be in the format {pattern}. Sorry!","ui_validation")({pattern:i}),t)}else TS.error("Error: cannot validate")}function C(e,t){var n=G(e)?W(e):e.val();var r=n===n.toLocaleLowerCase();if(r)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field must be lowercase only","ui_validation")(),t)}function M(e,t){var n=G(e)?W(e):e.val();var r=/\s/.test(n);if(!r)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field can\u2019t contain spaces","ui_validation")(),t)}function I(e,t){var n=G(e)?W(e):e.val();var r=/^[^\W_]/.test(n);if(r)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This first character must be a letter or number","ui_validation")(),t)}function A(e,t){var r=$.extend({},t,{quiet:true});if(f(e,r))if(v(e,r,n,true))if(M(e,r))if(D(e,r,/^[\w._-]+$/))if(I(e,r)){if(C(e,r))return!!p(e,t,TS.model.RESERVED_USERNAMES.join(","));TS.ui.validation.showWarning(e,i.lowercase,t)}else TS.ui.validation.showWarning(e,i.firstalphanumeric,t);else TS.ui.validation.showWarning(e,i.specials,t);else TS.ui.validation.showWarning(e,i.specials,t);else TS.ui.validation.showWarning(e,i.maxlength,t);else TS.ui.validation.showWarning(e,i.required,t)}function E(t,n,i){var s=$.extend({},n,{quiet:true});if(t.is('input[type="radio"]')||t.is('input[type="checkbox"]')||t.is("select"))return true;if(!G(t)){TS.error("Error: cannot validate");return}var o=_.trim(W(t));var l=TS.interop.i18n.deburr(o.toLowerCase());var u=z(i);if(_.includes(u,"required")&&!f(t,s)){TS.ui.validation.showWarning(t,a.required,n);return false}if(!v(t,s,e,true)){TS.ui.validation.showWarning(t,a.maxlength,n);return false}var d=TS.model.RESERVED_USERNAMES.concat(TS.model.RESERVED_KEYWORDS).map(function(e){return TS.interop.i18n.deburr(e)});if(-1!==d.indexOf(l)){TS.ui.validation.showWarning(t,a.reserved,n);return false}if("@"===o.charAt(0)){TS.ui.validation.showWarning(t,a.at_sign,n);return false}if(D(t,s,/^[-_.'\u2018\u2019",(){}[\]/;]+$/)){TS.ui.validation.showWarning(t,r.punctuation,n);return false}if(D(t,s,/[`~!@#$%^&*+=\\:"<>?|]/)){TS.ui.validation.showWarning(t,a.specials,n);return false}if(TS.emoji.hasUnifiedEmoji(o)){TS.ui.validation.showWarning(t,V(o),n);return false}return true}function P(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!G(e)){TS.error("Error: cannot validate");return}var r=W(e);var i=z(n);var a=_.includes(i,"fix");a&&(r=K(e));var s=TS.validation.channel_name_with_errors(r);if(true!==s){TS.ui.validation.showWarning(e,s.error_message,t);return false}return true}function F(e,t){t=t||{};var n=W(e).trim();var r=TS.validation.team_name(n);if(true!==r){t.should_truncate=false;"empty"===r.error_key?TS.ui.validation.showCustomValidation(e,r.error_message,t):TS.ui.validation.showError(e,r.error_message,t);return false}return true}function O(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var n=W(e);if(!n)return true;var r=n.match(TS.utility.email_regex);if(r&&1===r.length&&r[0]===n)return true;TS.ui.validation.showWarning(e,l.invalid,t)}else TS.error("Error: cannot validate")}function D(e,t,n){var r=G(e)?W(e):e.val();if(n.test(r))return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field contains invalid characters","ui_validation")(),t)}var H=function e(t){if(!isNaN(Date.parse(t))){var n=new Date(t);return!n.toISOString().indexOf(t)}};var B=function e(t,n,r){var i=$(document.querySelector('label[for="'+(r.custom_for||t.attr("name"))+'"]'));if(!i.length)return;return!(r&&r.quiet)&&n&&false===i.data("validation-ephemeral")};var j=function e(t,n,r,i,a){i=i||{};_.isUndefined(i.should_truncate)&&(i.should_truncate=true);if(i&&i.quiet)return;var s=$(document.querySelector('label[for="'+(i.custom_for||t.attr("name"))+'"]'));if(!s.length)return;var o=s.data("validation-timeout");clearTimeout(o);var l=s.find(".validation_message");if(!l.length){l=$("<span />").addClass("validation_message").toggleClass("overflow_ellipsis",i.should_truncate);t.is("select")?l.insertBefore(s.find("select")):l.appendTo(s)}L(t,s,r);if(!n){l.remove();return}l.get(0).title=n;l.fadeIn(100);s.data("validation-ephemeral",!!a);a&&s.data("validation-timeout",setTimeout(function(){s.removeData("validation-ephemeral").removeData("validation-timeout");l.fadeOut(100,function(){L(t,s);l.remove()})},a))};var R=["validation_error","validation_warning","validation_success"];var L=function e(t,n,r){if(n.hasClass(r))return;t.removeClass(R.join(" "));t.addClass(r);n.removeClass(R.join(" "));n.addClass(r)};var N=function e(t,n,r,i){r-n<=6?U(t,n,r,i):q(t,i)};var U=function e(t,n,r,i){var a=document.querySelector('label[for="'+(i.custom_for||t.attr("name"))+'"]');if(!a)return;var s=[n,r].join("/");$(a).attr("data-countdown",s).addClass("countdown");var o=window.getComputedStyle(a,":after");var l=parseFloat(o.width)||9*s.length;if(t.hasClass("no_validation_padding"))return;t.data("countdown-padding-right")||t.data("countdown-padding-right",parseFloat(t.css("padding-right")));t.css("padding-right",l+parseFloat(o.right)+t.data("countdown-padding-right"))};var q=function e(t,n){var r=document.querySelector('label[for="'+(n.custom_for||t.attr("name"))+'"]');if(!r)return;$(r).removeClass("countdown");t.removeData("countdown-padding-right");t.css("padding-right","")};var G=function e(t){if(TS.utility&&TS.utility.contenteditable)return t.is("input")||t.is("textarea")||TS.utility.contenteditable.isContenteditable(t);return t.is("input")||t.is("textarea")};var W=function e(t){if(TS.utility&&TS.utility.contenteditable)return TS.utility.contenteditable.value(t);return t.val()};var z=function e(t){if(!_.isString(t))return[];return _(t).split(",").map(_.trim).compact().value()};var K=function e(t){var n=W(t);var r=n.toLowerCase().replace(/^#+/,"");r=r.replace(/^\s+/,"");r=r.replace(/\s+$/,"");r=r.replace(/\s/g,"-");if(r&&n!==r){var i=TS.utility.contenteditable.cursorPosition(t).start;r.length<n.length&&(i-=n.length-r.length);t.val(r);TS.utility.contenteditable.cursorPosition(t,i)}return r};var V=function e(t){if(TS.boot_data.feature_i18n_channels_validate_emoji){var n=/(?:\uD83D\uDCA9)/;var r=[TS.interop.i18n.t("For all manner of complex reasons, names simply cannot contain emoji. Try again?","ui_validation")(),TS.interop.i18n.t("Using emoji for names makes some sense, but sadly, not enough. Try again?","ui_validation","29a0641ffb224418f796bb16c7f79013ec377a4c")(),TS.interop.i18n.t("For technical reasons, emoji are not allowed in names. Try again?","ui_validation")(),TS.interop.i18n.t("Of course you want a name with an emoji. Sadly, it is not to be. Try letters?","ui_validation")()];if(t.match(n))return TS.interop.i18n.t("For reasons of party-pooping, names cannot contain emoji. Try again?","ui_validation")();return _.sample(r)}return a.emoji}})()},10013:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var r=function(){function e(e,t){var n=[];var r=true;var i=false;var a=void 0;try{for(var s=e[Symbol.iterator](),o;!(r=(o=s.next()).done);r=true){n.push(o.value);if(t&&n.length===t)break}}catch(e){i=true;a=e}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();(function(){TS.registerModule("utility",{onStart:function e(){TS.utility.makeRefererSafeLink=_.memoize(TS.utility.makeRefererSafeLink);TS.interop.Flannel.useSocket()&&TS.redux.socket.connectedSig.add(TS.utility.resetRefererSafeLinkCache);TS.prefs&&TS.prefs.team_hide_referers_changed_sig&&TS.prefs.team_hide_referers_changed_sig.add(TS.utility.resetRefererSafeLinkCache);t=TS.interop.i18n.t("me","utility")();i=TS.interop.i18n.t("you","utility")();g=TS.utility.normalizeDevHost("https://"+document.location.hostname+"/files");S=TS.utility.normalizeDevHost("https://"+document.location.hostname+"/team")},keymap:{alt:18,ctrl:17,cmd_ff:224,cmd_other:91,cmd_right:93,esc:27,shift:16,tab:9,del:8,delete:46,enter:13,left:37,up:38,right:39,down:40,pageup:33,pagedown:34,end:35,home:36,space:32,semicolon:59,equals_sign:187,minus_sign:189,comma:188,period:190,left_square_bracket:219,right_square_bracket:221,V:86,a:65,e:69,b:66,k:75,i:73,z:90,y:89,insert:45,slash:191},email_regex:new RegExp("^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$","i"),regexpEscape:function e(t,n){n=Math.min(n||5e5,5e5);t.length>n&&(t=t.slice(0,n));return _.escapeRegExp(t)},ensureInArray:function e(t,n){if(t.indexOf(n)>-1)return false;t.push(n);return true},makeComparableVersion:function e(t){var n=t.split("-")[0];return _.reduce(n.split("."),function(e,t){return 1e3*e+parseInt(t,10)},0)},compareSemanticVersions:function e(t,n){var r=TS.utility.makeComparableVersion(t);var i=TS.utility.makeComparableVersion(n);if(r===i)return 0;return r>i?1:-1},isAppVersionBefore:function e(t){if(!TS.model.is_our_app){if("dev"===TS.boot_data.version_ts)throw new Error("Cannot check app version because we are not in the app, silly goose.");return false}return-1===TS.utility.compareSemanticVersions(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor+"."+TS.model.desktop_app_version.patch,t)},doRectsOverlap:function e(t,n){return!(n.left>t.right||n.right<t.left||n.top>t.bottom||n.bottom<t.top)},doesRectContainRect:function e(t,n,r,i){r=r||0;if(n.top<t.top-r)return false;if(n.bottom>t.bottom+r)return false;if(i)return true;if(n.left<t.left-r)return false;if(n.right>t.right+r)return false;return true},shouldLinksHaveTargets:function e(){return!!(TS.client||TS.web&&TS.web.space)},parseJSONOrElse:function e(t,n){if(""===t)return n;try{return JSON.parse(t)}catch(e){return n}},stringifyJSONOrElse:function e(t,n,r,i){try{return JSON.stringify(t,n,r)}catch(e){if("function"===typeof i)return i(e);return i}},ordinalNumber:function e(t){return TS.interop.i18n.t("{number_str, selectordinal, one{#st}two{#nd}few{#rd}other{#th}}","utilities")({number_str:t.toString()})},getTeamUrl:function e(){return S},getHistoryRetryDelay:function e(t,n){t=_.isInteger(t)?t:1;var r=2500;var i=5e3;var a=_.random(r,i);if("fatal_error"===n){var s=1.3;a*=Math.pow(s,t)}return a},getChannelNameFromUrl:function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(!n)return"";var r="messages"==n[0]||"archives"==n[0];if(!r)return"";return decodeURIComponent(n[1])},getMessageTimestampFromUrl:function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(!n)return"";var r="messages"==n[0]||"archives"==n[0];if(!r)return"";var i=n[2];if(!i||"p"!=i[0]||17!=i.length)return"";i=i.substr(1,10)+"."+i.substr(11);return decodeURIComponent(i)},getHCAttributionQS:function e(){return TS.boot_data.hc_tracking_qs},getFlexPartsFromUrl:function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(!n)return"";var r={messages:true,archives:true}[n[0]];var i=r?2:1;return n.slice(i)},getFlexNameFromUrl:function e(t){var n=TS.utility.getFlexPartsFromUrl(t)[0];if(!n)return"";return decodeURIComponent(n)},getFlexExtraFromUrl:function e(t){var n=TS.utility.getFlexPartsFromUrl(t)[1];if(!n)return"";return decodeURIComponent(n).replace(/%2F/g,"/")},getFlexExtraTypeFromUrl:function e(t){var n=TS.utility.getFlexPartsFromUrl(t)[2];if(!n)return"";return decodeURIComponent(n).replace(/%2F/g,"/")},removeUrlParam:function e(t,n){var r=n.split("?")[0];var i=-1!==n.indexOf("?")?n.split("?")[1]:"";var a=[];var s;if(""!==i){a=i.split("&");for(var o=a.length-1;o>=0;o-=1){s=a[o].split("=")[0];s===t&&a.splice(o,1)}r=a.length?r+"?"+a.join("&"):r}return r},isUnreadViewPath:function e(t){return 0===t.indexOf("/unreads")},isThreadsViewPath:function e(t){return 0===t.indexOf("/threads")},isExploreViewPath:function e(t){return 0===t.indexOf("/explore")},isAppSpaceViewPath:function e(t){return 0===t.indexOf("/app-space")},isSlackUrl:function e(t){return f.test(t)},getPathFromSlackUrl:function e(t){var n=t.match(f);var r=n&&n[2];if(!r)return;var i=t.split(r);var a=i[1].split("?")[0];return(r+a).split("/")},getTeamFromSlackUrl:function e(t){var n=t.match(f);var r=n&&n[1];return r},refashionUrl:function e(t,n,i,a){var s=document.createElement("a");s.href=t;var o=s.pathname.slice(1).split("/").slice(0,2),l=r(o,2),u=l[0],d=l[1];s.pathname=_.compact([n||"/"+u+"/"+d,i,a]).join("/");"/"!==s.pathname[s.pathname.length-1]&&(s.pathname+="/");return s.toString()},dataURItoBlob:function e(t){return TS.utility.base64StrtoBlob(TS.utility.base64StrFromDataURI(t))},base64StrFromDataURI:function e(t){return t.split(",")[1]},base64StrtoBlob:function e(t){var n=atob(t);var r=new ArrayBuffer(n.length);var i=new Uint8Array(r);for(var a=0;a<n.length;a+=1)i[a]=n.charCodeAt(a);var s=new DataView(r);var o=new Blob([s]);return o},ellipsize:function e(t,n){if(!t)return t;n&&parseInt(n,10)||(n=50);if(t.length>n){var r=t.substr(0,n/2);var i=t.substr(-n/2,t.length);t=r+"..."+i}return t},makeSafeForDomId:function e(t){return String(t).replace(/\./g,"_")},makeSafeForDomClass:function e(t){return t.replace(/\s/g,"_")},getImageIconClass:function e(t,n){var r=n;var i=80;var a=80;t&&(t.thumb_360_w<i||t.thumb_360_h<a)&&(r=t.thumb_360_w>t.thumb_360_h?"landscape":t.thumb_360_w<t.thumb_360_h?"portrait":"square");return r},getAppliedClasses:function e(t){return _.reduce(t,function(e,t,n){t&&e.push(n);return e},[]).join(" ")},numberWithK:function e(t){if(t>999){t=Math.round(t/1e3*10)/10;return(TS.interop.i18n.number(t)||"")+"K"}return TS.interop.i18n.number(t)||""},cleanChannelName:function e(t){var n=XRegExp("[^\\pL\\pM\\pN_-]+","g");var r=XRegExp("[\\pM\\pM\\pM]","g");var i=/^[-_]+?$/;t=t.toLowerCase();t=t.replace(/^#+/g,"");t=t.replace(/ /g,"-");t=t.replace(n,"_");t=t.replace(/-+/g,"-");t=t.replace(/_+/g,"_");if(i.test(t)||r.test(t))return null;return t},openInNewTab:function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.dontEncodeHash,a=void 0!==i&&i;if(0===t.indexOf("/")&&TS.boot_data.team_url){var s=TS.boot_data.team_url;s=s.substr(0,s.length-1);t=s+t}var o=t;var l="";var u=o.indexOf("?");var d=TS.utility.urlNeedsRefererHiding(t);if(-1!==u){d&&(t=_.escape(t.substring(0,u)));var c=o.substring(u+1,o.length);o=o.substring(0,u);if(c.length){var m=TS.interop.url.queryStringParse(c);var f=TS.interop.url.parseUrl(t);var p=false;f&&"accounts.google.com"==f.hostname&&"/o/oauth2/auth"==f.pathname&&(p=true);_.forEach(m,function(e,n){if(d){t=TS.interop.url.setUrlQueryStringValue(t,n,e||"",p);a&&(t=t.replace("%23","#"))}else l+='<input type="hidden" name="'+_.escape(n)+'" value="'+_.escape(e||"")+'">'})}}if(d){l='<input type="hidden" name="url" value="'+_.escape(t)+'">';o="https://"+TS.boot_data.redir_domain+"/link"}$("<form>"+l+"</form>").attr({method:"GET",action:o,target:n}).appendTo("body").submit().remove()},isScalar:function e(t){return/boolean|number|string/.test("undefined"===typeof t?"undefined":n(t))},sanitizeHTML:function t(n,r,i,a){var s=function e(t){var n=t.tagName.toLowerCase();if(r.indexOf(n)<0)return null;Array.prototype.slice.apply(t.attributes).forEach(function(e){i.indexOf(e.name)<0&&t.attributes.removeNamedItem(e.name)});Array.prototype.slice.apply(t.children).forEach(function(n){var r=e(n);r||t.removeChild(n)});return t};e=e||new DOMParser;var o=e.parseFromString(n,"text/html")||e.parseFromString(n,"text/xml");var l=o.body;if(1!=l.children.length)return"";var u=s(l.children[0]);l=null;o=null;if(u)return a?u:u.outerHTML;return""},getChildTextNodes:function e(t){var n=[];if(!t)return n;if(t instanceof Text){n.push(t);return n}var r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,false);var i=r.nextNode();while(i){n.push(i);i=r.nextNode()}return n},getAttributesFromHTMLString:function t(n){e=e||new DOMParser;var r=e.parseFromString(n,"text/html")||e.parseFromString(n,"text/xml");var i=r.body;if(1!=i.children.length)return{};var a={};[].slice.apply(i.children[0].attributes).forEach(function(e){a[e.name]=e.value});i=null;r=null;return a},linkify:function e(t,n,r,i){if(!t)return t;t=t.replace(TS.interop.url.URL_REGEXP,function(e){var t;if(0===e.toLowerCase().indexOf("www.")){if(!r)return e;t="http://"+e}else t=e;if(i)return"<"+t+"|"+e+">";return"<a "+TS.utility.makeRefererSafeLink(t)+' target="'+(n||"")+'">'+e+"</a>"});return t},linkifyInternal:function e(t,n){return TS.utility.linkify(t,"",n,true)},preg_quote:function e(t){return(""+t).replace(/([\\.+*?[^\]$(){}=!<>|:])/g,"\\$1")},getActiveElementProp:function e(t){if(!document.activeElement)return"";if("NODENAME"===t){if(!document.activeElement.nodeName)return"";return document.activeElement.nodeName.toUpperCase()}return document.activeElement[t]},isTabCompleteShowing:function e(){if($("#chat_input_tab_ui").length)return true;return false},isFocusOnInput:function e(){var t=TS.utility.getActiveElementProp("NODENAME");if(""==t)return false;if("INPUT"===t)return true;if("TEXTAREA"===t)return true;if("SELECT"===t)return true;if(TS.utility.contenteditable.isContenteditable(document.activeElement))return true;return false},unformatTopicOrPurpose:function e(t){return TS.format.unFormatMsg(t)},formatTopicOrPurpose:function e(t,n){t=TS.format.formatWithOptions(t,{},{no_preformatted:!!n});t=t.replace(/(<br[^>]*>)/,'<span class="hidden br_ellipsis">\u2026</span>$1');return t},removeLinksFromTabFlow:function e(t){return t.replace(p,'$1 tabindex="-1"$2')},populateInput:function e(t,n,r){n||(n="");var i=$(t);TS.utility.contenteditable.value(i,n);_.isNumber(r)&&TS.utility.contenteditable.cursorPosition(i,r)},populateThreadInputs:function e(t,n,r){TS.ui.replies.activeConvoModelId()===n&&TS.ui.replies.activeConvoThreadTs()===r&&TS.ui.replies.populateReplyInput(t);TS.model.threads_view_is_showing&&TS.ui.thread.findAndPopulateInput(t,n,r)},urlNeedsRefererHiding:function e(t){if(!t)return false;t=t.toLowerCase();if(0!==t.indexOf("https://")&&0!==t.indexOf("http://")&&0!==t.indexOf("ftp://")&&0!==t.indexOf("sftp://"))return false;var n=true;var r=TS.interop.url.getHostName(t,n);var i=getRefererHidingWhiteList();if(i&&i.indexOf&&-1!==i.indexOf(r))return false;return true},referer_safe_url_map:{},makeRefererSafeLink:function e(t){if("string"!==typeof t){TS.error("Expected url to be a string, got: "+("undefined"===typeof t?"undefined":n(t)));return}t=TS.format.replaceHighlightMarkers(t);var r=t.replace(/&amp;/g,"&");r.match(/javascript:/gi)&&(r="#");var i=true;var a=TS.utility.sanitizeHTML('<a href="'+r+'"></a>',["a"],["href"],i)||null;a&&(r=a.href);r=_.escape(r).replace(/&amp;/g,"&").replace(/(%27|&#39;)/g,"'");t&&t.lastIndexOf("/")!==t.length-1&&r&&r.lastIndexOf("/")===r.length-1&&(r=r.slice(0,-1));r=r||"#";var s='href="'+r+'"';var l="onclick";var u=o();TS.model&&TS.model.is_our_app||u&&u.rewrite_on_right_click&&(l="onmousedown");if(!TS.utility.urlNeedsRefererHiding(t))return s;if(TS.utility.externalURLsNeedRedirecting()){var d=encodeURIComponent(r);var c="https://"+TS.boot_data.redir_domain+"/link?url="+d+(u&&u.redirect_type?"&v="+u.redirect_type:"");var m="url-"+Math.random()+"-"+performance.now();TS.utility.referer_safe_url_map[m]=r;s+=' data-referer-safe="1" '+l+'="this.href=&quot;'+c+'&quot;" onmouseover="this.href=TS.utility.referer_safe_url_map[&quot;'+m+'&quot;]" data-referer-original-href="'+r+'" rel="noreferrer"'}else s+=' rel="noreferrer"';return s},resetRefererSafeLinkCache:function e(){TS.utility.makeRefererSafeLink&&TS.utility.makeRefererSafeLink.cache&&TS.utility.makeRefererSafeLink.cache.clear()},makeSureAllExternalLinksAreRefererSafe:function e(t){var n=Date.now();var r=[];if(TS.utility.externalURLsNeedRedirecting()){t.find("a[href]:not([data-referer-safe])").each(function(){var e=$(this);var t=e.attr("href");if(!TS.utility.urlNeedsRefererHiding(t))return;r.push(this.outerHTML);e.removeAttr("href");var n=this.outerHTML.replace("<a",function(){return"<a "+TS.utility.makeRefererSafeLink(t)+" "});e.replaceWith(n);r[r.length-1]+="\n->\n"+n});if(TS.model&&TS.model.team&&TS.has_pri[h]&&TS.boot_data.feature_tinyspeck)if(r.length){TS.log(h,"#"+t.attr("id")+" had "+r.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to fix it took "+(Date.now()-n)+"ms");TS.dir(h,r)}else TS.log(h,"#"+t.attr("id")+" had "+r.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to check it took "+(Date.now()-n)+"ms")}else{t.find("a[href]:not([rel])").each(function(){var e=$(this);var t=e.attr("href");if(0===t.indexOf("mailto")||0===t.indexOf("skype"))return;if(t&&"#"!==t){if(TS.utility.urlNeedsRefererHiding(t)){r.push(this.outerHTML);e.attr("rel","noreferrer");r[r.length-1]+="\n->\n"+this.outerHTML}}else e.removeAttr("href")});if(TS.model&&TS.model.team&&TS.has_pri[h]&&TS.boot_data.feature_tinyspeck)if(r.length){TS.log(h,"#"+t.attr("id")+" had "+r.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to add rel it took '+(Date.now()-n)+"ms");TS.dir(h,r)}else TS.log(h,"#"+t.attr("id")+" had "+r.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to check it took '+(Date.now()-n)+"ms")}},makeSureAllLinksHaveTargets:function e(t){var n=Date.now();var r=[];t.find("a[href]:not([target])").each(function(){var e=$(this);var t=e.attr("href");if(0===t.indexOf("mailto")||0===t.indexOf("skype"))return;if(t&&"#"!==t){r.push(this.outerHTML);e.attr("target",t);r[r.length-1]+="\n->\n"+this.outerHTML}else e.removeAttr("href")});if(TS.model&&TS.model.team&&TS.has_pri[h]&&TS.boot_data.feature_tinyspeck)if(r.length){TS.log(h,"#"+t.attr("id")+" had "+r.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to add targets it took "+(Date.now()-n)+"ms");TS.dir(h,r)}else TS.log(h,"#"+t.attr("id")+" had "+r.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to check it took "+(Date.now()-n)+"ms");TS.utility.makeSureAllExternalLinksAreRefererSafe(t)},sortTable:function e(t,n,r,i,a){r="desc"===r?"desc":"asc";a="desc"===a?"desc":"asc";function s(e){return function(t,n){var s=o(t,e);var l=o(n,e);if($.isNumeric(s)&&$.isNumeric(l)){if(s==l&&i){s=o(t,i);l=o(n,i);if($.isNumeric(s)&&$.isNumeric(l)){if(a!=r)return l-s;return s-l}if(a!=r)return TS.interop.i18n.sorter(l,s);return TS.interop.i18n.sorter(s,l)}return s-l}return TS.interop.i18n.sorter(s,l)}}function o(e,t){return $(e).children("td").eq(t).attr("data-sort-val")}var l=t.find("tr:gt(0)").toArray().sort(s(n));"desc"===r&&(l=l.reverse());for(var u=0;u<l.length;u+=1)t.append(l[u])},getPercSmartly:function e(t,n){if(!t||!n)return"0%";var r=t/n*100;if(100!=r&&100==Math.round(r))return"99%";if(r<.7)return"<1%";return Math.round(r)+"%"},isCursorWithinTBTs:function e(t){var n=TS.utility.contenteditable.cursorPosition(t);var r=TS.utility.contenteditable.value(t);var i=r.substr(0,n.end);var a=i.match(/```/g);if(!a)return false;var s=a.length;if(s%2)return true;return false},hex2rgb:function e(t){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:void 0},rgb2hex:function e(t){if(/^#[0-9A-F]{6}$/i.test(t))return t;var n=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);n||(n=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.?\d+)\)$/));if(!n)return;function r(e){return("0"+parseInt(e,10).toString(16)).slice(-2)}return"#"+r(n[1])+r(n[2])+r(n[3])},setImmediate:function e(t){u(t)},immediateDebounce:function e(t){var n=false;return function(){if(n)return;var e=this;var r=arguments;n=true;u(function(){n=false;t.apply(e,r)})}},debounce:function e(t,n){var r;return function(){var e=this;var i=arguments;clearTimeout(r);r=setTimeout(function(){t.apply(e,i)},n)}},debounceWithPromise:function e(t,n){var r;return function(){var e=this;var i=arguments;r&&r.cancel();r=new Promise(function(e){setTimeout(e,n)}).then(function(){return t.apply(e,i)});return r}},throttleFunc:function e(t,n,r){var i={};var a=function e(){var r=Array.prototype.slice.apply(arguments);var a=_.some(r,_.isObject);a&&TS.error("You're passing non-scalar arguments to a function throttled with TS.utility.throttleFunc; it will likely not work as you want");var s="f-"+r.join("-");if(i[s]&&i[s].context!==this)throw new Error("Cannot use this function with different `this` contexts across different calls "+this+" "+i[s].context);i[s]=i[s]||{requested:Date.now(),timeout:0,context:this};i[s].timeout||e.always_wait?i[s].requested=Date.now():t.apply(i[s].context,r);if(i[s].timeout)return;i[s].timeout=setTimeout(function e(){var a=Date.now()-i[s].requested;if(a>=n){t.apply(i[s].context,r);delete i[s]}else i[s].timeout=setTimeout(e,n-a)},n)};a.always_wait=!!r;return a},cmdKey:function e(t){if(!t)return false;if(TS.model.is_mac)return!!t.metaKey;return!!t.ctrlKey},looksLikeKeyboardShortcut:function e(t){var n=t.ctrlKey||t.altKey||t.metaKey;if(!n)return false;if(t.keyCode===TS.utility.keymap.alt||t.keyCode===TS.utility.keymap.ctrl||t.keyCode===TS.utility.keymap.cmd_ff||t.keyCode===TS.utility.keymap.cmd_other||t.keyCode===TS.utility.keymap.cmd_right)return false;var r=String.fromCharCode(t.keyCode);if(/^(\w|[$-/:-?{-~!"^_`[\]])$/i.test(r))return true;return true},isForwardDeleteKey:function e(t){if(t.keyCode===TS.utility.keymap.delete)return true;if(TS.model.is_mac&&t.ctrlKey&&"d"===t.key)return true;return false},isBoldKey:function e(t){if(!t)return false;return t.keyCode===TS.utility.keymap.b&&TS.utility.cmdKey(t)},isItalicKey:function e(t){if(!t)return false;return t.keyCode===TS.utility.keymap.i&&TS.utility.cmdKey(t)},throttle:function(){var e;var t;e={delay:200,timer_group:"generic"};t={timers:{},queues:{}};function n(e){var n;var r;if(t.timers[e]){if(t.queues[e])for(n=0,r=t.queues[e].length;n<r;n+=1)t.queues[e][n]&&t.queues[e][n]();t.queues[e]=null;t.timers[e]=null}}function r(r,i,a){if(!r)return false;i=i||e.timer_group;if(!t.timers[i]){a=a||e.delay;t.timers[i]=window.setTimeout(function(){n(i)},a)}t.queues[i]||(t.queues[i]=[]);t.queues[i].indexOf?-1===t.queues[i].indexOf(r)&&t.queues[i].push(r):t.queues[i].push(r)}return{method:r}}(),getImgProxyURL:function e(t,n,r){return TS.utility.getImgProxyURLWithOptions(t,{width:n,height:r})},getImgProxyURLWithOptions:function e(t,n){if(!t)return t;if(!TS.boot_data.image_proxy_url)return t;var r=TS.boot_data.image_proxy_url;if(0===t.indexOf(r))return t;var i=getRefererHidingWhiteList();var a;if(!n.emoji&&0===t.indexOf("https://")){a=t.replace(/^https:\/\//,"");var s=true;var o=TS.interop.url.getHostName(t,s);if(i&&-1!==i.indexOf(o)){if(n.stop_animations&&"slack-imgs.com"===o){var l=TS.interop.url.urlQueryStringParse(a).o1;var u;u=n.stop_animations||false===TS.prefs.getPref("a11y_animations")?l?l+".gu":"gu":l&&l.replace(/\.gu|gu/,"");return TS.interop.url.setUrlQueryStringValue(t,"o1",u)}return t}}if(0===t.indexOf("/img/"))return t;r=TS.interop.url.setUrlQueryStringValue(r,"c","1");var d=[];var c=parseInt(n.width,10);var _=parseInt(n.height,10);if(c&&_){d.push("wi"+c);d.push("he"+_);TS.boot_data.feature_use_imgproxy_resizing&&d.push("si")}n.rotate&&d.push("ro");n.render_svg&&d.push("sv2");n.convert_ico&&d.push("ip");(n.stop_animations||false==TS.prefs.getPref("a11y_animations"))&&d.push("gu");d.length>0&&(r=TS.interop.url.setUrlQueryStringValue(r,"o1",d.join(".")));return TS.interop.url.setUrlQueryStringValue(r,"url",t)},rAF:function(){var e=["ms","moz","webkit","o"];var t=window.requestAnimationFrame;var n;for(n=0;n<e.length&&!t;n+=1)t=window[e[n]+"RequestAnimationFrame"];if(!t){var r=0;return function(e){var t=Date.now();var n=Math.max(0,16-(t-r));var i=window.setTimeout(function(){e(t+n)},n);r=t+n;return i}}return function(e){return t.call(window,e)}}(),cancelRAF:function(){var e=["ms","moz","webkit","o"];var t=window.cancelAnimationFrame;var n;for(n=0;n<e.length&&!t;n+=1)t=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];if(!t)return function(e){clearTimeout(e)};return function(e){t.call(window,e)}}(),startAnimation:function e(t){return m.subscribe(t)},getLocationHashString:function e(t){t=t||document;var n=t.location.hash;if(n&&n.length)return n.substr(1);return n},getYoutubeIdFromURL:function e(t){var n="";t=t.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);if(void 0!==t[2]){n=t[2].split(/[^0-9a-z_-]/i);n=n[0]}else n=t;return n},loadUrlInWindowIfOnline:function e(t,n){n=n||document;var r=function e(r){if(r){$("body").addClass("hidden");n.location=t}else TS.generic_dialog.alert(TS.interop.i18n.t("You can\u2019t perform that action because you are not online :(","utility")())};return TS.api.call("api.test",{}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},externalURLsNeedRedirecting:function e(){if(TS.model.team&&TS.prefs.getTeamPref("hide_referers")&&!TS.model.is_our_app)return true;return false},swapInRedirUrlForIframe:function e(t,n){n=n||o();if(!n)return t;if(!n.iframe_redirect_type)return t;var r=$(t);var i=r.attr("src");if(!i)return t;"1"==TS.qs_args.test_iframe_referers&&(i="https://"+document.location.host+"/referertester.html?"+Date.now());i="https://"+TS.boot_data.redir_domain+"/link?v="+n.iframe_redirect_type+"&url="+encodeURIComponent(i);r.attr("src",i);t=r[0].outerHTML;"1"==TS.qs_args.test_iframe_referers&&TS.info("html with redir:"+t);return t},setCssFromHeightAndWidthAttrs:function e(t){if(!t)return;var n=$(t);n.css({height:n.attr("height"),width:n.attr("width")});return n[0].outerHTML},isArrowKey:function e(t){var n=TS.utility.keymap;if(t==n.down)return true;if(t==n.up)return true;if(t==n.right)return true;if(t==n.left)return true;return false},isPageKey:function e(t){var n=TS.utility.keymap;if(t==n.pageup)return true;if(t==n.pagedown)return true;if(t==n.home)return true;if(t==n.end)return true;return false},isNumericKey:function e(t){if(t>=48&&t<=57)return true;return false},getFileIDFromURL:function e(t){if(!t)return null;t=TS.utility.normalizeDevHost(String(t));var n=document.createElement("a");n.href=g;var r=n.host;var i=document.createElement("a");i.href=t;var a;try{a=_.trimStart(i.pathname,"/")}catch(e){var s=true;TS.console.logError(e,"invalid_pathname_bug input="+t+", files_url="+g,void 0,s);return null}var o=[r,"files.dev.slack.com","files.staging.slack.com","files.slack.com"];var l=TS.redux.enterprise.getEnterprise();l&&l.domain&&(TS.boot_data&&"dev"===TS.boot_data.version_ts?o.push(l.domain+".enterprise.dev.slack.com"):o.push(l.domain+".enterprise.slack.com"));if(-1===o.indexOf(i.host))return null;var u;var d;if(0===a.indexOf("files/")){d=a.split("/");if(d.length<3)return null;var c=d[1];if(!c)return null;if(!(!TS.boot_data.feature_deprecate_get_member_by_name&&TS.interop.members.getMemberByName(c)||TS.interop.members.getMemberById(c)))return null;u=d[2]}else{if(0!==a.indexOf("files-pri/"))return null;d=a.split("/");if(d.length<3)return null;var m=d[1];if(m.indexOf("-")<0)return null;var f=m.split("-");if(2!==f.length)return null;u=f[1]}if(!u)return null;if("F"!==u.substr(0,1))return null;if(u.length<2)return null;if(u.length>15)return null;return u},getMemberIdFromURL:function e(t){if(!t)return null;t=TS.utility.normalizeDevHost(String(t));var n;if(0===t.indexOf("/team/"))n=t.split("/team/");else{n=TS.utility.getPathFromSlackUrl(t);if(!n||n.length<2||"team"!==n[0])return null}var r=n[1];if(!r)return null;var i=TS.interop.members.getMemberById(r)||!TS.boot_data.feature_deprecate_get_member_by_name&&TS.interop.members.getMemberByName(r);if(i)return i.id;return null},normalizeDevHost:function e(t){return t.replace(/\.dev[0-9]*.slack.com/i,".dev.slack.com").replace(/\.staging.slack.com/i,".slack.com")},platformSupportsHtmlNotifications:function e(){if(TS.model.win_ssb_version&&window.winssb){if(window.winssb.app.canShowHtmlNotifications)return window.winssb.app.canShowHtmlNotifications();return false!==window.winssb.app.willUseHwAcceleration}return false},platformSupportsImgEmojiInHtmlNotifications:function e(){return TS.model.win_ssb_version&&(TS.model.win_ssb_version>.9||.9==TS.model.win_ssb_version&&TS.model.win_ssb_version_minor>=5)},findAllTeamEmojiInStr:function e(t,n){t=$.trim(t);var r=[];if(!t)return r;r=t.match(TS.emoji.getColonsRx())||r;var i=[];r=r.filter(function(e){if(TS.emoji.isValidName(e))return true;e.split("::").forEach(function(e){var t=TS.emoji.isValidName(e);if(!t)return;i.push(":"+t+":")});return false});r=r.concat(i);n&&(r=_.uniq(r));TS.dir(248,r);return r},areSimpleObjectsEqual:function e(t,r){if(t===r)return true;if(void 0===t&&r)return false;if(void 0===r&&t)return false;if(("undefined"===typeof t?"undefined":n(t))!==("undefined"===typeof r?"undefined":n(r)))return false;if(null===t&&r)return false;if(null===r&&t)return false;if(t.length!==r.length)return false;var i;for(i in r){if("undefined"===typeof t[i]&&"undefined"!==typeof r[i])return false;if(r[i])switch(n(r[i])){case"object":if(!e(t[i],r[i]))return false;break;case"function":if(String(r[i])!=String(t[i]))return false;break;default:if(r[i]!==t[i])return false}else if(t[i])return false}for(i in t)if("undefined"===typeof r[i]&&"undefined"!==typeof t[i])return false;return true},deepDiffObjects:function e(t,r){if(_.isEmpty(t))return{};if(_.isEmpty(r))return t;var i={};_.each(t,function(e,t){var a=r[t];if(a===e)return;if(("undefined"===typeof e?"undefined":n(e))!==("undefined"===typeof a?"undefined":n(a)))i[t]=e;else if(_.isArray(e))i[t]=_.difference(e,a);else if(_.isPlainObject(e)){var s=TS.utility.deepDiffObjects(e,a);_.isEmpty(s)||(i[t]=s)}else i[t]=e});return i},appendLogToUrlWithLimit:function e(t,n){if(!t)return t;t+=-1==t.indexOf("?")?"?":"&";if(!n)return t;var r=2e3-t.length;return t+n.substr(0,r)},makeWebWorker:function e(t,n){var r=URL.createObjectURL(new Blob(["(",t,")()"],{type:"application/javascript"}));var i=new Worker(r);URL.revokeObjectURL(r);i.onmessage=n;return i},strGetWordCount:function e(t){return t.trim().split(/\s+/).length},truncateToNearestWordBoundary:function e(t,n){t.string&&(t=t.string);if(t.length<=n)return t;var r="\u2026";var i=t.substring(0,n);var a=i.lastIndexOf(" ");if(a>0&&a>n-15)return i.substring(0,a)+r;return i.substring(0,i.length-1)+r},truncateAndEscape:function e(t,n){if(t.length<=n)return _.escape(t);return _.escape(t.substring(0,n-1))+"&hellip;"},truncateHTML:function(){var e;try{if(window.DOMParser){e=new DOMParser;e.parseFromString("","text/html")||(e=null)}}catch(t){e=null}function t(e,n,r){var i=_.toArray(n.childNodes);_.forEach(i,function(i){if(e>=r){n.removeChild(i);return}if(i.nodeType===Node.TEXT_NODE){var a=i.textContent;if(e+a.length>r){i.textContent=a.substring(0,r-e);e+=r-e}else e+=i.textContent.length}else e=t(e,i,r)});return e}return function(n,r){try{var i;if(e){var a=e.parseFromString(n,"text/html");i=a.body}else{var s=jQuery.parseHTML("<div>"+n+"</div>");i=s[0]}var o=t(0,i,r);if(o>=r){var l=document.createTextNode("\u2026");i.appendChild(l)}return i.innerHTML}catch(e){TS.error(e);return n}}}(),isSpaceClickEventSafe:function e(t,n){if(t.target){var r=$(t.target).closest("[href]");if(!r[0])return true;if(!r.closest(".post_body").length&&!r.closest("ts-rocket").length)return true;var i=r[0].protocol;if(i&&false===/^https?:$/.test(i)){TS.warn("not following bad link from a post preview");t.preventDefault();return false}if(r.data("original-href")){TS.warn("not following possibly spoofed link from a post preview");t.preventDefault();var s=r.data("referer-original-href")||r.attr("href");n||a(r.data("original-href"),r.attr("href"),s);return false}}return true},getCachedScript:function e(t,n){n=$.extend(n||{},{dataType:"script",cache:true,url:t});return jQuery.ajax(n)},disableElement:function e(t,n){t=$(t);t.attr("disabled",n);t.attr("aria-disabled",n)},enableFeatureForUser:function e(t){if(t<0||t>100){TS.warn("TS.utility.enableFeatureForUser() expects a number between 0 and 100");return false}return _.random(0,100)<t},roundToThree:function e(t){return+(Math.round(t+"e+3")+"e-3")},convertBytesToMegabytes:function e(t){return t/1024/1024},convertKilobytesToMegabytes:function e(t){return t/1024},queryIsMaybeSelf:function e(n){n=_.toLower(n);if("me"===n||"you"===n||n===t||n===i)return true;return false},openAuthenticatedInBrowser:function e(t){var n=null!==TS.model.desktop_app_version;if(n&&parseFloat(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor)>=2.6){var r=TS.boot_data.team_url+"web/open"+t;TSSSB.call("openAuthenticatedInBrowser",r)}else window.open(t)},getFontDescriptorForElement:function e(t){var n=t instanceof jQuery?t:$(t);return[n.css("font-style"),n.css("font-weight"),n.css("font-size"),n.css("font-family")].join(" ")},measureTextWidth:function e(t,n){if(!t)return 0;this._measure_text_width_canvas=this._measure_text_width_canvas||document.createElement("canvas");var r=this._measure_text_width_canvas.getContext("2d");r.font=n;return r.measureText(t).width},bytesInUnicodeCodePoint:function e(t){if(t<0||t>1114111)throw new RangeError("Invalid unicode code point {"+t+"}");if(t<128)return 1;if(t<2048)return 2;if(t<65536)return 3;if(t<=1114111)return 4},getRefererPolicy:o,uuidv4:function e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.floor(16*Math.random());var n="x"==e?t:t%4+8;return n.toString(16)})},exampleEmailAddress:function e(t){if("you"===t)return TS.interop.i18n.t("you@{example_com}","utility")({example_com:"example.com"});return TS.interop.i18n.t("name@{example_com}","utility")({example_com:"example.com"})},exampleWebAddress:function e(){return"example.com"},test:function e(){var t={clearAndGetRefererPolicy:function e(){s=void 0;return o()},getRefererPolicy:function e(){return o()}};Object.defineProperty(t,"_files_url",{get:function e(){return g},set:function e(t){g=t}});Object.defineProperty(t,"_team_url",{get:function e(){return S},set:function e(t){S=t}});return t}});var e;var t;var i;var a=function e(t,n,r){var i="";var a="";i+='<ts-icon class="ts_icon_warning yolk_orange small_right_margin"></ts-icon> ';i+=TS.interop.i18n.t("Caution: Tricky Link","utility")();a+="<p>";a+='  <span class="inline_block">'+TS.interop.i18n.t("The link you clicked (<strong>{url}</strong>) is tricky.","utility")({url:TS.interop.i18n.safeString(_.escape(r))})+"</span>";a+='  <span class="inline_block">'+TS.interop.i18n.t("It has been formatted to look like another web address (<strong>{url}</strong>).","utility")({url:TS.interop.i18n.safeString(_.escape(t))})+"</span>";a+="</p>";a+="<p>"+TS.interop.i18n.t("Are you sure you want to follow it?","utility")()+"</p>";TS.generic_dialog.start({title:i,body:a,show_cancel_button:false,show_secondary_go_button:true,secondary_go_button_text:TS.interop.i18n.t("Let\u2019s risk it","utility")(),secondary_go_button_class:"btn_outline",onSecondaryGo:function e(){window.open(n)},go_button_text:TS.interop.i18n.t("Take me back to safety","utility")(),esc_for_ok:true,enter_always_gos:true})};var s;function o(){if(!_.isUndefined(s))return s;var e=window.boot_data;if(!e){TS.warn("window.boot_data not available");s=null;return s}var t={iframe_redirect_type:4,redirect_type:3,rewrite_on_right_click:true};var n=TS.console&&TS.console.warn;if(!window.bowser){n&&TS.warn(8675309,"window.bowser undefined, defaulting to restrictive referrer policy");s=t;return s}if(bowser.chrome&&bowser.version>=4.1||bowser.opera&&bowser.version>=15){s={iframe_redirect_type:4,redirect_type:null,rewrite_on_right_click:false};return s}if(bowser.ie){s={iframe_redirect_type:4,redirect_type:3,rewrite_on_right_click:true};return s}if(bowser.firefox){s={iframe_redirect_type:bowser.version>=36?4:2,redirect_type:3,rewrite_on_right_click:bowser.version<36};return s}if(bowser.safari&&bowser.version>=5||navigator.userAgent.match(/(Slack_SSB)/g)){s={iframe_redirect_type:2,redirect_type:null,rewrite_on_right_click:false};return s}navigator.userAgent&&navigator.userAgent.match(/phantomjs/i)&&(n=false);n&&TS.warn(8675309,"browser not recognized, defaulting to restrictive referrer policy");s=t;return t}var l=null;window.getRefererHidingWhiteList=function(){if(l)return l;l=["slack.com","slack-files.com","slack-imgs.com",TS.boot_data.redir_domain];return l};var u=window.setImmediate;if(!u)if(window.MutationObserver){var d=document.createElement("div");var c=[];new MutationObserver(function(){var e=c.slice();c.length=0;e.forEach(function(e){e()})}).observe(d,{attributes:true});u=function e(t){c.length||d.setAttribute("yes","no");c.push(t)}}else u=function e(t){setTimeout(t,0)};var m=function(){var e=false;var t=[];function n(){if(!e)return;t.forEach(function(e){e()});TS.utility.rAF(n)}function r(r){var i={start:function i(){t.push(r);if(!e){e=true;TS.utility.rAF(n)}},stop:function n(){t.splice(t.indexOf(r),1);t.length||(e=false)}};i.start();return i}return{subscribe:r,subscribers:t,isRunning:function t(){return e}}}();var f=/([^.:/]+)(?:\.[^.]+)?\.slack\.com\/((?:messages|archives|unreads|threads|team)\/)/;var p=/(<a\b[^>]*)(>)/gi;var h=365;var g=null;var S=null})()},10028:function(e,t){(function(){TS.registerModule("enterprise",{onStart:function e(){if(!TS.boot_data.page_needs_enterprise)return;TS.client&&TS.interop.environment.isSSBAndAtLeastVersion("2.7")&&TS.redux.socket.connectedSig.add(n);TS.boot_data.feature_dark_qs&&(t=TS.utility.enableFeatureForUser(100))},promiseToSearchEnterpriseChannels:function t(n){var a=n.query,s=n.count;if(!TS.enterprise.isCrossWorkspacePrototypeEnabled()&&!TS.enterprise.isCrossWorkspacePrototypeDarkEnabled())return Promise.resolve();var o=!!a;i(!o);var l=r({query:a,count:s});if(!l)return Promise.resolve();var u=TS.api.callImmediately("enterprise.channels.search",l).then(function(t){_.get(t,"data.channels",[]).forEach(function(t){e[t.id]=t})}).catch(_.noop);if(!TS.enterprise.isCrossWorkspacePrototypeEnabled()&&TS.enterprise.isCrossWorkspacePrototypeDarkEnabled())return Promise.resolve();return o?u:new Promise(function(e){return u.then(e)})},getChannelById:function t(n){var r=e[n];return r&&!r.is_group?r:null},getGroupById:function t(n){var r=e[n];return r&&r.is_group?r:null},getChannels:function t(){if(!TS.enterprise.isCrossWorkspacePrototypeEnabled())return[];return _.reject(e,"is_group")},getGroups:function t(){if(!TS.enterprise.isCrossWorkspacePrototypeEnabled())return[];return _.filter(e,"is_group")},getModelObById:function e(t){if(!TS.boot_data.page_needs_enterprise)return TS.redux.channels.getEntityById(t);return TS.redux.channels.getEntityById(t)||TS.enterprise.getChannelById(t)||TS.enterprise.getGroupById(t)},isCrossWorkspacePrototypeEnabled:function e(){return TS.boot_data.page_needs_enterprise&&TS.boot_data.feature_enterprise_frecency&&TS.boot_data.feature_cross_workspace_quick_switcher_prototype},isCrossWorkspacePrototypeDarkEnabled:function e(){return TS.boot_data.feature_dark_qs&&t}});var e={};var t;var n=function e(t){if(t)return;if(!TS.shared.isRelevantTeam())return;var n=TSSSB.call("getSignedInTeamIds");var r=_.get(n,"length");var i=20;if(!r)return TS.warn("WTF did not find any teams in the desktop?");if(r>=i)return TS.warn("Will not auto add any more teams to the desktop.");var a=TS.prefs.getPref("enterprise_excluded_app_teams");var s=a?a.split(","):[];var o=_.difference(_.get(TS.model,"user.enterprise_user.teams",[]),n,s).slice(0,i-r);_.map(o,function(e){return TS.client.userAddedToTeam(e)})};var r=function e(t){var n=t.query,r=t.count;if(n)return{query:n,count:r};var i=100;var a="C";var s="G";var o=_(TS.ui.frecency.getMostCommonWithPrefix(a)).map("id").reject(TS.redux.channels.getEntityById).value().slice(0,i);var l=_(TS.ui.frecency.getMostCommonWithPrefix(s)).map("id").reject(TS.redux.channels.getEntityById).value().slice(0,i);var u=o.concat(l);if(u.length)return{channels:u,count:u.length};return null};var i=function t(n){n&&(e={})}})()},10030:function(e,t){(function(){TS.registerModule("format.texty",{convertContentsStringToDisplayString:function e(t){return TS.interop.texty.convertContentsStringToDisplayString(t,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText())}})})()},10035:function(e,t){(function(){TS.registerModule("tabcomplete.channels",{type:"channels",getMatch:function e(t){if(!_.isString(t))return;var n;var r;var i;if(TS.boot_data.feature_allow_cjk_autocomplete){r=Math.max(t.lastIndexOf("\uff03"),t.lastIndexOf("#"));i=/(^|\n|.)([#\uff03][^~`!@#\uff03$%^&*()+=[\]{}\\|;:'",.<>/?\s]*)$/i}else{r=t.lastIndexOf("#");i=/(^|\n|.)(#[^~`!@#$%^&*()+=[\]{}\\|;:'",.<>/?\s]*)$/i}var a=TS.interop.i18n.deburr(t);a.replace(i,function(e,i){if(!TS.tabcomplete.isAllowedSurroundingCharacter(i))return;n=t.substr(r,t.length-r)});if(!n)return;return{match:n,index:r}},shouldDisplayResults:function e(t,n){if(!t||_.isEmpty(n))return false;var r=t.replace(/^#/,"").toLowerCase();var i=1===n.length&&n[0].name===r;return!i},getResultAtIndex:function e(t,n){if(!t||!_.isNumber(n))return;return t[n]},getInsertData:function e(t){if(!t)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"channel"}}});var n="#"+t.name;return{text:n,ensure_preceding_space:true}},search:function i(a,s,o){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"channel"}}});if(TS.boot_data.feature_lazy_channels)n(a).then(function(n){var r=_.map(n,"model_ob");o(null,r);if(!e(a,r))return;return n.promise.then(function(e){var n=_.map(e,"model_ob");t(r,n)||o(null,n)})});else{var l=r(a);o(null,l)}},render:function e(t,n){var r=TS.templates.tabcomplete_channel_header({text:t});var i=TS.templates.tabcomplete_channel_results({results:n});return TS.tabcomplete.renderMenu(r,i)},onSelect:function e(t,n){if(!t)return;n||(n="");n=TS.boot_data.feature_allow_cjk_autocomplete?n.replace(/^(#|\uff03)/,""):n.replace(/^#/,"");TS.ui.frecency.record(t,n)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)}});var e=function e(t,n){t=TS.boot_data.feature_allow_cjk_autocomplete?t.replace(/^(#|\uff03)/,""):t.replace(/^#/,"");if(n&&1===n.length&&""+n[0].name===t)return false;return true};var t=function e(t,n){if(!n&&!t)return true;if(!n||!t)return false;if(t.length!==n.length)return false;return _.isEqualWith(t,n,function(e,t){return e.id===t.id})};function n(e){var t=TS.boot_data.feature_allow_cjk_autocomplete?e.replace(/^(#|\uff03)/,""):e.replace(/^#/,"");return TS.searcher.search(t,{channels:{include_archived:false},tiered:true,sort:{prefer_exact_match:true,frecency:true,allow_empty_query:true,search_previous_channel_names:true,prefer_channels_user_belongs_to:false},limit:25})}function r(e){var t;t={channels:TS.interop.redux.models.channels.getUnarchivedPublicAndPrivateChannels(TS.redux.getState()).filter(TS.interop.rules.channels.isPublicChannel)};var n={prefer_exact_match:true,frecency:true,limit:25,allow_empty_query:true,search_previous_channel_names:true};var r=e.replace(/^#/,"");var i=TS.sorter.search(r,t,n);return _.map(i,"model_ob")}})()},10036:function(e,t){(function(){TS.registerModule("tabcomplete.commands",{type:"commands",getMatch:function e(t,n,r){if(!_.isString(t))return;if(_.isNumber(r)&&0!==r)return;t.startsWith("\uff0f")&&(t="/"+t.substring(1));"/"===t&&TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_start",trigger:"slash_command"}}});var i;var a;TS.interop.i18n.deburr(t).replace(/^(\/\S*)$/i,function(e,n,r){a=r;i=t.substr(a,n.length)});if(!i)return;return{match:i,index:a}},getResultAtIndex:function e(t,n){if(!t||!_.isNumber(n))return;var r=_.flatMap(t,"cmds");return _.find(r,{index:n})},getInsertData:function e(t){if(!t)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_select",trigger:"slash_command"}}});if("last"===t.type)return TS.interop.texty.convertContentsStringToContents(t.cmd,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());return{text:t.name}},search:function t(n,r,i){if(TS.apps.permissions.areXoxaAppsInstalled()){i(null,e(n,r));var a=TS.cmd_handlers.getCmdAppUserIds();a.length&&TS.interop.membership.ensureChannelMembershipIsKnownForUsers(TS.model.active_cid,a).then(function(t){t&&i(null,e(n,r))})}else{var s=e(n,r);i(null,s)}},render:function e(t,n){var r=TS.templates.tabcomplete_command_header({text:t});var i=TS.templates.tabcomplete_command_results({results:n});return TS.tabcomplete.renderMenu(r,i)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},onSelect:function e(t,n){"client"===t.type&&TS.interop.clog.track("BUILTIN_CHAT_COMMAND_AUTOCOMPLETE",{locale:TS.interop.i18n.locale,search_term:n,slash_command_canonical_name:t.canonical_name||t.name,slash_command_name:t.name})}});function e(e,n){var r=t(n);var i=TS.interop.i18n.deburr(e.toLowerCase());i=TS.tabcomplete.trimTrailingCharacterModifier(i);i&&(r=r.filter(function(e){if(0===(e.normalized||e.name).indexOf(i))return true;if(e.canonical_name&&0===e.canonical_name.indexOf(i))return true;var t=e.localized_aliases||e.aliases;if(t)return t.some(function(e){var t=TS.interop.i18n.deburr(e);return 0===t.indexOf(i)});return false}));var a=_.map(r,"name");var s=TS.cmd_handlers.sortNames(a);var o;if("/"===i&&TS.chat_history.getCommands().length){var l=TS.chat_history.getCommands()[0].trim();var u=l.split(" ")[0];var d=TS.cmd_handlers.getAvailableUserCmds()[u]&&!n.in_thread;var c=d?1:0;o=s.map(function(e,t){return _.assign({index:t+c,name:e},TS.cmd_handlers[e])});var m=l;m=TS.interop.texty.convertContentsStringToDisplayString(l,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());if(d){var f={name:m,cmd:l,index:0,type:"last"};o.unshift(f);var p=TS.cmd_handlers.groupCmdsByType(o);var h=TS.interop.i18n.t("Last Used","command_tab_complete");p.unshift({name:h,id:"last",cmds:[f]});return p}return TS.cmd_handlers.groupCmdsByType(o)}o=s.map(function(e,t){return _.assign({index:t,name:e},TS.cmd_handlers[e])});return TS.cmd_handlers.groupCmdsByType(o)}function t(e){var t=TS.cmd_handlers.getAvailableUserCmds(e);var n=_.map(t,function(e,t){return _.assign({name:t},e)});return n}})()},10037:function(e,t){(function(){TS.registerModule("tabcomplete.emoji",{type:"emoji",getMatch:function e(t,n){if(!_.isString(t))return;var r;var i;var a=/(^|\n|[^+-])([+-]?[:|\uff1a][^~@#$%^&*()=[\]{}\\|!?`;:\uff1a",.<>/ ]*)$/i;t.replace(a,function(e,n,a,s){var o=n[n.length-1];if(!TS.tabcomplete.isAllowedSurroundingCharacter(o))return;if(n.trim()&&/^[+-]/.test(a)){a=a.slice(1);s+=1}i=s+n.length;r=t.substr(i,a.length)});if(!r)return;if(TS.emoji.getEmoticonsRx().test(r))return;if(!n&&!l(r,TS.interop.i18n.locale))return;return{match:r,index:i}},shouldDisplayResults:function e(t,n,r){if(!t||_.isEmpty(n)||_.isEmpty(n.results))return false;if(1===n.results.length&&r)return false;return true},getResultAtIndex:function e(t,n){if(!t||!t.results||!_.isNumber(n))return;var r=t.results[n];if(!r)return;return{action:t.action,emoji:r}},getInsertData:function e(t){if(!t||!t.emoji)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"emoji"}}});var n=":"+(t.emoji.display_name||t.emoji.name)+":";TS.utility.contenteditable.inlineEmojiIsEnabled()&&(n=":"+t.emoji.name+":");if(t.emoji.is_skin){var r=!TS.utility.contenteditable.inlineEmojiIsEnabled();n+=TS.emoji.getChosenSkinToneModifier(r)||""}var i=n;var a="";if("add_rxn"===t.action){i="+"+n;a="+"}else if("remove_rxn"===t.action){i="-"+n;a="-"}if(TS.utility.contenteditable.inlineEmojiIsEnabled())return{text:a,slackemoji:n};return{text:i}},getNextSelectedIndex:function e(a){var s;switch(a.keyCode){case TS.utility.keymap.right:s="right";break;case TS.utility.keymap.left:s="left";break;case TS.utility.keymap.up:s="up";break;case TS.utility.keymap.down:s="down";break;default:break}if(!s)return;var o=t(a.menu);if(1===o.length)return 0;if("right"===s)return a.selectedIndex<o.length-1?a.selectedIndex+1:0;if("left"===s)return a.selectedIndex>0?a.selectedIndex-1:o.length-1;if(a.keyCode===TS.utility.keymap.home||"up"===s&&a.metaKey)return 0;if(a.keyCode===TS.utility.keymap.end||"down"===s&&a.metaKey)return o.length-1;var l=_.map(o,function(e,t){var r=n(e);r.index=t;return r});var u=l[a.selectedIndex];var d=r(u,l,"down"===s);var c=i(u,d);if(!c){if("down"===s)return o.length-1;if("up"===s)return 0}return c.index},search:function t(n,r,i){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"emoji"}}});var o=/^(\+|-):/.test(n)?n[0]:"";var l=r.index;n=TS.emoji.normalizeSearchTerm(n);n=TS.tabcomplete.trimTrailingCharacterModifier(n);var u=a(n);var d;if(0===l&&o){var c=TS.shared.legacyGetActiveModelOb();var m=e(c);if("-"===o){var f=s(n,m);_.isEmpty(f)||(d={action:"remove_rxn",results:f})}else if("+"===o){var p=_.difference(u,m);_.isEmpty(p)||(d={action:"add_rxn",results:p})}}else d={action:"search",results:u};"U02592DNU"===TS.model.user.id&&TS.console.logError(JSON.stringify({query:n,results:d}),"emoji_tabcomplete_results");d&&!d.results.length&&(d=null);i(null,d)},render:function e(t,n){var r=TS.templates.tabcomplete_emoji_header({text:t,action:n.action});var i=_.map(n.results,function(e){return o(e,n.action)});var a=TS.templates.tabcomplete_emoji_results({results:i});return TS.tabcomplete.renderMenu(r,a)},onSelect:function e(t,n){if(!t||!t.emoji)return;n||(n="");n=n.replace(/^:/,"");TS.ui.frecency.record(t.emoji,n)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},test:function n(){var r={};Object.defineProperty(r,"_getResultElements",{get:function e(){return t},set:function e(n){t=n}});Object.defineProperty(r,"_getLocalResults",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(r,"_getPrevMsgRxns",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(r,"_sortResults",{get:function e(){return s},set:function e(t){s=t}});return r}});var e=function e(t){var n=TS.utility.msgs.getDisplayedMsgs(t.msgs);var r=_.find(n,function(e){return!e.is_ephemeral});if(!r)return;var i=TS.rxns.getMemberRxnsFromMessage(r,TS.model.user.id);var a=_.map(i,function(e){var t=e.name.replace(/(:.+)$/,"");return TS.emoji.getEmojiByName(t)});return _.compact(a)};var t=function e(t){if(!t)return[];return _.toArray(t.querySelectorAll(".tab_complete_ui_item"))};var n=function e(t){var n=t.offsetLeft;return{left:n,right:n+t.offsetWidth,top:t.offsetTop}};var r=function e(t,n,r){if(!t||!n||!n.length)return;var i=_.groupBy(n,"top");var a=_.map(_.keys(i),_.toNumber);var s=a.indexOf(t.top);var o=r?s+1:s-1;var l=a[o];return i[l]};var i=function e(t,n){if(!t||!n||!n.length)return;var r=n.filter(function(e){if(_.inRange(e.left,t.left,t.right))return true;if(_.inRange(e.right,t.left,t.right))return true;if(e.left<t.left&&e.right>t.right)return true;return false});if(!r)return;var i=_.maxBy(r,function(e){var n=Math.max(e.left,t.left);var r=Math.min(e.right,t.right);return r-n});return i};var a=function e(t){return s(t,TS.model.emoji_map)};var s=function e(t,n){if(!n||!n.length)return[];var r={emoji:n};var i={allow_empty_query:true,frecency:true,limit:50,prefer_exact_match:true};var a=t.replace(/^(\+|-)?:/,"");n=TS.sorter.search(a,r,i);return _.map(n,"model_ob")};var o=function e(t){var n=":"+(t.display_name||t.name)+":";var r={emoji_is_plain_text_only:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emoji:t,emoji_display_name_with_colons:n};if(t.is_skin){r.show_skin_tone_variant=t.is_skin;r.emoji_name_with_colons_and_skin=t.name_with_colons+TS.emoji.getChosenSkinToneModifier();r.emoji_display_name_with_colons_and_skin=n+TS.emoji.getChosenSkinToneModifier(true)}return r};var l=function e(t,n){switch(n){case"ja-JP":return t.length>=2;default:return t.length>=3}}})()},10038:function(e,t){(function(){TS.registerModule("tabcomplete.members",{type:"members",getMatch:function e(t,n,r,i){var a;var s;var o=/(^|\n|.)?((?:@|\uFF20)([^\n@\uFF20]*))$/i;t.replace(o,function(e,t,n,r,o){var l=TS.tabcomplete.isAllowedSurroundingCharacter(t)||i&&i.allowed_preceding_symbols&&-1!==i.allowed_preceding_symbols.indexOf(t);if(!l)return;if(r.length&&r.match(/^\s/))return;t&&(o+=t.length);a=n;s=o});if(!a&&n){var l=_.last(/(^|\s)([^\s\n@\uFF20]+)$/.exec(t));l=TS.tabcomplete.trimSurroundingSymbols(l);if(c(l,n)){a=l;s=t.length-l.length}}if(!a)return;return{match:a,index:s}},shouldDisplayResults:function e(t,n){if(!t||_.isEmpty(n))return false;return true},getResultAtIndex:function e(t,n){if(!t||!_.isNumber(n))return;TS.log(90211,"Getting result at index: "+n+"; User: "+(t[n]?t[n].id:""));return t[n]},getInsertData:function e(t){if(!t)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"member"}}});var n=TS.interop.texty.getDisplayTextForSearchResult(t);TS.log(90211,"Getting insert data for result: "+t.id);var r=TS.interop.texty.shouldHighlightMention(t.id,n,TS.model.user.id,TS.model.highlight_words);return{text:n,format:{slackmention:{id:t.id,label:n,mention:r}}}},search:function n(r,i,u){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"member"}}});var d=f(r,i.isUserSolicited);var c=m(d);var h;i.no_model_ob||(h=i.model_ob||TS.shared.legacyGetActiveModelOb());var g=l(h,i.no_model_ob);var S=TS.interop.userGroups.getActiveUserGroups();var T;i.complete_member_specials&&(T=TS.tabcomplete.members.getBroadcastKeywords(i.complete_member_specials));var v=a(h,r,{members:g,usergroups:S,broadcast_keywords:T},i.include_deleted);c(function(){u(null,v)});if(h){var b=_(g).map("id").without("USLACKBOT").value();if(b.length>e){var y=TS.boot_data.page_needs_enterprise?"W":"U";var w=TS.ui.frecency.getMostCommonWithPrefix(y,e);var k=_.map(w,"id");var C=_.intersection(b,k);var M=_.difference(b,C);b=C.concat(M.slice(0,e-C.length))}TS.log(1990,"Ensuring we have membership for "+b.length+" users in "+h.id+": "+b);TS.interop.membership.ensureChannelMembershipIsKnownForUsers(h.id,b).then(function(e){TS.log(1990,"Got membership for "+b.length+" users in "+h.id+"; any fetches required? "+e);e&&c(function(){u(null,v)})})}if(TS.model.team&&"T025LDE84"===TS.model.team.id&&r&&"h"===r.replace(/^@/,"")[0]){var I=v.map(function(e){return e&&e.id});if(-1===I.indexOf("U7T4Z7K8A")){var A=_.find(g,function(e){return e&&"U7T4Z7K8A"===e.id})||{};TS.logError({members:I.sort(),local_u7t_user_id:A.id||"NOT FOUND",local_u7t_user_stranger:A.is_stranger,local_u7t_user_deleted:A.deleted,local_u7t_user_name:A.name,local_u7t_user_display_name_lc:A._display_name_lc,local_u7t_user_real_name_lc:A._real_name_lc},"tabcomplete_shared_channel TS.tabcomplete.members.search local_results","T025LDE84")}}if(o(r,g,i)){var E={include_deleted:i.include_deleted,limit:t};var P=s(h,r,E);P.then(function(e){var t=_(g).concat(e).compact().uniqBy("id").value();TS.boot_data.page_needs_enterprise&&(t=t.filter(function(e){if(!e.enterprise_user||!e.enterprise_user.teams)return true;return e.enterprise_user.teams.length}));var n=a(h,r,{members:t,usergroups:S,broadcast_keywords:T},i.include_deleted);var s=[];if(h){var o=_.filter(n,"is_usergroup");s=_.reduce(o,function(e,t){var n=x(t.id,h.id);n.isResolved()||e.push(n);return e},[]);TS.interop.membership.ensureChannelMembershipIsKnownForUsers(h.id,_.map(n,"id"))}s.length?Promise.all(s).then(function(){c(function(){u(null,n)})}):p(v,n)||c(function(){u(null,n)});return null})}},render:function e(t,n,r){"@"!==t[0]&&"\uff20"!==t[0]&&(t="@"+t);var i=TS.templates.tabcomplete_member_header({text:t});var a;r.no_model_ob||(a=r.model_ob||TS.shared.legacyGetActiveModelOb());var s=n.map(function(e){if(e.is_broadcast_keyword)return e;if(e.is_usergroup)return d(a,e);return u(a,e,t)});var o=TS.templates.tabcomplete_member_results({results:s,is_client:!!TS.client});return TS.tabcomplete.renderMenu(i,o)},onSelect:function e(t,n){if(!t)return;n||(n="");n=n.replace(/^@/,"");TS.ui.frecency.record(t,n)},getIndexForPopulatingInput:function e(t,n){if(!w()){TS.tabcomplete.members.onSelectedIndexChange(t);return t}var r=$(".tab_complete_ui_item.active").data("index");var i=t;var a=t;var s=y(r,t,n);if(b()||T(t))if(s){i=S()-1;a=i}else{i=0;a=0}else if(_.isUndefined(n)&&v(t)){i=r;a=r}else if(!s&&v(t)){i=0;a=0}TS.tabcomplete.members.onSelectedIndexChange(a);return i},onSelectedIndexChange:function e(t){TS.log(90211,"Selected index changed to: "+t);TS.tabcomplete.onSelectedIndexChange(t)},getBroadcastKeywords:function e(t){var n=TS.utility.members.getBroadcastKeywordsForUser();_.isArray(t)&&(n=n.filter(function(e){return-1!==t.indexOf(e.id)}));return n},test:function e(){var t={IGNORED_SEARCH_TERMS:n,MIN_UNPREFIXED_MATCH_LENGTH:r};Object.defineProperty(t,"IGNORED_SEARCH_TERMS",{get:function e(){return n},set:function e(t){n=t}});Object.defineProperty(t,"_shouldDoAsyncSearch",{get:function e(){return o},set:function e(t){o=t}});Object.defineProperty(t,"_getLocalMembers",{get:function e(){return l},set:function e(t){l=t}});Object.defineProperty(t,"_sortResults",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(t,"SEARCH_DELAY_MS",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(t,"_ensureUserGroupMembersInModelObNumIsKnown",{get:function e(){return x},set:function e(t){x=t}});Object.defineProperty(t,"_getUserGroupMembersNotInModelObCount",{get:function e(){return C},set:function e(t){C=t}});return t}});var e=100;var t=25;var n=["the","and"];var r=3;var i=500;var a=function e(n,r,i,a){var s={allow_empty_query:true,frecency:true,limit:t,prefer_exact_match:true};var o=n&&!n.is_im;if(o){s.model_ob=n;s.prefer_channel_members=o}var l=r.replace(/^@/,"");var u=_.trimEnd(l);var d=TS.sorter.search(u,i,s);var c=_.map(d,"model_ob");var m=c;a&&(m=_.sortBy(m,function(e){return e.deleted}));return m};var s=function e(t,n,r){var i={query:n.replace(/^@/,""),max_api_results:r.limit,include_deleted:r.include_deleted,include_org:true,include_slackbot:true,include_self:true,full_profile_filter:false};r.include_deleted||(i.limit_by_model_relevancy=t);t&&!t.is_im&&(i.determine_membership_for_channel=t.id);return TS.members.promiseToSearchMembers(i).then(function(e){if(!e||!e.items||!e.items.length)return[];return e.items})};var o=function e(t,i,a){if(0!==t.indexOf("@")){if(-1!==n.indexOf(t))return false;if(t.length<r)return false;if(a.member_prefix_required)return false;return false}if(i&&i.length&&1===i.length&&"@"+i[0].name===t)return false;return true};var l=function e(t,n){var r=TS.members.getActiveMembersWithSelfAndSlackbot();TS.boot_data.page_needs_enterprise&&(r=r.filter(function(e){if(!e.enterprise_user||!e.enterprise_user.teams)return true;return e.enterprise_user.teams.length}));n||(r=r.filter(function(e){return TS.utility.members.isMemberRelevantToModel(e,t)}));if(!r||!r.length){var i="TS.tabcomplete.members@_getLocalMembers: no active members returned!";var a=["active_members:"+r,"guest_accessible_user_ids:"+TS.model.guest_accessible_user_ids.length].join(", ");TS.console.logError(i,a)}return r};var u=function e(t,n){var r=[];var i=[];var a;var s;a=TS.interop.members.getPrefCompliantMemberName(n,false,false);s=TS.interop.members.getMemberSecondaryName(n);r.push("primary_name");i.push("secondary_name");var o=t&&(!t.is_im||n.is_app_user);var l;var u;var d;if(o){d=TS.interop.membership.getCachedChannelMembershipInfoForUser(t.id,n.id);u=d.is_known;u&&(l=!d.is_member)}var c;if(TS.interop.members.isExternal(n)){var _=TS.teams.getTeamById(n.team_id);_&&_.name&&(c=_.name)}return{is_member:true,member:n,primary_name_classes:r.join(" "),secondary_name_classes:i.join(" "),show_channel_membership:o,member_does_not_belong_to_channel:l,secondary_name:s,primary_name:a,membership_status_is_known:u,team_name:c}};var d=function e(t,n){var r=0;t&&(r=C(n.id,t.id));return{description:n.description||n.name,is_usergroup:true,members_not_in_channel:r,usergroup:n}};var c=function e(t,i){if(!t)return false;if(i)return true;if(t.length<r)return false;if(_.includes(n,t.toLowerCase()))return false;return true};var m=function e(t){var n=Date.now()+t;return function(e){var t=Date.now();var r=Math.max(0,n-t);setTimeout(e,r)}};var f=function e(t,n){if(0===t.indexOf("@"))return 0;if(n)return 0;return i};var p=function e(t,n){if(!n&&!t)return true;if(!n||!t)return false;if(t.length!==n.length)return false;return _.isEqualWith(t,n,function(e,t){return e.id===t.id})};var h=function e(){return $(".tab_complete_ui_item")};var g="reveal_hidden_items";var S=function e(){var t=h();var n=t.index($("."+g));if(n)return n;return-1};var T=function e(t){var n=h();if(n.eq(t).hasClass("deleted"))return true;return false};var v=function e(t){var n=h();if(n.eq(t).hasClass(g))return true;return false};var b=function e(){var t=$(".active."+g);return-1!==h().index(t)};var y=function e(t,n,r){if(r)return r;if(0===t&&Math.abs(n-t)>1)return true;if(t-n===1)return true;return false};var w=function e(){if($(".tab_complete_ui_item.deleted").length)return true;return false};var k={};var x=function e(t,n){var r=TS.interop.userGroups.getUserGroupById(t);var i=false;var a=TS.interop.channels.getChannelById(n,i)||TS.interop.channels.getGroupById(n,i);if(!r||!a)return Promise.resolve();if(_.isUndefined(r.users)){if(!k[t]){k[t]=TS.user_groups.promiseToGetUserGroupMembers(t).then(function(e){if(e&&e.users)return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,e.users)}).finally(function(){delete k[t]});return k[t]}return k[t]}return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,r.users)};var C=function e(t,n){var r=TS.interop.userGroups.getUserGroupById(t);var i=_.get(r,"users.length");var a=false;var s=TS.interop.channels.getChannelById(n,a)||TS.interop.channels.getGroupById(n,a);if(!r||!s)return 0;if(_.isUndefined(r.users))return 0;var o=r.users.some(function(e){return!TS.interop.redux.models.membership.isMembershipKnownForUser(TS.redux.getState(),s.id,e)});if(o)return 0;var l=r.users.filter(function(e){var t=TS.interop.membership.getCachedChannelMembershipInfoForUser(s.id,e);return t.is_known&&t.is_member});return i-l.length}})()},10039:function(e,t){(function(){TS.registerModule("tabcomplete",{positionUIRelativeToInput:function e(t,n,r){if(!t||!n)return;var i=$(n).offset();t.style.left=i.left+"px";var a;if(r){var s=i.top+$(n).height()+2;t.style.top=s+"px";a=$(window).height()-s}else{t.style.bottom=$(window).height()-i.top+"px";a=i.top}var o=_.clamp(a-$(t).find(".tab_complete_ui_header").outerHeight()-2,454);$(t).find(".tab_complete_ui_scroller").css("maxHeight",o+"px")},render:function e(t,n,r,i){switch(t){case"members":return TS.tabcomplete.members.render(n,r,i);case"commands":return TS.tabcomplete.commands.render(n,r,i);case"emoji":return TS.tabcomplete.emoji.render(n,r,i);case"channels":return TS.tabcomplete.channels.render(n,r,i);default:TS.warn('TS.tabcomplete: unknown render type "'+t+'"')}},renderMenu:function e(t,n){return TS.templates.tabcomplete_menu({safe_header_html:new Handlebars.SafeString(t),safe_results_html:new Handlebars.SafeString(n)})},onSelectedIndexChange:function e(t){var n=$(".tab_complete_ui_item");n.removeClass("active");n.removeAttr("aria-selected");n.eq(t).addClass("active").attr("aria-selected","true");n.eq(t).scrollintoview({duration:0})},isAllowedSurroundingCharacter:function e(t){if(!t||!t.trim())return true;return""===TS.tabcomplete.trimSurroundingSymbols(t)},trimSurroundingSymbols:function e(t){if(!t)return"";return t.replace(n,"")},trimTrailingCharacterModifier:function e(t){if(!t)return"";return t.replace(r,"")},test:function t(){return{ALLOWED_PRECEDING_SYMBOLS:e}}});var e=["{","[","(","*","_","/",'"',"\u201c","'","\u2018","\u2019","<"];var t={hiragana:"\\u3040-\\u309F",katakana:"\\u30A0-\\u30FF",katakana_phonetic_extensions:"\\u31F0-\\u31FF",halfwidth_fullwidth_forms:"\\uFF00-\\uFFEF",cjk_ideographs:"\\u3400-\\u4DBF\\u4E00-\\u62FF\\u6300-\\u77FF\\u7800-\\u8CFF\\u8D00-\\u9FFF",cjk_radicals:"\\u2E80-\\u2EFF",cjk_kangxi_radicals:"\\u2F00-\\u2FDF",cjk_ideographic_description_characters:"\\u2FF0-\\u2FFF",cjk_punctuation:"\\u3001-\\u303F",cjk_strokes:"\\u31C0-\\u31EF",cjk_enclosed_letters_months:"\\u3200-\\u32FF",cjk_compatability:"\\u3300-\\u33FF\\uF900-\\uFAFF\\uFE30-\\uFE4F"};var n=function(e,t){var n=e.map(function(e){return"\\"+e});if(TS.boot_data.feature_allow_cjk_autocomplete)return new RegExp("^("+n.join("|")+"|["+_.values(t).join("")+"])+","g");return new RegExp("^("+n.join("|")+")+","g")}(e,t);var r=/[`\xb4\u02c6\xa8\u02dc]$/})()},10041:function(e,t){(function(){TS.registerComponent("ui.CurrentStatusInput",{_constructor:function e(t){this._onSave=t.onSave;this._onEscape=t.onEscape;this._onError=t.onError;this._$container=t.$parent.find(".current_status_input_container").addBack(".current_status_input_container");this._$emoji_input=t.$parent.find('[name="status_emoji"]');this._$inline_saver=t.$parent.find(".current_status_inline_saver");this._$input=t.$parent.find(".current_status_input");this._$action_buttons=t.$parent.find(".current_status_action_buttons");this._$cancel_button=this._$action_buttons.find(".current_status_cancel_button");this._$save_button=this._$action_buttons.find(".current_status_save_button");this._$status_emoji_picker=t.$parent.find(".current_status_emoji_picker");this._$status_clear_icon=t.$parent.find(".status_clear_icon");this._$status_clear_icon_wrap=t.$parent.find(".status_clear_icon_wrap");this._$presets_list=t.$parent.find(".current_status_presets");this._has_form_context=t.has_form_context;this._has_presets_menu=t.has_presets_menu;this._preset_index=t.preset_index;this._is_preset_editor=_.isNumber(this._preset_index);this._selected_emoji=this._getOriginalStatus().emoji;this._bindFunctions();this._bindEvents();this._toggleStatusClearIcon();this._startTexty();TS.ui.validation.validate(this._$input)},destroy:function e(){this._$input&&TS.utility.contenteditable.unload(this._$input);this._unbindEvents();this._$container=null;this._$emoji_input=null;this._$inline_saver=null;this._$input=null;this._$action_buttons=null;this._$cancel_button=null;this._$save_button=null;this._$status_clear_icon=null;this._$status_clear_icon_wrap=null;this._$status_emoji_picker=null;this._$presets_list=null;this._has_form_context=null;this._has_presets_menu=null;this._selected_emoji=null;this._preset_index=null;this._is_preset_editor=null;this._onSave=null;this._onEscape=null;this._onError=null},focus:function e(){this._$input&&this._$input.length&&TS.utility.contenteditable.setCursorAtEnd(this._$input)},getEscapedInputText:function e(){return _.escape(TS.emoji.maybeGetCanonicalEmojiString(TS.utility.contenteditable.value(this._$input).replace(/\t/g," ").trim()))},hasText:function e(){return!TS.utility.contenteditable.isEmpty(this._$input,true)},hasNewText:function e(){return this.getEscapedInputText()!==this._getOriginalStatus().text},isEdited:function e(){return this.hasNewText()||this._selected_emoji!==this._getOriginalStatus().emoji},isSaveable:function e(){return this.isEdited()},onEmojiSelected:function e(t){t=t||"";this._selectEmoji(t);this._toggleActionButtons();this._toggleStatusClearIcon();this.focus()},onTabComplete:function e(t,n){TS.utility.populateInput(this._$input,t,n);TS.ui.validation.validate(this._$input)},_bindFunctions:function e(){this._onFocus=this._onFocus.bind(this);this._onCancel=this._onCancel.bind(this);this._onKeydown=this._onKeydown.bind(this);this._onKeyup=this._onKeyup.bind(this);this._onBodyClick=this._onBodyClick.bind(this);this.clearCurrentStatus=this.clearCurrentStatus.bind(this);this._openEmojiPicker=this._openEmojiPicker.bind(this);this._presetChosen=this._presetChosen.bind(this);this._editCurrentStatus=this._editCurrentStatus.bind(this);this.onEmojiSelected=this.onEmojiSelected.bind(this);this.onTabComplete=this.onTabComplete.bind(this)},_bindEvents:function e(){this._$input.on("keydown.ui_current_status_input",this._onKeydown);this._$input.on("keyup.ui_current_status_input",this._onKeyup);this._$status_emoji_picker.on("click.ui_current_status_input",this._openEmojiPicker);this._$status_clear_icon.on("click.ui_current_status_input",this.clearCurrentStatus);this._$cancel_button.on("click.ui_current_status_input",this._onCancel);this._$save_button.on("click.ui_current_status_input",this._editCurrentStatus);this._has_presets_menu||this._$presets_list.on("click.ui_current_status_input",".current_status_preset_option",this._presetChosen)},_unbindEvents:function e(){this._$input&&this._$input.off(".ui_current_status_input");this._$status_clear_icon&&this._$status_clear_icon.off(".ui_current_status_input");this._has_presets_menu||this._$presets_list.off(".ui_current_status_input");this._$status_emoji_picker&&this._$status_emoji_picker.length&&this._$status_emoji_picker.off(".ui_current_status_input");this._$cancel_button&&this._$cancel_button.length&&this._$cancel_button.off(".ui_current_status_input");this._$save_button&&this._$save_button.length&&this._$save_button.off(".ui_current_status_input");this._maybeRemoveBodyClickHandler()},_getOriginalStatus:function e(){var t=TS.interop.members.getMemberCurrentStatus(TS.model.user,TS.team.getTeamCustomStatusPresets(),TS.boot_data.feature_i18n_custom_status);var n=this._is_preset_editor?TS.prefs.getTeamPref("custom_status_presets")[this._preset_index][0]:t.emoji;var r=this._is_preset_editor?TS.prefs.getTeamPref("custom_status_presets")[this._preset_index][1]:t.text;TS.boot_data.feature_i18n_custom_status&&!this._is_preset_editor&&(r=(_.find(TS.team.getTeamCustomStatusPresets(),function(e){return e.canonical===t.canonical})||{}).text||r);return{emoji:n,text:r}},_selectEmoji:function e(t){this._selected_emoji=t||"";this._$emoji_input.val(this._selected_emoji);this._$status_emoji_picker.find(".current_status_empty_emoji").toggleClass("hidden",!!this._selected_emoji);this._$status_emoji_picker.find(".current_status_emoji").html(TS.format.formatCurrentStatus(this._selected_emoji,void 0,{stop_animations:true,transform_missing_emoji:true,ignore_emoji_mode_pref:TS.interop.rules.emoji.shouldRenderEmojiAsText()}))},_onCancel:function e(){if(!this._has_form_context){this._maybeRemoveBodyClickHandler();this._restoreCurrentStatus();TS.utility.contenteditable.blur(this._$input);this._maybeHidePresetsMenu();_.isFunction(this._onEscape)&&this._onEscape(this._getOriginalStatus())}},_onFocus:function e(t){(!this.isEdited()||this._getSelectedPresetIndex()>-1||!(this.hasText()||this._selected_emoji))&&this._maybeShowPresetsMenu(t);this._maybeAddBodyClickHandler()},_onBodyClick:function e(t){if(TS.ui.react_emoji_menu.is_showing)return;if($.contains(this._$container.get(0),t.target))return;this._onCancel()},_onKeydown:function e(t){if(t.which===TS.utility.keymap.enter)t.stopPropagation();else if(t.which===TS.utility.keymap.tab)t.stopPropagation();else if(t.which===TS.utility.keymap.esc){t.stopPropagation();t.preventDefault()}},_onKeyup:function e(t){if([TS.utility.keymap.enter,TS.utility.keymap.esc,TS.utility.keymap.tab].indexOf(t.which)>-1)return;this._toggleStatusClearIcon();this._toggleActionButtons();this.isEdited()?this._maybeHidePresetsMenu():this._maybeShowPresetsMenu(t)},_maybeShowPresetsMenu:function e(t){if(this._has_presets_menu){TS.menu.startWithList(t,this._$presets_list,{onClick:this._presetChosen,close_on_click:true,ignore_bounds:true,attach_to_target_at_full_width:true,keep_menu_open_if_target_clicked_again:true});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)}},_maybeHidePresetsMenu:function e(){this._has_presets_menu&&TS.model.menu_is_showing&&TS.menu.end()},_maybeAddBodyClickHandler:function e(){!this._has_form_context&&this._has_presets_menu&&TS.utility.rAF(function(){$("body").on("click.ui_current_status_input",this._onBodyClick)}.bind(this))},_maybeRemoveBodyClickHandler:function e(){!this._has_form_context&&this._has_presets_menu&&$(document.body).off(".ui_current_status_input")},_getCanonicalStatus:function e(t){if(TS.boot_data.feature_i18n_custom_status)return(_.find(TS.team.getTeamCustomStatusPresets(),function(e){return e.text===t})||{}).canonical||null;return""},_getLocalizedStatus:function e(t){if(TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE)return TS.emoji.maybeGetLocalizedEmojiString(t);return t},_openEmojiPicker:function e(r){var i=$(r.target).closest(".current_status_emoji_picker").dimensions_rect();var a=!this._has_presets_menu;TS.ui.react_emoji_menu.start({e:r,callback:this.onEmojiSelected,position:a?"bottom-left":"top-left",offset_y:a?n:t,target_bounds:i})},_toggleActionButtons:function e(){this._$action_buttons.toggleClass("invisible",!this.isSaveable()||!this.hasText()&&!this._selected_emoji)},_toggleStatusClearIcon:function e(){this._$status_clear_icon_wrap.toggleClass("hidden",!this._selected_emoji&&!this.hasText())},_presetChosen:function e(t){var n=$(t.target).closest(".current_status_preset_option");var r=n.data("text")||"";var i=n.data("emoji")||"";TS.utility.contenteditable.value(this._$input,TS.format.unFormatMsg(r));this._selectEmoji(i);this._toggleStatusClearIcon();this._editCurrentStatus()},clearCurrentStatus:function e(){TS.utility.contenteditable.clear(this._$input);TS.ui.validation.validate(this._$input);this._selectEmoji("");this._toggleStatusClearIcon();this._toggleActionButtons();this._editCurrentStatus()},clogStatusChange:function t(n,r,i){var a={custom_status_set_origin:i};if(!n&&!r){a.custom_status="UNKNOWN";TS.interop.clog.track("CUSTOM_STATUS_CLEAR",a);return}var s=this._getSelectedPresetIndex(n,r);a.custom_status=s>-1?TS.prefs.getTeamPref("uses_customized_custom_status_presets")?"ADMIN_PRESET":e[s]:"USER_DEFINED";a.custom_status_text=n;a.custom_status_emoji=r;TS.interop.clog.track("CUSTOM_STATUS_SET",a)},clogPresetChange:function e(t,n){TS.interop.clog.track("CUSTOM_STATUS_ADMIN_PRESET_SET",{custom_status_text:t,custom_status_emoji:n,custom_status_preset:"ADMIN_PRESET_"+(this._preset_index+1)})},_getSelectedPresetIndex:function e(t,n){_.isUndefined(t)&&(t=this.getEscapedInputText());_.isUndefined(n)&&(n=this._selected_emoji);var r=TS.team.getTeamCustomStatusPresets();var i=_.findIndex(r,function(e){return e.text===t});var a=_.findIndex(r,function(e){return e.emoji===n});return i>-1&&i===a?i:-1},_restoreCurrentStatus:function e(){var t=this._getOriginalStatus();TS.utility.contenteditable.value(this._$input,TS.format.unFormatMsg(t.text));TS.ui.validation.validate(this._$input);this._selectEmoji(t.emoji);this._toggleStatusClearIcon();this._toggleActionButtons()},_editCurrentStatus:function e(){if(this._has_form_context)return Promise.resolve();if(!TS.ui.validation.validate(this._$input,{quiet:true,fast:true})){TS.ui.validation.validate(this._$input);return Promise.resolve()}if(!this.isSaveable())return Promise.resolve();this._maybeRemoveBodyClickHandler();var t=TS.emoji.maybeGetCanonicalEmojiString(TS.utility.contenteditable.value(this._$input).replace(/\t/g," ").trim());var n=this.getEscapedInputText();var r=this._selected_emoji||t&&TS.prefs.getTeamPref("custom_status_default_emoji");var i;this._has_presets_menu?i="FLEXPANE_PROFILE":this._has_form_context||(i="TEAM_MENU");var a;if(this._is_preset_editor)a=new Promise(function(e,n){return TS.prefs.setTeamPrefByAPI({custom_status_presets:this._getUpdatedPresets(t,this._selected_emoji)},n,["uses_customized_custom_status_presets"]).then(e)}.bind(this));else{var s={status_text:t,status_emoji:this._selected_emoji};TS.boot_data.feature_i18n_custom_status&&(s.status_text_canonical=this._getCanonicalStatus(t));var o={profile:JSON.stringify(s)};a=TS.api.call("users.profile.set",o)}a.then(function(){this._is_preset_editor?this.clogPresetChange(n,r):this.clogStatusChange(n,r,i)}.bind(this),function(e){_.isFunction(this._onError)&&this._onError(this._getOriginalStatus());e&&e.data&&"ratelimited"===e.data.error?TS.generic_dialog.alert(TS.interop.i18n.t("You\u2019re changing your status too often! You might have better luck if you try again in a few minutes.","current_status")()):TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","current_status")());this._$input&&this._restoreCurrentStatus();return e}.bind(this));TS.ui.inline_saver.show({target:this._$inline_saver,promise:a});_.isFunction(this._onSave)&&this._onSave({text:n,emoji:r});return a},_startTexty:function e(){var t=this._editCurrentStatus;var n=this._onCancel;var r=this._onFocus;var i=this._$input;var a=this._is_preset_editor?TS.interop.i18n.t("e.g. Gone to lunch","current_status")():TS.interop.i18n.t("What\u2019s your status?","current_status")();TS.utility.contenteditable.create(i,{modules:{tabcomplete:{completers:["emoji"],positionMenu:function e(t){t.style.width=i.outerWidth()+"px";t.style.minWidth=0;TS.tabcomplete.positionUIRelativeToInput(t,i)}},keyboard:{useFormattingCommands:false}},singleLineInput:true,placeholder:a,ariaLabel:TS.interop.i18n.t("What\u2019s your status?","current_status")(),onFocus:function e(){r(jQuery.Event("focus",{target:i,currentTarget:i}))},onEnter:function e(){t();return false},onEscape:function e(){n();return false},onTextChange:function e(){TS.ui.validation.validate(i)}});TS.utility.contenteditable.value(i,TS.format.unFormatMsg(this._getOriginalStatus().text));TS.utility.contenteditable.enable(i)},_getUpdatedPresets:function e(t,n){var r=[];var i=TS.prefs.getTeamPref("custom_status_presets");TS.boot_data.feature_i18n_custom_status&&(i=i.map(function(e){return e.slice(0,2)}));var a=i.slice(0,this._preset_index);var s=[n,t];var o=i.slice(this._preset_index+1);r=a;r.push(s);return r.concat(o)}});var e=["IN_A_MEETING","COMMUTING","OUT_SICK","VACATIONING","WORKING_REMOTELY"];var t=-5;var n=5})()},11186:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=n(11187);var i=n.n(r);var a=n(11188);var s=n.n(a);var o=n(11189);var l=n.n(o);var u=n(11190);var d=n.n(u);var c=n(11191);var _=n.n(c);var m=n(11192);var f=n.n(m);var p=n(11193);var h=n.n(p);var g=n(11194);var S=n.n(g);var T=n(11195);var v=n.n(T);var b=n(11196);var y=n.n(b);var w=n(11197);var k=n.n(w);var x=n(11198);var C=n.n(x);var M=n(11200);var I=n.n(M);var A=n(11201);var E=n.n(A);var P=n(11202);var F=n.n(P);var O=n(11203);var D=n.n(O);var $=n(11204);var H=n.n($);var B=n(11206);var j=n.n(B);var R=n(11207);var L=n.n(R);var N=n(11208);var U=n.n(N);var q=n(11209);var G=n.n(q);var W=n(11210);var z=n.n(W);var K=n(11211);var V=n.n(K);var Y=n(11212);var J=n.n(Y);var Q=n(11213);var X=n.n(Q);var Z=n(11214);var ee=n.n(Z);var te=n(11215);var ne=n.n(te);var re=n(11216);var ie=n.n(re);var ae=n(11217);var se=n.n(ae);var oe=n(11218);var le=n.n(oe);var ue=n(11219);var de=n.n(ue);var ce=n(11220);var _e=n.n(ce);var me=n(11221);var fe=n.n(me);var pe=n(11222);var he=n.n(pe);var ge=n(11223);var Se=n.n(ge);var Te=n(11224);var ve=n.n(Te);var be=n(11225);var ye=n.n(be);var we=n(11226);var ke=n.n(we);var xe=n(11227);var Ce=n.n(xe);var Me=n(11228);var Ie=n.n(Me);var Ae=n(11229);var Ee=n.n(Ae);var Pe=n(11230);var Fe=n.n(Pe);var Oe=n(11231);var De=n.n(Oe);var $e=n(11232);var He=n.n($e);var Be=n(11233);var je=n.n(Be);var Re=n(11234);var Le=n.n(Re);var Ne=n(11236);var Ue=n.n(Ne);var qe=n(11237);var Ge=n.n(qe);var We=n(11238);var ze=n.n(We);var Ke=n(11239);var Ve=n.n(Ke);var Ye=n(11240);var Je=n.n(Ye);var Qe=n(11241);var Xe=n.n(Qe);var Ze=n(11242);var et=n.n(Ze);var tt=n(11243);var nt=n.n(tt);var rt=n(10013);var it=n.n(rt);var at=n(11244);var st=n.n(at);var ot=n(11245);var lt=n.n(ot);var ut=n(11246);var dt=n.n(ut);var ct=n(11247);var _t=n.n(ct);var mt=n(11248);var ft=n.n(mt);var pt=n(11249);var ht=n.n(pt);var gt=n(11250);var St=n.n(gt);var Tt=n(11251);var vt=n.n(Tt);var bt=n(11252);var yt=n.n(bt);var wt=n(11253);var kt=n.n(wt);var xt=n(11254);var Ct=n.n(xt);var Mt=n(11255);var It=n.n(Mt);var At=n(11256);var Et=n.n(At);var Pt=n(11257);var Ft=n.n(Pt);var Ot=n(11258);var Dt=n.n(Ot);var $t=n(10012);var Ht=n.n($t);var Bt=n(11259);var jt=n.n(Bt);var Rt=n(11260);var Lt=n.n(Rt);var Nt=n(11261);var Ut=n.n(Nt);var qt=n(11262);var Gt=n.n(qt);var Wt=n(11263);var zt=n.n(Wt);var Kt=n(11264);var Vt=n.n(Kt);var Yt=n(11265);var Jt=n.n(Yt);var Qt=n(11266);var Xt=n.n(Qt);var Zt=n(11267);var en=n.n(Zt);var tn=n(11268);var nn=n.n(tn);var rn=n(11269);var an=n.n(rn);var sn=n(11270);var on=n.n(sn);var ln=n(11271);var un=n.n(ln);var dn=n(11272);var cn=n.n(dn);var _n=n(11273);var mn=n.n(_n);var fn=n(11274);var pn=n.n(fn);var hn=n(10028);var gn=n.n(hn);var Sn=n(11275);var Tn=n.n(Sn);var vn=n(11276);var bn=n.n(vn);var yn=n(11277);var wn=n.n(yn);var kn=n(11278);var xn=n.n(kn);var Cn=n(11279);var Mn=n.n(Cn);var In=n(11280);var An=n.n(In);var En=n(11281);var Pn=n.n(En);var Fn=n(11282);var On=n.n(Fn);var Dn=n(11283);var $n=n.n(Dn);var Hn=n(11284);var Bn=n.n(Hn);var jn=n(11285);var Rn=n.n(jn);var Ln=n(11286);var Nn=n.n(Ln);var Un=n(11287);var qn=n.n(Un);var Gn=n(11288);var Wn=n.n(Gn);var zn=n(13640);var Kn=n.n(zn);var Vn=n(11289);var Yn=n.n(Vn);var Jn=n(11290);var Qn=n.n(Jn);var Xn=n(11291);var Zn=n.n(Xn);var er=n(11292);var tr=n.n(er);var nr=n(11293);var rr=n.n(nr);var ir=n(11294);var ar=n.n(ir);var sr=n(10030);var or=n.n(sr);var lr=n(10039);var ur=n.n(lr);var dr=n(10038);var cr=n.n(dr);var _r=n(10035);var mr=n.n(_r);var fr=n(10036);var pr=n.n(fr);var hr=n(10037);var gr=n.n(hr);var Sr=n(10041);var Tr=n.n(Sr);var vr=n(11295);var br=n.n(vr);var yr=n(13641);var wr=n.n(yr)},11187:function(e,t){(function(){TS.registerModule("presence_manager",{sub_list_changed:new signals.Signal,onStart:function e(){i=true;p=TS.utility.enableFeatureForUser(1);o.length&&b();l.length&&y();TS.redux.socket.disconnectedSig.add(k);TS.redux.socket.connectedSig.add(w)},addPresenceList:function e(t){if(-1===a.indexOf(t)){a.push(t);t.added_sig.add(g);t.removed_sig.add(S)}},removePresenceList:function e(t){if(a.indexOf(t)>-1){a.splice(a.indexOf(t),1);t.added_sig.remove(g);t.removed_sig.remove(S)}},createNewPresenceList:function e(t){return new TS.PresenceList(t)},isSubscribedToMember:function e(t){return o.indexOf(t)>=0},queryMemberPresence:function e(t){_.isArray(t)?t.forEach(function(e){h(e)}):h(t);y()},periodicallyCheckPresenceConsistency:function e(t){_.isUndefined(t)&&(t=1e3);if(c){clearInterval(c);c=null}c=setInterval(x,t)},stopCheckingPresenceConsistency:function e(){c&&clearInterval(c);c=null},getSubList:function e(){return o.slice()},test:function e(){var t={getSubObject:function e(){var t={};var n;for(n in s)s[n]&&(t[n+" "+TS.interop.members.getMemberById(n).name]=s[n]);return t},getSubList:function e(){return o}};Object.defineProperty(t,"_is_first_connection",{get:function e(){return f},set:function e(t){f=t}});Object.defineProperty(t,"_handleConnect",{get:function e(){return w},set:function e(t){w=t}});Object.defineProperty(t,"_addMemberToQueryList",{get:function e(){return h},set:function e(t){h=t}});Object.defineProperty(t,"_sendSubList",{get:function e(){return b},set:function e(t){b=t}});Object.defineProperty(t,"_sendQueryList",{get:function e(){return y},set:function e(t){y=t}});return t}});var e="USLACKBOT";var t=1e3;var n=1300;var r=1300;var i=false;var a=[];var s={};var o=[];var l=[];var u=false;var d=false;var c;var m=false;var f=true;var p=false;var h=function e(t){if(o.indexOf(t)>-1)return;if(l.indexOf(t)>-1)return;l.push(t)};var g=function e(t){_.isArray(t)||(t=[t]);t.forEach(function(e){T(e)})};var S=function e(t){_.isArray(t)||(t=[t]);t.forEach(function(e){v(e)})};var T=function t(n){if(n===e)return;if(s[n])s[n]+=1;else{s[n]=1;o.push(n);b()}return null};var v=function e(t){if(s[t]){s[t]-=1;if(!s[t]){var n=o.indexOf(t);o.splice(n,1);b()}}return null};var b=function e(){if(!i||0===o.length||u)return null;if(!TS.redux.socket.isConnected())return;u=true;Promise.resolve().then(function(){u=false;p&&TS.metrics.count("presence_manager",o.length);if(o&&o.length>n){if(!m){TS.console.logError({},"presence_sub_list_too_long","List length is "+o.length);m=true}o=o.slice(0,n)}var e={type:"presence_sub",ids:o};TS.interop.SocketManager.send(e);TS.presence_manager.sub_list_changed.dispatch();return null})};var y=function e(){if(!i||0===l.length||d)return null;if(!TS.redux.socket.isConnected())return;d=true;Promise.resolve().then(function(){d=false;_.chunk(l,r).forEach(function(e){var t={type:"presence_query",ids:e};TS.interop.SocketManager.send(t)});l=[];return null})};b=_.throttle(b,t);y=_.throttle(y,t);var w=function e(t){if(TS.client&&!f&&!t){var n=_.map(TS.model.members,"id");var r=_.map(TS.model.bots,"id");var i=n.concat(r);i.forEach(function(e){h(e)})}f=false;b();y()};var k=function e(){TS.redux.socket.promiseToHaveOpenWebSocket().then(function(){b();y()})};var x=function e(){var t;var n=[];var r=[];var i=[];var a=Array.prototype.slice.call(document.querySelectorAll("[data-member-presence]"));a.forEach(function(e){t=e.getAttribute("data-member-presence");$(e).is(":visible")?r.push(t):i.push(t)});r=_.uniq(r);if(_.difference(r,o).length){var s=_.map(_.difference(r,o),TS.interop.members.getMemberById);TS.warn("There are members needing presence updates in the DOM that are not in the presence subscription list");TS.warn("Missing Names:",_.map(s,"name"));TS.warn("Missing Ids:",_.map(s,"id"))}n=_.uniq(r.concat(i));if(_.difference(o,n).length){var l=_.map(_.difference(o,n),TS.interop.members.getMemberById);TS.warn("There are members in the presence subscription list that are no longer in the DOM.");TS.warn("This might be fine if a longListView of members is showing, but once that list is removed these errors should go away.");TS.warn("Extra Names:",_.map(l,"name"));TS.warn("Extra Ids:",_.map(l,"id"))}}})()},11188:function(e,t){(function(){TS.registerModule("compression",{compress:function e(t,n,i,s){var o=Date.now();if(i){var l=LZString.compress(n);var u=Date.now()-o;TS.has_pri[a]&&TS.log(a,t+" took "+u+"ms to _compress immediately str.length: "+n.length);return s({k:t,str:l})}r(t,n,function(e,n){var r=Date.now()-o;TS.has_pri[a]&&TS.log(a,t+" took "+r+"ms for the compression worker to callback ("+n+"ms spent within the worker) result.length: "+e.length);s({k:t,str:e})})},deCompress:function e(t,n){return""},terminate:function t(){e&&e.terminate();e=null}});var e=null;var t=0;var n={};var r=function r(a,s,o){e||i();t+=1;var l="job_key"+t;n[l]=function(e,t){o(e,t);delete n[l]};e.postMessage({request:"compress",input:s,job_key:l,k:a})};var i=function t(){if(e){TS.error("_makeWorker but there is a _worker");return}var r=_.get(TS,"boot_data.vvv_paths.lz_string","/js/libs/lz-string-1.4.4.js");var i=TS.environment.is_dev;(TS.qs_args.local_assets||i)&&(r=location.protocol+"//"+location.host+r);e=TS.utility.makeWebWorker("function() {\t\t\tself.importScripts('"+r+"');\t\t\tself.onmessage = function(e) {\t\t\t\tvar start = Date.now();\t\t\t\tvar result;\t\t\t\tif (e.data.request === 'compress') {\t\t\t\t\tresult = LZString.compress(e.data.input)\t\t\t\t}\t\t\t\tvar elapsed = Date.now() - start;\t\t\t\tpostMessage({\t\t\t\t\trequest: e.data.request,\t\t\t\t\tresult: result,\t\t\t\t\tjob_key: e.data.job_key,\t\t\t\t\tk: e.data.k,\t\t\t\t\telapsed: elapsed\t\t\t\t});\t\t\t}\t\t}",function(e){var t=n[e.data.job_key];if(!t){TS.error("e.data.job_key:"+e.data.job_key+" had no record in _callbacks??");return}t(e.data.result,e.data.elapsed)})};var a=488})()},11189:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var e="STORAGE";TS.registerModule("storage",{version:"0.85",msgs_version:window.boot_data&&boot_data.cache_version||"unknown_version",cache_ts_version:window.boot_data&&boot_data.cache_ts_version||"unknown_version",do_compression:!TS.model.is_our_app&&"undefined"!==typeof window.Worker&&(!window.bowser||!bowser.phantom&&!bowser.msie),test:function e(){return{getLocalStorage:R,setLocalStorage:L,getKeys:k,set:B}},onStart:function t(){TS.storage.onStart=function(){};TS.storage.enterprise.start();if(!TS.storage.do_compression&&TS.boot_data.feature_force_ls_compression){TS.interop.console.info(e,"Special case: force-enabling LS compression for this session.");TS.storage.do_compression=true}TS.storage.version+=TS.storage.do_compression?"-compressed-LZString":"";var n=s||"1"==TS.qs_args.ls_disabled||!j||TS.boot_data&&TS.boot_data.ls_disabled||function(){if(!TS.storage.storageAvailable()){C();if(!TS.storage.storageAvailable()){TS.interop.console.info(e,"TS.storage.storageAvailable() = false in onStart after flushing all our keys, so disabling");return true}}return false}();if(TS.has_pri[G]){TS.log(G,"TS.storage.onStart should_disable:"+n);TS.log(G,"TS.storage.do_compression:"+TS.storage.do_compression+" (_ls.getItem('is_compressed') === 'yes'):"+(j&&"yes"===j.getItem("is_compressed")))}TS.ui.window_unloaded_sig.add(I);TS.ui.window_focus_changed_sig.add(A);TS.storage.setDisabled(n);B("rxn_records",null);if(TS.useReactMessages()){var r=TS.storage.fetchExpandableState();TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(r))}},setDisabled:function e(t){if(s==t)return;if(t||!j){s=true;j&&C()}else{s=false;x()}TS.log(G,"_disabled:"+s)},storageAvailable:function e(){if(!j)return false;try{var t="test_to_see_if_we_can_write_to_local_storage";j.setItem(t,"foo");j.removeItem(t);return true}catch(e){return false}},storageSize:function t(r){var i=0;if(!j)return i;var a=k();var s=0;var o;var l;for(var u=0;u<a.length;u+=1){s+=1;o=a[u];l=j.getItem(o);if(l||""===l){i+=l.length;r&&TS.info(o+"="+(2*l.length/1024).toFixed(2)+"KB (total="+(i/1024).toFixed(2)+"KB)")}else TS.interop.console.info(e,o+" not measurable value, typeof:"+("undefined"===typeof l?"undefined":n(l)))}r&&TS.info("total for "+s+" items is "+(i/1024).toFixed(2)+"KB");return i},completelyEmptyAllStorageAndReset:function e(){TS.info("completelyEmptyAllStorageAndReset running");M();TS.storage.storeLastEventTS("",true,true);var t=TS.storage.fetchLastEventTS(true);TS.info("completelyEmptyAllStorageAndReset fetched_b4_flush:"+t);if(t){TS.info("completelyEmptyAllStorageAndReset _getKeys:"+k().join(", "));TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(l).join(", "))}D(true,"completelyEmptyAllStorageAndReset");var n=TS.storage.fetchLastEventTS(true);TS.info("completelyEmptyAllStorageAndReset fetched_after_flush:"+n);if(n){TS.info("completelyEmptyAllStorageAndReset _getKeys:"+k().join(", "));TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(l).join(", "))}},flush:function e(t){TS.has_pri[G]&&TS.log(G,"TS.storage.flush()");C();t&&TS.storage.clearBufferAndCache()},clearBufferAndCache:function e(){TS.has_pri[G]&&TS.log(G,"TS.storage.clearBufferAndCache()");l={};u={};TS.compresion&&TS.compression.terminate()},fetchStorageVersion:function e(){return $("storage_version")},storeStorageVersion:function e(t){B("storage_version",t,true)},fetchCacheTSStorageVersion:function e(){return $("storage_cache_ts_version")},storeCacheTSStorageVersion:function e(t){B("storage_cache_ts_version",t,true)},_makeMsgInputId:function e(t){return"msg_input_"+t},fetchLastMsgInput:function e(t){return $(TS.storage._makeMsgInputId(t),null)},fetchLastMsgInputFromSSB:function e(n){if(!TS.storage.enterprise.supported())return;var r=TS.storage._makeMsgInputId(n);var i=t+"_"+r;return y[i]},storeLastMsgInput:function e(t,n){B(TS.storage._makeMsgInputId(t),n);TS.storage.enterprise.setLastMsgInput(t,n)},_makeCommentInputId:function e(t){return"comment_input_"+t},fetchLastCommentInput:function e(t){return $(TS.storage._makeCommentInputId(t),null)},storeLastCommentInput:function e(t,n){B(TS.storage._makeCommentInputId(t),n)},fetchOldestTs:function e(t){return $(a(t),null)},storeOldestTs:function e(t,n){B(a(t),n)},fetchActiveHistory:function e(){return $("active_history",[])||[]},storeActiveHistory:function e(t){B("active_history",t,true)},fetchLastEventTS:function e(t){return $("last_event_ts","",t)||""},storeLastEventTS:function e(t,n,r){B("last_event_ts",t,n,r)},fetchUIState:function e(){var t=$("ui_state",{})||{};_.isString(t)&&(t={});return t},storeUIState:function e(t){B("ui_state",t)},fetchExpandableState:function e(){var t=$("expandable_state",{});return t&&"object"===("undefined"===typeof t?"undefined":n(t))?t:{}},storeExpandableState:function e(t){B("expandable_state",t)},fetchClientWindows:function e(){return $("client_windows",{})||{}},storeClientWindows:function e(t){B("client_windows",t)},fetchInputHistory:function e(){var t=$("input_history",[])||[];"string"===typeof t&&(t=[t]);var n=300;t.length>n&&(t.length=n);return t},storeInputHistory:function e(t){B("input_history",t)},fetchCustomEmoji:function e(){return $("custom_emoji",null)||null},storeCustomEmoji:function e(t){B("custom_emoji",t)},fetchStaticTranslations:function e(){return $("static_translations",null)||null},storeStaticTranslations:function e(t){B("static_translations",t)},fetchApps:function e(){return $("apps",null)||null},storeApps:function e(t){B("apps",t)},fetchAppsSearchResults:function e(){return $("apps_search",null)||null},storeAppsSearchResults:function e(t){B("apps_search",t)},fetchCmds:function e(){return $("cmds",null)||null},storeCmds:function e(t){B("cmds",t)},fetchChannelPageState:function e(){return $("channel_page_state",{})||{}},storeChannelPageState:function e(t){B("channel_page_state",t)},fetchInvitesState:function e(){return $("invites_state",[])||[]},storeInvitesState:function e(t){B("invites_state",t)},fetchBriefingOpensCount:function e(){return Number($("briefing_opens_count",0))||0},storeBriefingOpensCount:function e(t){B("briefing_opens_count",t)},fetchReplyInput:function e(t,n){var r=$("reply_inputs")||[];var i=_.find(r,{model_ob_id:t,thread_ts:n});return i?i.text:""},storeReplyInput:function e(t,n,r){var i=10;var a=$("reply_inputs")||[];a=_.reject(a,{model_ob_id:t,thread_ts:n});a.length>i&&a.shift();a.push({model_ob_id:t,thread_ts:n,text:r});B("reply_inputs",a)},fetchFilterState:function e(){return $("team_filter_state","")||""},storeFilterState:function e(t){B("team_filter_state",t)},fetchCallsState:function e(){return $("calls_state",{})||{}},storeCallsState:function e(t){B("calls_state",t)},fetchFrecency:function e(t){return $("frecency_"+t)},storeFrecency:function e(t,n){B("frecency_"+t,n)},clearFrecency:function e(t){B("frecency_"+t,"")},fetchEnterpriseState:function e(){return $("enterprise_state",{})||{}},storeEnterpriseState:function e(t){B("enterprise_state",t)},fetchSidebarSectionState:function e(){return $("sidebar_section_state",{})},storeSidebarSectionState:function e(t){return B("sidebar_section_state",t)},enterprise:{supported:function e(){if(!TS.boot_data.feature_slackday_unsent_msg_sync||!TS.boot_data.page_needs_enterprise||!TS.model.is_our_app)return;if(!window.desktop||!window.desktop.enterpriseStorage)return;return true},start:function e(){if(!TS.storage.enterprise.supported())return;TS.storage.enterprise.initStorage();TS.storage.enterprise.subscribe()},initStorage:function e(){if(!TS.storage.enterprise.supported())return;var t=window.desktop.enterpriseStorage&&window.desktop.enterpriseStorage.storage;y=t||{};TS.storage.enterprise.processStorageData()},isEligibleChannel:function e(t){if("D"===t.charAt(0))return true;var n;if("C"===t.charAt(0)||"G"===t.charAt(0)){n=TS.redux.channels.getEntityById(t);if(!n)return;if(n.is_org_shared)return true;if(n.is_shared&&n.shared_team_ids&&n.shared_team_ids.length){var r=-1!==n.shared_team_ids.indexOf(TS.model.team.id);return r}}return false},makeLastMsgInputKey:function e(n){return""+t+TS.storage._makeMsgInputId(n)},getLastMsgInput:function e(t){if(!TS.storage.enterprise.supported())return;if(!TS.storage.enterprise.isEligibleChannel(t))return;var n=TS.storage.enterprise.makeLastMsgInputKey(t);var r=y[n]||"";return r},setLastMsgInput:function e(t,n){if(!TS.storage.enterprise.supported())return;if(!TS.storage.enterprise.isEligibleChannel(t))return;var r=TS.storage.enterprise.makeLastMsgInputKey(t);var i={last_msg_input:n};TS.storage.enterprise.set(r,i)},get:function e(t){if(!TS.storage.enterprise.supported())return;var n=window.desktop.enterpriseStorage.getItem(t);return n},set:function e(t,n){if(!TS.storage.enterprise.supported())return;window.desktop.enterpriseStorage.setItem(t,n)},subscribe:function e(){if(!TS.storage.enterprise.supported())return;window.desktop.enterpriseStorage.addListener("update",TS.storage.enterprise.storageUpdatedFromSSB)},updateStorageData:function e(t){var n=w(t);if(!n)return;if(!TS.storage.enterprise.isEligibleChannel(n))return;var r=TS.storage.enterprise.get(t);y[t]=r},storageUpdatedFromSSB:function e(t){if(!TS.storage.enterprise.supported())return;if(!t)return;t.added&&t.added.length&&t.added.forEach(function(e){TS.storage.enterprise.updateStorageData(e)});t.updated&&t.updated.length&&t.updated.forEach(function(e){TS.storage.enterprise.updateStorageData(e)});t.deleted&&t.deleted.length&&t.deleted.forEach(function(e){delete y[e]});TS.storage.enterprise.processStorageData()},processStorageData:function e(){if(!TS.storage.enterprise.supported())return;var t=TS.shared.legacyGetActiveModelOb();Object.keys(y).forEach(function(e){var n=w(e);var r=TS.redux.channels.getEntityById(n);if(!r)return;var i=y[e];if(!i||void 0===i.last_msg_input)return;if(r.last_msg_input===i.last_msg_input)return;r.last_msg_input=i.last_msg_input;r.has_draft=i.last_msg_input.length;n===t.id&&(i.last_msg_input.length?TS.client.msg_input.populateWithLast():TS.client.msg_input.populate(""))})}}});var t=window.boot_data.user_id+"_";var r="channel_msgs_";var i="oldest_msg_ts_";var a=function e(t){return i+t};var s;var o=false;var l={};var u={};var d=1e3;var c=false;var m=1e3;var f=false;var p=1e3;var h=false;var g=false;var S=null;var T=3e5;var v=1e4;var b=1e3;var y={};var w=function e(t){if(!t||!t.length)return;var n=t.split&&t.split("_");if(!n||!n.length)return;var r=n[n.length-1];return r};var k=function e(){var t=[];if(!j)return t;var n=j.length;if(!n)return t;for(var r=0;r<n;r+=1)t.push(j.key(r));return t};var x=function n(){var r;if(!s){var i=TS.storage.fetchStorageVersion()||"";var a=-1!=i.indexOf("-compressed")||"yes"===j.getItem("is_compressed");if(TS.storage.do_compression&&!a){TS.interop.console.info(e,"migrating to compressed format");r=k();r.forEach(function(e){var n=e.replace(t,"");var r=H(e,j.getItem(e));var i="converting: "+e+" -> "+n+" val.length: "+(void 0===r||null===r?-1:String(r).length);B(n,null);B(n,r);$(n)==r?TS.has_pri[G]&&TS.log(G,i+" SUCCESS _get(name) has a value:"+!!$(n)+", and it it the same as val"):TS.error(i+" FAILURE _get(name) !== val")});TS.interop.console.info(e,"migration to compressed format complete, "+r.length+" migrated");TS.storage.storeStorageVersion(TS.storage.version)}else TS.has_pri[G]&&TS.log(G,"no migration needed");j.setItem("is_compressed",TS.storage.do_compression?"yes":"no")}var o=TS.storage.fetchCacheTSStorageVersion();TS.has_pri[G]&&TS.log(G,"storage_cache_ts_version:"+o);var l=TS.storage.fetchStorageVersion()||"";if(TS.has_pri[G]){TS.log(G,"TS.storage.version:"+TS.storage.version);TS.log(G,"storage_version:"+l);TS.log(G,"TS.storage last_unload_flushing: "+$("last_unload_flushing"));TS.log(G,"TS.storage.storageAvailable(): "+TS.storage.storageAvailable())}r=k();TS.has_pri[G]&&TS.dir(G,r,"_getKeys()");if(TS.storage.storageAvailable()){if(l!=TS.storage.version){TS.log(G,"storage_version:"+l+" does not match TS.storage.version:"+TS.storage.version+" so flushing all our keys: "+r.join(", "));C()}else if(!TS.storage.fetchLastEventTS()){TS.log(G,"TS.storage.fetchLastEventTS() is empty so flushing channel data");M()}}else{TS.log(G,"TS.storage.storageAvailable() = false so flushing all our keys");C()}TS.storage.storeStorageVersion(TS.storage.version);TS.redux.socket.connectedSig.addOnce(E)};var C=function e(){k().forEach(function(e){0===e.indexOf(t)&&j.removeItem(e)})};var M=function e(){var n=k();TS.has_pri[G]&&TS.log(G,n,"_getKeys()");var a;for(var s=0;s<n.length;s+=1){a=n[s];if(0!==a.indexOf(t))continue;if(-1==a.indexOf(r)&&-1==a.indexOf(i))continue;j.removeItem(a);delete l[a]}for(a in l){if(0!==a.indexOf(t))continue;if(-1==a.indexOf(r)&&-1==a.indexOf(i))continue;delete l[a]}u={};n=k();TS.dir(488,n,"_getKeys()")};var I=function e(){o=true;B("last_unload_flushing",(new Date).toString(),true);D(true,"_windowUnloaded");TS.compression.terminate()};var A=function e(){D(true,"_windowBlurred")};var E=function e(){if(S){window.clearInterval(S);S=null}S=window.setInterval(P,T)};var P=function e(){if(!TS.model)return;var t=Object.keys(l).length;if(!t)return;var n=false;var r="";if(!TS.model.ui.is_window_focused){r="window blurred!";n=true}var i=Date.now()-TS.model.client.last_user_active_timestamp;if(!n&&i>=v){r="window focused, but user has been idle long enough "+i+" >= "+v;n=true}TS.has_pri[G]&&TS.log(G,"_maybeFlushBuffer ok_to_flush_all:"+n);if(n){D(true,"maybeFlushBuffer ("+t+") "+r);return}var a=i>b;TS.has_pri[G]&&TS.log(G,"_maybeFlushBuffer ok_to_flush_some:"+a);r="window focused, but user has been idle long enough "+i+" >= "+b;a&&D(false,"maybeFlushBuffer ("+t+") "+r)};var F=function e(t){return"string"!==typeof t&&"number"!==typeof t&&t?JSON.stringify(t):t};var O=function e(t){if("undefined"===t)return null;if("null"===t)return null;return t};var D=function e(t,n){if(s)return;var r=new Date;var i=Date.now();var a;var o=0;var d;var c=TS.model&&TS.model.team&&TS.model.team.domain&&TS.boot_data.feature_tinyspeck;var _;var m;var f;var S;var T;for(d in l){if(l[d].being_flushed)continue;S=F(l[d].val);if(void 0===S||null===S){j.removeItem(d);delete l[d];delete u[d]}else try{N(d,S)}catch(e){TS.error(0,e);C();delete l[d];delete u[d];continue}o+=1;a=Date.now()-i;c&&TS.has_pri[G]&&TS.log(G,"_flushBuffer _ls.setItem "+d+": "+a+"ms "+(l[d]&&l[d].val&&l[d].val.toString?l[d].val.toString().substr(0,100):"NULL?"));if(!t){_=new Date-r;if(!h&&_>p){h=true;f=new Date;try{m=TS.storage.storageSize()}catch(e){}f=new Date-f;T="Took "+_+"ms for "+o+" item (!all case) (threshold is "+p+" ms). Key: "+d+". Buffer length: "+(l[d]&&l[d].val&&l[d].val.toString()?l[d].val.toString().length:"unknown (not a string)")+". localStorage size: "+(m||"unknown")+". Time to read LS size: "+f;TS.info("_flushBuffer exceeded slow write threshold: "+T)}}l[d]&&(l[d].being_flushed=true);if(!t){TS.has_pri[G]&&TS.log(G,"_flushBuffer: Wrote one item. why: "+n);return}u={}}if(o&&!g){_=new Date-r;if(_>p){g=true;try{m=TS.storage.storageSize()}catch(e){}T="Took "+_+"ms for "+o+" items (threshold is "+p+" ms). localStorage size: "+m+". App open for "+((Date.now()-TS.boot_data.start_ms)/1e3/60).toFixed(2)+" min. why: "+n;TS.info("_flushBuffer exceeded slow write threshold (all case): "+T)}}TS.has_pri[G]&&(0===o?TS.log(G,"_flushBuffer: Nothing to save."):TS.log(G,"_flushBuffer: Saved "+o+(1===o?" item":" items")+" why: "+n))};var $=function e(n,r,i){var a=t+n;i&&TS.info("_get name:"+n+" k:"+a+" disabled:"+s+' _buffer["'+a+'"].val:'+(l[a]&&l[a].val));if(s)return l[a]&&l[a].val||r;if(a in l)return l[a]&&l[a].val||r;if(u.hasOwnProperty(a))return u[a];var o=H(a,q(a,j.getItem(a)),r,i);u[a]=o;return o};var H=function e(t,r,i,a){var s=new Date;var o=O(r);a&&TS.info("_get _correctBadValsFromStorage(_ls.getItem(k)) k:"+t+" typeof result:"+("undefined"===typeof o?"undefined":n(o))+" /^[{[]/.test(result):"+/^[{[]/.test(o));var l;o&&"string"===typeof o&&/^[{[]/.test(o)&&(o=TS.utility.parseJSONOrElse(o)||o);o=o||(void 0!==i?i:null);s=new Date-s;if(!c&&s>d){c=true;try{l=TS.storage.storageSize()}catch(e){}var u="_get took longer than threshold: Took "+s+"ms to read "+t+" (theshold is "+d+"ms), length = "+(o&&!isNaN(o.length)?o.length:"unknown")+". Storage size: "+l;TS.info(u)}return o};var B=function n(r,i,a,o){var d=false;var c=new Date;var _;var p=t+r;l[p]={val:i,being_flushed:false};u[p]=l[p].val;o&&TS.info("_set immediate:"+a+" name:"+r+" k:"+p+" disabled:"+s+" do_compression:"+TS.storage.do_compression+' _buffer["'+p+'"].val:'+l[p].val);if(a){if(!s){var h=F(i);if(void 0===h||null===h){j.removeItem(p);delete l[p]}else try{N(p,h,a)}catch(e){TS.interop.console.warn("_set _ls.setItem failed, flushing. TS.storage.storageSize():"+TS.storage.storageSize(false));d=true}}o&&TS.info("_set failed:"+d);if(!d){o&&TS.info('_set _buffer["'+p+'"]:'+(l[p]&&JSON.stringify(l[p])));c=new Date-c;if(c>m){TS.interop.console.info(e,"_set immediately "+r+": "+c+"ms "+(i&&i.toString?i.toString().substr(0,100):"NULL?"));if(!f){f=true;try{_=TS.storage.storageSize()}catch(e){}var g="_set exceeded slow set threshold (immediate): Took "+c+"ms to write "+p+" (theshold is "+m+"ms), length = "+(i&&!isNaN(i.length)?i.length:"unknown")+". Storage length: "+_;TS.info(g)}}else TS.has_pri[G]&&TS.log(G,"_set GOOD immediately: "+a+" "+r+": "+c+"ms",i)}}};var j=window.localStorage;var R=function e(){return j};var L=function e(t){j=t};var N=function e(t,n,r){n=String(n);if(TS.storage.do_compression){TS.compression.compress(t,n,r||o,U);return}U({k:t,str:n})};var U=function t(r){j.setItem(r.k,r.str);var i=function t(i){var a=j.getItem(r.k);if(a===r.str){i>1&&TS.interop.console.info(e,r.k+" now saved, try #"+i);delete l[r.k];delete u[r.k];return}if(i>1&&(!l[r.k]||l[r.k].val!=r.str)){TS.error("buffer changed for "+r.k+" so we don't care anymore, a new value is being set for it, try #"+i);return}TS.error("WTF not saved, try #"+i+" "+r.k+" "+(r.str||"").length+" typeof ob.str:"+n(r.str)+" from_ls:"+("undefined"===typeof a?"undefined":n(a)));j.setItem(r.k,r.str);setTimeout(t,1e3,i+1)};i(1)};var q=function e(t,r){if(!TS.storage.do_compression){if("\u4000"===r){TS.console.logError({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:n(window.Worker),has_bowser:!!window.bowser},"decompress_empty_string_fail");return""}return r}var i=Date.now();r&&(r=LZString.decompress(r));var a=Date.now()-i;r&&TS.has_pri[G]&&TS.log(G,t+" took "+a+"ms to _decompress str.length: "+r.length);if("\u4000"===r){TS.console.logError({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:n(window.Worker),has_bowser:!!window.bowser},"decompress_double_compressed_fail");return""}return r};var G=488})()},11190:function(e,t){(function(){TS.registerModule("api",{paused_sig:new signals.Signal,unpaused_sig:new signals.Signal,Q_empty_sig:new signals.Signal,onStart:function e(){if(TS.boot_data.page_needs_enterprise){a.push("enterprise.channels.search");c.push("enterprise.channels.search")}},test:function e(){var t={_one_at_a_time_methodsA:d,_ensure_model_methodsA:a,_pause:le,_unPause:ue,_pauseUntilAPIConnectionRestored:me,_promisify:Y,_getMaxAttempts:I,_incrementPending:E,_decrementPending:P,_getDefaultArgsByMethodName:O,_kickOffACallOrEnqueue:D,_callOutsideHandler:G,_nextFromQ:B,_reQueue:W,_calculateHTTPErrorDelayMs:z,_makeLogSafeMethodName:K,_logError:q,_getAPIErrorObject:V,_maybeShowConnectivityWarning:ie,_one_at_a_time_Q:g};Object.defineProperty(t,"_pauseFor",{get:function e(){return _e},set:function e(t){_e=t}});Object.defineProperty(t,"_pauseUntilBackOnline",{get:function e(){return fe},set:function e(t){fe=t}});Object.defineProperty(t,"_pauseUntilServiceIsUp",{get:function e(){return pe},set:function e(t){pe=t}});Object.defineProperty(t,"_maybePauseUntilServiceIsUp",{get:function e(){return ge},set:function e(t){ge=t}});Object.defineProperty(t,"_one_at_a_time_call_pending",{get:function e(){return h},set:function e(t){h=t}});Object.defineProperty(t,"_is_paused",{get:function e(){return T},set:function e(t){T=t}});Object.defineProperty(t,"_ensure_model_methodsA",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(t,"_one_at_a_time_methodsA",{get:function e(){return d},set:function e(t){d=t}});Object.defineProperty(t,"_max_attempts",{get:function e(){return y}});Object.defineProperty(t,"_pending",{get:function e(){return f},set:function e(t){f=t}});Object.defineProperty(t,"_pause_secs",{get:function e(){return v},set:function e(t){v=t}});Object.defineProperty(t,"_maybeTimingClearMarks",{get:function e(){return te},set:function e(t){te=t}});Object.defineProperty(t,"_maybeTimingCount",{get:function e(){return X},set:function e(t){X=t}});Object.defineProperty(t,"_maybeTimingMark",{get:function e(){return Z},set:function e(t){Z=t}});Object.defineProperty(t,"_maybeTimingMeasure",{get:function e(){return ee},set:function e(t){ee=t}});Object.defineProperty(t,"_maybeShowConnectivityWarning",{get:function e(){return ie},set:function e(t){ie=t}});Object.defineProperty(t,"_default_api_args",{get:function e(){return r},set:function e(t){r=t}});Object.defineProperty(t,"_default_api_args_by_method",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(t,"_kickOffACall",{get:function e(){return $},set:function e(t){$=t}});Object.defineProperty(t,"_kickOffACallOrEnqueue",{get:function e(){return D},set:function e(t){D=t}});Object.defineProperty(t,"_last_connectivity_warning_time",{get:function e(){return re},set:function e(t){re=t}});Object.defineProperty(t,"_api_queue_depth_warning_threshold",{get:function e(){return ne},set:function e(t){ne=t}});Object.defineProperty(t,"_main_Q",{get:function e(){return p},set:function e(t){p=t}});Object.defineProperty(t,"_one_at_a_time_Q",{get:function e(){return g},set:function e(t){g=t}});Object.defineProperty(t,"_makeRequest",{get:function e(){return H},set:function e(t){H=t}});return t},call:function e(r,i,a,s,o){if(TS.boot_data.feature_modern_api_q){if("function"===typeof a){TS.console.logStackTraceToBackEnd("Using `TS.api.call` with a `handler` callback is deprecated.",t,n);return TS.interop.api.callWithDeprecatedHandler(r,i,a)}return TS.interop.api.call(r,i)}return D(r,i,a,s,o)},callImmediately:function e(r,i,a,s,o){if(TS.boot_data.feature_modern_api_q){if("function"===typeof a){TS.console.logStackTraceToBackEnd("Using `TS.api.callImmediately` with a `handler` callback is deprecated.",t,n);return TS.interop.api.callExpeditedWithDeprecatedHandler(r,i,a)}return TS.interop.api.callExpedited(r,i)}var l=true;if(-1!=d.indexOf(r)&&h){TS.warn(r+" cannot be called with TS.api.callImmediately because a one-at-a-time call is already pending, so sending to _kickOffACallOrEnqueue for enqueuing");return D(r,i,a,s,o,l)}if(T){TS.warn(r+" cannot be called with TS.api.callImmediately because we are waiting due to a non-200 response, so sending to _kickOffACallOrEnqueue for enqueuing");return D(r,i,a,s,o,l)}i=i||{};var u=Y(r,a);return $(r,i,u,s,o)},debugGetCounts:function e(){return{_method_call_counts:C,_pending:f}},debugSetResponseDelay:function t(n){e=n},hasPendingRequests:function e(){return!!f},getQLengths:function e(){return{_main_Q:p.length,_one_at_a_time_Q:g.length}},isPaused:function e(){if(TS.boot_data.feature_modern_api_q){var t=TS.interop.api.getQueue();return!!(t&&t.isPaused())}return T},callFuncWhenApiQisEmpty:function e(t){if(TS.boot_data.feature_modern_api_q){TS.interop.api.getQueue().awaitEmptyQ().then(t);return}TS.api.hasPendingRequests()?TS.api.Q_empty_sig.has(t)||TS.api.Q_empty_sig.addOnce(t):t()},debugShowStatus:function e(){TS.console.group("TS.api status");T?v?TS.log(2,"API calls are paused for "+v+"more seconds"):TS.log(2,"API calls are paused."):TS.log(2,"API calls are NOT paused");TS.warn(2,"Pending count is "+f+", main queue length is "+p.length+", and one-at-a-time queue length is "+g.length);if(C.total_asks==C.total_attempts)TS.log(2,"Total API calls made (there have been no retries): "+C.total_asks);else{TS.log(2,"Total API calls made (not including retries): "+C.total_asks);TS.log(2,"Total API calls made (including retries): "+C.total_attempts)}C.total_non_200s?TS.warn(2,"Total non-200 API responses: "+C.total_non_200s):TS.log(2,"No non-200 API responses");TS.console.groupEnd("TS.api status")},debugShowQueue:function e(){_.forEach({main:p,"one-at-a-time":g},function(e,t){TS.console.group("TS.api "+t+" queue");e.length?e.forEach(function(e){TS.log(2,e.method,e.args)}):TS.log(2,"Nothing pending in "+t+" queue");TS.console.groupEnd("TS.api "+t+" queue")})},debugSetPaused:function e(t){var n=100;if(t){le({reason:{DEBUG:true},retry_after:1e3*n});TS.log(2,"API calls are now paused for",n,"seconds")}else{ue();TS.log(2,"API calls are now unpaused")}},runNextFromQueue:function e(){if(T){TS.info("Calls are paused, so runNextFromQueue doing anything");return}TS.info("Running next from queue");B()}});var e=0;var t="ts_api_call_handler_deprecated";var n=0;var r={};var i={"channels.view":{canonical_avatars:true,name_tagging:true},"rtm.leanStart":{canonical_avatars:true,name_tagging:true},"rtm.start":{canonical_avatars:true,name_tagging:true},"users.info":{canonical_avatars:true,name_tagging:true},"users.list":{canonical_avatars:true,name_tagging:true},"conversations.view":{canonical_avatars:true,name_tagging:true}};var a=["activity.mentions","stars.list","files.list","files.info","search.messages","search.files","channels.history","groups.history","im.history","mpim.history","channels.listShared","groups.listShared","unread.history","pins.list","subteams.users.list","subteams.list","channels.replies","groups.replies","im.replies","subscriptions.thread.getView","chat.command","conversations.history","highlights.briefing","channels.insights"];var s=["channels.history","pins.list","groups.history","im.history","mpim.history","unread.history","activity.mentions","conversations.history"];var o=["activity.mentions","conversations.history","conversations.info","unread.history"];var l=["rtm.start","rtm.leanStart","files.list"];var u=["rtm.start","rtm.leanStart","activity.mentions","stars.list","files.list","files.info","apps.list","commands.list","channels.list","emoji.list","help.issues.list","subteams.list","subteams.users.list","rtm.checkFastReconnect"];var d=["users.prefs.set","rtm.start","rtm.leanStart","rtm.checkFastReconnect","enterprise.setPhoto","signup.createTeam"];var c=["api.benchmark","channels.view","conversations.view","dnd.teamInfo","screenhero.rooms.create","screenhero.rooms.join","screenhero.rooms.refreshToken","screenhero.rooms.invite","highlights.list","enterprise.channels.createShared","enterprise.groups.createShared","enterprise.teams.create","api.statusSite","channels.insights","search.team","search.enterprise"];var m=["api.test","auth.emailToken","auth.findTeam","auth.findUser","auth.loginMagic","auth.signin","enterprise.signup.complete","enterprise.signup.checkDomain","enterprise.signup.checkPassword","helpdesk.get","signup.addLead","team.checkEmailDomains","test.versionInfo","oauth.access"];var f=0;var p=[];var h=false;var g=[];var S=4;var T=false;var v=0;var b;var y=10;var w=6e4;var k=5e3;var x=100;var C={total_asks:0,total_attempts:0,total_non_200s:0};var M=0;var I=function e(t){if("rtm.start"===t)return 2;if("rtm.leanStart"===t)return 2;if("rtm.checkFastReconnect"===t)return 2;return y};var A=function e(t,n){var r=I(t);if("rtm.start"===t&&n>=r)return true;if("rtm.leanStart"===t&&n>=r)return true;if("rtm.checkFastReconnect"===t&&n>=r)return true;if(M>=4)return true};var E=function e(t){f+=1;f>=10?X("ts_api_pending_10plus"):f>=5?X("ts_api_pending_5plus"):f>=3?X("ts_api_pending_3plus"):2==f?X("ts_api_pending_2"):1==f&&X("ts_api_pending_1");-1!=d.indexOf(t)&&(h=true)};var P=function e(t){f-=1;-1!=d.indexOf(t)&&(h=false)};var F=function e(t){P(t);T||B()};var O=function e(t){return _.assign({},r,i[t])};var D=function e(t,n,r,i,a,s){if(_.isUndefined(t)){TS.error("Tried to make API call, but API method name was not specified");throw new Error("Invalid API call")}n=_.defaults(n||{},O(t));var o=Y(t,r);var l;if(-1!=d.indexOf(t)){if(!T&&!h)return $(t,n,o,i,a);l=g}else{if(!T&&f<S)return $(t,n,o,i,a);l=p}var u={p:o,method:t,args:n,dont_set_active:i,progressHandler:a};s?l.unshift(u):l.push(u);if(T){X("ts_api_called_while_paused");ie()}l==p&&X("ts_api_main_queue_depth",p.length);return o.promise};var $=function e(t,n,r,i,a){if(r.promise.isCancelled()){TS.has_pri[ve]&&TS.log(ve,t+" cancelled before call could be made in TS.api");setTimeout(B,1);return r.promise}TS.has_pri[ve]&&TS.log(ve,'calling method "'+t+'" args._attempts:'+n._attempts);E(t);var s=t.indexOf("search.")>-1;TS.boot_data.page_needs_enterprise&&n.enterprise_token&&s&&!TS.prefs.getPref("search_only_current_team")?n.token=n.enterprise_token:TS.boot_data.page_needs_enterprise&&n.enterprise_token&&!s?n.token=n.enterprise_token:n.token=TS.model.api_token;if(!TS.client&&!i){n.set_active=true;TS.model.last_net_send=Date.now()}var o=Date.now();var l=j(t,n);var u=o/1e3;var d=TS.model.api_url+t+"?_x_id="+TS.boot_data.version_uid.substring(0,8)+"-"+u;_.each(TS.qs_args,function(e,t){0!=t.indexOf("feature_")&&0!=t.indexOf("exp_")||(d+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e))});if(TS.boot_data.feature_tinyspeck){var m=sessionStorage.getItem("ts_api_db_proxy_enabled");m&&(d+="&db_proxy_enabled="+m)}TS.boot_data.feature_channel_eventlog_client&&("channels.history"!==t&&"groups.history"!==t&&"im.history"!==t&&"mpim.history"!==t&&"conversations.history"!==t||(n.visible=1));var f=function e(){R(l)};var p=function e(i,a){var s=Date.now()-o;TS.dir(2,{data:i,args:n},'got api rsp for method "'+t+'" (took '+s+"ms)");i=i||{ok:false};if(i.ok){L(l);G(t,n,i,a,r);return{breathing_ms:x,try_again:false}}U(l);q(t,n,i);if(-1!=c.indexOf(t)){TS.warn('NOT re-Qing "'+t+'", as specified');G(t,n,i,a,r);return{breathing_ms:x,try_again:false}}if((429==i.status||503==i.status)&&n._attempts>=I(t)||n._synchronously){TS.warn('NOT re-Qing api call "'+t+'" because we tried too many times ('+n._attempts+")");G(t,n,i,a,r);return{breathing_ms:x,try_again:false}}if("_timeout"===i.error)return{breathing_ms:k,try_again:true};if("_badly_formed"===i.error)return{breathing_ms:x,try_again:true};if("_http_error"===i.error){n._delay_ms=z(n,i);if(0==i.status&&A(t,n._attempts)){fe(n._attempts);return{breathing_ms:0}}if(i.status>=500&&A(t,n._attempts)){ge(I(t),n._attempts);var u=n._attempts<I(t);return{breathing_ms:n._delay_ms,try_again:u}}C.total_non_200s+=1;return{breathing_ms:n._delay_ms}}var d=false;var _=3;var m=x;if(n._attempts<_)if("search.files"!==t&&"search.messages"!==t||"solr_failed"!==i.error){if("users.info"===t&&"user_not_found"===i.error){m=1e3*n._attempts;d=true}}else d=true;if(d)return{breathing_ms:m,try_again:true};G(t,n,i,a,r);return{breathing_ms:x,try_again:false}};H(d,t,n,r,f,i,a,p);return r.promise};var H=function e(t,n,r,i,a,s,o,l){var d=new XMLHttpRequest;var c=-1!=u.indexOf(n);var p=0;if(!r._attempts){r._attempts=0;C.total_asks+=1;C[n]=C[n]?C[n]+1:1}r._attempts+=1;C.total_attempts+=1;TS.has_pri[be]&&TS.log(be,n+" count: "+C[n]+" (asks: "+C.total_asks+" attempts: "+C.total_attempts+")");var h=function e(){TS._count_bytes_received&&(TS._bytes_received+=d.responseText.length);try{var t=JSON.parse(d.responseText)}catch(e){l({ok:false,error:"_parse_error",status:d.status})}M=0;var a=l(t,d.getResponseHeader("X-Slack-Req-Id"));a.try_again&&setTimeout(function(){W(n,r,i,s,o);T||f||B()},a.breathing_ms);F(n)};var g=function e(){var t={ok:false,error:"_http_error",status:parseInt(d.status,10),retry_after:parseInt(d.getResponseHeader&&d.getResponseHeader("Retry-After"),10)};t.status>=500||0==t.status?M+=1:M=0;var a=l(t);function u(){W(n,r,i,s,o);F(n)}if(false===a.try_again){var c;G(n,r,t,c,i);F(n)}else a.breathing_ms?setTimeout(u,a.breathing_ms):u()};var S=function e(){d.onerror=_.noop;d.onreadystatechange=_.noop;d.onprogress=_.noop;d.abort();v=_.noop;var t={ok:false,error:"_timeout",seconds:w};var a=l(t);setTimeout(function(){a.try_again&&W(n,r,i,s,o);F(n)},a.breathing_ms)};i.onCancel=function(){TS.has_pri[ve]&&TS.log(ve,n+" cancelled and aborted during request in TS.api");d.onerror=_.noop;d.onreadystatechange=_.noop;d.onprogress=_.noop;d.abort();v=_.noop;clearTimeout(p);setTimeout(F,x,n)};var v=function e(t){TS.has_pri[ye]&&TS.log(ye,n+" progress: "+(void 0!=t&&-1!=t&&100*t+"%"||-1!=t&&0!==t&&100*t+"%"||"unknown"));if(!c)return;clearTimeout(p);var i=w;"rtm.start"===n&&(i=r.cache_ts?1.5*w:2*w);p=setTimeout(function(){clearTimeout(p);var e=w+"ms passed, no "+n+" progress";var t="API method timed out after "+i;var r="api_call_timeout";var a=false;TS.console.logError(e,t,r,a);S()},i)};d.onprogress=function(e){var t=e.lengthComputable?e.loaded/e.total:-1;c&&v(t);o&&o(t)};d.onerror=function(){};d.onreadystatechange=function(){if(1==d.readyState);else if(2==d.readyState)a&&a(d);else if(3==d.readyState);else if(4==d.readyState){d.onprogress({loaded:1,total:1,lengthComputable:true});d.onprogress=_.noop;clearTimeout(p);if(200==d.status){d.onreadystatechange=null;h()}else g()}};var b=new FormData;var y=m.indexOf(n)<0;var k=false;Object.keys(r).forEach(function(e){if("token"===e&&!y)return;if("_"===e[0]&&"_x_reason"!==e)return;b.append(e,r[e]);k=true});d.open("POST",t,!r._synchronously);d.setRequestHeader("X-Slack-Version-Ts",TS.boot_data.version_ts);c&&v(0);k?d.send(b):d.send()};var B=function e(){var t;if(g.length&&!h)t=g.shift();else if(p.length>=ae&&se){t=_.find(p,function(e){return oe(e.method)!==se});t&&p[0]!==t?_.remove(p,t):t=p.shift()}else p.length&&(t=p.shift());if(!t){if(0===f){TS.api.Q_empty_sig.dispatch();se=void 0}return}se=oe(t.method);$(t.method,t.args,t.p,t.dont_set_active,t.progressHandler)};var j=function e(t,n){var r="api_call_"+K(t);var i=r+"__headers";var a="start_"+C.total_asks+"_"+r;Z(a);return{args:n,method:t,mark_label:a,headers_label:i,complete_label:r,ephemeral:-1===l.indexOf(t)}};var R=function e(t){if(!t)return;ee(t.headers_label,t.mark_label,null,{ephemeral:t.ephemeral});N(t,t.headers_label)};var L=function e(t){if(!t)return;Z(t.complete_label,t.mark_label,null,{ephemeral:t.ephemeral});N(t,t.complete_label);te(t.mark_label)};var N=function e(t,n){if(!t)return;if("rtm.start"===t.method||"rtm.leanStart"===t.method){var r=n;r+="__dmeliding_"+(t.args.only_relevant_ims?"yes":"no");ee(r,t.mark_label,null,{ephemeral:t.ephemeral})}};var U=function e(t){if(!t)return;te(t.mark_label)};var q=function e(t,n,r){if("file_deleted"===r.error);else{var i=r;var a='api call "'+t+'" not ok';var s="api_call_error";var o=false;TS.console.logError(i,a,s,o);if(TS.qs_args.log_api_failures){try{TS.warn("args: "+JSON.stringify(n))}catch(e){TS.warn("could not stringify args")}try{TS.warn("data: "+JSON.stringify(r))}catch(e){TS.warn("could not stringify data")}}else TS.warn("args/data logging skipped, run with ?log_api_failures=1 to enable full logging")}};var G=function e(t,n,r,i,l){var u=function e(){var a=TS.client&&TS.client.stats&&TS.client.stats.isEnabled();var s;var o;if(a){Se+=1;s="api_response_handler_"+Se;o="slow_api_handler_"+t;TS.metrics.mark(s)}l.handler(r.ok,r,n,i);if(a){var u=TS.metrics.measureAndClear(o,s);u>Te&&TS.warn("API method handler took too long ("+u+"): "+t,TS.console.getStackTrace())}return Promise.resolve()};if(!r.ok&&r.active_migration&&TS.boot_data){var d=TS.boot_data.api_active_migration_error_response_type;if(d)if(TS.boot_data.ignore_api_active_migration_error)TS.info('API returned "active_migration" (enterprise org migration) for '+t+' - skipping "'+d+'" because ignore_api_active_migration_error set.',r);else if("allow_reload"===d){if(!TS.boot_data.active_migration_reload_underway){TS.warn('About to reload because API returned "active_migration" (enterprise org migration) for '+t+" and api_active_migration_error_response_type allows reload.",r);TS.boot_data.active_migration_reload_underway=true;TS.reload(false,"TS.api._callOutsideHandler")}}else if("show_dialog"===d)if(TS.boot_data.user_saw_migration_dialog)TS.info('API returned "active_migration" (enterprise org migration) for '+t+", but user has already seen dialog. Doing nothing.");else{TS.info('API returned "active_migration" (enterprise org migration) for '+t+". Showing migration dialog.");TS.ui.fs_modal.start({title:"This team is joining an Enterprise Organization!",body:"Apologies for the interruption. This team is currently being migrated into "+(r.enterprise_name?"the <b>"+_.escape(r.enterprise_name)+"</b> Organization":"an Organization")+", which can take some time to complete. In the meantime, you won\u2019t be able to use it, but we\u2019ll email you once it\u2019s done.",show_cancel_button:false,show_go_button:false,disable_default_controls:true,disable_esc:true});TS.boot_data.user_saw_migration_dialog=true}else TS.warn('API returned "active_migration" (enterprise org migration) for '+t+', but api_active_migration_error_response_type of "'+d+'" not recognized - doing nothing.',r);else TS.info('API returned "active_migration" (enterprise org migration) for '+t+" - not alerting or reloading because no api_active_migration_error_response_type set.",r);return u()}if(!r.ok)return u();if(-1==a.indexOf(t))return u();var c=function e(){if(0===t.indexOf("bots."))return Promise.resolve();TS.has_pri[we]&&TS.log(we,'running api data from "'+t+'" through TS.bots.legacyEnsureBotsInDataArePresent()');return TS.bots.legacyEnsureBotsInDataArePresent(r,t,n.channel||void 0).catch(function(e){TS.error(e)})};var m=function e(){if(_.includes(s,t))return Promise.resolve();if(0===t.indexOf("users."))return Promise.resolve();TS.has_pri[we]&&TS.log(we,'running api data from "'+t+'" through TS.members.legacyEnsureMembersInDataArePresent()');return TS.members.legacyEnsureMembersInDataArePresent(r,t).catch(function(e){TS.error(e)})};var f=function e(){if(TS.boot_data.feature_lazy_channels&&_.includes(o,t))return Promise.resolve();TS.has_pri[we]&&TS.log(we,'running api data from "'+t+'" through TS.shared.legacyEnsureModelObsInDataArePresent()');return TS.ensureFullyBooted().then(function(){return TS.shared.legacyEnsureModelObsInDataArePresent(r,t).catch(function(e){TS.error(e)})})};var p=function e(){if(0===t.indexOf("teams."))return Promise.resolve();TS.log(528,'running api data from "'+t+'" through TS.teams.ensureTeamsInDataArePresent()');var n="TS.api.ensureTeams for method: "+t;return TS.teams.ensureTeamsInDataArePresent(r,n).catch(function(e){TS.error(e)})};f().then(function(){return Promise.join(c(),m(),p())}).then(u)};var W=function e(t,n,r,i,a){TS.warn('re Qing api call "'+t+'"');var s=-1!=d.indexOf(t)?g:p;s.unshift({method:t,args:n,p:r,dont_set_active:i,progressHandler:a})};var z=function e(t,n){var r=180;var i=1.1;var a=n.retry_after;if(429==n.status||503==n.status)a=a||60;else if(504==n.status)a=a||15;else if(n.status>=500)a=a||30;else{i=1.3;a=1;r=60}a>180&&(a=180);var s=t._delay_ms?Math.min(t._delay_ms*i,1e3*r):1e3*(a+1);s+=Math.random()*(s/2);return Math.floor(s)};var K=function e(t){return String(t).replace(/\./g,"_")};var V=function e(t){var n=new Error('API call "'+t.method+'" not ok');n.method=t.method;n.data=t.data;n.args=t.args;n.request_id=t.request_id;return n};var Y=function t(n,r){var i;var a;var s=new Promise(function(e,t,n){a=e;i=t;n(function(){"function"===typeof r&&TS.error("Because you passed a handler, which is deprecated, this API call has been cancelled but your handler has not been called. Use Promise chaining to cancel and react.");l.onCancel()})});"function"===typeof r&&(s=s.caught(_.noop));var o=function t(s,o,l,u){var d={data:o,args:l,method:n,request_id:u};function c(){s?a(d):i(V(d));r&&r(s,o,l,u)}e?setTimeout(c,e):c()};var l={promise:s,handler:o,onCancel:_.noop};return l};var J=.01;var Q=TS.qs_args.api_timings||Math.random()<=J;var X=function e(t,n){if(!Q)return;TS.metrics.count(t,n)};var Z=function e(t){if(!Q)return;TS.metrics.mark(t)};var ee=function e(t,n,r,i){if(!Q)return;TS.metrics.measure(t,n,r,i)};var te=function e(t){if(!Q)return;TS.metrics.clearMarks(t)};var ne=100;var re=0;var ie=function e(){if(TS.ui.fs_modal.is_showing)return;if(!T)return;if(p.length<ne)return;var t=3e5;if(Date.now()-re<t)return;re=Date.now();TS.metrics.count("ts_api_connectivity_warning_shown");TS.ui.fs_modal.start({title:"Connection troubles",body:"We're having a bit of trouble with our connections to Slack's servers. We've seen this problem clear up with a restart of Slack, a solution which we suggest to you now only with great regret and self-loathing.",go_button_text:"Reload Slack",cancel_button_text:"Ignore",onGo:function e(){TS.metrics.count("ts_api_connectivity_warning_reload");TS.reload(null,"API queue was too deep ("+p.length+" / "+ne+") and user chose to reload")},onCancel:function e(){TS.metrics.count("ts_api_connectivity_warning_ignore")}})};var ae=5;var se;var oe=function e(t){return t.replace(/^(channels|groups|im|mpim)\./,"_modelob_.")};var le=function e(t){if("undefined"===typeof t)throw new Error("Please specify the reason pausing the API");if(!T){T=true;X("ts_api_pause");Z("ts_api_pause_start");TS.api.paused_sig.dispatch(t)}};var ue=function e(){if(T){T=false;X("ts_api_unpause");ee("ts_api_pause_duration","ts_api_pause_start");te("ts_api_pause_start")}};var de=function e(){TS.api.unpaused_sig.dispatch()};var ce=1e3;var _e=function e(t){v=Math.max(v,Math.ceil(t/ce));le({reason:{API_ERROR:true},retry_after:v});clearInterval(b);b=setInterval(function(){v-=1;TS.api.paused_sig.dispatch({reason:{API_ERROR:true},retry_after:v});if(!v){clearInterval(b);ue();de();B()}},ce)};var me=function e(t,n){if(T)return;le({reason:t});return TS.api.connection.waitForAPIConnection(n).catch(function(){}).then(ue).then(de).then(B).catch(function(e){TS.error("An error occured while waiting for API connection to come back",e);throw e})};var fe=function e(t){TS.warn(t+" consecutive connection errors. Pausing API queue until internet returns");return me({OFFLINE:true})};var pe=function e(t,n){TS.warn("Received "+n+" consecutive 500s; pausing API queue until we determine the service is in a good state");return me({SERVICE_DOWN:true},t)};var he=false;var ge=function e(t,n){if(he)return;he=true;TS.api.connection.promiseToTestAPIConnection().then(function(e){e||pe(t,n)}).finally(function(){he=false})};var Se=0;var Te=1e3;var ve=2;var be=48;var ye=222;var we=528})()},11191:function(e,t){(function(){TS.registerModule("permissions.members",{onStart:function e(){TS.boot_data.feature_stop_loud_channel_mentions&&TS.client&&TS.client.login_sig&&TS.client.login_sig.add(t)},canThread:function e(t){if(!TS.boot_data.feature_default_shared_channels)return true;if(t.is_read_only||t.is_non_threadable)return false;return true},canPostInChannel:function e(t){if(t.is_general)return TS.permissions.members.canPostInGeneral(TS.model.user);if(TS.interop.channels.isImWithDeletedMember(t.id))return false;if(TS.boot_data.feature_default_shared_channels){if(t.is_read_only||t.is_thread_only)return false;return true}return!TS.channels.read_only.isReadOnly(t.id)},canPostInGeneral:function t(n){if(!n)return false;return e("who_can_post_general",n)},canPostInModelOb:function e(t,n){if(n.is_general)return TS.permissions.members.canPostInGeneral(t);if(TS.interop.rules.channels.isOrgShared(n))return TS.permissions.members.canPostInChannel(n);if(TS.interop.channels.isImWithDeletedMember(n.id))return false;return true},canNonAdminsAtMentionEveryoneBySettings:function t(){if(TS.boot_data.feature_default_shared_channels&&TS.interop.rules.channels.isOrgDefaultChannel(TS.shared.legacyGetActiveModelOb()))return false;return e("who_can_at_everyone",TS.model.user)},canAtMentionEveryone:function e(){if(!TS.boot_data.feature_stop_loud_channel_mentions)return TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings();var t=TS.interop.channels.getGeneralChannel();if(!t){TS.warn("WTF, could not getGeneralChannel()? Checking only team settings, skipping large channel mentions check.");return TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings()}return TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings()&&!TS.permissions.members.shouldStopChannelMentions(t.id,TS.model.user.id)},canNonAdminsAtChannelOrGroupBySettings:function t(n){if(TS.boot_data.page_needs_enterprise&&TS.model.user.enterprise_user.is_admin)return true;if(n&&TS.boot_data.feature_default_shared_channels&&TS.interop.rules.channels.isOrgDefaultChannel(TS.redux.channels.getEntityById(n)))return false;return e("who_can_at_channel",TS.model.user)},canAtChannelOrGroup:function e(t){if(TS.model.user.is_owner||TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_admin)return true;var n=TS.permissions.members.canNonAdminsAtChannelOrGroupBySettings(t);var r=TS.permissions.members.shouldStopChannelMentions(t,TS.model.user.id);return n&&!r},shouldStopChannelMentions:function e(t,n){if(!TS.boot_data.feature_stop_loud_channel_mentions)return false;var i=TS.redux.channels.getEntityById(t);if(!i){TS.warn("shouldStopChannelMentions(): could not find model_ob for id "+t);return false}if(i.is_im&&!i.is_mpim)return false;if(TS.boot_data.feature_default_shared_channels&&TS.interop.rules.channels.isOrgDefaultChannel(i))return true;var a=TS.interop.memberCounts.getOrFetchMemberCounts(i.id);var s=_.get(a,"counts.member_count")||0;var o=s>=r;if(o&&n){var l=TS.interop.members.getMemberById(n);if(l){var u=TS.interop.rules.channels.isOrgShared(i);u&&l.enterprise_user.is_admin&&(o=false);!u&&l.is_admin&&(o=false)}}return o},canMsgMentionChannelIfMention:function e(t,n,r){if(!TS.boot_data.feature_stop_loud_channel_mentions)return true;if(!t){TS.warn("canMsgMentionChannel: WTF no msg_text?",arguments);return true}var i=true;var a=false;var s=false;var o=false;var l={text:t,subtype:""};var u=TS.interop.messages.containsMention(l,a,i,s,o);if(!u)return true;var d=TS.permissions.members.shouldStopChannelMentions(n,r);if(d)return false;return true},canArchiveChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_archive_channels",TS.model.user)},canCreateChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_create_channels",TS.model.user)},canCreateGroups:function t(){if(TS.model.user.is_ultra_restricted)return false;return e("who_can_create_groups",TS.model.user)},canCreateMpims:function e(){if(TS.model.user.is_ultra_restricted)return false;return true},canCreateAndDeleteUserGroups:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_create_delete_user_groups",TS.model.user,true)},canEditUserGroups:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_edit_user_groups",TS.model.user,true)},canUserSeeMember:function e(t){if(!TS.model.user.is_restricted)return true;if(t.is_self)return true;if(t.is_slackbot)return true;return TS.members.getMembersForUser().indexOf(t)>=0},canKickFromChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_kick_channels",TS.model.user,true)},canKickFromGroups:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_kick_groups",TS.model.user,true)},canCreateConvertOrgSharedChannels:function e(){if(!TS.boot_data.page_needs_enterprise)return false;if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return true;return TS.permissions.members.canManageOrgSharedChannels()},canManageOrgSharedChannels:function e(){if(!TS.prefs.getTeamPref("who_can_manage_shared_channels"))return true;if(!TS.boot_data.page_needs_enterprise)return false;var t=TS.model.user;if(t.is_restricted)return false;if(void 0!==TS.prefs.getTeamPref("can_user_manage_shared_channels"))return TS.prefs.getTeamPref("can_user_manage_shared_channels");var n=TS.prefs.getTeamPref("who_can_manage_shared_channels").type[0];if("regular"===n)return true;if("admin"===n)return t.is_admin||t.is_owner||!!(t.enterprise_user&&(t.enterprise_user.is_admin||t.enterprise_user.is_owner));if("owner"===n){if(t.enterprise_user&&(t.enterprise_user.is_admin||t.enterprise_user.is_owner))return true;if(TS.prefs.getTeamPref("who_can_manage_shared_channels").user&&TS.prefs.getTeamPref("who_can_manage_shared_channels").user.indexOf(TS.model.user.id)>-1)return true;return false}return false},canRequestSharedChannel:function e(){if(!TS.model.team.plan)return false;if(TS.boot_data.page_needs_enterprise&&!TS.boot_data.feature_shared_channels_enterprise)return false;var t=_.includes(i,TS.model.team.domain);var n=TS.model.user.is_owner||TS.model.user.is_admin;if(t&&n)return 0!==TS.prefs.getTeamPref("enable_shared_channels");return 1===TS.prefs.getTeamPref("enable_shared_channels")},canCreateSharedChannel:function e(){if(!TS.model.user.is_owner&&!TS.model.user.is_admin)return false;return TS.permissions.members.canRequestSharedChannel()},canDisconnectSharedChannels:function e(){if(!TS.model.user.is_owner&&!TS.model.user.is_admin)return false;if(!TS.model.team.plan||TS.boot_data.page_needs_enterprise&&!TS.boot_data.feature_tinyspeck&&!TS.boot_data.feature_shared_channels_enterprise)return false;return true},canManageParticipationInSharedChannelsOpenBeta:function e(){if(!TS.model.team.plan)return false;if(TS.boot_data.page_needs_enterprise&&!TS.boot_data.feature_shared_channels_enterprise)return false;return TS.model.user.is_admin},canManageExternalSharedChannels:function e(){return TS.model.user.is_owner||TS.model.user.is_admin},canExportMessageHistory:function e(t){if(TS.boot_data.feature_channel_exports&&(TS.model.user.is_admin||t.is_im||t.is_group))return true;return false},canUserInviteToChannel:function e(t){if(TS.model.user.is_ultra_restricted)return false;if(t.is_channel&&t.is_member)return true;if(t.is_group)return true;return false},canNonAdminInviteToWorkspace:function e(){if(!TS.model.team||!TS.model.user)return false;if(TS.model.user.is_restricted)return false;return!TS.prefs.getTeamPref("invites_only_admins")||TS.boot_data.page_needs_enterprise&&TS.prefs.getTeamPref("who_can_manage_guests")&&TS.interop.rules.admin.canOrgUserManageGuests(TS.model.team,TS.model.user)},canUserInviteToWorkspace:function e(){if(!TS.model.user)return false;return TS.model.user.is_admin||TS.permissions.members.canNonAdminInviteToWorkspace()},test:function t(){var n={};Object.defineProperty(n,"_checkPrefCascade",{get:function t(){return e},set:function t(n){e=n}});return n}});var e=function e(t,n,r){"undefined"===typeof r&&(r=true);if(n.is_restricted)return"ra"===TS.prefs.getTeamPref(t);if("ra"===TS.prefs.getTeamPref(t))return true;if("regular"===TS.prefs.getTeamPref(t))return true;if("admin"===TS.prefs.getTeamPref(t))return!!n.is_admin;if("owner"===TS.prefs.getTeamPref(t))return!!n.is_owner;return r};function t(){TS.prefs.team_loud_channel_mentions_limit_changed_sig.add(n);n()}var n=function e(){r=TS.prefs.getTeamPref("loud_channel_mentions_limit")||Math.infinity};var r;var i=["rsquared","shared-channels","ultra4slack","slacksharedchannels","bankrate","mtzhf","sarankco","caspersleep","patronage","forbes-business","forbes","nobleppl","tray","stembolt","aking-prod-60","aking-prod-120","stripe","c2","sidlee","nprdigital","insideenergy","3qdigital","radiant-lighting","labyrinth-lab","coloradopublicradio","pcetest1","pcetest2","50bradslavin","surveymonkey","parlevel","zdcorp","happy-returns","solsties","ncc-test-api1-team1","ncc-test-api2-team1","digitalica","eventbrite","songkick","everlane","smyte","bauerxcelmedia","stroeerdigitalgroup","crossengage","outcastagency","methodhome","awaymessages","hellofresh","npr","harvest-test","harvest-client","paperplayground","paper-dbx","digishopgirl","zoomwebdevep1","zoomwebdevep2","carousell","sidearm","paciolan","wwit-apps-ogilvy","iridesco","nikkeidevs","stripe-vendor","nikkeiitb","tab","fogcreek","beproud","institute-group","frontiers-inc","zd-media","ce-one-sharedchannels","ce-two-sharedchannels","friendstestteam","frontiersdemo1","frontiersdemo2","frontiersdemo3"]})()},11192:function(e,t){(function(){TS.registerModule("tips",{onStart:function t(){e.delegate(".ts_tip_lazy, .ts_tip_float","mouseenter",o);e.delegate(".ts_tip_float","mouseleave",l);e.on("click",".ts_tip",function(e){if(TS.isPartiallyBooted()){e.preventDefault();e.stopPropagation();TS.incremental_boot.userDidInteractWithUI();return}c($(this))})},hideAll:function e(){$(".ts_tip").addClass("ts_tip_hide")},unhideAll:function e(){$(".ts_tip").removeClass("ts_tip_hide")},updateTipTitle:function e(t,r){var a=m(t);a.length?a.html(r):t.attr("title",r);if(n&&n[0]==t[0])if(r){i.html(r);d()}else u()},updateFloater:function e(t){i&&t.title&&i.text(t.title);r&&t.classes_to_add&&r.addClass(t.classes_to_add.join(" "))}});var e=$("BODY");var t=null;var n=null;var r=null;var i=null;var a=10;var s=0;var o=function o(l){n=$(l.currentTarget);var c=n.hasClass("ts_tip_multiline");n.addClass("ts_tip_hidden");0==n.children(".ts_tip_tip").length&&p(n,c);n.removeAttr("title");n.removeClass("ts_tip_lazy");$("#ts_tip_float_floater").remove();if(n.hasClass("ts_tip_float")){var _=n.attr("class").split(/\s+/).filter(function(e){if("ts_tip_float"===e)return false;if("ts_tip_lazy"===e)return false;return 0===e.indexOf("ts_tip")});var m=TS.templates.builders.strBuilder('<div id="ts_tip_float_floater" style="width:${w}px; height:${h}px;" class="${classes}">${tip_html}</div>',{w:n.outerWidth(),h:n.outerHeight(),classes:_.join(" "),tip_html:n.find(".ts_tip_tip").clone()[0].outerHTML});r=$(m);e.append(r);s=setTimeout(function(){r.removeClass("ts_tip_hidden");d()},a);t=n.closest(":scrollable(vertical)");t.on("scroll.ts_tip_removal",u);n.on("destroyed.ts_tip_removal",u);n.hasClass("ts_tip_hide_on_click")&&n.on("click.ts_tip_removal",u);if(c)i=r.find(".ts_tip_multiline_inner");else{i=r.find(".ts_tip_tip_inner");i.length||(i=r.find(".ts_tip_tip"))}}else setTimeout(function(){n.removeClass("ts_tip_hidden")},a)};var l=function e(){u()};var u=function e(){clearTimeout(s);r&&r.addClass("ts_tip_hidden");if(n&&n.length){n.off("click.ts_tip_removal");n.off("destroyed.ts_tip_removal")}t&&t.off("scroll.ts_tip_removal");t=null;n=null;r=null;i=null};var d=function e(){var t=n.offset();var i=2;var a=window.innerWidth-i;var s=window.innerHeight-i;var o=r.hasClass("ts_tip_multiline");var l=function e(){if(o)return r.find(".ts_tip_multiline_inner").dimensions_rect();return r.find(".ts_tip_tip").dimensions_rect()};var u=function e(t){r.removeClass("\t\t\tts_tip_right \t\t\tts_tip_rightish \t\t\tts_tip_left \t\t\tts_tip_leftish \t\t\tts_tip_multiline_top_leftish \t\t\tts_tip_multiline_top_left \t\t\tts_tip_multiline_top_right \t\t\tts_tip_multiline_top_rightish \t\t").addClass(t)};r.css("left",t.left).css("top",t.top);var d=l();d.bottom>s?r.removeClass("ts_tip_bottom").addClass("ts_tip_top"):d.top<i&&r.removeClass("ts_tip_top").addClass("ts_tip_bottom");if(o){d.right>a?u("ts_tip_multiline_top_rightish"):d.left<i&&u("ts_tip_multiline_top_leftish");d=l();d.right>a?u("ts_tip_multiline_top_right"):d.left<i&&u("ts_tip_multiline_top_left")}else{d.right>a?u("ts_tip_rightish"):d.left<i&&u("ts_tip_leftish");d=l();d.right>a?u("ts_tip_right"):d.left<i&&u("ts_tip_left")}};var c=function e(t){var n=m(t);var r="tip-toggle-auto";var i;t.data(r)?i=t:n.data(r)&&(i=n);if(!(i&&i.length))return;var a=n.html();var s=i.data(r);if(!s)return TS.warn("No toggle state text defined on tipped element. Please add text to data-tip-toggle-text or data-tip-toggle-auto attribute");TS.tips.updateTipTitle(t,s);i.data(r,a)};var m=function e(t){var n=t.find(".ts_tip_multiline_inner");n.length||(n=t.find(".ts_tip_tip_inner"));n.length||(n=t.find(".ts_tip_tip"));return n};var f=function e(t){if(t.text().trim().length)return;if(t.attr("aria-label"))return;return _.uniqueId("ts_tip_tip_")};var p=function e(t,n){var r="";if(t.data("tip-member"))r=TS.templates["c-member"]({member:TS.interop.members.getMemberById(t.data("tip-member")),size:"small",avatar:true,no_tip:true,dark:true,omit_status:true,forced_primary:"real_name"});else{var i=_.escape(t.prop("title"));var a=f(t);var s=a?' id="'+a+'"':"";r=n?'<span class="ts_tip_multiline_inner">'+i+"</span>":i}var o=["<span",s,' class="ts_tip_tip"',">",r,"</span>"];t.append(o.join(""));t.attr("aria-labelledby",a)}})()},11193:function(e,t){(function(){TS.registerModule("tips.texty",{onStart:function t(){e.delegate(".ts_tip_texty","mouseenter",n);e.delegate(".ts_tip_texty","mouseleave",r)},show:function e(t,n){i(t,n)},hide:function e(){a()},isShowing:function e(){return t}});var e=$("BODY");var t=false;var n=function e(t){i(t.target)};var r=function e(){a()};var i=function n(r,i){var a=r.getAttribute("data-title")||null;var s=r.getAttribute("data-id")&&"UNVERIFIED"!==r.getAttribute("data-id")?TS.interop.members.getMemberById(r.getAttribute("data-id")):null;$("#ts_tip_texty_tip").remove();if(!a&&!s)return;var o=$('<div id="ts_tip_texty_tip"'+(i?' class="ts_tip_texty_slow"':"")+"></div>");var l=r.getBoundingClientRect();TS.interop.mountTooltipTip(TS.boot_data.team_id,o[0],s?s.id:null,{children:a,position:"top",className:s?"c-tooltip__tip--member":""});e.append(o);var u=e.height()-l.top;var d=l.left;d-=o.width()/2;d+=l.width/2;o.css({bottom:u+"px",left:d+"px",opacity:1});t=true};var a=function e(){var n=document.getElementById("ts_tip_texty_tip");if(!n)return;var r=$(n).hasClass("ts_tip_texty_slow")?200:100;$(n).fadeOut(r,function(){TS.interop.unmountTooltipTip(n);$(n).remove();t=false})}})()},11194:function(e,t){(function(){TS.registerModule("notifs",{onStart:function e(){},canCorGHaveChannelMentions:function e(t){var n=TS.interop.channels.getChannelById(t)||TS.interop.channels.getGroupById(t)||TS.interop.channels.getMpimById(t);if(!n){TS.error("no model_ob for c_id:"+t+"?");return true}return TS.notifs.canModelObHaveChannelMentions(n)},canModelObHaveChannelMentions:function e(t){if(t.is_im)return false;if("admin"===TS.prefs.getTeamPref("who_can_at_channel")||"owner"===TS.prefs.getTeamPref("who_can_at_channel"))return true;if(TS.interop.rules.channels.isRequired(t)&&("admin"===TS.prefs.getTeamPref("who_can_at_everyone")||"owner"===TS.prefs.getTeamPref("who_can_at_everyone")))return true;if(t.is_general&&("admin"===TS.prefs.getTeamPref("who_can_post_general")||"owner"===TS.prefs.getTeamPref("who_can_post_general")))return true;var n=TS.notifs.getCalculatedCorGNotifySetting(t.id);var r=TS.notifs.isCorGMuted(t.id);if("everything"===n&&!r)return true;return!TS.notifs.hasUserSuppressedCorGChannelMentions(t)},hasUserSuppressedCorGChannelMentions:function e(t){if(TS.boot_data.feature_turn_mpdm_notifs_on)return!!TS.redux.notifications.getNotificationsChannelPref(t.id,"suppress_at_channel");var n=TS.model.at_channel_suppressed_channels.indexOf(t.id);if(-1!=n)return true;return false},hasUserSuppressedCorGChannelMentionsById:function e(t){var n=TS.interop.channels.getChannelById(t)||TS.interop.channels.getGroupById(t)||TS.interop.channels.getMpimById(t);if(!n){TS.error("no model_ob for c_id:"+t+"?");return true}return TS.notifs.hasUserSuppressedCorGChannelMentions(n)},hasUserSuppressedCorGPushChannelMentions:function e(t){var n=TS.interop.channels.getChannelById(t)||TS.interop.channels.getGroupById(t)||TS.interop.channels.getMpimById(t);if(!n){TS.error("no model_ob for c_id:"+t+"?");return true}var r=TS.model.push_at_channel_suppressed_channels.indexOf(n.id);if(-1!=r)return true;return false},isCorGMuted:function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}return TS.redux.channels.isChannelMutedById(t)},getCorGsNotUsingGlobalPushNotificationSetting:function e(){var t={nothing:[],mentions:[],everything:[]};var n;var r;var i={};var a;var s;var o="quiet";(TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_dm_alert"))&&(o="mentions");TS.prefs.getPref("push_everything")&&(o="loud");s=TS.prefs.getPref("push_loud_channels_set")?TS.prefs.getPref("push_loud_channels_set").split(","):[];for(r=0;r<s.length;r+=1){a=$.trim(s[r]);if(!a)continue;i[a]="quiet"}s=TS.interop.redux.models.channels.getPublicChannelsUserIsIn(TS.redux.getState());for(r=0;r<s.length;r+=1){if(!s[r])continue;a=s[r].id;if("mentions"!==TS.notifs.getCalculatedCorGPushNotifySetting(a))continue}s=TS.prefs.getPref("push_mention_channels")?TS.prefs.getPref("push_mention_channels").split(","):[];for(r=0;r<s.length;r+=1){a=$.trim(s[r]);if(!a)continue;if(!i[a])continue;i[a]="mentions"}s=TS.prefs.getPref("push_loud_channels")?TS.prefs.getPref("push_loud_channels").split(","):[];for(r=0;r<s.length;r+=1){a=$.trim(s[r]);if(!a)continue;if(!i[a])continue;i[a]="loud"}_.forOwn(i,function(e,r){n=TS.interop.channels.getChannelById(r)||TS.interop.channels.getGroupById(r)||TS.interop.channels.getMpimById(r);if(!n)return;if(n.is_archived)return;if(n.is_channel&&!n.is_member)return;if("loud"===e){if("loud"===o)return;t.everything.push(n)}else if("mentions"===e){if("mentions"===o)return;t.mentions.push(n)}else if("mentions_suppressed"===e);else{if("quiet"===o)return;t.nothing.push(n)}});return t},getCorGsNotUsingGlobalNotificationSetting:function e(){var t={nothing:[],mentions:[],everything:[],muted:[],suppressed:[]};var n=TS.interop.redux.models.channels.getPublicChannelsUserIsIn(TS.redux.getState());_.forOwn(n,function(e){if(e.is_archived)return;if(!e.is_member)return;r(e.id)&&t.nothing.push(e);i(e.id)&&t.mentions.push(e);a(e.id)&&t.everything.push(e);TS.notifs.isCorGMuted(e.id)&&t.muted.push(e);TS.notifs.hasUserSuppressedCorGChannelMentions(e)&&t.suppressed.push(e)});_.forOwn(TS.model.groups,function(e){if(e.is_archived)return;r(e.id)&&t.nothing.push(e);i(e.id)&&t.mentions.push(e);a(e.id)&&t.everything.push(e);TS.notifs.isCorGMuted(e.id)&&t.muted.push(e);TS.notifs.hasUserSuppressedCorGChannelMentions(e)&&t.suppressed.push(e)});_.forOwn(TS.model.mpims,function(e){if(e.is_archived)return;r(e.id)&&t.nothing.push(e);i(e.id)&&t.mentions.push(e);a(e.id)&&t.everything.push(e);TS.notifs.isCorGMuted(e.id)&&t.muted.push(e);TS.notifs.hasUserSuppressedCorGChannelMentions(e)&&t.suppressed.push(e)});return t},getCalculatedCorGNotifySetting:function r(i){if(!i){TS.error('wtf no c_id "'+i+'"');return false}if(TS.boot_data.feature_turn_mpdm_notifs_on){var a=TS.redux.notifications.getCalculatedDesktopNotifySetting(i);if("mentions_dms"===a)return"mentions";return a}var s=n(i);if(s){if(e(i))return"everything";if(t(i))return"nothing";return"mentions"}if(TS.prefs.getPref("growls_enabled")){if(TS.prefs.getPref("all_channels_loud"))return"everything";return"mentions"}return"nothing"},muteOrUnmuteCorG:function e(t){if(!t)return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var n=TS.redux.channels.getEntityById(t);if(!n)return;if(n.is_im)return;var r=TS.notifs.isCorGMuted(t);if(r)TS.notifs.makeCorGNOTMuted(t);else{TS.notifs.makeCorGMuted(t);n.is_mpim&&TS.mpims.legacyMarkMostRecentReadMsg(n,TS.model.marked_reasons.muted)}var i=TS.redux.channels.getMutedChannelsAsArray().join(",");TS.prefs.onPrefChanged({name:"muted_channels",value:i});TS.prefs.setPrefByAPI({name:"muted_channels",value:i})},makeCorGMuted:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=true;TS.redux.channels.setMutedChannelById(t,a);TS.prefs.setMutedChannels(TS.redux.channels.getMutedChannelsAsArray().join(","));if(!TS.client)return;n&&TS.channels.legacyCalcUnreadCnts(n);r&&TS.groups.legacyCalcUnreadCnts(r);i&&TS.mpims.legacyCalcUnreadCnts(i)},makeCorGNOTMuted:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=false;TS.redux.channels.setMutedChannelById(t,a);TS.prefs.setMutedChannels(TS.redux.channels.getMutedChannelsAsArray().join(","));if(!TS.client)return;n&&TS.channels.legacyCalcUnreadCnts(n);r&&TS.groups.legacyCalcUnreadCnts(r);i&&TS.mpims.legacyCalcUnreadCnts(i)},makeCorGSuppressed:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.at_channel_suppressed_channels.indexOf(t);-1==a&&TS.model.at_channel_suppressed_channels.push(t);TS.prefs.setSuppressedChannels(TS.model.at_channel_suppressed_channels.join(","));if(!TS.client)return;n&&TS.channels.legacyCalcUnreadCnts(n);r&&TS.groups.legacyCalcUnreadCnts(r);i&&TS.mpims.legacyCalcUnreadCnts(i)},makeCorGNOTSuppressed:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.at_channel_suppressed_channels.indexOf(t);-1!=a&&TS.model.at_channel_suppressed_channels.splice(a,1);TS.prefs.setSuppressedChannels(TS.model.at_channel_suppressed_channels.join(","));if(!TS.client)return;n&&TS.channels.legacyCalcUnreadCnts(n);r&&TS.groups.legacyCalcUnreadCnts(r);i&&TS.mpims.legacyCalcUnreadCnts(i)},makeCorGPushSuppressed:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_at_channel_suppressed_channels.indexOf(t);-1==a&&TS.model.push_at_channel_suppressed_channels.push(t);TS.prefs.setPushSuppressedChannels(TS.model.push_at_channel_suppressed_channels.join(","))},makeCorGNOTPushSuppressed:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_at_channel_suppressed_channels.indexOf(t);-1!=a&&TS.model.push_at_channel_suppressed_channels.splice(a,1);TS.prefs.setPushSuppressedChannels(TS.model.push_at_channel_suppressed_channels.join(","))},makeCorGDTopNothing:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.loud_channels.indexOf(t);-1!=a&&TS.model.loud_channels.splice(a,1);TS.prefs.setLoudChannels(TS.model.loud_channels.join(","));a=TS.model.never_channels.indexOf(t);if(TS.prefs.getPref("growls_enabled")){-1==a&&TS.model.never_channels.push(t);u(t)}else{-1!=a&&TS.model.never_channels.splice(a,1);d(t)}TS.prefs.setNeverChannels(TS.model.never_channels.join(","))},makeCorGDTopEverything:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.never_channels.indexOf(t);-1!=a&&TS.model.never_channels.splice(a,1);TS.prefs.setNeverChannels(TS.model.never_channels.join(","));a=TS.model.loud_channels.indexOf(t);if(TS.prefs.getPref("growls_enabled")&&TS.prefs.getPref("all_channels_loud")){-1!=a&&TS.model.loud_channels.splice(a,1);d(t)}else{-1==a&&TS.model.loud_channels.push(t);u(t)}TS.prefs.setLoudChannels(TS.model.loud_channels.join(","))},makeCorGDTopMentions:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.loud_channels.indexOf(t);-1!=a&&TS.model.loud_channels.splice(a,1);TS.prefs.setLoudChannels(TS.model.loud_channels.join(","));a=TS.model.never_channels.indexOf(t);-1!=a&&TS.model.never_channels.splice(a,1);TS.prefs.setNeverChannels(TS.model.never_channels.join(","));TS.prefs.getPref("growls_enabled")&&!TS.prefs.getPref("all_channels_loud")?d(t):u(t)},makeCorGPushNothing:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_loud_channels.indexOf(t);-1!=a&&TS.model.push_loud_channels.splice(a,1);TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","));a=TS.model.push_mention_channels.indexOf(t);-1!=a&&TS.model.push_mention_channels.splice(a,1);TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","));TS.prefs.getPref("push_everything")||TS.prefs.getPref("push_mention_alert")?c(t):m(t)},makeCorGPushEverything:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_mention_channels.indexOf(t);-1!=a&&TS.model.push_mention_channels.splice(a,1);TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","));a=TS.model.push_loud_channels.indexOf(t);if(TS.prefs.getPref("push_everything")){-1!=a&&TS.model.push_loud_channels.splice(a,1);m(t)}else{-1==a&&TS.model.push_loud_channels.push(t);c(t)}TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","))},makeCorGPushMentions:function e(t){var n=TS.interop.channels.getChannelById(t);var r=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_loud_channels.indexOf(t);-1!=a&&TS.model.push_loud_channels.splice(a,1);TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","));a=TS.model.push_mention_channels.indexOf(t);if(!TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_everything")){-1==a&&TS.model.push_mention_channels.push(t);c(t)}else{-1!=a&&TS.model.push_mention_channels.splice(a,1);m(t)}TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","))},getCalculatedCorGPushNotifySetting:function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.boot_data.feature_turn_mpdm_notifs_on){var n=TS.redux.notifications.getCalculatedMobileNotifySetting(t);if("mentions_dms"===n)return"mentions";return n}var r=l(t);if(r){if(s(t))return"everything";if(o(t))return"mentions";return"nothing"}if(TS.prefs.getPref("push_everything"))return"everything";if(TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_dm_alert"))return"mentions";return"nothing"},getGlobalHighlightWords:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.redux.notifications.getGlobalHighlightWords();return TS.prefs.getPref("highlight_words")},setGlobalHighlightWords:function e(t){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.notifs.setGlobalNotificationPrefByKey("global_keywords",t);return TS.prefs.setPrefByAPI({name:"highlight_words",value:t})},getDesktopNotificationSoundPref:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.redux.notifications.getDesktopNotificationSoundPref();return TS.prefs.getPref("new_msg_snd")},setDesktopNotificationSoundPref:function e(t){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.notifs.setGlobalNotificationPrefByKey("desktop_sound",t);return TS.prefs.setPrefByAPI({name:"new_msg_snd",value:t})},getThreadsEverythingNotificationPref:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.redux.notifications.getThreadsEverythingNotificationPref();return TS.prefs.getPref("threads_everything")},setThreadsEverythingNotificationPref:function e(t){var n="threads_everything";if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.notifs.setGlobalNotificationPrefByKey(n,t);return TS.prefs.setPrefByAPI({name:n,value:t})},getNotificationPushIdleWaitTimeInMinutes:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.redux.notifications.getNotificationPushIdleWaitTimeInMinutes();return TS.prefs.getPref("push_idle_wait")},setNotificationPushIdleWaitTimeInMinutes:function e(t){var n="push_idle_wait";if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.notifs.setGlobalNotificationPrefByKey(n,t);return TS.prefs.setPrefByAPI({name:n,value:t})},getNoTextInNotificationsPref:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.redux.notifications.getNoTextInNotificationsPref();return TS.prefs.getPref("no_text_in_notifications")},setNoTextInNotificationsPref:function e(t){var n="no_text_in_notifications";if(TS.boot_data.feature_turn_mpdm_notifs_on)return TS.notifs.setGlobalNotificationPrefByKey(n,t);return TS.prefs.setPrefByAPI({name:n,value:t})},getGlobalNotificationSetting:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on){var t=TS.redux.notifications.getGlobalDesktopNotifySetting();if("mentions_dms"===t)return"mentions";return t}if(!TS.prefs.getPref("growls_enabled"))return"nothing";if(TS.prefs.getPref("all_channels_loud"))return"everything";return"mentions"},setDesktopGlobalNotifySetting:function e(t,n){if(!TS.boot_data.feature_turn_mpdm_notifs_on)return;return TS.notifs.setGlobalNotificationPrefByKey("global_desktop",t,n)},getGlobalPushNotificationSetting:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on){var t=TS.redux.notifications.getGlobalMobileNotifySetting();if("mentions_dms"===t||"dms"===t)return"mentions";return t}if(TS.prefs.getPref("push_everything"))return"everything";if(TS.prefs.getPref("push_mention_alert")&&TS.prefs.getPref("push_dm_alert"))return"dm_and_mentions";if(TS.prefs.getPref("push_mention_alert"))return"mentions";if(TS.prefs.getPref("push_dm_alert"))return"dms";return"nothing"},setMobileGlobalNotifySetting:function e(t){if(!TS.boot_data.feature_turn_mpdm_notifs_on)return;return TS.notifs.setGlobalNotificationPrefByKey("global_mobile",t)},setGlobalNotificationPrefByKey:function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"mentions"===n&&(n="mentions_dms");return TS.api.call("users.prefs.setNotifications",{global:true,name:t,value:n,sync:r,_x_reason:TS.ui.prefs_dialog&&TS.ui.prefs_dialog.isOpen()?"prefs_dialog_open":"prefs_dialog_closed"})}});var e=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.loud_channels.indexOf(t)>-1)return true;return false};var t=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.never_channels.indexOf(t)>-1)return true;return false};var n=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.loud_channels_set&&TS.model.loud_channels_set.indexOf(t)>-1)return true;return false};var r=function e(t){if(TS.prefs.getPref("growls_enabled")&&"nothing"===TS.notifs.getCalculatedCorGNotifySetting(t))return true;return false};var i=function e(t){var n=TS.notifs.getCalculatedCorGNotifySetting(t);if("mentions"!==n)return false;if(!TS.prefs.getPref("growls_enabled")||TS.prefs.getPref("all_channels_loud"))return true;return false};var a=function e(t){if((!TS.prefs.getPref("growls_enabled")||!TS.prefs.getPref("all_channels_loud"))&&"everything"===TS.notifs.getCalculatedCorGNotifySetting(t))return true;return false};var s=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_loud_channels.indexOf(t)>-1)return true;return false};var o=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_mention_channels.indexOf(t)>-1)return true;return false};var l=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_loud_channels_set&&TS.model.push_loud_channels_set.indexOf(t)>-1)return true;return false};var u=function e(t){var n=TS.model.loud_channels_set.indexOf(t);-1==n&&TS.model.loud_channels_set.push(t);TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))};var d=function e(t){var n=TS.model.loud_channels_set.indexOf(t);-1!=n&&TS.model.loud_channels_set.splice(n,1);TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))};var c=function e(t){var n=TS.model.push_loud_channels_set.indexOf(t);-1==n&&TS.model.push_loud_channels_set.push(t);TS.prefs.setPushLoudChannelsSet(TS.model.push_loud_channels_set.join(","))};var m=function e(t){var n=TS.model.push_loud_channels_set.indexOf(t);-1!=n&&TS.model.push_loud_channels_set.splice(n,1);TS.prefs.setPushLoudChannelsSet(TS.model.push_loud_channels_set.join(","))}})()},11195:function(e,t){(function(){TS.registerModule("redux.all_unreads",{onStart:function e(){t()},updateHasUnreads:function e(t){if("boolean"!==typeof t)return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreads(t))},updateHasUnreadThreads:function e(t){if("boolean"!==typeof t)return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreadThreads(t))},updateThreadsMentionCount:function e(t){if(!_.isInteger(t))return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateThreadsMentionCount(t))}});function e(){TS.redux.all_unreads.updateHasUnreadThreads(TS.model.threads_has_unreads);TS.redux.all_unreads.updateThreadsMentionCount(TS.model.threads_mention_count)}function t(){_.get(TS,"client.threads.threads_unread_changed")&&TS.client.threads.threads_unread_changed.add(e)}})()},11196:function(e,t){(function(){TS.registerModule("redux.channels",{onStart:function t(){e=TS.interop.rules.channels.isIm;Object.defineProperty(TS.model,"channels",{get:function e(){return p("channels")}});Object.defineProperty(TS.model,"groups",{get:function e(){return p("groups")}});Object.defineProperty(TS.model,"mpims",{get:function e(){return p("mpims")}});Object.defineProperty(TS.model,"ims",{get:function e(){return p("ims")}})},clearAllShowInListEvenThoughUnreadsFlags:function e(){TS.redux.dispatch(TS.interop.redux.models.channels.clearAllShowInListEvenThoughUnreadsFlags())},dangerouslyGetEntityById:function e(t){return r(t)},dangerouslyGetPublicChannels:function e(){return TS.interop.redux.models.channels.getPublicChannels(TS.redux.getState())},dangerouslyGetPrivateChannels:function e(){return TS.interop.redux.models.channels.getPrivateChannels(TS.redux.getState())},dangerouslyGetMpims:function e(){return TS.interop.redux.models.channels.getMpims(TS.redux.getState())},setMarkingState:function e(t,n){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.setMarkingState({id:t,needsApiMarking:n}))},clearAllMarkingFlags:function e(){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.clearAllMarkingFlags())},clearMarkingFlagsForIds:function e(t){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.clearMarkingFlagsForIds(t))},getAllIdsNeedingMarking:function e(){return s()},getAllUnmutedIdsNeedingMarking:function e(){return l()},getAllMutedIdsNeedingMarking:function e(){return o()},bulkAddEntities:function e(t){TS.redux.dispatch(TS.interop.redux.models.channels.bulkAddChannels({channels:t}))},bulkUpdateEntities:function e(t){TS.redux.dispatch(TS.interop.redux.models.channels.bulkUpdateChannels({channels:t}))},addEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){var n="Attempting to add a channel interop object, not a channel. Only raw channel objects can be added. Take this to #dhtml-modern";if(f())throw new Error(n);TS.error(n);return}TS.redux.dispatch(TS.interop.redux.models.channels.addChannel({channel:t}))},removeEntity:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.channels.removeChannels({ids:[t.id]}))},replaceEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){var n="Attempting to replace a channel object with a channel interop object. If you are trying to update a property for this channel you should change the property directly. Take this to #dhtml-modern";if(f())throw new Error(n);TS.error(n);return}TS.redux.channels.addEntity(t)},updateMutedChannels:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];var n=_.reduce(t,function(e,t){e[t]=true;return e},{});TS.redux.dispatch(TS.interop.redux.models.channelsMeta.mutedChannels.setMutedChannels(n))},getMutedChannelsAsArray:function e(){return _.reduce(u(),function(e,t,n){e.push(n);return e},[])},setMutedChannelById:function e(t,n){if(!t||_.isUndefined(n))return;var r={id:t,muted:n};TS.redux.dispatch(TS.interop.redux.models.channelsMeta.mutedChannels.setMutedChannel(r))},isChannelMutedById:function e(n){if(!n)return false;return t(n)},getEntityById:function e(t,n){return TS.interop.channels.getEntityById(t,n)},getPublicChannelByName:function e(t){var n=i(t);if(TS.interop.rules.channels.isPublicChannel(n))return n},getPublicOrPrivateChannelByName:function e(t){var n=i(t);if(TS.interop.rules.channels.isPublicChannel(n)||TS.interop.rules.channels.isPrivateChannel(n))return n},getChannelByName:function e(t){return i(t)},getImByMemberId:function t(n){var r=a(n);var i=TS.redux.channels.getEntityById(r);if(e(i))return i;return null},test:function e(){var t={};return t}});var e;var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.mutedChannels.isChannelMutedById");var n=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getAllChannels");var r=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getChannelById");var i=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getChannelByName");var a=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getImIdByMemberId");var s=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllIdsNeedingMarking");var o=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllMutedIdsNeedingMarking");var l=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllUnmutedIdsNeedingMarking");var u=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.mutedChannels.getMutedChannels");var d;var c={};var m={channels:void 0,groups:void 0,mpims:void 0,ims:void 0};var f=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var p=function t(r){var i=n();var a;switch(r){case"channels":a=function e(t){return t.is_channel};break;case"groups":a=function e(t){return t.is_group&&!t.is_mpim};break;case"ims":a=e;break;case"mpims":a=function e(t){return t.is_group&&t.is_mpim};break;default:}if(i===d&&c[r])return c[r];if(i!==d){d=i;c={}}c[r]=_.filter(i,a);c[r]=_.map(c[r],TS.redux.channels.interop.maybeWrapEntity);m[r]||(m[r]=_.defer(function(){delete c[r];delete m[r];d=null}));return c[r]}})()},11197:function(e,t){(function(){TS.registerModule("redux.channels.interop",{maybeWrapEntity:function e(t){if(!t||!t.id)return t;return T(t.id)},getSetCounts:function e(){return _.chain(t).map(function(e,t){return{key:t,value:e}}).sortBy("value").reverse().value()},getReduxSetCounts:function e(){return _.chain(n).map(function(e,t){return{key:t,value:e}}).sortBy("value").reverse().value()},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getChannelById");var t={};var n={};var r={};var i=function e(){var t=window.Proxy&&S();return t};var a=function e(t,n,r){if(!t||!n)return;var i={id:t};i[n]=r;TS.redux.dispatch(TS.interop.redux.models.channels.updateOneKeyForChannel(i))};var s=["_show_in_list_even_though_no_unreads","deleted","has_draft","is_archived","is_channel","is_ext_shared","is_group","is_im","is_member","is_mpim","is_open","is_org_shared","is_pending_ext_shared","is_shared","is_starred","last_read","members","priority","unread_cnt","unread_highlight_cnt"];var o=["_display_name","_archive_msgs","_checking_at_channel_status","_consistency_has_been_checked","_consistency_is_being_checked","_delayed_fetch_timer","_did_defer_initial_msg_history","_display_name_lc","_display_name_truncated","_has_auto_scrolled","_history_fetched_since_last_connect","_i18n_ns_history","_i18n_ns","_internal_name","_jumper_previous_name_match","_latest_via_users_counts","_mark_most_recent_read_timer","_marked_reason","_members","_mention_count_display_via_users_counts","_name_lc","_needs_unread_recalc","_prev_last_read","_score","_temp_last_read","_temp_unread_cnt","_users_counts_info","active_members","can_thread","create_channel","created","creator","date_created","enterprise_id","fetched_history_after_scrollback_time","has_fetched_history_after_scrollback","has_pins","history_changed","history_fetch_failed","history_fetch_retries","history_is_being_fetched","id","inherit","is_default","is_general","is_global_shared","is_limited","is_moved","is_non_threadable","is_org_default","is_org_mandatory","is_private","is_read_only","is_thread_only","last_made_active","last_msg_input","latest","length","member","msgs","name_normalized","name","needs_joined_message","never_needs_joined_msg","note","num_members","old_name","oldest_msg_ts","opened_this_session","org","parent_group","pending_shared","pinned_items","pinned_items_count","presence","previous_names","purpose","scroll_top","shared_team_ids","shares","domain","tooltip","topic","unlinked","unread_count_display","unread_count","unread_highlight_cnt_in_client","unread_highlights","unreads","user","was_archived_this_session"];var l=["_get","_is_interop_channel_object","_set","_setWithReduxAction","attributes","children","disabled","is_broadcast_keyword","is_divider","is_emoji","is_usergroup","is_view","is_app_action","nodeType","old_name","props_to_define","selector","then","title","toObject","toJSON","window"];var u=_.reduce(s,function(e,t){e[t]=true;return e},{});var d=_.reduce(o,function(e,t){e[t]=true;return e},{});var c=_.reduce(l,function(e,t){e[t]=true;return e},{});var m={};var f=function t(n,i){if(!d[i]&&!u[i]&&!c[i]&&_.isString(i)){TS.console.logStackTrace("Accessing an unknown key "+i+" on a model object");r[i]||(r[i]=true);S()&&TS.console.error('Dev only warning: Trying to get an unknown field "'+i+'" from a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #dhtml-modern');var a=e(n.id);return a&&a[i]}return n[i]};var p=function n(i,a,s){_.isString(a)&&(t[a]=(t[a]||0)+1);if(!d[a]&&!u[a]&&_.isString(a)){TS.console.logStackTrace("Setting an unknown key "+a+" on a model object");r[a]||(r[a]=true);if(S())throw new Error('Dev only warning: Trying to set an unknown field "'+a+'" on a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #dhtml-modern');var o=e(i.id);o&&(o[a]=s)}i[a]=s;return true};var h=function e(t){this.id=t;Object.defineProperties(this,this.props_to_define)};var g={};_.without(o,"id").forEach(function(e){g[e]={enumerable:true,get:function t(){return this._get(e)},set:function t(n){return this._set(e,n)}};s.forEach(function(e){g[e]={enumerable:true,get:function t(){return this._get(e)},set:function t(n){return this._setWithReduxAction(e,n)}}})});h.prototype.props_to_define=g;h.prototype._is_interop_channel_object=true;h.prototype._get=function(t){var n=e(this.id);if(n)return n[t]};h.prototype._set=function(t,n){var r=e(this.id);r&&(r[t]=n);return true};h.prototype._setWithReduxAction=function(t,r){var i=e(this.id);if(i&&i[t]!==r){a(this.id,t,r);n[t]=(n[t]||0)+1}return true};var S=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var T=function e(t){if(!t)throw new Error("Must pass in a valid id to _createWrappedEntityById");var n;var r=i();if(m[t])n=m[t];else{n=new h(t);r&&(n=new window.Proxy(n,{get:function e(t,n){return f(t,n)},set:function e(t,n,r){return p(t,n,r)}}));m[t]=n}return n}})()},11198:function(e,t){(function(){TS.registerModule("redux.presence",{onStart:function e(){r()},getPresenceByMemberId:function t(n){return e(n)},toggleUserPresence:function e(){return TS.redux.dispatch(TS.interop.redux.features.presence.toggleUserPresence())},updatePresenceForMember:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.features.presence.updatePresence({memberId:t.id,presence:t.presence}))},addToBulkUpsertPayload:function e(n){if(!n)return;var r=n.id;var i=n.presence;t.push({id:r,presence:i})},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.presence.getPresenceByMemberId");var t=[];var n=function e(){if(t.length){TS.redux.dispatch(TS.interop.redux.features.presence.bulkUpdatePresence(t));t=[]}};var r=function e(){TS.members.presence_changed_sig.add(TS.redux.presence.updatePresenceForMember);TS.members.batch_upserted_sig.add(n)}})()},11200:function(e,t){(function(){TS.registerModule("redux.dnd",{isMemberInDndById:function t(n){return e(n)},getDndScheduleByMemberId:function e(n){return t(n)},getAllDndSchedules:function e(){return r()},getSnoozeScheduleForCurrentUser:function e(){return n()},updateDndForMember:function e(t,n){if(!t)return;TS.redux.dispatch(TS.interop.redux.features.dnd.updateDnd({memberId:t,isInDnd:n}))},updateDndScheduleForMembers:function e(t){if(!t||!_.isArray(t)||!t.length)return;TS.redux.dispatch(TS.interop.redux.features.dnd.updateDndSchedules(t))},updateDndScheduleForMember:function e(t,n,r){if(!t)return;TS.redux.dispatch(TS.interop.redux.features.dnd.updateDndSchedule({memberId:t,nextDndStartTs:n,nextDndEndTs:r}))},removeDndScheduleForMember:function e(t){if(!t||!_.isArray(t)||!t.length)return;TS.redux.dispatch(TS.interop.redux.features.dnd.removeDndSchedule({memberIds:t}))},updateSnoozeScheduleForCurrentMember:function e(t,n){TS.redux.dispatch(TS.interop.redux.features.dnd.updateSnooze({snoozeEnabled:t,snoozeEndTs:n}))},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getDndByMemberId");var t=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getDndScheduleByMemberId");var n=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getSnoozeScheduleForCurrentUser");var r=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getAllDndSchedules")})()},11201:function(e,t){(function(){TS.registerModule("redux.enterprise",{setEnterprise:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.enterprise.setEnterprise(t))},getEnterprise:function e(){if(!TS.interop.redux.models.enterprise.getEnterprise)return null;return TS.interop.redux.models.enterprise.getEnterprise(TS.redux.getState())},getEnterpriseOrgName:function e(){if(!TS.interop.redux.models.enterprise.getEnterpriseOrgName)return null;return TS.interop.redux.models.enterprise.getEnterpriseOrgName(TS.redux.getState())},updateEnterpriseOrgName:function e(t){if(!TS.interop.redux.models.enterprise.updateEnterpriseName)return null;return TS.redux.dispatch(TS.interop.redux.models.enterprise.updateEnterpriseName(t))},getEnterpriseId:function e(){if(!TS.interop.redux.models.enterprise.getEnterpriseId)return null;return TS.interop.redux.models.enterprise.getEnterpriseId(TS.redux.getState())},getEnterpriseOrgInfo:function e(){if(!TS.interop.redux.models.enterprise.getEnterpriseOrgInfo)return Promise.reject();return TS.redux.dispatch(TS.interop.redux.models.enterprise.getEnterpriseOrgInfo())}})})()},11202:function(e,t){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};(function(){TS.registerModule("redux.members",{onStart:function e(){if(TS.boot_data.no_login)return;c=TS.utility.enableFeatureForUser(1);f();Object.defineProperty(TS.model,"members",{get:function e(){return TS.redux.members.getAllMembers()},set:function e(){TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.members: Set TS.model.members");return false}});Object.defineProperty(TS.model,"user",{get:function e(){return i()}})},getPotentiallyUnknownMemberById:function e(t){t&&"@"===t[0]&&(t=t.substring(1));if(!TS.interop.utility.looksLikeMemberId(t)){c&&TS.console.logStackTraceToBackEnd("non-ID passed into getPotentiallyUnknownMemberById","member_name_as_id_lookup",1);if(TS.boot_data.feature_deprecate_get_member_by_name)return null;var i=TS.interop.members.getMemberByName(t);if(i)return i}var a=r(t);if(!a)return null;if(a.isUnknown){TS.members.legacySetMemberUnknown(t);return _.omit(n({},a,{is_unknown:true}),"isUnknown")}if(a.isNonExistent)return _.omit(n({},a,{is_non_existent:true}),"isNonExistent");return a},getMemberByEmail:function e(n){var r=t(n);if(!r||!r.profile)return null;return r},getAllMembers:function t(){var n=e();if(n===s)return o;o=_.values(n);s=n;return o},isMemberKnown:function e(t){return a(t)},addMember:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.members.addMember(t))},addToBulkUpsertPayload:function e(t){l.push(t)},bulkUpsertMembers:function e(t){if(!_.isArray(t))return;if(!t.length)return;TS.redux.dispatch(TS.interop.redux.models.members.bulkAddMembers(t))},logStats:function e(){var t=_(u).keys().union(_.keys(d)).value();var n={};_.forEach(t,function(e){n[e]={gets:u[e]||0,sets:d[e]||0}});TS.console.table(n)},test:function e(){var t={_addSignalListeners:f};Object.defineProperty(t,"_bulk_upsert_payload",{get:function e(){return l},set:function e(t){l=t}});return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getAllMembers");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getMemberByEmail");var r=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getMemberById");var i=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getCurrentMember");var a=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.isMemberKnown");var s;var o;var l=[];var u={};var d={};var c;var m=function e(){if(l.length){TS.redux.dispatch(TS.interop.redux.models.members.bulkAddMembers(l));l=[]}};var f=function e(){TS.members.batch_upserted_sig.add(m)}})()},11203:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("redux.bots",{onStart:function e(){Object.defineProperty(TS.model,"bots",{get:function e(){return TS.redux.bots.getAllBots()},set:function e(){TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.bots: Set TS.model.bots");return false}})},getBotByMsg:function e(n){var r=t(n);return r?l(r):null},getAllBots:function t(){return _.values(e())},upsertBot:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.bots.upsertBot(t))},bulkUpsertBots:function e(t){if(!_.isArray(t))return;TS.redux.dispatch(TS.interop.redux.models.bots.bulkUpsertBots({bots:t}))},logStats:function e(){var t=_(r).keys().union(_.keys(i)).value();var n={};_.forEach(t,function(e){n[e]={gets:r[e]||0,sets:i[e]||0}});TS.console.table(n)}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.bots.getAllBots");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.bots.getBotByMsg");var r={};var i={};var a=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var s=function e(t,a){if("symbol"!==("undefined"===typeof a?"undefined":n(a))){if(!_.isNumber(r[a])){r[a]=0;i[a]=0}r[a]+=1}return t[a]};var o=function e(t,a,s){if("symbol"!==("undefined"===typeof a?"undefined":n(a))){if(!_.isNumber(i[a])){r[a]=0;i[a]=0}i[a]+=1}t[a]=s;return true};var l=function e(t){if(!window.Proxy||!a())return t;return new window.Proxy(t,{get:function e(t,n){return s(t,n)},set:function e(t,n,r){return o(t,n,r)}})}})()},11204:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("redux.user_groups",{onStart:function e(){u();Object.defineProperty(TS.model,"user_groups",{get:function e(){return TS.redux.user_groups.getAllUserGroups()},set:function e(){TS.error("TS.redux.user_groups: trying to set TS.model.user_groups???");return false}})},getUserGroupById:function e(n){var r=t(n);if(!r||r.id!==n)return null;return f(r)},getAllUserGroups:function t(){var n=e();if(n===r)return i;i=_.values(n).sort(TS.interop.i18n.mappedSorter("_name_lc"));r=n;return i},addUserGroup:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.userGroups.bulkAddGroups([t]))},addToBulkUpsertPayload:function e(t){o.push(t)},logStats:function e(){var t=_(a).keys().union(_.keys(s)).value();var n={};_.forEach(t,function(e){n[e]={gets:a[e]||0,sets:s[e]||0}});TS.console.table(n)},test:function e(){var t={_addSignalListeners:u};Object.defineProperty(t,"_bulk_upsert_payload",{get:function e(){return o},set:function e(t){o=t}});return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.userGroups.getAllUserGroups");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.userGroups.getUserGroupById");var r;var i;var a={};var s={};var o=[];var l=function e(){if(o.length){TS.redux.dispatch(TS.interop.redux.models.userGroups.bulkAddGroups(o));o=[]}};var u=function e(){TS.user_groups.batch_upserted_sig.add(l)};var d=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var c=function e(t,r){if("symbol"!==("undefined"===typeof r?"undefined":n(r))){if(!_.isNumber(a[r])){a[r]=0;s[r]=0}a[r]+=1}return t[r]};var m=function e(t,r,i){if("symbol"!==("undefined"===typeof r?"undefined":n(r))){if(!_.isNumber(s[r])){a[r]=0;s[r]=0}s[r]+=1}t[r]=i;return true};var f=function e(t){if(!window.Proxy||!d())return t;return new window.Proxy(t,{get:function e(t,n){return c(t,n)},set:function e(t,n,r){return m(t,n,r)}})}})()},11206:function(e,t){(function(){TS.registerModule("redux.files",{onStart:function e(){Object.defineProperty(TS.model,"files",{get:function e(){return TS.redux.files.getAllFiles()},set:function e(){TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.files: Set TS.model.files");return false}})},getFileById:function e(n){var r=t(n);if(!r||r.id!==n)return null;return r},getFileByProp:function e(t,n){var r=TS.redux.files.getAllFiles();return _.find(r,function(e){return e[t]===n})},getAllFiles:function t(){var i=e();if(i===n)return r;r=_.values(i);n=i;return r},addFile:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.files.addFile(t))},bulkAddFiles:function e(t){if(!_.isArray(t))return;TS.redux.dispatch(TS.interop.redux.models.files.bulkAddFiles(t))},logStats:function e(){var t=_(i).keys().union(_.keys(a)).value();var n={};_.forEach(t,function(e){n[e]={gets:i[e]||0,sets:a[e]||0}});TS.console.table(n)}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.files.getAllFiles");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.files.getFileById");var n;var r;var i={};var a={}})()},11207:function(e,t){(function(){TS.registerModule("redux.prefs",{setUserPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setUserPrefs(t))},setTeamPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setTeamPrefs(t))},setEnterprisePrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setEnterprisePrefs(t))},setUserPref:function e(t,n){if(TS.redux.prefs.getUserPref(t)===n)return;TS.redux.dispatch(TS.interop.redux.features.prefs.setUserPref({pref:t,value:n}))},setMultipleUserPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setMultipleUserPrefs(t))},setTeamPref:function e(t,n){if(TS.redux.prefs.getTeamPref(t)===n)return;TS.redux.dispatch(TS.interop.redux.features.prefs.setTeamPref({pref:t,value:n}))},setChannelNotificationOverrideAndCallApi:function e(t,n,r){TS.redux.dispatch(TS.interop.redux.features.prefs.setChannelNotificationOverrideAndCallApi({name:t,value:n,channelId:r}))},getUserPref:function t(n){return e(n)},getTeamPref:function e(n){return t(n)},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getUserPref");var t=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getTeamPref")})()},11208:function(e,t){(function(){TS.registerModule("redux.reactions",{updateReaction:function e(t,n){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.reactions.updateReaction({key:t,reactions:n}))},addToBulkUpsertPayload:function n(r,i){if(!r)return;if(!e)return;t.push({key:r,reactions:i})},isInBulkUpsertMode:function t(){return e},startBulkUpsert:function t(){if(e)return false;e=true;return true},finishBulkUpsert:function t(){if(!e)return false;n();e=false;return true}});var e=false;var t=[];var n=function e(){if(t.length){TS.redux.dispatch(TS.interop.redux.models.reactions.bulkUpdateReaction(t));t=[]}}})()},11209:function(e,t){(function(){TS.registerModule("redux.messages",{addMessages:function e(t,n,r){var i=_.some(t,function(e){var t=TS.redux.messages.getMessageByTimestamp(e.channel,e.ts);return!t});TS.redux.dispatch(TS.interop.redux.models.messages.addMessages(t));if(n){var a=t&&t[0]&&t[0].channel;var s=_.map(t,"ts");var o={};r&&(o={oldest:_.min(s),hasMore:false});TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(_.assign({channelId:a,timestamps:s},o)))}return i},addMessage:function e(t,n,r){if(!t||!t.channel||!t.ts)return;var i=TS.redux.messages.getMessageByTimestamp(t.channel,t.ts);TS.redux.dispatch(TS.interop.redux.models.messages.addMessages([t]));var a={channelId:t.channel,timestamps:[t.ts],fromEvtLog:!!r};if(n){a.oldest=t.ts;a.hasMore=false;a.append=true}TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(a));return!i},replaceMessage:function e(t,n){if(!t||!t.channel||!t.ts)return;var r=false;TS.redux.messages.addMessage(t,r,n)},removeMessage:function e(t,n){if(!t||!t.channel||!t.ts)return;TS.interop.messages.isReply(t)&&"thread_broadcast"!==t.subtype?TS.redux.dispatch(TS.interop.redux.actions.removeMessageAndTimestamp({channelId:t.channel,ts:t.ts,fromEvtLog:n})):TS.redux.dispatch(TS.interop.redux.features.messagePane.maybeAnimateDeleteMessage(t,n))},channelHistoryChanged:function e(t){TS.redux.dispatch(TS.interop.redux.models.channelHistory.removeAllTimestamps({channelId:t}))},getMessageByTimestamp:function e(t,n){if(!TS.interop.redux.models.messages.getMessageByTimestamp)return null;return TS.interop.redux.models.messages.getMessageByTimestamp(TS.redux.getState(),t,n)},getMessagesInChannel:function e(t,n,r){if(!t)return[];void 0===r&&(r=true);var i=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),t,n);var a=TS.interop.redux.models.messages.getMessagesByChannelId(TS.redux.getState(),t);var s=i&&i.timestamps||[];var o=_(s).map(function(e){return a[e]}).compact().value();o=TS.interop.messages.computeRollups(o).messages;var l=_(o).reject(TS.interop.rules.messages.isHidden).sortBy("ts");return r?l.reverse().value():l.value()},getRecentMessagesInChannel:function e(t,n){return TS.redux.messages.getMessagesInChannel(t,null,n)},getLastMessageInChannel:function e(t){if(!t)return null;var n=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),t);var r=n&&n.timestamps||[];var i=_.last(r);if(!i)return null;return TS.redux.messages.getMessageByTimestamp(t,i)},getExpandablesInChannel:function e(t){var n=TS.redux.messages.getMessagesInChannel(t,null,false);return _(n).map(function(e){var t=e.ts;if(e.file)return TS.interop.messages.getExpandableKey("file",t,{id:e.file});if("sh_room_shared"===e.subtype||"sh_room_created"===e.subtype)return TS.interop.messages.getExpandableKey("call",t,{id:e._room_id});if(e.attachments)return _.map(e.attachments,function(e){return TS.interop.messages.getExpandableKey("attachment",t,{id:e.id,imageUrl:e.image_url,audioHtml:e.audio_html,videoHtml:e.video_html,thumbUrl:e.thumb_url})});return null}).flatten().compact().value()},getMessagesByProp:function e(t,n){var r=TS.interop.redux.models.messages.getMessagesByProps(TS.redux.getState(),t,n);return _(r).sortBy("ts").reverse().value()},getMessagesByChannelId:function e(t,n){void 0===n&&(n=true);var r=TS.interop.redux.models.messages.getMessagesByChannelId(TS.redux.getState(),t);return n?_(r).sortBy("ts").reverse().value():_(r).sortBy("ts").value()},recordDeletedMessage:function e(t,n){TS.redux.dispatch(TS.interop.redux.features.deletedMessages.recordMessageDeleted({channelId:t,ts:n}))}})})()},11210:function(e,t){(function(){TS.registerModule("redux.notifications",{getCalculatedDesktopNotifySetting:function t(n){return e(n)},getCalculatedMobileNotifySetting:function e(n){return t(n)},getDefaultDesktopNotifySetting:function e(t){return n(t)},getDefaultMobileNotifySetting:function e(t){return r(t)},getGlobalDesktopNotifySetting:function e(){return i("global_desktop")},getGlobalMobileNotifySetting:function e(){return i("global_mobile")},getGlobalHighlightWords:function e(){return i("global_keywords")},getDesktopNotificationSoundPref:function e(){return i("desktop_sound")},getNotificationPushIdleWaitTimeInMinutes:function e(){return i("push_idle_wait")},getThreadsEverythingNotificationPref:function e(){return i("threads_everything")},getNoTextInNotificationsPref:function e(){return i("no_text_in_notifications")},getAllNotificationOverrides:function e(){return a()},getNotificationsChannelPref:function e(t,n){return s(t,n)}});var e=TS.redux.bindSelectorToStore("TS.interop.notifications.getCalculatedDesktopNotifySetting");var t=TS.redux.bindSelectorToStore("TS.interop.notifications.getCalculatedMobileNotifySetting");var n=TS.redux.bindSelectorToStore("TS.interop.notifications.getDefaultDesktopNotifySetting");var r=TS.redux.bindSelectorToStore("TS.interop.notifications.getDefaultMobileNotifySetting");var i=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getNotificationsGlobalPref");var a=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getAllNotificationOverrides");var s=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getNotificationsChannelPref")})()},11211:function(e,t){(function(){TS.registerModule("redux.teams",{onStart:function e(){Object.defineProperty(TS.model,"team",{get:function e(){return TS.redux.teams.getCurrentTeam()},set:function e(){TS.error("TS.redux.teams: trying to set TS.model.team???");return false}})},addTeam:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.teams.addTeam(t))},removeTeam:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.teams.removeTeam(t))},getTeamById:function e(t){if(!TS.interop.redux.models.teams.getTeamById)return null;return TS.interop.redux.models.teams.getTeamById(TS.redux.getState(),t)},getAllTeams:function e(){if(!TS.interop.redux.models.teams.getAllTeams)return null;return TS.interop.redux.models.teams.getAllTeams(TS.redux.getState())},getTeamByEnterpriseId:function e(t){if(!TS.interop.redux.models.teams.getTeamByEnterpriseId)return null;return TS.interop.redux.models.teams.getTeamByEnterpriseId(TS.redux.getState(),t)},getTeamByDomain:function e(t){if(!TS.interop.redux.models.teams.getTeamByDomain)return null;return TS.interop.redux.models.teams.getTeamByDomain(TS.redux.getState(),t)},getCurrentTeam:function e(){if(!TS.interop.redux.models.teams.getCurrentTeam)return null;return TS.interop.redux.models.teams.getCurrentTeam(TS.redux.getState())},ensureEnterpriseTeamIsKnown:function e(t,n){if(!TS.interop.redux.models.teams.ensureEnterpriseTeamIsKnown)return null;return TS.redux.dispatch(TS.interop.redux.models.teams.ensureEnterpriseTeamIsKnown(TS.redux.getState(),{id:t,additionalOptions:n}))}})})()},11212:function(e,t){(function(){TS.registerModule("redux.socket",{connectedSig:new signals.Signal,disconnectedSig:new signals.Signal,provisionallyConnectedSig:new signals.Signal,socketErrorMessageReceivedSig:new signals.Signal,socketMessageReceivedSig:new signals.Signal,troubleConnectingSig:new signals.Signal,waitingForRateLimitSig:new signals.Signal,hasNeverConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.hasNeverConnected"),wasPreviouslyConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.wasPreviouslyConnected"),isAsleep:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isAsleep"),isConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isConnected"),isConnecting:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isConnecting"),isProvisionallyConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isProvisionallyConnected"),isWaitingForConnectivity:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isWaitingForConnectivity"),isWaitingForRateLimit:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isWaitingForRateLimit"),promiseToHaveOpenWebSocket:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.promiseToHaveOpenWebSocket")})})()},11213:function(e,t){(function(){TS.registerModule("redux.canvases",{addCanvas:function e(t){TS.redux.dispatch(TS.interop.redux.models.canvases.addCanvas(t))},updateCanvas:function e(t){TS.redux.dispatch(TS.interop.redux.models.canvases.updateCanvas(t))}})})()},11214:function(e,t){(function(){TS.registerModule("channels",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,left_sig:new signals.Signal,member_left_sig:new signals.Signal,list_fetched_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,topic_changed_sig:new signals.Signal,purpose_changed_sig:new signals.Signal,created_sig:new signals.Signal,deleted_sig:new signals.Signal,renamed_sig:new signals.Signal,archived_sig:new signals.Signal,unarchived_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,converted_to_shared_sig:new signals.Signal,unshared_sig:new signals.Signal,shared_teams_updated_sig:new signals.Signal,shared_invite_pending_sig:new signals.Signal,shared_invite_revoked_sig:new signals.Signal,shared_invite_accepted_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,onStart:function e(){TS.channels.deleted_sig.add(function(e){TS.channels.temp_list_of_removed_channels[e]=true});TS.channels.joined_sig.add(function(e){delete TS.channels.temp_list_of_removed_channels[e.id]});TS.useReactMessages()||TS.channels.left_sig.add(function(e){e.is_group||TS.channels.legacyCalcUnreadCnts(e,true)})},data_updated_sig:new signals.Signal,temp_list_of_removed_channels:{},legacyAddMsg:function e(t,n){var r=TS.interop.channels.getChannelById(t);if(!r){TS.channels.temp_list_of_removed_channels[t]||TS.error('unknown channel "'+t+'"');return}if(TS.useReactMessages()){if(!TS.redux.messages.addMessage(n,true))return;if(TS.interop.messages.isReply(n)&&!TS.shared.legacyAddMsg(r,n))return}else if(!TS.shared.legacyAddMsg(r,n))return;var i=!TS.interop.rules.messages.isTempMsg(n);TS.channels.legacyCalcUnreadCnts(r,i);TS.utility.msgs.maybeTruncateMsgs(r);TS.channels.message_received_sig.dispatch(r,n);r.is_mpim&&!r.is_open&&TS.interop.messages.canCountAsUnreadForCurrentUser(n,TS.model.user.id)&&TS.api.call("conversations.open",{channel:r.id,reason:"TS.channels.legacyAddMsg"})},legacyCalcUnreadCnts:function e(t,n){TS.shared.legacyCalcUnreadCnts(t,TS.channels,n)},legacyRemoveMsg:function e(t,n){var r=TS.interop.channels.getChannelById(t);if(!r){TS.error('unknown channel "'+t+'"');return}TS.useReactMessages()&&TS.redux.messages.removeMessage(n);if(!TS.useReactMessages()||TS.interop.messages.isReply(n)){r._archive_msgs&&TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n)}TS.channels.message_removed_sig.dispatch(r,n);TS.channels.legacyCalcUnreadCnts(r,true)},legacyEnsureWeCanSendMessageToChannel:function e(t,n,r){var i;if(!t)return false;if(t.is_archived)return false;if(!t.is_member)return false;var a=TS.interop.channels.getGeneralChannel();var s=function e(t,i){if(i){var a={text:t,ephemeral_type:i,slackbot_feels:"sad_surprise"};TS.client.ui.addOrFlashEphemeralBotMsg(a)}else TS.generic_dialog.alert(t).then(function(){r?TS.ui.replies.focusReplyInput():TS.view.focusMessageInput()});if(r){TS.ui.replies.populateReplyInput(n);TS.ui.replies.focusReplyInput()}else{TS.utility.contenteditable.value(TS.client.ui.$msg_input,n);TS.view.focusMessageInput()}};if(t.is_general&&!TS.permissions.members.canPostInGeneral(TS.model.user)){var o=TS.interop.i18n.t("A Workspace Owner has restricted posting to the #*{channel_name}* channel.","channels")({channel_name:t.name});s(o,"general_posting_restricted");return false}var l=TS.format.cleanMsg(n);var u=!!r;var d=TS.model.here_regex.test(l)||l.match(/(^|\s)@here(\b|$)/i);var c=TS.model.channel_regex.test(l)&&!u||TS.model.group_regex.test(l)&&!u;var _=TS.model.everyone_regex.test(l)&&!u||TS.interop.rules.channels.isRequired(t)&&c;if(_){if(!TS.permissions.members.canAtMentionEveryone(t.id)){if(TS.model.user.is_restricted){i="<p>"+TS.interop.i18n.t("Your account is restricted, and you cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";s(i);return false}if(TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings(t.id)){i="<p>"+TS.interop.i18n.t("Usage of <b>{everyone}</b> is restricted to Workspace Admins in the large general channel.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.metrics.count("stopped_loud_channel_mention")}else i="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";!TS.interop.rules.channels.isRequired(t)&&TS.permissions.members.canAtChannelOrGroup(t.id)&&(i+='<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>");s(i);return false}if(!TS.interop.rules.channels.isRequired(t)&&!d){if(a&&a.is_member)TS.generic_dialog.start({title:TS.interop.i18n.t("Send {everyone} a message","channels")({everyone:TS.templates.builders.atLabel("everyone")}),body:TS.interop.i18n.t('<p class="bold">Would you like to switch to #{general_channel} and send your message?</p>\t\t\t\t\t\t\t<p class="">Using <b>{everyone}</b> in a message is a way to address your entire workspace, but it must be done in the #{general_channel} channel.</p>\t\t\t\t\t\t\t<p class="no_bottom_margin">If you just want to address everyone in this channel, use <b>{channel}</b> instead.</p>',"channels")({general_channel:a.name,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, send it","channels")(),onGo:function e(){TS.channels.legacyDisplayChannel({id:a.id,and_send_txt:n})},onCancel:function e(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,n);TS.view.focusMessageInput()}});else{i="<p>"+TS.interop.i18n.t("You cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.permissions.members.canAtChannelOrGroup(t.id)&&(i+='<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>");s(i)}return false}}if((c||d)&&!TS.permissions.members.canAtChannelOrGroup(t.id)){var m=d?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");if(TS.permissions.members.canNonAdminsAtChannelOrGroupBySettings(t.id)){i="<p>"+TS.interop.i18n.t("Usage of <b>{key_word}</b> is restricted to Workspace Admins in this large channel.","channels")({key_word:m})+"</p>";TS.metrics.count("stopped_loud_channel_mention")}else i="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <b>{key_word}</b> messages.","channels")({key_word:m})+"</p>";s(i);return false}if(!u&&TS.ui.needToShowAtChannelWarning(t.id,n)){TS.ui.at_channel_warning_dialog.startInMessagePane(t.id,n);return false}return true},legacyOnSendMsg:function e(t,n){var r=_.get(n,"SENT_MSG.channel");var i=TS.interop.channels.getChannelById(r);if(!i){TS.error("unknown channel? "+r);return}TS.shared.legacyOnSendMsg(t,n,i,TS.channels)},legacyDisplayChannel:function e(t){var n=_.defaults({},t,{from_history:false,replace_history_state:false});var r=n.id;if(!r){TS.error("no channel id supplied");return}var a=n.path;var s=n.and_send_txt;var o=n.from_history;var l=n.replace_history_state;if(TS.isPartiallyBooted()&&r!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+r);var u=TS.interop.channels.getChannelById(r);if(!u){TS.error('channel "'+r+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);TS.shared.legacyMaybeClearHasAutoScrolled();if(r===TS.model.active_channel_id&&!l&&!TS.client.activeChannelIsHidden()){TS.warn('channel "'+r+'" already displayed');s&&TS.shared.legacySendMsg(r,_.trim(s));return}TS.has_pri[i]&&TS.log(i,"legacyDisplayChannel: "+u.id);TS.shared.legacyDidDeferMessageHistoryById(u.id)&&TS.shared.legacyCheckInitialMsgHistory(u,TS.channels);if(!u.is_member){if(s){TS.model.requested_channel_joins[r]={and_send_txt:s};TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:r})).catch(_.noop);return}var d=TS.shared.legacyGetActiveModelOb();d.is_channel&&!d.is_member||(TS.client.archives.previous_model_ob=d)}var c=!l&&o;var m=TS.client.channelDisplaySwitched({id:r,path:a,replace_history_state:l,no_history_add:c});m&&TS.channels.switched_sig.dispatch();s&&TS.shared.legacySendMsg(r,_.trim(s))},setLastRead:function e(t,n,r){if(TS.boot_data.feature_modern_set_last_read)return TS.redux.dispatch(TS.interop.actions.setLastRead({id:t.id,ts:n}));var i;if(TS.useReactMessages()){i=TS.model.last_reads_set_by_client[t.id+"_"+n];delete TS.model.last_reads_set_by_client[t.id+"_"+n]}if(t.last_read===n)return false;if(n.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts: "+n);return false}var s=t.id+". last_read = "+t.last_read+" -> "+n+", reason: "+(r||"unspecified");if(t.last_read>n){if(!TS.useReactMessages()){i=TS.model.last_reads_set_by_client[t.id+"_"+n];delete TS.model.last_reads_set_by_client[t.id+"_"+n]}if(i){TS.warn("NOT going back in time on channel "+s);return}TS.has_pri[a]&&TS.log(a,"going back in time on channel "+s,TS.console.getStackTrace());TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,n)}else{TS.has_pri[a]&&TS.log(a,"TS.channels.setLastRead: "+s);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,n)}t.last_read=n;r&&(t._marked_reason=r);TS.channels.marked_sig.dispatch(t);TS.shared.legacyMaybeClearUsersCountsInfo(t);TS.channels.legacyCalcUnreadCnts(t);return true},legacyMarkMostRecentReadMsg:function e(t,n,r){if(!t){TS.error("channel unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:n}));return}if((!t.msgs||!t.msgs.length)&&!r)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){t.is_member&&(t.msgs&&t.msgs.length||!t._latest_via_users_counts)&&TS.warn('no valid tses for channel "'+t.id+'"???');return}TS.channels.markReadMsg(t.id,i,n)},markReadMsg:function e(t,n,r){if(TS.boot_data.feature_modern_set_last_read){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:n,reason:r}));return}var i=TS.interop.channels.getChannelById(t);if(!i){TS.error('channel "'+t+'" unknown');return}if(i.last_read===n)return;if(TS.channels.setLastRead(i,n,r)){i._marked_reason=r;if(i.is_member){var a=true;TS.redux.channels.setMarkingState(i.id,a)}}},legacyOnJoin:function e(t,n,r){if(!t){if("name_taken"===n.error);else if("is_archived"===n.error)TS.channels.legacyDisplayChannel({id:TS.redux.channels.getPublicChannelByName(r.name).id});else if("restricted_action"===n.error)TS.generic_dialog.alert(TS.interop.i18n.t("<p>You don\u2019t have permission to create new channels.</p><p>Talk to your Workspace Owner.</p>","channels")());else{TS.error("failed to join channel");TS.generic_dialog.alert(TS.interop.i18n.t("Oops, something went wrong.","client")())}return}var i;var a;if(n.channel){a=TS.interop.channels.upsertChannel(n.channel);i=n.channel.id}if(!i){TS.error("no channel_id?!!");return}var s="";if(TS.model.requested_channel_joins[i]){s=TS.model.requested_channel_joins[i].and_send_txt;delete TS.model.requested_channel_joins[i]}if(!a){TS.error("no channel?!!");return}if(r._in_background)return;TS.interop.channels.getNeedsCreatedMessageState(a.name)||a.never_needs_joined_msg||(a.needs_joined_message=true);TS.client&&TS.channels.legacyDisplayChannel({id:i,and_send_txt:s})},leave:function r(i){var a=TS.interop.channels.getChannelById(i)||TS.interop.channels.getGroupById(i);if(!a)return t({channel:a,reason:"no_channel"});var s=TS.interop.rules.channels.getLeaveAction(TS.redux.getState(),a);switch(s){case"confirm_and_leave":return n(a).then(function(t){if(t)return e(a)});case"confirm_leave_and_archive":var o=true;return Promise.resolve(TS.channels.ui.showArchiveGroupDialog(a,o));case"close":return Promise.resolve(TS.shared.legacyCloseArchivedChannel(a.id));case"leave":return e(a);case"":return t({channel:a,reason:"restricted_action"});default:TS.error("Failed to leave channel "+i+'. No case for a leave action "'+s+'" is defined.')}},legacyAlertSetPurposeError:function e(t){var n;var r=_.get(t,"data.error");n="too_long"===r?TS.interop.i18n.t("That purpose is too long. Please try again with fewer than 250 characters.","channels")():"restricted_action"===r||"user_is_restricted"===r?TS.interop.i18n.t("Uh oh! You don\u2019t have permission to change the purpose. Talk to your workspace admin.","channels")():TS.interop.i18n.t("Uh oh! Something went wrong with setting the purpose. Please try again.","channels")();var i=TS.interop.i18n.t("Oooops!","channels")();TS.generic_dialog.alert(n,i)},legacyAlertSetTopicError:function e(t){var n;var r=_.get(t,"data.error");var i=TS.interop.i18n.t("Oooops!","channels")();n="too_long"===r?TS.interop.i18n.t("That channel topic is too long. Please try again with fewer than 250 characters.","channels")():"restricted_action"===r||"user_is_restricted"===r?TS.interop.i18n.t("Uh oh! You don\u2019t have permission to change the channel topic. Talk to your workspace admin.","channels")():TS.interop.i18n.t("Uh oh! Something went wrong with setting the channel topic. Please try again.","channels")();TS.generic_dialog.alert(n,i)},legacyMaybeCallCheckInitialMsgHistory:function e(t){if(TS.client&&t.is_member){var n=true;TS.shared.legacyCheckInitialMsgHistory(t,TS.channels,n)}},legacyUpdateClientFromUpsert:function e(t,n){if(TS.client){var r=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(t);TS.model.active_cid===t.id?TS.channels.legacyCalcUnreadCnts(t,r):n||TS.channels.legacyCalcUnreadCnts(t,r)}},legacyMarkScrollTop:function e(t,n){var r=TS.interop.channels.getChannelById(t);if(!r)return false;if(r.scroll_top===n)return false;r.scroll_top=n;return true},legacyMaybeLoadScrollBackHistory:function e(t,n){var r=TS.interop.channels.getChannelById(t);if(!r)return false;return TS.shared.legacyMaybeLoadScrollBackHistory(r,TS.channels,n)},legacyOnHistory:function e(t,n,r){var i=TS.interop.channels.getChannelById(r.channel);if(!i){TS.error('error no channel "'+r.channel+'"');return}if(!t||!n||!n.messages){TS.error("failed to get history for channel "+r.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=TS.utility.getHistoryRetryDelay(i.history_fetch_retries,_.get(n,"error"));TS.info("retrying history fetch on channel "+i.id+" in "+a);window.setTimeout(function(){TS.info("retrying history fetch on channel "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.channels.legacyFetchHistory(i,r,TS.channels.legacyOnHistory)},a);return}i.history_fetch_retries=0;var s=TS.shared.legacyOnHistory(i,n,r,TS.channels);if(!s){i.history_is_being_fetched=false;TS.channels.history_fetched_sig.dispatch(i)}var o=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.channels.legacyCalcUnreadCnts(i,o)},legacyFetchHistory:function e(t,n,r){if(!t){TS.error('error no channel "'+t+'"');return}t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.channels.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){TS.error("giving up on channels.history for "+t.id+", channel.history_fetch_retries = "+t.history_fetch_retries);t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;TS.client&&TS.client.msg_pane.updateEndMarker();return}r=r||TS.channels.legacyOnHistory;TS.api.call("conversations.history",n).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},closeArchivedChannel:function e(t){TS.shared.legacyCloseArchivedChannel(t)},fetchList:function e(t,n){var i={exclude_members:1};if(TS.boot_data.feature_conversations_list){t&&(i.cursor=t);i.types="public_channel";i.limit=1e3;i.include_shared=true;var a=n||[];TS.api.call("conversations.list",i).then(function(e){var t=e.data,n=e.args,i=e.request_id;var s=true;a=a.concat(t.channels);if(!t.response_metadata.next_cursor){t.channels=a;r&&r(s,t,n,i);return{data:t,args:n,request_id:i}}TS.channels.fetchList(t.response_metadata.next_cursor,a)},function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r&&r(a,t,n,i);return{data:t,args:n,request_id:i}})}else TS.api.call("channels.list",i).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r&&r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r&&r(a,t,n,i);return{data:t,args:n,request_id:i}})},legacyKickMember:function e(t,n){if(!TS.permissions.members.canKickFromChannels())return;var r=TS.interop.channels.getChannelById(t);if(!r)return;return TS.shared.legacyKickMember(r,n)},test:function e(){var t={_onListFetched:r};Object.defineProperty(t,"_confirmIntentToLeaveChannel",{get:function e(){return n},set:function e(t){n=t}});return t}});var e=function e(n){TS.channels.legacyMarkMostRecentReadMsg(n,TS.model.marked_reasons.left);TS.client.markLastReadsWithAPI();return TS.redux.dispatch(TS.interop.channels.submitLeave({channelId:n.id})).then(function(){n.msgs&&(n.msgs.length=0);n.is_limited&&(n.is_limited=false)}).catch(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.message,i=e.data;var a=_.get(i,"error")||r;return t({channel:n,reason:a})})};var t=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.channel,r=t.reason;var i;switch(r){case"last_member":TS.interop.rules.channels.isExternallySharedChannel(n)?i=TS.model.user.is_admin?TS.interop.i18n.t('<h3 class="top_margin">To leave this channel, it needs to be unshared</h3><p>Since you\u2019re the last person from <strong>{team_name}</strong>, you\u2019ll need to stop sharing this channel before you can leave it.</p>',"channels")({team_name:TS.interop.i18n.safeString(_.escape(TS.model.team.name))}):TS.interop.i18n.t('<h3 class="top_margin">To leave this channel, it needs to be unshared</h3><p>Since you\u2019re the last person from <strong>{team_name}</strong>, you\u2019ll need an admin\u2019s help to leave. It\u2019s just a couple steps:</p><ul><li>Invite an admin to this channel.</li><li>Ask them to unshare and archive the channel.</li></ul>',"channels")({team_name:TS.interop.i18n.safeString(_.escape(TS.model.team.name))}):TS.shared.legacyCloseArchivedChannel(n.id);break;case"restricted_action":i=TS.interop.i18n.t("Sorry, you can\u2019t leave <strong>#{channel_name}</strong>!","channels")({channel_name:n.name});break;default:break}return i?TS.generic_dialog.alert(i):Promise.resolve()};var n=function e(t){return new Promise(function(e){TS.generic_dialog.start({title:TS.interop.i18n.t("Leave {group}","groups")({group:TS.model.group_prefix+t.name}),body:TS.interop.i18n.t("<p>If you leave the private channel, you will no longer be able to see any of its messages. To rejoin the private channel, you will have to be re-invited.</p><p>Are you sure you wish to leave?</p>","groups")(),go_button_text:TS.interop.i18n.t("Yes, leave the private channel","groups")(),onGo:function t(){return e(true)},onCancel:function t(){return e(false)}})})};var r=function e(t,n){if(!t){TS.error("failed to fetch channel list");return}var r=true;var i=_.map(n.channels,function(e){return TS.interop.channels.upsertChannel(e,r)});i.length&&TS.redux.channels.bulkAddEntities(_.compact(i));TS.channels.list_fetched_sig.dispatch(n.channels)};var i=999;var a=142})()},11215:function(e,t){(function(){TS.registerModule("membership",{membership_counts_need_refetch_sig:new signals.Signal,onStart:function t(){var n=Infinity;TS.members.changed_deleted_sig.add(e,this,n)}});var e=function e(){TS.redux.dispatch(TS.interop.redux.models.memberCounts.clearAllMemberCounts())}})()},11216:function(e,t){(function(){TS.registerModule("channels.read_only",{list_updated_sig:new signals.Signal,refetching_channel_info_ids:{},stashAndFetchChannelPostingUpdates:function e(t,n,r){if(!TS.boot_data.page_needs_enterprise||!TS.boot_data.feature_default_shared_channels)return;if(TS.channels.read_only.refetching_channel_info_ids[t])return;TS.channels.read_only.refetching_channel_info_ids[t]=true;var i={id:t};var a=true;switch(n){case 6:i.is_read_only=true;i.is_thread_only=false;i.is_non_threadable=false;break;case 7:i.is_read_only=false;i.is_thread_only=true;i.is_non_threadable=false;break;case 8:i.is_read_only=false;i.is_thread_only=false;i.is_non_threadable=true;break;default:a=false;break}if(a){TS.interop.channels.upsertChannel(i);TS.channels.read_only.list_updated_sig.dispatch()}TS.view.checkIfInputShouldBeDisabledAndPopulate();TS.shared.promiseToRefetchModelOb(t,r).then(function(){delete TS.channels.read_only.refetching_channel_info_ids[t];TS.view.checkIfInputShouldBeDisabledAndPopulate();TS.channels.read_only.list_updated_sig.dispatch()})},addChannelToList:function e(t){TS.model.read_only_channels=_.uniq(_.concat(TS.model.read_only_channels,t));TS.channels.read_only.list_updated_sig.dispatch()},removeChannelFromList:function e(t){TS.model.read_only_channels=TS.model.read_only_channels.filter(function(e){return e!==t});TS.channels.read_only.list_updated_sig.dispatch()},isReadOnly:function e(t){if(TS.boot_data.page_needs_enterprise){if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return false}else if(TS.model.user.owner)return false;if(!TS.interop.utility.looksLikeChannelId(t))return false;var n=TS.redux.channels.getEntityById(t);if(!n)return false;if(n.is_im||n.is_mpim)return false;if(!_.isUndefined(n.is_read_only))return n.is_read_only;return TS.model.read_only_channels.indexOf(t)>-1}})})()},11217:function(e,t){(function(){TS.registerModule("channels.ui",{onStart:function e(){},showArchiveChannelDialog:function e(t){TS.generic_dialog.start({title:TS.interop.i18n.t("Archive #{channel_name}","channels")({channel_name:t.name}),body:TS.templates.channel_option_archive({name:t.name}),go_button_text:TS.interop.i18n.t("Yes, archive the channel","channels")(),onGo:function e(){var n=function e(t,n){if(t){if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}return}var r=TS.interop.i18n.t("Archiving failed with error: {error}","channels")({error:n.error});"last_ra_channel"===n.error?r=TS.model.user.is_admin?TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")():TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to.","channels")():"restricted_action"===n.error?r=TS.interop.i18n.t("<p>You don\u2019t have permission to archive channels.</p><p>Talk to your Workspace Owner.</p>","channels")():"already_archived"===n.error?r=TS.interop.i18n.t("This channel was already archived.","channels")():"cant_archive_general"===n.error&&(r=TS.interop.i18n.t("This channel cannot be archived.","channels")());setTimeout(TS.generic_dialog.alert,500,r)};TS.api.call("conversations.archive",{channel:t.id}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}},function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})}})},showArchiveGroupDialog:function e(t,n){var r=TS.interop.i18n.t("{leave, select, true{Leave and archive}other{Archive}} {prefix}{name}","channels")({leave:n,prefix:TS.model.group_prefix,name:t.name});var i=TS.interop.i18n.t("{leave, select, true{Yes, leave & archive the channel}other{Yes, archive the channel}}","channel")({leave:n});TS.generic_dialog.start({title:r,body:TS.templates.channel_option_archive({name:t.name,group_prefix:TS.model.group_prefix}),go_button_text:i,onGo:function e(){var r=function e(r,i){if(r){n&&TS.client&&TS.shared.legacyCloseArchivedChannel(t.id);if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}return}var a=TS.interop.i18n.t("Archiving failed with error: {error}","channels")({error:i.error});"last_ra_channel"===i.error?a=TS.model.user.is_admin?TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")():TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to.","channels")():"already_archived"===i.error?a=TS.interop.i18n.t("This channel was already archived.","channels")():"restricted_action"===i.error?a=TS.interop.i18n.t("<p>You don\u2019t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channels")():"user_is_restricted"===i.error&&(a=n?TS.interop.i18n.t('<h3 class="top_margin">Ask an admin to archive this channel</h3><p>Since you\u2019re the last one here, you\u2019ll need to invite an admin and ask them to archive the channel.</p>',"channels")():TS.interop.i18n.t("<p>You don\u2019t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channels")());setTimeout(TS.generic_dialog.alert,500,a)};TS.api.call("conversations.archive",{channel:t.id}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}},function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})}})},channelCreateDialogShowDisallowedCharsAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".invalid_chars_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogShowSinglePunctuationAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".single_punctuation_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogCleanName:function e(t){var n=t.find(".title_input").val();var r=TS.utility.cleanChannelName(n);while("#"===n.substr(0,1))n=n.substr(1);if(r!=n){t.find(".title_input").val(r);TS.channels.ui.channelCreateDialogShowDisallowedCharsAlert(t);return false}return true},channelCreateDialogValidateInput:function e(t){var n=t.find(".title_input").val();var r=TS.utility.cleanChannelName(n);if(!TS.channels.ui.channelCreateDialogCleanName(t))return false;if("_"===r||"-"===r){TS.channels.ui.channelCreateDialogShowSinglePunctuationAlert(t);return false}if(!n){$("#channel_create_title").select();return false}if(TS.redux.channels.getPublicChannelByName(n)||TS.interop.memberExistsWithName(n)){TS.channels.ui.channelCreateDialogShowNameTakenAlert(t);return false}return true}})})()},11218:function(e,t){(function(){TS.registerModule("groups",{switched_sig:new signals.Signal,member_joined_sig:new signals.Signal,member_left_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,closed_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,converted_to_shared_sig:new signals.Signal,shared_teams_updated_sig:new signals.Signal,legacyAddMsg:function e(t,n){var r=TS.interop.channels.getGroupById(t);if(!r){TS.channels.temp_list_of_removed_channels[t]||TS.error('unknown group "'+t+'"');return}if(TS.useReactMessages()){if(!TS.redux.messages.addMessage(n,true))return;if(TS.interop.messages.isReply(n)&&!TS.shared.legacyAddMsg(r,n))return}else if(!TS.shared.legacyAddMsg(r,n))return;var i=!TS.interop.rules.messages.isTempMsg(n);TS.groups.legacyCalcUnreadCnts(r,i);TS.utility.msgs.maybeTruncateMsgs(r);TS.groups.message_received_sig.dispatch(r,n);r.is_open||TS.api.call("conversations.open",{channel:r.id})},legacyCalcUnreadCnts:function e(t,n){TS.shared.legacyCalcUnreadCnts(t,TS.groups,n)},legacyRemoveMsg:function e(t,n){var r=TS.interop.channels.getGroupById(t);if(!r){TS.error('unknown group "'+t+'"');return}TS.useReactMessages()&&TS.redux.messages.removeMessage(n);if(!TS.useReactMessages()||TS.interop.messages.isReply(n)){r._archive_msgs&&TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n)}TS.groups.message_removed_sig.dispatch(r,n);TS.groups.legacyCalcUnreadCnts(r,true)},legacyOnSendMsg:function e(t,n){var r=TS.interop.channels.getGroupById(n.SENT_MSG.channel);if(!r){TS.error("unknown group? "+n.SENT_MSG.channel);return}TS.shared.legacyOnSendMsg(t,n,r,TS.groups)},legacyDisplayGroup:function e(n){var r=_.defaults({},n,{from_history:false,replace_history_state:false});var i=r.id;if(!i){TS.error("no group id supplied");return}var a=r.path;var s=r.and_send_txt;var o=r.from_history;var l=r.replace_history_state;if(TS.isPartiallyBooted()&&i!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+i);var u=TS.interop.channels.getGroupById(i);if(!u){TS.error('group "'+i+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);TS.shared.legacyMaybeClearHasAutoScrolled();TS.shared.legacyDidDeferMessageHistoryById(u.id)&&TS.shared.legacyCheckInitialMsgHistory(u,TS.groups);TS.has_pri[t]&&TS.log(t,"legacyDisplayGroup "+u.id+" from_history:"+o+" replace_history_state:"+l);if(i===TS.model.active_group_id&&!l&&!TS.client.activeChannelIsHidden()){TS.warn('group "'+i+'" already displayed');s&&TS.shared.legacySendMsg(i,$.trim(s));return}var d=!l&&o;var c=a||"/messages/"+u;var m=TS.client.channelDisplaySwitched({id:i,path:c,replace_history_state:l,no_history_add:d});m&&TS.groups.switched_sig.dispatch();if(u.is_open){s&&TS.shared.legacySendMsg(i,$.trim(s));return}TS.model.requested_group_opens[i]={and_send_txt:s};TS.api.call("conversations.open",{channel:u.id})},setLastRead:function e(t,r,i){if(TS.boot_data.feature_modern_set_last_read)return TS.redux.dispatch(TS.interop.actions.setLastRead({id:t.id,ts:r}));var a;if(TS.useReactMessages()){a=TS.model.last_reads_set_by_client[t.id+"_"+r];delete TS.model.last_reads_set_by_client[t.id+"_"+r]}if(t.last_read===r)return false;if(r.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts:"+r);return false}var s=t.id+". last_read = "+t.last_read+" -> "+r+", reason: "+(i||"unspecified");if(t.last_read>r){if(!TS.useReactMessages()){a=TS.model.last_reads_set_by_client[t.id+"_"+r];delete TS.model.last_reads_set_by_client[t.id+"_"+r]}if(a){TS.warn("NOT going back in time on group "+s);return}TS.has_pri[n]&&TS.log(n,"going back in time on group "+s);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,r)}else{TS.has_pri[n]&&TS.log(n,"TS.groups.setLastRead: "+s);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,r)}t.last_read=r;i&&(t._marked_reason=i);TS.groups.marked_sig.dispatch(t);TS.shared.legacyMaybeClearUsersCountsInfo(t);TS.groups.legacyCalcUnreadCnts(t);return true},legacyMarkMostRecentReadMsg:function e(t,n,r){if(!t){TS.error("group unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:n}));return}if((!t.msgs||!t.msgs.length)&&!r)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){(t.msgs&&t.msgs.length||!t._latest_via_users_counts)&&TS.warn('no valid tses for group "'+t.id+'"???');return}TS.groups.markReadMsg(t.id,i,n)},markReadMsg:function e(t,n,r){if(TS.boot_data.feature_modern_set_last_read){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:n,reason:r}));return}var i=TS.interop.channels.getGroupById(t);if(!i){TS.error('group "'+t+'" unknown');return}if(i.last_read===n)return;if(TS.groups.setLastRead(i,n,r)){i._marked_reason=r;var a=true;TS.redux.channels.setMarkingState(i.id,a)}},createChild:function t(n,r,i){var a=TS.interop.channels.getGroupById(n);if(!a)return;TS.model.archives_and_recreated_groups[n]=true;var s=r?r.join(","):"";var o=function t(n,r,a){e(n,r,a);i&&i(n,r,a)};TS.api.call("conversations.createChild",{channel:n,_and_invite_members_ids:s}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}},function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})},legacyMaybeCallCheckInitialMsgHistory:function e(t){if(TS.client){var n=true;TS.shared.legacyCheckInitialMsgHistory(t,TS.groups,n)}},legacyUpdateClientFromUpsert:function e(t,n){if(TS.client){var r=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(t);TS.model.active_cid===t.id?TS.groups.legacyCalcUnreadCnts(t,r):n||TS.groups.legacyCalcUnreadCnts(t,r)}TS.boot_data.feature_typeless_upsert_channel||TS.groups.legacyCalcActiveMembersForGroup(t)},legacyMarkScrollTop:function e(t,n){var r=TS.interop.channels.getGroupById(t);if(!r)return false;if(r.scroll_top===n)return false;r.scroll_top=n;return true},legacyMaybeLoadScrollBackHistory:function e(t,n){var r=TS.interop.channels.getGroupById(t);if(!r)return false;return TS.shared.legacyMaybeLoadScrollBackHistory(r,TS.groups,n)},legacyOnHistory:function e(t,n,r){var i=TS.interop.channels.getGroupById(r.channel);if(!i){TS.error('error no group "'+r.channel+'"');return}if(!t||!n||!n.messages){TS.error("failed to get history for group "+r.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=TS.utility.getHistoryRetryDelay(i.history_fetch_retries,_.get(n,"error"));TS.info("retrying history fetch on group "+i.id+" in "+a);window.setTimeout(function(){TS.info("retrying history fetch on group "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.groups.legacyFetchHistory(i,r,TS.groups.legacyOnHistory)},a);return}i.history_fetch_retries=0;var s=TS.shared.legacyOnHistory(i,n,r,TS.groups);if(!s){i.history_is_being_fetched=false;TS.groups.history_fetched_sig.dispatch(i)}var o=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.groups.legacyCalcUnreadCnts(i,o)},legacyFetchHistory:function e(t,n,r){if(!t){TS.error('error no group "'+t+'"');return}t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.groups.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;TS.client&&TS.client.msg_pane.updateEndMarker();return}r=r||TS.groups.legacyOnHistory;TS.api.call("conversations.history",n).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}},function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},legacyCalcActiveMembersForGroup:function e(t){if(TS.boot_data.feature_typeless_upsert_channel)return;t.active_members.length=0;if(!t.members)return;var n;for(var r=0;r<t.members.length;r+=1){n=TS.interop.members.getMemberById(t.members[r]);if(!n)continue;if(n.deleted)continue;t.active_members.push(n.id)}},legacyCalcActiveMembersForAllGroups:function e(){if(TS.boot_data.feature_typeless_upsert_channel)return;var t=TS.model.groups;for(var n=0;n<t.length;n+=1)TS.groups.legacyCalcActiveMembersForGroup(t[n])},createSuggestedName:function e(t){var n=TS.model.user.name;var r=[];var i;var a;var s=TS.model.channel_name_max_length;for(a=0;a<t.length;a+=1){i=TS.interop.members.getMemberById(t[a]);if(!i)continue;r.push(i)}r.sort(function e(t,n){var r=t._name_lc;var i=n._name_lc;if(r<i)return-1;if(r>i)return 1;return 0});for(a=0;a<r.length;a+=1){i=r[a];n+="-"+i.name.split("-")[0]}if(n.length>s){n=n.substr(0,s);"-"===n.charAt(n.length-1)&&(n=n.substr(0,s-1))}var o=n;var l=1;var u;while(TS.redux.channels.getPublicOrPrivateChannelByName(n)||TS.interop.members.memberExistsWithName(n)){u=(l+1).toString();l+=1;n=o+u;n.length>s&&(n=o.substr(0,s-u.length)+u)}return n},kickMember:function e(t,n){if(!TS.permissions.members.canKickFromGroups())return;var r=TS.interop.channels.getGroupById(t);if(!r)return;return TS.shared.legacyKickMember(r,n)}});var e=function e(t,n,r){if(!t){"name_taken"===n.error||"restricted_action"===n.error||TS.error("failed to create group");return}if(n.channel){var i=TS.interop.channels.upsertGroup(n.channel);var a=n.channel.id}if(!a){TS.error("no group_id?!!");return}if(!i){TS.error("no group?!!");return}var s=r._and_invite_members_ids?r._and_invite_members_ids.split(","):null;s&&TS.api.call("conversations.invite",{channel:a,users:s.join(",")});TS.client&&TS.groups.legacyDisplayGroup({id:a})};var t=999;var n=142})()},11219:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};(function(){TS.registerModule("files",{team_file_added_sig:new signals.Signal,team_file_deleted_sig:new signals.Signal,team_file_deleted_success_sig:new signals.Signal,team_file_changed_sig:new signals.Signal,team_file_shared_sig:new signals.Signal,team_file_comment_added_sig:new signals.Signal,team_file_comment_edited_sig:new signals.Signal,team_file_comment_deleted_sig:new signals.Signal,file_uploaded_sig:new signals.Signal,file_uploading_sig:new signals.Signal,file_progress_sig:new signals.Signal,file_canceled_sig:new signals.Signal,file_queue_emptied_sig:new signals.Signal,channel_files_fetched_sig:new signals.Signal,user_changed_public_url_sig:new signals.Signal,uploadQ:[],uploading:false,polling_count:0,polling_file_id:null,polling_ticket:null,polling_tim:null,polling_handler:null,waiting_for_refresh:{},supported_audio_type_re:/^(m4a|mp3|wav)$/,supported_video_type_re:/^(mp4|mov|webm)$/,onStart:function e(){TS.prefs.team_disable_file_editing_changed_sig.add(TS.files.getFileActions,TS.files.upsertAndSignal)},isFilePrivate:function e(t){return!t.is_public&&!t.is_external&&!t.is_shared},isFileAuthorExternal:function e(t){if(!_.isObject(t))return false;var n=TS.interop.members.getMemberById(t.user);if(!_.isObject(n))return false;return TS.interop.members.isExternal(n)},isFileUntitled:function e(t){return"-"===t.name},createPublicURL:function e(t,n){if(TS.prefs.getTeamPref("disallow_public_file_urls"))return;var r=function e(r,i,a){if(r){TS.files.upsertAndSignal({id:t.id,public_url_shared:true});TS.files.user_changed_public_url_sig.dispatch(i.file)}else if(i.error&&"not_allowed"===i.error){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",true);TS.boot_data.feature_external_files?TS.generic_dialog.alert(TS.interop.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this Post.","files")()):TS.generic_dialog.alert(TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this space.","files")())}n&&"function"===typeof n&&n(r,i,a)};return TS.api.callImmediately("files.sharedPublicURL",{file:t.id}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},createSpace:function e(t){var n={};TS.boot_data.page_needs_enterprise&&(n.team=TS.model.team.id);var r=function e(n,r){if(n){var i=TS.files.upsertAndSignal(r.file).file;TS.web&&TS.ssb.upsertFileInSSBParentWin(i);t(i)}else{TS.generic_dialog.alert('<p class="no_bottom_margin">'+TS.interop.i18n.t("Oops! Something went wrong. Please try again.","files")()+"</p>");t(null)}};return TS.api.callImmediately("files.createSpace",n).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},createAndOpenNewSpace:function e(t,n){var r=TS.model.active_cid?"?origin_channel="+TS.model.active_cid:"";TS.boot_data.page_needs_enterprise&&(r.length?r+="&origin_team="+TS.model.team.id:r="?origin_team="+TS.model.team.id);if(n||!TS.model.is_our_app){var i="/files/create/post"+r;TS.utility.openInNewTab(i,"_blank");"function"===typeof t&&t();return Promise.resolve()}return TS.files.createSpace(function(e){if(e){var n=e.permalink+r;TS.ssb.openNewFileWindow(e,n,r)||TS.utility.openInNewTab(n,e.id)}"function"===typeof t&&t()})},createArugula:function e(t){var n={};TS.boot_data.page_needs_enterprise&&(n.team=TS.model.team.id);var r=function e(n,r){if(n){var i=TS.files.upsertAndSignal(r.file).file;TS.web&&TS.ssb.upsertFileInSSBParentWin(i);t(i)}else{TS.generic_dialog.alert('<p class="no_bottom_margin">'+TS.interop.i18n.t("Oops! Something went wrong. Please try again.","files")()+"</p>");t(null)}};return TS.api.callImmediately("files.createArugula",n).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},createAndOpenNewArugula:function e(t,n){var r=TS.model.active_cid?"?origin_channel="+TS.model.active_cid:"";TS.boot_data.page_needs_enterprise&&(r.length?r+="&origin_team="+TS.model.team.id:r="?origin_team="+TS.model.team.id);if(n||!TS.model.is_our_app){var i="/files/create/arugula"+r;TS.utility.openInNewTab(i,"_blank");"function"===typeof t&&t();return Promise.resolve()}return TS.files.createArugula(function(e){if(e){var n=e.permalink+r;TS.ssb.openNewFileWindow(e,n,r)||TS.utility.openInNewTab(n,e.id)}"function"===typeof t&&t()})},promptForFileUnshare:function e(t,n){var r=TS.redux.channels.getEntityById(n);if(!r||r.is_im||r.is_mpim)return;var i=TS.interop.i18n.t("<p>Are you sure you want to un-share this file from the <strong>{channel_name}</strong> {is_private, select, true {private} other {}} channel?</p>\t\t\t<p>Un-sharing the file will not remove existing share and comment messages, but it will keep any future comments from appearing in the channel.</p>","files")({is_private:r.is_private||r.is_group,channel_name:r.is_channel&&!r.is_private?"#"+r.name:r.name});TS.generic_dialog.start({title:TS.interop.i18n.t("Un-share file","files")(),body:i,show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, unshare this file","files")(),cancel_button_text:TS.interop.i18n.t("Cancel","files")(),onGo:function e(){TS.files.unshareFile(t,n)}})},shareFile:function e(t,n,r,i,a){var s={file:t,channel:n,comment:r||""};s.resharing_aware=true;i&&(s.share_quietly=true);var o=function e(t,n,r){TS.files.onFileShare(t,n,r);a&&a(t,n,r)};return TS.api.call("files.share",s).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})},onFileShare:function e(t,n,r){if(!t)return;TS.files.fetchFileInfo(r.file,function(e,t){TS.web&&TS.files.upsertAndSignal(t)});TS.web&&TS.web.space&&TS.web.space.onFileShare(t,n,r)},unshareFile:function e(t,n,r){var i=function e(n,i,a){TS.files.onFileUnShare(n,i,a);r&&r(t,TS.files.getFileById(t))};TS.api.call("files.unshare",{file:t,channel:n}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},fetchFileInfo:function e(t,n,r){var i=false;return s(t,i,n,r)},fetchFileInfoRaw:function e(t,n,r){var i=true;return s(t,i,n,r)},onFileUnShare:function e(t,n,r){if(!t)return;TS.files.fetchFileInfo(r.file,function(e,t){TS.web&&TS.files.upsertAndSignal(t)})},fetchTeamFiles:function e(n,r){var i=function e(t,n,i){if(t&&n.files){var a;for(var s=0;s<n.files.length;s+=1){a=n.files[s];TS.files.upsertFile(a)}}r&&r(t,n,i)};TS.api.call("files.list",{types:n,count:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},fetchMemberFiles:function e(n,r,i){var a=function e(t,n,r){if(t&&n.files){var a;for(var s=0;s<n.files.length;s+=1){a=n.files[s];TS.files.upsertFile(a)}}i&&i(t,n,r)};TS.api.call("files.list",{user:n,types:r,count:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;a(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;a(i,t,n,r);return{data:t,args:n,request_id:r}})},fetchChannelFiles:function e(t,n,r,i){var a=i&&i.length?i.join(","):"";if(n){var s=function e(t,r,i){t&&TS.files.onChannelFetch(t,r,i);n(t,r,i)};TS.api.call("files.list",{channel:t,types:a,count:r}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})}else TS.api.call("files.list",{channel:t,types:a}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.files.onChannelFetch&&TS.files.onChannelFetch(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.files.onChannelFetch&&TS.files.onChannelFetch(i,t,n,r);return{data:t,args:n,request_id:r}})},fetchMultipleFiles:function e(t,n,r){var i={files:t.join(",")};if(!t.length){TS.warn("TS.files.fetchMultipleFiles called with an empty file ID list:");TS.console.logStackTrace();var a={ok:true,files:[]};n&&n(true,a,i);return Promise.resolve({data:a,args:i})}var s=function e(t,i,a){if(t&&i.files&&!r){var s;for(var o=0;o<i.files.length;o+=1){s=i.files[o];TS.files.upsertFile(s)}}n&&n(t,i,a)};TS.boot_data.feature_no_files_info&&t.forEach(function(e){return TS.redux.dispatch(TS.interop.redux.features.fileUpdate.setFileFetching({fileId:e}))});return TS.api.call("files.list",i).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})},fetchMultipleFilesRaw:function e(t){var n=null;var r=true;return TS.files.fetchMultipleFiles(t,n,r)},onChannelFetch:function e(t,n,r){if(!t)return;if(n.files){var i;for(var a=0;a<n.files.length;a+=1){i=n.files[a];TS.files.upsertFile(i)}}TS.files.channel_files_fetched_sig.dispatch(r.channel,n.files)},addComment:function e(t,n,r,i){var a={file:t,comment:n,channel:r||""};var s=function e(t,n,r){TS.files.onFileComment(t,n,r);i&&i(t,n,r)};TS.api.callImmediately("files.comments.add",a).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})},onFileComment:function e(t,n,r){if(!t)return;var i=TS.files.getFileById(r.file);if(!i){TS.error("no file? "+r.file);return}TS.files.addCommentToFile(n.comment,i)},getFileById:function e(t){return TS.redux.files.getFileById(t)},getFileByDownloadUrlPrivate:function e(t){return TS.files.getFileByProp("url_private_download",t)},getFileByProp:function e(t,n){return TS.redux.files.getFileByProp(t,n)},getFileActions:function e(t){if(!t)return;var n={};var r=false;t.user==TS.model.user.id&&(r=true);t.is_public?n.share=true:r?n.share=true:n.share_private_file=true;n.comment=true;t.public_url_shared||"external"===t.mode||TS.model.user.is_restricted||TS.prefs.getTeamPref("disallow_public_file_urls")||(t.is_public?n.create_public_link=true:r&&(n.create_public_link=true));!t.public_url_shared||TS.model.user.is_restricted||!TS.model.user.is_admin&&!r||TS.prefs.getTeamPref("disallow_public_file_urls")||(n.revoke_public_link=true);"hosted"!==t.mode&&"snippet"!==t.mode||(n.download=true);(t.mimetype&&0===t.mimetype.indexOf("image/")||"pdf"===t.filetype||"external"===t.mode||"snippet"===t.mode||"email"===t.mode)&&(n.open_original=true);TS.web&&("post"!==t.mode&&"snippet"!==t.mode&&"space"!==t.mode&&"email"!==t.mode&&"docs"!==t.mode||(n.print=true));"space"!==t.mode||"USLACKBOT"===t.user&&"Getting_Started_with_Posts"===t.name||(n.learn_more=true);"space"!==t.mode&&"docs"!==t.mode||(n.new_window=true);"space"===t.mode&&"locked"!==t.state&&(n.edit=true);if(r){"snippet"!==t.mode&&"post"!==t.mode&&"space"!==t.mode&&"docs"!==t.mode||(n.edit=true);"hosted"!==t.mode&&"email"!==t.mode||(n.edit_title=true);n.delete_file=true}if(TS.model.user.is_admin){var i=TS.interop.members.isExternalById(t.user);n.delete_file=!i}TS.clipboard.canWriteText()&&(n.copy_file_link=true);"external"===t.mode&&(r||TS.model.user.is_admin)&&(n.refresh=true);window.Dropbox&&Dropbox.isBrowserSupported()&&TS.prefs.getPref("dropbox_enabled")&&"hosted"===t.mode&&(n.save_to_dropbox=true);if(TS.client){var a=TS.shared.legacyGetActiveModelOb();if(TS.pins.canUserPinHere(a))if(t.pinned_to&&-1!==t.pinned_to.indexOf(a.id))n.unpin_file=true;else{var s=!!t.is_public;t.channels?s=s||-1!==t.channels.indexOf(a.id):TS.warn("No channels array for file object in getFileActions(): "+t.id);t.groups?s=s||-1!==t.groups.indexOf(a.id):TS.warn("No groups array for file object in getFileActions(): "+t.id);t.ims?s=s||-1!==t.ims.indexOf(a.id):TS.warn("No ims array for file object in getFileActions(): "+t.id);s&&(n.pin_file=true)}}n.rxn_file=true;if(TS.prefs.getTeamPref("disable_file_editing")){n.edit=false;n.edit_title=false}TS.prefs.getTeamPref("disable_file_deleting")&&(n.delete_file=false);if(t.is_tombstoned){n.edit=false;n.edit_title=false;n.delete_file=false}return n},getFileCommentActions:function e(t,n){if(!t)return{};var r={can_edit:!TS.boot_data.feature_file_threads,can_delete:true};t.user!=TS.model.user.id?r.can_edit=false:TS.prefs.getTeamPref("msg_edit_window_mins")>-1&&(Date.now()-TS.interop.datetime.toDateObject(t.timestamp))/6e4>TS.prefs.getTeamPref("msg_edit_window_mins")&&(r.can_edit=false);TS.prefs.getTeamPref("allow_message_deletion")?t.user!=TS.model.user.id&&(TS.model.user.is_admin||(r.can_delete=false)):TS.model.user.is_admin||(r.can_delete=false);if(TS.client){var i=TS.shared.legacyGetActiveModelOb();if(TS.pins.canUserPinHere(i))if(t.pinned_to&&-1!==t.pinned_to.indexOf(i.id))r.can_unpin=true;else{var a=!!n.is_public;n.channels?a=a||-1!==n.channels.indexOf(i.id):TS.warn("No channels array for file object in getFileCommentActions(): "+n.id);n.groups?a=a||-1!==n.groups.indexOf(i.id):TS.warn("No groups array for file object in getFileCommentActions(): "+n.id);n.ims?a=a||-1!==n.ims.indexOf(i.id):TS.warn("No ims array for file object in getFileCommentActions(): "+n.id);a&&(r.can_pin=true)}}r.rxn_file_comment=!TS.boot_data.feature_file_threads;return r},getThumbSrcForFile:function e(t,n){try{t=l(t)}catch(e){return false}var i=r({suppressAnimations:!TS.prefs.getPref("a11y_animations"),featurePjpeg:TS.boot_data.feature_pjpeg},n);return TS.interop.files.getThumbSrcForFile(t,i)},fileIsImage:function e(t){try{t=l(t)}catch(e){return false}return TS.interop.files.fileIsImage(t)},fileHasRichPreview:function e(t){try{t=l(t)}catch(e){return false}var n=t.mimetype&&-1!==t.mimetype.indexOf("image/");return t.has_rich_preview&&!n},fileIsPDF:function e(t){try{t=l(t)}catch(e){return false}return"pdf"===t.filetype},getFileTemplateArguments:function e(t,n){var r={};r.current_user_id=TS.model.user.id;r.file_partial="generic";/(snippet|post|email|docs)/.test(t.mode)&&(r.file_partial=t.mode);/(space)/.test(t.mode)&&(r.file_partial="post");if(TS.interop.files.isTombstone(t)){r.file_partial="tombstone";r.file_tombstone=true}if(TS.files.fileIsImage(t)){r.file_partial="image";r.image_src=TS.files.getThumbSrcForFile(t,{maxSize:n});r.image_width=360===n?t.thumb_360_w:t.thumb_480_w||t.thumb_360_w;r.image_height=360===n?t.thumb_360_h:t.thumb_480_h||t.thumb_360_h;r.preserve_aspect_ratio=r.image_width>0&&r.image_height>0;r.preview_actions_class="";(r.image_width<170||r.image_height<50)&&(r.preview_actions_class+=" overflow_preview_actions");r.image_width<170&&(r.preview_actions_class+=" overflow_preview_actions_width")}/(post|space|email|docs|generic)/.test(r.file_partial)&&(r.title_hider=true);"snippet"===t.mode&&(r.title_hider="Untitled"===t.title);r.filesize=t.size>2e4&&!/(gdoc|gpres|gsheet|gdraw)/.test(t.filetype);/(space|post)/.test(t.filetype)||(r.meta_filetype=new Handlebars.SafeString(TS.templates.builders.makeFiletypeHTML(t)));TS.templates.builders.makeExternalFiletypeHTML(t)===r.meta_filetype&&(r.meta_filetype=false);if(TS.interop.files.fileIsHostedSupportedMedia(t)){if(TS.interop.files.fileIsSupportedVideo(t)){r.file_is_video=true;var i={width:t.width,height:t.height,source:t.url_private,size:t.size};if(t.video){r.transcoding_status=t.video.status;if(t.video.outputs)for(var a=t.video.outputs.length-1;a>=0;a-=1){var s=t.video.outputs[a];if(!s.source)continue;(!i.width||s.width>i.width)&&(i=s)}}r.video_height=TS.model.native_video_embed_height;t.thumb_video&&(r.poster=t.thumb_video);r.best_source=i.source}if(TS.interop.files.fileIsSupportedAudio(t)){r.file_is_audio=true;r.audio_preload="metadata";t.size<=TS.model.native_media_preload_limit_bytes&&(r.audio_preload="auto")}}return r},getFileDetailsMetaTemplateArguments:function e(t){var n=TS.files.getFileActions(t);var r="post"===t.mode;var i="space"===t.mode||"post"===t.mode;var a="snippet"===t.mode;var s="docs"===t.mode;var o={file:t,user:TS.model.user,download:"hosted"===t.mode,edit_link:r?t.edit_link:t.permalink,edit:(i||a)&&t.user===TS.model.user.id,is_post:r,is_post_or_space:i,is_snippet:a,is_arugula:s,show_open_public_link:!TS.prefs.getTeamPref("disallow_public_file_urls"),show_revoke_public_link:!TS.prefs.getTeamPref("disallow_public_file_urls")&&n.revoke_public_link};if("email"===t.mode){o.to_more_count=t.to.length-1;o.cc_more_count=t.cc.length-1}t&&t.id&&("snippet"!==t.mode&&"post"!==t.mode&&"space"!==t.mode||t.content||t.content_html||t.content_highlight_html||TS.files.fetchFileInfo(t.id));return o},createFileCommentsGroup:function e(t){var n={};function r(e,t,r){var i=TS.redux.channels.getEntityById(t);var a=i&&TS.interop.rules.channels.getDisplayNameForChannel(i);var s=e.share_info&&e.share_info[t];var o=s&&s.timestamp;var l=TS.interop.members.getMemberById(s&&s.user_id);var u=l&&TS.interop.members.getPrefCompliantMemberName(l);n[t]={name:a,first_share:{name:u,timestamp:o},comments:r?[r]:[]}}for(var i=t.comments.length-1;i>=0;i-=1){var a=t.comments[i];a.channel&&(n[a.channel]?n[a.channel].comments.unshift(a):r(t,a.channel,a))}_.each([t.channels,t.groups,t.ims,t.mpims],function(e){if(e)for(var i=e.length-1;i>=0;i-=1){var a=e[i];n[a]||r(t,a)}});t._comments_grouped=n},resetFileCommentsGroup:function e(t){t._comments_grouped=null},sortFiles:function e(t){function n(e,t){if(e.timestamp<t.timestamp)return 1;if(e.timestamp>t.timestamp)return-1;return 0}t.sort(n)},getFileCommentById:function e(t,n){var r;for(var i=0;i<t.comments.length;i+=1){r=t.comments[i];if(r.id==n)return r}return null},addCommentToFile:function e(t,n){var r=TS.files.getFileCommentById(n,t.id);if(r)return r;t._rxn_key=TS.rxns.getRxnKey("file_comment",t.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;n.comments.push(t);TS.files.sortCommentsOnFile(n);TS.files.team_file_comment_added_sig.dispatch(n,t);return t},editCommentOnFile:function e(t,n){var r;var i=false;var a=false;for(var s=0;s<n.comments.length;s+=1){r=n.comments[s];if(r.id==t.id){i=true;n.comments[s]=t;r.is_starred&&(t.is_starred=true);r._rxn_key&&(t._rxn_key=r._rxn_key);r.pinned_to&&!t.pinned_to&&(t.pinned_to=r.pinned_to);if(n.initial_comment&&r.id==n.initial_comment.id){n.initial_comment=t;a=true}break}}if(!i)return false;TS.files.sortCommentsOnFile(n);TS.files.team_file_comment_edited_sig.dispatch(n,t);a&&TS.files.team_file_changed_sig.dispatch(n);return true},deleteCommentOnFile:function e(t,n){var r;var i=[];var a;for(var s=0;s<n.comments.length;s+=1){r=n.comments[s];if(r.id==t){a=r;n.initial_comment&&r.id==n.initial_comment.id&&(n.initial_comment=null);continue}i.push(r)}if(i.length==n.comments.length)return;n.comments=i;TS.files.sortCommentsOnFile(n);TS.files.team_file_comment_deleted_sig.dispatch(n,t,a);TS.files.team_file_changed_sig.dispatch(n)},sortCommentsOnFile:function e(t){function n(e,t){if(e.timestamp>t.timestamp)return 1;if(e.timestamp<t.timestamp)return-1;return 0}t.comments.sort(n)},upsertFile:function e(t){Object.keys(t).length<2&&TS.error("upserting a bad file object! it has less than 2 properties");var r=TS.files.getFileById(t.id);var i="NOOP";var s=[];var o;var l;var u;t=TS.interop.files.processFileForUpserting(t);if(r){t._rxn_key=TS.rxns.getRxnKey("file",t.id);l=TS.rxns.getExistingRxnsByKey(t._rxn_key);l&&!t.reactions?TS.warn("file:"+t.id+" has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;if(t.comments)for(u=0;u<t.comments.length;u+=1){o=t.comments[u];o._rxn_key=TS.rxns.getRxnKey("file_comment",o.id);l=TS.rxns.getExistingRxnsByKey(o._rxn_key);l&&!o.reactions?TS.warn("comment:"+t.id+" has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(o._rxn_key,o.reactions);delete o.reactions}if(t.initial_comment){t.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",t.initial_comment.id);l=TS.rxns.getExistingRxnsByKey(t.initial_comment._rxn_key);l&&!t.initial_comment.reactions?TS.warn("initial_comment:"+t.id+" has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(t.initial_comment._rxn_key,t.initial_comment.reactions);delete t.initial_comment.reactions}for(var d in t)if("channels"===d||"ims"===d||"groups"===d||"pinned_to"===d||"to"===d||"from"===d||"cc"===d||"attachments"===d){var c=false;var m=_.isArray(t[d])?t[d]:[];var f=_.isArray(r[d])?r[d]:[];"to"===d||"from"===d||"cc"===d||"attachments"===d?f.length!=m.length&&(c=true):f.join("")!=m.join("")&&(c=true);if(c){i="CHANGED";s.push(d)}}else if("preview"===d){if(r[d]!==t[d]){i="CHANGED";s=s.concat([d,"content","content_html","content_highlight_html"])}}else if("comments"===d){if(t[d]&&!TS.utility.areSimpleObjectsEqual(t[d],r[d],"file:"+t.id+" "+t.name)){i="CHANGED";s.push(d)}}else if("content"===d){if(t[d]&&r[d]!=t[d]){i="CHANGED";s.push(d)}}else if("editor"===d||"state"===d){if(t[d]!=r[d]){s.push(d);i="CHANGED"}}else if("initial_comment"===d);else if("reactions"===d);else if("channel_map"!==d&&"group_map"!==d&&"im_map"!==d&&"teams"!==d&&"teams_shared_with"!==d&&"users"!==d||TS.utility.isScalar(t[d])){if("video"===d){if(t[d]&&!TS.utility.areSimpleObjectsEqual(t[d],r[d],"file:"+t.id+" "+t.name)){i="CHANGED";s.push(d)}}else if("shares"===d)TS.boot_data.feature_file_threads&&(TS.utility.areSimpleObjectsEqual(r[d],t[d])||(i="CHANGED"));else if(r[d]!=t[d])if(t[d]&&!TS.utility.isScalar(t[d]))TS.warn(d+" is not scalar! it needs to be handled by upsertFile specifically to test if it has changed! "+n(t[d]));else if("boolean"!==typeof t[d]||!t[d]!=!r[d]){s.push(d+" ["+r[d]+"] -> ["+t[d]+"]");i="CHANGED"}}else;r=t}else{i="ADDED";t._rxn_key=TS.rxns.getRxnKey("file",t.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;if(t.comments){for(u=0;u<t.comments.length;u+=1){o=t.comments[u];o._rxn_key=TS.rxns.getRxnKey("file_comment",o.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(o._rxn_key,o.reactions);delete o.reactions}if(t.initial_comment){t.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",t.initial_comment.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t.initial_comment._rxn_key,t.initial_comment.reactions);delete t.initial_comment.reactions}}var p=TS.redux.members.getPotentiallyUnknownMemberById(t.user);if(p){p.files.push(t);TS.files.sortFiles(p.files)}else TS.error("hmmm, file "+t.id+" does not have a known user "+t.user);a(t);r=t}if("CHANGED"===i){a(t);_.includes(s,"comments")&&TS.utility.msgs.updateCommentReferences(r)}if("NOOP"!==i){TS.redux.dispatch(TS.interop.redux.models.files.addFile(r));TS.boot_data.feature_no_files_info&&TS.redux.dispatch(TS.interop.redux.features.fileUpdate.setFileUpdated({fileId:r.id}))}return{status:i,file:r,what_changed:s}},upsertAndSignal:function e(t){var n=TS.files.upsertFile(t);"CHANGED"===n.status?TS.files.team_file_changed_sig.dispatch(n.file):"ADDED"===n.status&&TS.files.team_file_added_sig.dispatch(n.file);return n},removeFile:function e(t){TS.log(4,'removing file "'+t+'"');var n=TS.files.getFileById(t);n&&(n.is_deleted=true);if(TS.boot_data.feature_file_threads&&n){TS.redux.dispatch(TS.interop.redux.models.files.tombstoneFile({fileId:t}));n=TS.files.getFileById(t)}TS.model.channels.forEach(function(e){n&&TS.utility.msgs.removeFileSharesAndMentions(e,n);n&&TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});TS.model.groups.forEach(function(e){n&&TS.utility.msgs.removeFileSharesAndMentions(e,n);n&&TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});TS.model.ims.forEach(function(e){n&&TS.utility.msgs.removeFileSharesAndMentions(e,n);n&&TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});TS.model.mpims.forEach(function(e){n&&TS.utility.msgs.removeFileSharesAndMentions(e,n);n&&TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});n&&TS.files.team_file_deleted_sig.dispatch(n)},upload:function e(t){TS.files.uploading?TS.files.uploadQ.push(t):TS.files.actuallyUpload(t)},actuallyUpload:function t(n){TS.files.uploading=true;n.retry_num=n.retry_num||0;var r=new FormData;var i;var a=!!n.file;n.title&&(n.title=TS.emoji.maybeGetCanonicalEmojiString(n.title));if(n.text){i=n.title||n.filetype;TS.files.file_uploading_sig.dispatch(i,n.retry_num>0,a);r.append("content",n.text);n.filetype&&r.append("filetype",n.filetype);n.filename&&TS.warn("ignoring filename because it makes no sense for text files")}else{i=n.title||n.filename||n.file&&n.file.name||"blob";TS.files.file_uploading_sig.dispatch(i,n.retry_num>0,a);"string"===typeof n.file?r.append("content64",n.file):r.append("file",n.file);n.filename&&r.append("filename",n.filename);n.filetype&&TS.warn("ignoring filetype we send a filename which can intuit it")}r.append("token",TS.model.api_token);if(n.channels&&n.channels.length){var s="";"string"===typeof n.channels?s=n.channels:n.channels.join&&(s=n.channels.join(","));r.append("channels",s)}r.append("title",n.title);n.initial_comment&&r.append("initial_comment",n.initial_comment);var o="files.uploadAsync";if(n.link){n.is_dropbox&&(o="files.uploadExternal");n.is_box&&(o="files.uploadExternal");r.append("link",n.link)}var l;l="files.uploadAsync"===o?TS.model.async_api_url+o:TS.model.api_url+o;var u=false;e=$.ajax({url:l,data:r,dataType:"json",cache:false,contentType:false,processData:false,type:"POST",xhr:function e(){var e=jQuery.ajaxSettings.xhr();e.upload&&e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=parseInt(100*e.loaded/e.total,10);TS.files.file_progress_sig.dispatch(t)}else TS.info("Upload length not computable")},false);return e},error:function e(t,r,a){u=true;TS.info("Error: Failed to upload file.");TS.info("textStatus:"+r+" errorThrown:"+a);TS.info("data:"+t);if("abort"===r){TS.files.file_canceled_sig.dispatch(i);TS.files.uploadOver(false);return}if(0===n.retry_num){n.retry_num+=1;TS.files.actuallyUpload(n)}else TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function e(){n.retry_num+=1;TS.files.actuallyUpload(n)},onCancel:function e(){TS.files.uploadOver(false)}})},complete:function e(t){if(u)return;t=jQuery.parseJSON(t.responseText);if(t&&t.ok&&t.file)if("files.uploadAsync"===o){var r=function e(t,n,r){if(!TS.files.polling_file_id)return;if(t)if("complete"===n.status){var i=TS.files.upsertAndSignal(n.file);TS.files.uploadProcessingOver(true,i.file.id)}else if("failed"===n.status){var a="";n.debug&&TS.boot_data.feature_tinyspeck&&(a="<br><br>TS only Debugging:<br><br>"+n.debug);TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")()+a,go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function e(){r.retry_num+=1;TS.files.actuallyUpload(r)},onCancel:function e(){TS.files.uploadProcessingOver(false,TS.files.polling_file_id)}})}else TS.files.pollForUploadProcessing();else{TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload.","files")(),show_cancel_button:true});TS.files.uploadProcessingOver(false,TS.files.polling_file_id)}};TS.files.startPollingForUploadProcessing(t.file,t.ticket,r)}else{var i=TS.files.upsertAndSignal(t.file);TS.files.uploadOver(t.ok,i.file.id)}else{TS.info("Error: Failed to upload file.");TS.info(t);if(t)if(0===n.retry_num){n.retry_num+=1;TS.files.actuallyUpload(n)}else"folders_not_supported"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Folders not supported","files")(),body:TS.interop.i18n.t("<p>Sorry, <strong>{folder_name}</strong> is a folder, and folder uploads are not supported by Slack.</p>\t\t\t\t\t\t\t\t\t<p>Try uploading a .zip version of the file instead.</p>","files")({folder_name:_.escape(n.filename)}),show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();TS.files.uploadOver(false)}}):"request_timeout"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("File upload timed out","files")(),body:TS.interop.i18n.t('<p>It looks like you\u2019re on a slow or inconsistent internet connection. You may want to try your file upload again later. Or, try again now and it might work if you cross your fingers!</p>\t\t\t\t\t\t\t\t\t<p>If you\u2019re still having problems, you can:</p>\t\t\t\t\t\t\t\t\t<ul><li><a href="/help/test" target="{new_win_name}" class="bold">Run our Self-Help Tests</a></li>\t\t\t\t\t\t\t\t\t<li><a href="/help/requests/new" target="{new_win_name}" class="bold">Contact our support team</li></ul>',"files")({new_win_name:TS.templates.builders.newWindowName()}),show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();TS.files.uploadOver(false)}}):"file_uploads_disabled"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("At the request of your administrator, file uploads have been disabled on this workspace.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}}):"file_uploads_except_images_disabled"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("At the request of your administrator, only images can be uploaded to this workspace.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}}):TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function e(){n.retry_num+=1;TS.files.actuallyUpload(n)},onCancel:function e(){TS.files.uploadOver(false)}});else{alert("Upload failed.");TS.files.uploadOver(false)}}}})},startPollingForUploadProcessing:function e(t,n,r){TS.files.polling_count=0;TS.files.polling_file_id=t;TS.files.polling_ticket=n;TS.files.polling_handler=r;TS.files.pollForUploadProcessing()},pollForUploadProcessing:function e(){TS.files.polling_count+=1;TS.files.polling_tim=setTimeout(function(){if(!TS.files.polling_ticket)return;var e=function e(t,n,r){if(!TS.files.polling_ticket)return;TS.files.polling_handler(t,n,r)};TS.api.callImmediately("files.uploadStatus",{ticket:TS.files.polling_ticket}).then(function(t){var n=t.data,r=t.args,i=t.request_id;var a=true;e(a,n,r,i);return{data:n,args:r,request_id:i}}).catch(function(t){var n=t.data,r=t.args,i=t.request_id;var a=false;e(a,n,r,i);return{data:n,args:r,request_id:i}})},1e3*TS.files.polling_count)},uploadProcessingOver:function e(t,n){if(TS.files.polling_file_id!=n)return;TS.info("TS.files.uploadProcessingOver polling_file_id:"+TS.files.polling_file_id+" polling_ticket:"+TS.files.polling_ticket+" polling_count:"+TS.files.polling_count);TS.files.polling_count=0;TS.files.polling_file_id=null;TS.files.polling_ticket=null;TS.files.polling_handler=null;clearTimeout(TS.files.polling_tim);TS.files.uploadOver(t,n)},uploadOver:function t(n,r){TS.files.file_uploaded_sig.dispatch(n,r);TS.files.uploading=false;e=null;TS.files.uploadQ.length?TS.files.actuallyUpload.call(null,TS.files.uploadQ.shift()):TS.files.file_queue_emptied_sig.dispatch()},cancelCurrentUpload:function t(){e&&e.abort()},deleteFile:function e(t){TS.api.call("files.delete",{file:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.files.onFileDelete&&TS.files.onFileDelete(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.files.onFileDelete&&TS.files.onFileDelete(i,t,n,r);return{data:t,args:n,request_id:r}})},onFileDelete:function e(t){!t},endEditFileTitle:function e(){$("#file_edit_title_container").addClass("hidden");$("#file_title_container").removeClass("hidden")},saveEditFileTitle:function e(t){var n=TS.files.getFileById(t);if(!n)return;var r=$("#file_edit_title_input").val();if(!$.trim(r)){TS.sounds.play("beep");return}var i=n.title;if(i==r){TS.files.endEditFileTitle();return}var a=function e(n){if(!n){TS.files.upsertAndSignal({id:t,title:i});TS.generic_dialog.alert(TS.interop.i18n.t("Something\u2019s gone wrong, and your change didn\u2019t save. If you see this message more than once, you may want to try restarting Slack.","files")(),TS.interop.i18n.t("Oh, crumbs!","files")(),TS.interop.i18n.t("Got it","files")())}};TS.api.callImmediately("files.edit",{file:t,title:TS.emoji.maybeGetCanonicalEmojiString(r)}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;a(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;a(i,t,n,r);return{data:t,args:n,request_id:r}});r=_.escape(r);TS.files.upsertAndSignal({id:t,title:r});TS.files.endEditFileTitle()},editFileTitle:function e(t){var n=TS.files.getFileById(t);if(!n)return;var r=n.title;r=r?TS.format.unFormatMsg(r):n.name;$("#file_title_container").addClass("hidden");$("#file_edit_title_container").removeClass("hidden");$("#file_edit_title_input").val(r);$("#file_edit_title_input").select()},openBoxChooser:function e(){TS.utility.box.unregister(TS.utility.box.SUCCESS_EVENT_TYPE,TS.files.onBoxChooser);TS.utility.box.success(TS.files.onBoxChooser);TS.utility.box.launchPopup()},onBoxChooser:function e(t){var n=new Array(t.length);for(var r=0;r<t.length;r+=1){var i=t[r];n[r]={name:i.name,link:i.url,is_box:true}}TS.boot_data.feature_file_threads?TS.redux.dispatch(TS.interop.redux.actions.openFileUploadDialog({files:n,initialChannelId:TS.model.active_cid})):TS.ui.upload_dialog.startWithCommentFromChatInput(n)},openDropboxChooser:function e(){var t="preview";Dropbox.choose({success:TS.files.onDropboxChooser,linkType:t,multiselect:true})},onDropboxChooser:function e(t){var n=[];for(var r=0;r<t.length;r+=1){var i=t[r];n.push({name:i.name,size:i.bytes,link:i.link,icon:i.icon,is_dropbox:true})}TS.boot_data.feature_file_threads?TS.redux.dispatch(TS.interop.redux.actions.openFileUploadDialog({files:n,initialChannelId:TS.model.active_cid})):TS.ui.upload_dialog.startWithCommentFromChatInput(n)},makeFileNameFromFile:function e(t){return t.name||TS.interop.i18n.t("Pasted image at {date}","files")({date:TS.interop.datetime.toFilenameFriendlyDate(Date.now()/1e3)})+".png"},makeFileTitleFromFile:function e(t){return t.name||TS.interop.i18n.t("Pasted image at {date}","files")({date:TS.interop.datetime.toDate(Date.now()/1e3)})},justUploadTheseFileNow:function e(t){var n;for(var r=0;r<t.length;r+=1){n=t[r];if(n.size>TS.model.upload_file_size_limit_bytes)continue;TS.files.upload({file:n,filename:TS.files.makeFileNameFromFile(n),title:TS.files.makeFileTitleFromFile(n),channels:[TS.shared.legacyGetActiveModelOb().id],initial_comment:""})}},refreshFile:function e(t){TS.files.startRefreshingFile(t);TS.api.call("files.refresh",{file:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.files.onFileRefresh&&TS.files.onFileRefresh(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.files.onFileRefresh&&TS.files.onFileRefresh(i,t,n,r);return{data:t,args:n,request_id:r}})},onFileRefresh:function e(t,n,r){var i=r.file;if(t)TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.interop.i18n.t("File refreshed!","files")()).end();else if(!t){TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.interop.i18n.t("Refresh failed.","files")()+"</span>",5e3);TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.interop.i18n.t("Refresh failed","files")()).end()}t&&!n.will_refresh&&TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.interop.i18n.t("File refreshed < 1 minute ago.","files")()+"</span>",5e3);if(TS.web&&t){TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.interop.i18n.t("Reloading...","files")());TS.reload(false,"TS.files.onFileRefresh")}if(!t&&"file_deleted"===n.error){var a=TS.files.getFileById(i);a&&TS.files.removeFile(a.id)}},fileWasMaybeRefreshed:function e(t){if(!t)return;if(!TS.files.waiting_for_refresh[t.id])return;TS.files.doneRefreshingFile(t.id,'<span class="kelly_green">'+TS.interop.i18n.t("File refreshed!","files")()+"</span>",6e4)},startRefreshingFile:function e(t){TS.files.waiting_for_refresh[t]=true;$('.file_refresh[data-file-id="'+t+'"]').addClass("hidden");$('.file_refresh_status[data-file-id="'+t+'"]').removeClass("hidden")},doneRefreshingFile:function e(t,n,r){delete TS.files.waiting_for_refresh[t];$('.file_refresh_status[data-file-id="'+t+'"]').html(n);setTimeout(function(){$('.file_refresh[data-file-id="'+t+'"]').removeClass("hidden");$('.file_refresh_status[data-file-id="'+t+'"]').text(TS.interop.i18n.t("Refreshing file...","files")()).addClass("hidden")},r)},reShareConfirmation:function e(t,n){var r=t.map(function(e){return TS.interop.members.getPrefCompliantMemberNameById(e.user,true)});r=_.uniq(r);var i=TS.shared.legacyGetActiveModelOb();var a=TS.interop.rules.channels.isExternallySharedChannel(i);var s;var o;if(a&&(i.is_im||i.is_mpim||i.is_private)){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}}?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, {file_count, plural, =1 {the file} other {they}} could be shared with anyone from <strong>{workspace_name}</strong>.</p>","files")({user_names:TS.interop.i18n.listify(r).join(""),workspace_name:_.escape(i.is_im?TS.teams.getTeamNameByMemberId(i.user):TS.interop.i18n.listify(_.map(i.shared_team_ids,TS.teams.getTeamNameById)).join("")),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(a&&i.is_channel){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}}?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, {file_count, plural, =1 {the file} other {they}} will be viewable by anyone from <strong>{workspace_names}</strong>.</p>","files")({user_names:TS.interop.i18n.listify(r).join(""),workspace_names:_.escape(TS.interop.i18n.listify(_.map(i.shared_team_ids,TS.teams.getTeamNameById)).join("")),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(i.is_im){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by <strong>{recipient_name}</strong>.</p>","files")({user_names:TS.interop.i18n.listify(r).join(""),recipient_name:TS.templates.builders.makeModelObNameForDisplay(i),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(i.is_mpim){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by everyone in this conversation.</p>","files")({user_names:TS.interop.i18n.listify(r).join(""),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else{s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by anyone in <strong>{channel_name}</strong>.</p>","files")({user_names:TS.interop.i18n.listify(r).join(""),channel_name:TS.templates.builders.makeModelObNameForDisplay(i),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}TS.generic_dialog.start({title:s,body:o,show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Share {file_count, plural, =1 {file} other {files}}","files")({file_count:t.length}),cancel_button_text:TS.interop.i18n.t("Cancel","files")(),onGo:n})},updateFileListItem:function e(t,n){var r=n.find('.file_list_item[data-file-id="'+t.id+'"]');if(r.length){r.replaceWith(TS.templates.builders.fileHTML(t));TS.files.fileIsImage(t)&&n.find(".lazy").lazyload()}},containerHasFileListItem:function e(t,n){return!!n.find('.file_list_item[data-file-id="'+t.id+'"]').length},nonImageCanUseFSFV:function e(t){if(!t)return false;return TS.model.pdf_viewer_enabled&&"hosted"===t.mode&&TS.files.fileIsPDF(t)&&t.size<=5e7},maybePruneChannels:function e(t){if(!t)return;if(t.channels&&t.channel_map){var n=_(t.channel_map).map(function(e){return TS.interop.rules.channels.isOrgShared(e)||e.team===TS.model.team.id?e.id:void 0}).compact().value();t.channels=_.intersection(t.channels,n)}}});var e=null;var t=20;var i={};var a=function e(t){if(!TS.files.fileIsImage(t))return;var n={width:t.thumb_360_w,height:t.thumb_360_h,link_url:t.url_private,internal_file_id:t.id};"gif"===t.filetype&&(t.deanimate_gif?TS.inline_imgs.makeInternalInlineImg(t.deanimate_gif,n):t.thumb_160&&TS.inline_imgs.makeInternalInlineImg(t.thumb_160,n));if(t.thumb_480_gif||t.thumb_360_gif){t.thumb_480_gif&&TS.inline_imgs.makeInternalInlineImg(t.thumb_480_gif,n);t.thumb_360_gif&&TS.inline_imgs.makeInternalInlineImg(t.thumb_360_gif,n)}else{t.thumb_720&&TS.inline_imgs.makeInternalInlineImg(t.thumb_720,n);t.thumb_480&&TS.inline_imgs.makeInternalInlineImg(t.thumb_480,n);t.thumb_360&&TS.inline_imgs.makeInternalInlineImg(t.thumb_360,n);TS.boot_data.feature_pjpeg&&t.pjpeg&&TS.inline_imgs.makeInternalInlineImg(t.pjpeg,n);TS.boot_data.feature_pdf_thumb&&t.thumb_pdf&&TS.inline_imgs.makeInternalInlineImg(t.thumb_pdf,n)}};var s=function e(t,r,a,s){var l=function e(i){var s;if(i&&i.data){if(i.data.file&&"email"===i.data.file.mode&&(!i.data.file.simplified_html||!TS.utility.isScalar(i.data.file.simplified_html))){var l=true;var u={type:n(i.data.file.simplified_html)};TS.console.logError(u,"simplified_html missing from files.info response","email_simplified_html_missing_v2",l)}var d=!!r;o(i.data.ok,i.data,i.args,d);s=r?i.data.file:TS.files.getFileById(t)}a&&a(t,s);return s||t};var u=500;var d=i[t];if(!d){TS.boot_data.feature_no_files_info&&TS.redux.dispatch(TS.interop.redux.features.fileUpdate.setFileFetching({fileId:t}));d=TS.api.call("files.info",{file:t,page:1,count:u,truncate:1,_x_reason:s});i[t]=d;d.finally(function(){delete i[t]})}return d.then(function(e){return l(e)}).catch(function(e){return l(e)})};var o=function e(t,n,r,i){if(!t){if("file_deleted"===n.error){var a=TS.files.getFileById(r.file);a?TS.files.removeFile(a.id):r.file&&TS.files.removeFile(r.file)}else"file_not_found"===n.error&&TS.files.removeFile(r.file);return}if(n.file){n.file.comments=n.comments;n.file.content=n.content;n.file.content_html=n.content_html;n.file.content_highlight_html=n.content_highlight_html;i||TS.files.upsertAndSignal(n.file)}};var l=function e(t){var n=_.isString(t)?TS.files.getFileById(t):t;if(!_.isObject(n))throw new Error("Expected file or file ID.");return n}})()},11220:function(e,t){(function(){TS.registerModule("ims",{switched_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,closed_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,onStart:function e(){TS.prefs.display_real_names_override_changed_sig.add(r);TS.prefs.team_display_real_names_changed_sig.add(r);TS.members.changed_profile_sig.add(n)},legacyAddMsg:function e(t,n){var r=TS.interop.channels.getImById(t);if(!r){TS.error('unknown im "'+t+'"');return}if(TS.useReactMessages()){if(!TS.redux.messages.addMessage(n,true))return;if(TS.interop.messages.isReply(n)&&!TS.shared.legacyAddMsg(r,n))return}else if(!TS.shared.legacyAddMsg(r,n))return;var i=!TS.interop.rules.messages.isTempMsg(n);TS.ims.legacyCalcUnreadCnts(r,i);TS.utility.msgs.maybeTruncateMsgs(r);TS.ims.message_received_sig.dispatch(r,n);r.is_open||TS.api.call("conversations.open",{users:r.user,return_im:true,reason:"TS.ims.legacyAddMsg"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}})},legacyCalcUnreadCnts:function e(t,n){TS.shared.legacyCalcUnreadCnts(t,TS.ims,n)},legacyRemoveMsg:function e(t,n){var r=TS.interop.channels.getImById(t);if(!r){TS.error('unknown im "'+t+'"');return}TS.useReactMessages()&&TS.redux.messages.removeMessage(n);if(!TS.useReactMessages()||TS.interop.messages.isReply(n)){r._archive_msgs&&TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n)}TS.ims.message_removed_sig.dispatch(r,n);TS.ims.legacyCalcUnreadCnts(r,true)},legacyOnSendMsg:function e(t,n){var r=TS.interop.channels.getImById(n.SENT_MSG.channel);if(!r){TS.error("unknown im? "+n.SENT_MSG.channel);return}TS.shared.legacyOnSendMsg(t,n,r,TS.ims)},legacyOnClose:function e(t){if(!TS.client)return;var n=TS.model.active_im_id===t;n?TS.client.activeChannelDisplayGoneAway():TS.ims.closed_sig.dispatch(TS.interop.channels.getImById(t))},legacyStartImById:function e(t,n,r){var i=TS.interop.channels.getImById(t);if(!i){TS.error(t+" not an im");return}TS.ims.legacyStartImByMemberId(i.user,n,r)},legacyStartImByMemberId:function e(t,n,r){if(TS.useReactMessages()){var i=TS.shared.legacyGetActiveModelOb();i&&TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessagesInChannel({channelId:i.id}))}var a=TS.redux.channels.getImByMemberId(t);if(a){TS.interop.channels.isImWithDeletedMember(a.id)&&(TS.client.archives.previous_model_ob=TS.shared.legacyGetActiveModelOb());TS.ims.legacyDisplayIm(a.id,n);if(a.is_open){r&&TS.shared.legacySendMsg(a.id,$.trim(r));return Promise.resolve()}}TS.redux.dispatch(TS.interop.redux.features.pendingOpenIm.addPendingOpenIm({memberId:t,msgText:r}));return TS.interop.channels.openConversationByMembers({memberIds:[t],reason:"TS.ims.legacyStartImByMemberId"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}})},promiseToStartImByMemberId:function e(t,n,r,i){var a;a=TS.useReactMessages()?TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(t)).catch(function(e){e&&"editing-message"===e.message&&TS.ui.fs_modal.close();throw e}):TS.ims.legacyStartImByMemberId(t,n,r,i);var s=function e(){var n=TS.shared.legacyGetActiveModelOb();return n&&n.is_im&&n.user===t};if(s())return Promise.resolve();return a.then(function(){if(s())return Promise.resolve();var e;return new Promise(function(t){e=function e(){if(s())return t()};TS.ims.switched_sig.add(e)}).timeout(3e4).finally(function(){TS.redux.dispatch(TS.interop.redux.features.pendingOpenIm.clearPendingOpenIm({memberId:t}));TS.ims.switched_sig.remove(e)})}).catch(_.noop)},legacyOnOpened:function e(t,n,r){if(!t)return;r.return_im&&n.channel&&TS.interop.channels.upsertIm(n.channel)},legacyDisplayIm:function e(t,n,r){if(TS.isPartiallyBooted()&&t!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+t);var i=TS.interop.channels.getImById(t);if(!i){TS.error('im "'+t+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(i);TS.shared.legacyMaybeClearHasAutoScrolled();TS.shared.legacyDidDeferMessageHistoryById(i.id)&&TS.shared.legacyCheckInitialMsgHistory(i,TS.ims);if(t==TS.model.active_im_id&&!TS.client.activeChannelIsHidden()){r&&TS.shared.legacySendMsg(i.id,$.trim(r));return}TS.has_pri[s]&&TS.log(s,"legacyDisplayChannel (im): "+t);var a=TS.client.channelDisplaySwitched({id:t,no_history_add:n});a&&TS.ims.switched_sig.dispatch();r&&TS.shared.legacySendMsg(i.id,$.trim(r))},setLastRead:function e(t,n,r){if(TS.boot_data.feature_modern_set_last_read)return TS.redux.dispatch(TS.interop.actions.setLastRead({id:t.id,ts:n}));var i;if(TS.useReactMessages()){i=TS.model.last_reads_set_by_client[t.id+"_"+n];delete TS.model.last_reads_set_by_client[t.id+"_"+n]}if(t.last_read==n)return false;if(n.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts:"+n);return false}var s=t.id+". last_read = "+t.last_read+" -> "+n+", reason: "+(r||"unspecified");if(t.last_read>n){if(!TS.useReactMessages()){i=TS.model.last_reads_set_by_client[t.id+"_"+n];delete TS.model.last_reads_set_by_client[t.id+"_"+n]}if(i){TS.warn("NOT going back in time on im "+s);return}TS.has_pri[a]&&TS.log(a,"going back in time on im "+s);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,n)}else{TS.has_pri[a]&&TS.log(a,"TS.ims.setLastRead: "+s);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,n)}if(TS.has_pri[a]){var o=TS.shared.legacyGetActiveModelOb();if(o&&o.id&&o.id!==t.id){TS.log(a,"setLastRead: IM "+t.id+" was marked with reason = "+(r||"unspecified")+", but is NOT active ("+o.id+"). Should it have been marked?\nTS.client.ui.isUserAttentionOnChat(): "+TS.client.ui.isUserAttentionOnChat()+"\nactiveChannelIsHidden: "+TS.client.activeChannelIsHidden());TS.log(a,"setLastRead stacktrace: "+TS.console.getStackTrace())}}t.last_read=n;r&&(t._marked_reason=r);TS.ims.marked_sig.dispatch(t);TS.shared.legacyMaybeClearUsersCountsInfo(t);TS.ims.legacyCalcUnreadCnts(t);return true},legacyMarkMostRecentReadMsg:function e(t,n,r){if(!t){TS.error("im unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:n}));return}if((!t.msgs||!t.msgs.length)&&!r)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){var s=t.msgs&&t.msgs.length;TS.has_pri[a]&&TS.log(a,"legacyMarkMostRecentReadMsg: no most_recent_valid_ts for IM "+t.id+"? "+s+" msgs at present.");(t.msgs&&t.msgs.length||!t._latest_via_users_counts)&&TS.warn('no valid tses for im "'+t.id+'"???');return}if(TS.has_pri[a]){var o=TS.shared.legacyGetActiveModelOb();var l=(t&&t.id)===(o&&o.id);n?TS.log(a,"IM "+t.id+" marked with reason = "+n):TS.log(a,"IM "+t.id+" marked without reason.");if(n&&!l){TS.log(a,"markMostRecentReadReadMsg: IM "+t.id+" was marked with reason = "+(n||"unspecified")+", but is NOT active ("+o.id+"). Should it have been marked?\nTS.client.ui.isUserAttentionOnChat(): "+TS.client.ui.isUserAttentionOnChat()+"\nactiveChannelIsHidden: "+TS.client.activeChannelIsHidden());TS.log(a,"markMostRecentReadReadMsg stacktrace: "+TS.console.getStackTrace())}}TS.ims.markReadMsg(t.id,i,n)},markReadMsg:function e(t,n,r){if(TS.boot_data.feature_modern_set_last_read){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:n,reason:r}));return}var i=TS.interop.channels.getImById(t);if(!i){TS.error('im "'+t+'" unknown');return}if(i.last_read==n)return;if(TS.ims.setLastRead(i,n,r)){i._marked_reason=r;var a=true;TS.redux.channels.setMarkingState(i.id,a)}},getDisplayNameOfUserForIm:function e(n){return t(n)},getDisplayNameOfUserForImLowerCase:function e(t){return TS.members.getPrefCompliantMemberNameLowerCase(TS.interop.members.getMemberById(t.user))},getImByUsername:function e(t){if(TS.boot_data.feature_deprecate_get_member_by_name){TS.logError("Tried to get IM by username","get_member_by_name","getImByUsername");return}var n=TS.interop.members.getMemberByName(t);if(!n)return null;return TS.redux.channels.getImByMemberId(n.id)},getFirstOpenIm:function e(){var t=TS.model.ims;var n;if(!t)return null;for(var r=0;r<t.length;r+=1){n=t[r];if(n.is_open)return n}return null},setNameFromMember:function t(n){var r=TS.redux.channels.getImByMemberId(n.id);if(!r)return;e(r,n)},legacyMaybeCallCheckInitialMsgHistory:function e(t){if(TS.client&&(t.is_open||t.unread_cnt)){var n=true;TS.shared.legacyCheckInitialMsgHistory(t,TS.ims,n)}},legacyUpdateClientFromUpsert:function e(t,n){if(TS.client){var r=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(t);TS.model.active_cid==t.id?TS.ims.legacyCalcUnreadCnts(t,r):n||TS.ims.legacyCalcUnreadCnts(t,r)}},legacyMarkScrollTop:function e(t,n){var r=TS.interop.channels.getImById(t);if(!r)return false;if(r.scroll_top==n)return false;r.scroll_top=n;return true},legacyMaybeLoadScrollBackHistory:function e(t,n){var r=TS.interop.channels.getImById(t);if(!r)return false;return TS.shared.legacyMaybeLoadScrollBackHistory(r,TS.ims,n)},legacyOnHistory:function e(t,n,r){var i=TS.interop.channels.getImById(r.channel);if(!i){TS.error('wtf no im "'+r.channel+'"');return}if(!t||!n||!n.messages){TS.error("failed to get history for im "+r.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=TS.utility.getHistoryRetryDelay(i.history_fetch_retries,_.get(n,"error"));TS.info("retrying history fetch on im "+i.id+" in "+a);window.setTimeout(function(){TS.info("retrying history fetch on im "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.ims.legacyFetchHistory(i,r,TS.ims.legacyOnHistory)},a);return}i.history_fetch_retries=0;var s=TS.shared.legacyOnHistory(i,n,r,TS.ims);if(!s){i.history_is_being_fetched=false;TS.ims.history_fetched_sig.dispatch(i)}var o=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.ims.legacyCalcUnreadCnts(i,o)},legacyFetchHistory:function e(t,n,r){if(!t){TS.error('wtf no im "'+t+'"');return}t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.ims.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;TS.client&&TS.client.msg_pane.updateEndMarker();return}r=r||TS.ims.legacyOnHistory;TS.api.call("conversations.history",n).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})}});var e=function e(t,n){TS._incremental_boot&&t.name||(t.name=t.user);n&&(t.name=n.name);t._name_lc=_.toLower(t.name)};var t=function e(t){if(t._display_name)return t._display_name;var n=t.user;var r=TS.interop.members.getMemberById(t.user);if(!r){t.name!==t.user||TS.boot_data.feature_non_blocking_user_boot||TS.console.logError({msg:"IM name looks like a member ID",im_user:n},"im_name_is_id");return t.name}var i=TS.interop.members.getPrefCompliantMemberName(r);if(i===t.user||i===r.id){TS.console.logError({msg:"Member name looks like an ID",im_user:n,member:r},"member_name_is_id");return t.name}t._display_name=i;return t._display_name};var n=function e(t){var n=_.find(TS.model.ims,{user:t.id});n&&i(n)};var r=function e(){TS.model.ims.forEach(i)};var i=function e(t){t._display_name=void 0};var a=142;var s=999})()},11221:function(e,t){(function(){TS.registerModule("mpims",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,onStart:function e(){TS.prefs.display_real_names_override_changed_sig.add(r);TS.prefs.team_display_real_names_changed_sig.add(r);TS.members.changed_profile_sig.add(n)},legacyAddMsg:function e(t,n){var r=TS.interop.channels.getMpimById(t);if(!r){TS.error('unknown mpim "'+t+'"');return}if(TS.useReactMessages()){if(!TS.redux.messages.addMessage(n,true))return;if(TS.interop.messages.isReply(n)&&!TS.shared.legacyAddMsg(r,n))return}else if(!TS.shared.legacyAddMsg(r,n))return;var i=!TS.interop.rules.messages.isTempMsg(n);TS.mpims.legacyCalcUnreadCnts(r,i);TS.utility.msgs.maybeTruncateMsgs(r);TS.mpims.message_received_sig.dispatch(r,n);if(!r.is_open&&TS.interop.messages.canCountAsUnreadForCurrentUser(n,TS.model.user.id))if(1==r.members.length){var a=r.members[0];TS.api.call("conversations.open",{users:a,return_im:true,reason:"TS.mpims.legacyAddMsg"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,n,r);return{data:t,args:n,request_id:r}})}else if(r.members.length>1){var s=r.members.join(",");TS.api.call("conversations.open",{users:s})}},legacyCalcUnreadCnts:function e(t,n){TS.shared.legacyCalcUnreadCnts(t,TS.mpims,n)},legacyRemoveMsg:function e(t,n){var r=TS.interop.channels.getMpimById(t);if(!r){TS.error('unknown mpim "'+t+'"');return}TS.useReactMessages()&&TS.redux.messages.removeMessage(n);if(!TS.useReactMessages()||TS.interop.messages.isReply(n)){r._archive_msgs&&TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n)}TS.mpims.message_removed_sig.dispatch(r,n);TS.mpims.legacyCalcUnreadCnts(r,true)},legacyOnSendMsg:function e(t,n){var r=TS.interop.channels.getMpimById(n.SENT_MSG.channel);if(!r){TS.error("unknown mpim? "+n.SENT_MSG.channel);return}TS.shared.legacyOnSendMsg(t,n,r,TS.mpims)},legacyDisplayMpim:function e(t){var n=_.defaults({},t,{from_history:false,replace_history_state:false});var r=n.id;if(!r){TS.error("no mpim id supplied");return}var i=n.path;var a=n.and_send_txt;var s=n.from_history;var o=n.replace_history_state;if(TS.isPartiallyBooted()&&r!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+r);var u=TS.interop.channels.getMpimById(r);if(!u){TS.error('mpim "'+r+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);TS.shared.legacyMaybeClearHasAutoScrolled();TS.shared.legacyDidDeferMessageHistoryById(u.id)&&TS.shared.legacyCheckInitialMsgHistory(u,TS.mpims);if(r==TS.model.active_mpim_id&&!o&&!TS.client.activeChannelIsHidden()){TS.warn('mpim "'+r+'" already displayed');a&&TS.shared.legacySendMsg(r,$.trim(a));return}TS.has_pri[l]&&TS.log(l,"legacyDisplayChannel (mpim): "+r);var d=!o&&s;var c=i||"/messages/"+u;var m=TS.client.channelDisplaySwitched({id:r,path:c,replace_history_state:o,no_history_add:d});m&&TS.mpims.switched_sig.dispatch();if(u.is_open){a&&TS.shared.legacySendMsg(r,$.trim(a));return}TS.model.requested_mpim_opens[r]={and_send_txt:a};var f=u.members.filter(function(e){return TS.model.user.id!==e});TS.api.call("conversations.open",{users:f.join(",")})},setLastRead:function e(t,n,r){if(TS.boot_data.feature_modern_set_last_read)return TS.redux.dispatch(TS.interop.actions.setLastRead({id:t.id,ts:n}));var i;if(TS.useReactMessages()){i=TS.model.last_reads_set_by_client[t.id+"_"+n];delete TS.model.last_reads_set_by_client[t.id+"_"+n]}if(t.last_read==n)return false;if(n.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts:"+n);return false}var a=t.id+". last_read = "+t.last_read+" -> "+n+", reason: "+(r||"unspecified");if(t.last_read>n){if(!TS.useReactMessages()){i=TS.model.last_reads_set_by_client[t.id+"_"+n];delete TS.model.last_reads_set_by_client[t.id+"_"+n]}if(i){TS.warn("NOT going back in time on mpim "+a);return}TS.has_pri[o]&&TS.log(o,"going back in time on mpim "+a);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,n)}else{TS.has_pri[o]&&TS.log(o,"TS.mpims.setLastRead: "+a);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,n)}t.last_read=n;r&&(t._marked_reason=r);TS.mpims.marked_sig.dispatch(t);TS.shared.legacyMaybeClearUsersCountsInfo(t);TS.mpims.legacyCalcUnreadCnts(t);return true},legacyMarkMostRecentReadMsg:function e(t,n,r){if(!t){TS.error("mpim unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:n}));return}if((!t.msgs||!t.msgs.length)&&!r)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){(t.msgs&&t.msgs.length||!t._latest_via_users_counts)&&TS.warn('no valid tses for mpim "'+t.id+'"???');return}TS.mpims.markReadMsg(t.id,i,n)},markReadMsg:function e(t,n,r){if(TS.boot_data.feature_modern_set_last_read){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:n,reason:r}));return}var i=TS.interop.channels.getMpimById(t);if(!i){TS.error('mpim "'+t+'" unknown');return}if(i.last_read==n)return;if(TS.mpims.setLastRead(i,n,r)){i._marked_reason=r;var a=true;TS.redux.channels.setMarkingState(i.id,a)}},legacyGetMembersInDisplayOrder:function e(t){if(!t)return;return _.chain(t.members).without(TS.model.user.id).map(function(e){var t=TS.redux.members.getPotentiallyUnknownMemberById(e);TS.boot_data.feature_non_blocking_user_boot||t&&!t.is_unknown&&!t.is_nonexistent||TS.warn("Could not find a member in model with id: "+e);return t}).compact().value()},legacyGetDisplayName:function e(t,n,r,i,o){var l=_.isInteger(i);if(t._display_name&&!n&&!r&&!l&&!o)return t._display_name;if(t._display_name_truncated&&!n&&!r&&!o&&l)return t._display_name_truncated;if(o)return s(t);return a(t,n)},getMemberCount:function e(t){return Math.min(Math.max(t.members.length-1,2),9)},makeNameForMpim:function t(n){return e(n)},legacyMaybeCallCheckInitialMsgHistory:function e(t){if(TS.client&&(t.is_open||t.unread_cnt)){var n=true;TS.shared.legacyCheckInitialMsgHistory(t,TS.mpims,n)}},legacyUpdateClientFromUpsert:function e(t,n){if(TS.client){var r=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(t);TS.model.active_cid==t.id?TS.mpims.legacyCalcUnreadCnts(t,r):n||TS.mpims.legacyCalcUnreadCnts(t,r)}},legacyMarkScrollTop:function e(t,n){var r=TS.interop.channels.getMpimById(t);if(!r)return false;if(r.scroll_top==n)return false;r.scroll_top=n;return true},legacyMaybeLoadScrollBackHistory:function e(t,n){var r=TS.interop.channels.getMpimById(t);if(!r)return false;return TS.shared.legacyMaybeLoadScrollBackHistory(r,TS.mpims,n)},legacyOnHistory:function e(t,n,r){var i=TS.interop.channels.getMpimById(r.channel);if(!i){TS.error('error no mpim "'+r.channel+'"');return}if(!t||!n||!n.messages){TS.error("failed to get history for mpim "+r.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=TS.utility.getHistoryRetryDelay(i.history_fetch_retries,_.get(n,"error"));TS.info("retrying history fetch on mpim "+i.id+" in "+a);window.setTimeout(function(){TS.info("retrying history fetch on mpim "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.ims.legacyFetchHistory(i,r,TS.mpims.legacyOnHistory)},a);return}i.history_fetch_retries=0;var s=TS.shared.legacyOnHistory(i,n,r,TS.mpims);if(!s){i.history_is_being_fetched=false;TS.mpims.history_fetched_sig.dispatch(i)}var o=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.mpims.legacyCalcUnreadCnts(i,o)},legacyFetchHistory:function e(t,n,r){if(!t){TS.error('error no mpim "'+t+'"');return}t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.mpims.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;TS.client&&TS.client.msg_pane.updateEndMarker();return}r=r||TS.mpims.legacyOnHistory;TS.api.call("conversations.history",n).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},setNamesFromMember:function e(n){TS.model.mpims.forEach(function(e){if(_.includes(e.members,n.id)){t(e);i(e)}})},checkMpimMatch:function e(t,n,r){if(!t)return;var i=true;var a=true;var s=TS.mpims.legacyGetMembersInDisplayOrder(t);for(var o=0;o<n.length;o+=1){var l=false;for(var u=0;u<s.length;u+=1)(TS.utility.members.checkMemberMatch(s[u],n[o],i)||r&&TS.utility.members.checkMemberMatch(s[u],r[o],i))&&(l=true);l||(a=false)}return a}});var e=function e(t){var n=TS.mpims.legacyGetMembersInDisplayOrder(t);if(n.length<2)return t._internal_name;return"@"+_(n).compact().map(function(e){if(TS.interop.members.isExternal(e))return e.name+"_"+e.team_id;return e.name}).value().join(",")};var t=function t(n){if(!n||!n.id)return;var r=e(n);var i=_.toLower(r);n.name===r&&n._name_lc===i||TS.redux.dispatch(TS.interop.redux.models.channels.bulkUpdateChannels({channels:[{id:n.id,name:r,_name_lc:i}]}))};var n=function e(t){TS.model.mpims.forEach(function(e){-1!==e.members.indexOf(t.id)&&i(e)})};var r=function e(){TS.model.mpims.forEach(i)};var i=function e(t){t._display_name=void 0};var a=function e(t,n){var r=TS.mpims.legacyGetMembersInDisplayOrder(t);var i=false;var a=_(r).map(function(e){var t=TS.interop.members.getPrefCompliantMemberName(e);e.is_unknown&&(i=true);if(n){var r="";var a=TS.interop.members.getMemberCurrentStatus(e,TS.team.getTeamCustomStatusPresets(),TS.boot_data.feature_i18n_custom_status);(a.emoji||a.text)&&(r=" "+TS.templates.current_status({tip_direction:"bottom",member:e,classes:"ts_tip_float"}));t=_.escape($.trim(t));t='<li class="mpdm_member '+TS.templates.makeMemberDomId(e)+" "+TS.templates.makeMemberPresenceStateClass(e)+'" data-member-id="'+e.id+'">'+t+r+"</li>"}return t}).compact().value();var s=n?a.join(" "):a.join(", ");n||i||(t._display_name=s);return s};var s=function e(t){var n=TS.mpims.legacyGetMembersInDisplayOrder(t);var r=n.map(function(e){return TS.interop.members.getPrefCompliantMemberName(e)});var i=TS.interop.i18n.listify(r,{strong:true}).join("");return i};var o=142;var l=999})()},11222:function(e,t){(function(){var e="HISTORY";TS.registerModule("shared",{msg_sent_sig:new signals.Signal,onStart:function e(){if(TS.client){TS.channels.switched_sig.add(p);TS.ims.switched_sig.add(p);TS.groups.switched_sig.add(p);TS.mpims.switched_sig.add(p);TS.client&&TS.client.unread&&TS.client.unread.switched_sig.add(p);TS.client&&TS.client.threads&&TS.client.threads.switched_sig.add(p);var t=function e(){n=true;y()};TS.redux.socket.connectedSig.addOnce(t);TS.redux.socket.connectedSig.add(k)}},test:function e(){var t={};Object.defineProperty(t,"_queried_usernames",{get:function e(){return w},set:function e(t){w=t}});return t},legacyDidDeferMessageHistoryById:function e(t){if(!t)return false;return i[t]},legacySetDeferMessageHistoryForId:function e(t,n){if(!t)return;i[t]=!!n},legacyMaybeClearUsersCountsInfo:function e(t){if(!t)return;if(I(t.id))return;TS.has_pri[H]&&TS.log(H,"Deleting users_counts_info for "+t.id);TS.shared.legacyDeleteUserCountsInfoForId(t.id)},legacySetUserCountsInfoForId:function e(t,n){if(!t)return;s[t]=n},legacyDeleteUserCountsInfoForId:function e(t){if(!t)return;delete s[t]},legacyGetOldestUnreadTsForId:function e(t){if(!t)return;return o[t]},legacySetOldestUnreadTsForId:function e(t,n){if(!t)return;o[t]=n},legacyCalcUnreadCnts:function e(t,n,r){if(TS.useReactMessages())return;if(TS._incremental_boot)return;if(TS.shared.legacyDidDeferMessageHistoryById(t.id)){if(t.is_im||t.is_mpim){TS.shared.legacyCheckInitialMsgHistory(t,n);return}if(!a[t.id]){var i=2500;var o=1e4;var l=_.random(i,o);TS.has_pri[A]&&TS.log(A,"legacyCalcUnreadCnts ("+t.id+"): no history in model, no history call yet - delaying "+l+" ms before history fetch.");a[t.id]=window.setTimeout(function(){TS.has_pri[A]&&TS.log(A,"legacyCalcUnreadCnts ("+t.id+"): fetching after "+l+" ms delay.");delete a[t.id];TS.shared.legacyCheckInitialMsgHistory(t,n)},l)}}t.unreads.length=0;t.unread_highlights.length=0;TS.shared.legacySetOldestUnreadTsForId(t.id,null);var u=t.msgs;var d=t.unread_cnt;var c=t.unread_highlight_cnt;var m;var f=false;var p=false;var h=true;var g="away"===TS.redux.presence.getPresenceByMemberId(TS.model.user.id);if(!t.was_archived_this_session){t.is_archived&&(h=false);t.is_channel&&!t.is_member&&(h=false)}if(t.is_im){var S=TS.interop.members.getMemberById(t.user);S&&S.deleted&&(h=false)}var T=TS.notifs.isCorGMuted(t.id);var v=t.is_im||t.is_mpim||TS.notifs.canModelObHaveChannelMentions(t);var b;if(h&&u)for(var y=0;y<u.length;y+=1){m=u[y];if(m.ts<=t.last_read)continue;if(TS.interop.rules.messages.isTempMsg(m)&&!m._alert_even_though_temp)continue;p=TS.interop.messages.canCountAsUnreadForCurrentUser(m,TS.model.user.id);f=f||p;if(!p)continue;t.unreads.push(m.ts);var w=TS.shared.legacyGetOldestUnreadTsForId(t.id);(!w||m.ts<w)&&TS.shared.legacySetOldestUnreadTsForId(t.id,m.ts);if("thread_broadcast"===m.subtype)continue;if(v){var k=1e3*parseFloat(m.ts);b=g||k<TS.model.user._presence_last_changed;if(TS.interop.messages.containsMention(m,b))if(TS.permissions.members.canMsgMentionChannelIfMention(m.text,t.id,m.user)){TS.log(99,"allowing channel mention for msg.ts "+m.ts+" from member "+m.user+" in "+t.id);t.unread_highlights.push(m.ts)}else TS.log(99,"ignoring large channel mention for msg.ts "+m.ts+" from member "+m.user+" in "+t.id+" because member is not an admin.")}else TS.utility.msgs.getMsgMentionData(m).non_channel_mentions&&t.unread_highlights.push(m.ts)}if(!f&&t.unreads.length){t.unreads.length=0;t.unread_highlights.length=0;TS.shared.legacySetOldestUnreadTsForId(t.id,null);r&&n.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.none_qualify)}TS.has_pri[E]&&TS.log(E,"TS.shared.legacyCalcUnreadCnts: "+t.id+", unreads.length: "+t.unreads.length+" and_mark: "+r);var x=TS.shared.lastReadIsOlderThanCurrentHistory(t);t.unread_cnt=x?Math.max(t.unread_cnt,t.unreads.length):t.unreads.length;T&&t.unread_cnt&&(t._show_in_list_even_though_no_unreads=true);t.unread_highlight_cnt=x?Math.max(t.unread_highlight_cnt,t.unread_highlights.length):t.unread_highlights.length;TS.shared.legacyMaybeMarkReadIfMuted(t,n);TS.utility.msgs.countAllUnreads();d!=t.unread_cnt&&n.unread_changed_sig.dispatch(t);c!=t.unread_highlight_cnt&&n.unread_highlight_changed_sig.dispatch(t);if(TS.client){if(!s[t.id]||!s[t.id].has_unreads)return;if(!t._history_fetched_since_last_connect||t.history_is_being_fetched)return;if(!t.msgs.length||t.unread_cnt)return;delete s[t.id];if(TS.notifs.isCorGMuted(t.id)){TS.has_pri[E]&&TS.log(E,"TS.shared.legacyCalcUnreadCnts: "+t.id+": ignoring possible users.counts has_unreads discrepancy because channel is muted.");return}var C=TS.shared.legacyGetActiveModelOb();if(C&&C.id===t.id){TS.has_pri[E]&&TS.log(E,"TS.shared.legacyCalcUnreadCnts: "+t.id+": ignoring possible users.counts has_unreads discrepancy due to active channel.");return}var M=TS.utility.msgs.getMostRecentValidTs(t);var I=TS.model.marked_reasons.none_qualify;TS.warn('Found users.counts discrepancy: has_unreads = true for "'+t.id+'", but client calculated 0 unreads after fetching history ('+t.msgs.length+' msgs). Marking now with reason="'+I+'" to correct discrepancy, assuming last_read ('+t.last_read+") < latest ("+M+").");if(parseFloat(t.last_read)>=parseFloat(M)){TS.warn('Error last >= latest for "'+t.id+'"? Bailing, not attempting to mark.');return}n.legacyMarkMostRecentReadMsg(t,I)}},legacyQueueConsistencyCheckAfterHistory:function e(t){if(!t){TS.warn("legacyQueueConsistencyCheck: no model_ob");return}if(t._consistency_is_being_checked||t._consistency_has_been_checked)return;var n=TS.shared.legacyGetControllerForModelOb(t);n.history_fetched_sig.addOnce(function(e){if(!e)return;if(e._consistency_is_being_checked||e._consistency_has_been_checked)return;TS.has_pri[A]&&TS.log(A,'"'+t.id+'": fetched history, now checking consistency.');TS.utility.msgs.checkConsistencyViaApi(e.id)})},legacyMaybeFetchHistoryAndThenCheckConsistency:function e(t){var n=true;TS.shared.legacyMaybeFetchHistory(t,n)},legacyMaybeFetchHistory:function e(t,n,r){if(!t){TS.warn("legacyMaybeFetchHistory: no model_ob?");return}var i;TS.has_pri[A]&&(i='legacyMaybeFetchHistory: "'+t.id+'": ');if(t.history_is_being_fetched){TS.has_pri[A]&&TS.log(A,i+"history is being fetched already. Queueing consistency check and exiting.");TS.shared.legacyQueueConsistencyCheckAfterHistory(t);return}if(t._history_fetched_since_last_connect){TS.has_pri[A]&&TS.log(A,i+"history already fetched.");TS.utility.msgs.checkConsistencyViaApi(TS.model.active_cid);return}TS.has_pri[A]&&(n?TS.log(A,i+"checking history first, then consistency."):TS.log(A,i+"checking history."));n&&TS.shared.legacyQueueConsistencyCheckAfterHistory(t);var a=TS.shared.legacyGetControllerForModelOb(t);TS.shared.legacyCheckInitialMsgHistory(t,a,r);TS.client&&TS.client.msg_pane&&TS.client.msg_pane.maybeClearNewMsgsTimer(t)},legacyCheckInitialMsgHistory:function e(t,r,i){if(TS.useReactMessages())return;if(t.history_is_being_fetched){TS.warn('legacyCheckInitialMsgHistory NOT DOING ANYTHING, because "'+t.id+'" history_is_being_fetched:true');return}var s=TS.isPartiallyBooted()||!n;if(s&&TS._did_incremental_boot&&t.id===TS.model.active_channel_id)return;if(a[t.id]){TS.has_pri[A]&&TS.log(A,"legacyCheckInitialMsgHistory ("+t.id+"): Clearing _delayed_fetch_timer and fetching immediately");window.clearTimeout(a[t.id]);delete a[t.id]}TS.shared.legacySetDeferMessageHistoryForId(t.id,false);i?t._needs_unread_recalc=true:TS.utility.msgs.maybeFetchUserDataFromLS(t);var o=TS.model.initial_msgs_cnt;var l=TS.interop.rules.channels.getLatestMsgTs(t);var u=TS.utility.msgs.getMsg(l,t.msgs);if(u&&!t._history_fetched_since_last_connect){TS.has_pri[A]&&TS.log(A,'We have all recent "'+t.id+'" messages, but have not fetched history since last connect. Will fetch, omitting "latest".');u=null;l=null}var d;if(u){TS.has_pri[A]&&TS.log(A,'we have all recent "'+t.id+'" msgs unread_count:'+t.unread_count+" unread_cnt:"+t.unread_cnt+" initial_count:"+o);TS.shared.legacyMaybeDealWithAllSentTempMsgs(t,r);var c=TS.utility.msgs.getOlderMsgsStatus(t);if(t.msgs.length<TS.model.initial_msgs_cnt&&c.more){if(TS.isPartiallyBooted());else{TS.error("calling legacyLoadHistory because status.more=true && model_ob.msgs.length < TS.model.initial_msgs_cnt: "+t.msgs.length+" < "+TS.model.initial_msgs_cnt);TS.dir(0,c,t.id);TS.shared.legacyLoadHistory(t,r,o)}return true}}else if(i)TS.shared.legacySetDeferMessageHistoryForId(t.id,true);else{TS.has_pri[A]&&TS.log(A,'WE DO NOT HAVE ALL RECENT MESSAGES for "'+t.id+'" unread_count:'+t.unread_count+" unread_cnt:"+t.unread_cnt+" initial_count:"+o);var _=false;!t.msgs.length;d={channel:t.id,count:o,inclusive:"string"===typeof t.latest,ignore_replies:true,include_pin_count:true,no_user_profile:true};l&&(d.latest=l);if(_)TS.has_pri[A]&&TS.log(A,'we have some but not all recent "'+t.id+'" msgs but we no_oldest so are not setting oldest for api call');else if(t.msgs.length&&!TS.interop.rules.messages.isTempMsg(t.msgs[0])){TS.has_pri[A]&&TS.log(A,'we have some but not all recent "'+t.id+'" msgs');d.oldest=t.msgs[0].ts}else TS.has_pri[A]&&TS.log(A,'we have no "'+t.id+'" msgs');if(!t._history_fetched_since_last_connect)if(t.msgs.length)if(1!==t.msgs.length||TS.interop.rules.messages.isTempMsg(t.msgs[0])){TS.has_pri[A]&&TS.log(A,"we have some ("+t.msgs.length+') but not all recent msgs for "'+t.id+'", and have not fetched history since last connection');if(d.latest){TS.has_pri[A]&&TS.log(A,'first history fetch since connect for "'+t.id+'" - deleting api_args.latest of '+d.latest);delete d.latest}d.oldest&&d.count&&TS.has_pri[A]&&TS.log(A,"We have api_args.oldest, fetching oldest + "+d.count+' messages on "'+t.id+'" to get client up-to-date.')}else{TS.has_pri[A]&&TS.log(A,"first new message on "+t.id+", fetching history without any latest/oldest");delete d.latest;delete d.oldest}else{TS.has_pri[A]&&TS.log(A,'we have no msgs for "'+t.id+'", and have not fetched history since last connection');if(d.latest){TS.has_pri[A]&&TS.log(A,"no msgs.length. dropping api_args.latest of "+d.latest+' for "'+t.id+'"');delete d.latest}if(d.oldest){TS.has_pri[A]&&TS.log(A,"no msgs.length. dropping api_args.oldest of "+d.oldest+' for "'+t.id+'"');delete d.oldest}}var m=function e(){if(t.history_is_being_fetched)TS.has_pri[A]&&TS.log(A,'NOT fetching history on "'+t.id+'", history already being fetched');else{TS.has_pri[A]&&TS.log(A,'fetching history for "'+t.id+'" with api_args',d);r.legacyFetchHistory(t,d)}};TS.redux.socket.isConnected()?m():TS.redux.socket.connectedSig.addOnce(m)}},legacyMaybeLoadScrollBackHistory:function t(n,r,i){if(!i&&0!==n.scroll_top)return false;var a=TS.utility.msgs.getOlderMsgsStatus(n);if(!a.more){TS.interop.console.info(e,"Not loading scrollback in "+n.id+": "+a.text);if(3===a.code){var s=_.map(n.msgs,"ts");TS.shared.legacyCheckForMoreMsgs(n).then(function(){var e;e="more messages than expected in "+n.id;TS.logError(e,"oldest_msg_ts or is_limited is wrong","Scrollback history error");var t=_.map(n.msgs,"ts");var i=_.difference(s,t);var a=_.difference(t,s);if(i.length||a.length){e="timestamps not present in new data:"+i.toString()+"; timestamps not present in old data: "+a.toString();TS.logError(e,"Found a difference in timestamps before and after history call","Scrollback history error")}else TS.log(null,"Did not find a difference between old and new timestamp data after history API call.");if(TS.shared.legacyGetActiveModelOb().id!==n.id||n.history_is_being_fetched)return;n.is_limited&&(n.is_limited=false);n.oldest_msg_ts&&TS.utility.msgs.resetOldestMsgsTs(n);TS.shared.legacyLoadScrollBackHistory(n,r)},_.noop)}return false}return TS.shared.legacyLoadScrollBackHistory(n,r)},legacyLoadScrollBackHistory:function t(n,r){if(!n.msgs.length){TS.has_pri[A]&&TS.log(A,"TS.shared.loadScrollbackHistory: No messages in "+n.id+" yet; not loading scrollback history.");if(!n._history_fetched_since_last_connect){TS.has_pri[A]&&TS.log(A,"TS.shared.legacyLoadScrollBackHistory: No messages, and history has not been fetched since last connect; doing an initial fetch.");TS.shared.legacyCheckInitialMsgHistory(n,r)}return}TS.interop.console.info(e,n.id+" HAS MORE");TS.shared.legacyLoadHistory(n,r);n.has_fetched_history_after_scrollback=true;n.fetched_history_after_scrollback_time=Date.now();return true},legacyLoadHistory:function e(t,n,r){var i={channel:t.id,latest:t.msgs[t.msgs.length-1].ts,count:r||TS.model.subsequent_msgs_cnt,ignore_replies:true,include_pin_count:true,no_user_profile:true};n.legacyFetchHistory(t,i)},legacyCheckForMoreMsgs:function e(t){var n={channel:t.id,latest:t.msgs[t.msgs.length-1].ts,count:1,ignore_replies:true,include_pin_count:true,no_user_profile:true};return TS.api.call("conversations.history",n).then(function(e){if(e.data.messages&&e.data.messages.length>0)return Promise.resolve(e);return Promise.reject(new Error("No more messages"))})},legacyOnSendMsg:function e(t,n,r,i){var a=n.temp_ts?TS.utility.msgs.getMsgByProp("temp_ts",n.temp_ts,r.msgs):null;if(!t){if(a){TS.model.unsent_msgs[a.ts]=true;i.msg_not_sent_sig.dispatch(r,a,n)}else TS.error("that makes no sense");return}TS.view.scroll_down_when_msg_from_user_is_added=true;var s;if(a){s=_.cloneDeep(a);s.text=n.text;s.ts=n.ts;delete s.is_pending;i.legacyRemoveMsg(r.id,a)}else{TS.warn("no temp msg for "+n.reply_to);s={text:n.text,user:TS.model.user.id,ts:n.ts}}n.SENT_MSG.thread_ts&&(s.thread_ts=n.SENT_MSG.thread_ts);i.legacyAddMsg(n.SENT_MSG.channel||r.id,TS.utility.msgs.processImsg(s,r.id));TS.shared.maybeShowEphemeralUserGroupMessage(r,s);var o=TS.client&&TS.client.stats&&TS.client.stats.isEnabled();o&&TS.metrics.measureAndClear("send_msg_channel","msg_input_try_to_submit");r.id&&c(r.id,s)},maybeShowEphemeralUserGroupMessage:function e(t,n){var r;if(t.is_channel)r=TS.interop.i18n.t("channel","shared")();else{if(!t.is_group||t.is_mpim)return;r=TS.interop.i18n.t("private channel","shared")()}var i=n.text.match(/<!subteam(.*?)>/g);if(i)for(var a=0;a<i.length;a+=1){var s=i[a].replace(">","").replace("<","");s=s.split("|")[0];var o=s.split("^")[1];if(!o)continue;(function(e){TS.user_groups.getUserGroupMembers(e,function(i){var a=_.uniq(i.users);if(!a)return;TS.interop.membership.ensureChannelMembershipIsKnownForUsers(t.id,a).then(function(){var i=[];a.forEach(function(e){var n=TS.interop.membership.getCachedChannelMembershipInfoForUser(t.id,e);n.is_member||i.push(e)});if(!i.length)return;var s=TS.interop.datetime.makeTsStamp();var o="<!subteam^"+e+">";var l=i.length;var u="TS.client.ui.promptForGroupOrChannelInvite('"+t.id+"', '"+i.join(",")+"', '"+s+"')";var d="TS.client.ui.sendChannelMsgThroughSlackBot('"+t.id+"', '"+n.ts+"', '"+i.join(",")+"', '"+s+"')";var c="TS.utility.msgs.removeEphemeralMsg('"+t.id+"', '"+s+"')";TS.client.msg_pane.addMaybeClick(u,TS.client.ui.promptForGroupOrChannelInvite.bind(Object.create(null),t.id,i.join(","),s));TS.client.msg_pane.addMaybeClick(d,TS.client.ui.sendChannelMsgThroughSlackBot.bind(Object.create(null),t.id,n.ts,i.join(","),s));TS.client.msg_pane.addMaybeClick(c,TS.utility.msgs.removeEphemeralMsg.bind(Object.create(null),t.id,s));var _="";_=TS.interop.i18n.t("{member_count, plural, =1 {One member} =2 {Two members} =3 {Three members} =4 {Four members} =5 {Five members} =6 {Six members} =7 {Seven members} =8 {Eight members} =9 {Nine members} =10 {Ten members} other {# members}} of the {name} group {member_count, plural, =1 {isn\u2019t} other {aren\u2019t}} in this {channel}. ","shared")({name:o,member_count:l,channel:r});"G"===t.id.charAt(0)?_+=TS.interop.i18n.t("If you\u2019d like I can <javascript:{prompt}|invite them to join>, or, <javascript:{nothing}|do nothing>.","shared")({prompt:u,nothing:c}):_+=TS.interop.i18n.t("If you\u2019d like Slack can <javascript:{message}|notify them about your message>.","shared")({message:d});TS.client.ui.addEphemeralBotMsg({channel:t.id,ts:s,text:_,thread_ts:n.thread_ts})})})})(o)}},legacySendMsg:function e(n,r,i,a){var s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!r)return false;var o=TS.redux.channels.getEntityById(n);if(!o)return false;var l=TS.shared.legacyGetControllerForModelOb(o);if(s)if(l===TS.groups||l===TS.ims){var u=B(o,r,l,i);if(!u)return false}else if(l===TS.channels){var d=TS.channels.legacyEnsureWeCanSendMessageToChannel(o,r,i);if(!d)return false}if(TS.useReactMessages()&&(TS.boot_data.feature_http_sendmsg||!i)){TS.redux.dispatch(TS.interop.redux.actions.prepareAndSendMessage({channelId:n,text:r,replyToTs:i?i.thread_ts||i.ts:null,shouldBroadcast:a}));TS.redux.dispatch(TS.interop.typing.currentUserEndedTyping({channelId:n}));return true}var c=o&&o.msgs&&o.msgs[0]&&TS.interop.datetime.toDateObject(o.msgs[0].ts+1)||Date.now();var m=TS.interop.datetime.makeTsStamp(c);var f=TS.format.cleanMsg(r);var p={type:"message",channel:n,text:$.trim(f)};if(i){p.thread_ts=i.thread_ts||i.ts;p.reply_broadcast=a}TS.interop.SocketManager.send(p).then(function(e){e.temp_ts=m;l&&l.legacyOnSendMsg&&l.legacyOnSendMsg(true,e)}).catch(function(e){e.msg=e.msg||{};e.msg.temp_ts=m;if(l&&l.legacyOnSendMsg){if(TS.boot_data.page_needs_enterprise&&TS.boot_data.feature_default_shared_channels){var t=e.msg.error.code;if(6===t||7===t||8===t){var n="TS.shared.legacySendMsg.catch";TS.channels.read_only.stashAndFetchChannelPostingUpdates(e.msg.SENT_MSG.channel,t,n)}}l.legacyOnSendMsg(false,e.msg)}}).finally(function(){_.pull(t[n],m)});t[n]=t[n]||[];t[n].push(m);TS.redux.dispatch(TS.interop.typing.currentUserEndedTyping({channelId:n}));var h={type:"message",text:f,user:TS.model.user.id,ts:m,is_pending:true,temp_ts:m,channel:n};if(p.thread_ts){h.thread_ts=p.thread_ts;h._hidden_reply=true;h._was_reply_broadcast=p.reply_broadcast}l.legacyAddMsg(n,h);TS.shared.msg_sent_sig.dispatch(o);return true},legacyOnHistory:function t(n,r,i,a){var s=n.msgs;var o;if(r.is_limited){TS.has_pri[A]&&TS.log(A,'data.is_limited case: setting has_more = false, is_limited = true for "'+n.id+'"',i);r.has_more=false;n.is_limited=true}var l;if(!n._history_fetched_since_last_connect){TS.has_pri[A]&&TS.log(A,'first history fetch for "'+n.id+'"',i);TS.client&&TS.client.msg_pane&&TS.client.msg_pane.maybeResetUnreadsCheck(n);if(i.oldest){if(r.has_more){n.msgs=[];c={channel:n.id,count:TS.model.initial_msgs_cnt,inclusive:true};TS.has_pri[A]&&TS.log(A,'first history fetch. has_more is TRUE for "'+n.id+'" - dumping history and fetching most recent '+TS.model.initial_msgs_cnt+" msgs. prior history call data follows.",i);a.legacyFetchHistory(n,c);return true}TS.has_pri[A]&&TS.log(A,'first history fetch. has_more is false for "'+n.id+'" - we should have all recent msgs. Setting _history_fetched_since_last_connect.',i);n._history_fetched_since_last_connect=true;if(n.history_is_being_fetched){TS.has_pri[A]&&TS.log(A,'Resetting history_is_being_fetched for "'+n.id+'"');n.history_is_being_fetched=false}l=true;TS.client&&TS.client.msg_pane&&TS.client.msg_pane.maybeStartNewMsgsTimer(n)}else{if(TS.prefs.getPref("start_scroll_at_oldest")){var u=parseInt(n.last_read,10)?n.last_read:null;if(r.messages&&u&&!i._second_attempt_for_last_read){var d=_.minBy(r.messages,"ts");if(d&&d.ts>u){var c={channel:n.id,count:3*TS.model.initial_msgs_cnt,inclusive:true,_second_attempt_for_last_read:true};TS.has_pri[A]&&TS.log(A,"last_read for "+n.id+" is older than the first history response, trying again with a larger count");a.legacyFetchHistory(n,c);return true}}}TS.has_pri[A]&&TS.log(A,'first history fetch. no "oldest" param for "'+n.id+'", marking _history_fetched_since_last_connect = true.',i);n._history_fetched_since_last_connect=true;if(n.history_is_being_fetched){TS.has_pri[A]&&TS.log(A,'Resetting history_is_being_fetched for "'+n.id+'"');n.history_is_being_fetched=false}l=true;TS.client&&TS.client.msg_pane&&TS.client.msg_pane.maybeStartNewMsgsTimer(n)}}if(i.oldest&&r.has_more){TS.interop.console.info(e,n.id+" has more than one page of msg history between what is in cache and the latest, so let's dump what we have and just use this page of results");TS.interop.console.info(e,n.id+" args.oldest:"+i.oldest);s.length=0;n.is_limited&&(n.is_limited=false)}var m=[];var f=[];if(r.messages){for(var p=0;p<r.messages.length;p+=1)if(!TS.utility.msgs.getMsg(r.messages[p].ts,s)){o=r.messages[p];m.push(TS.utility.msgs.processImsgFromHistory(o,n.id));f.push(o.ts)}TS.has_pri[A]&&TS.log(A,'got history for "'+n.id+'", added '+m.length+" new messages out of "+r.messages.length+" total.")}m.length&&!TS.utility.msgs.getDisplayedMsgs(m).length&&TS.warn("no displayed msgs in this page for "+n.id+" ! We expect TS.client.ui.afterHistoryFetch to detect this and load another page");s=m.concat(s);s=TS.utility.msgs.setMsgs(n,s);TS.has_pri[F]&&TS.log(F,n.id+" msgs has more history now");if(n.latest&&n.latest.ts&&!TS.utility.msgs.getMsg(n.latest.ts,s)){TS.has_pri[F]&&TS.log(F,"tacking on latest msg "+n.latest.ts);o=n.latest;TS.utility.msgs.appendMsg(s,TS.utility.msgs.processImsgFromHistory(o,n.id));TS.utility.msgs.sortMsgs(s)}i.oldest||r.has_more||r.is_limited||TS.utility.msgs.setOldestMsgsTs(n);TS.shared.legacyMaybeDealWithAllSentTempMsgs(n,a);if(l){TS.has_pri[A]&&TS.log(A,"legacyOnHistory: post-message merge, doing recalc of unread counts for "+n.id);var h=false;a.legacyCalcUnreadCnts(n,h)}TS.pins&&TS.pins.updateCount(n,r.pin_count)},legacyMaybeDealWithAllSentTempMsgs:function n(r,i){if(!TS.interop.Flannel.useSocket())return;function a(t){var n=TS.utility.msgs.getMsg(t,r.msgs);if(!n)return;var a=TS.utility.msgs.getNonTempMsgFromUserMatchingText(n.text,TS.model.user.id,r.msgs);if(a){var s=TS.interop.datetime.toDateObject(a.ts);var o=TS.interop.datetime.toDateObject(t);if(s<o){TS.interop.console.info(e,"existing_msg time is older than temp_msg time, so it can\u2019t be the message we were looking for");a=null}}if(!a){TS.warn("not removing, we don\u2019t appear to have this non-temp message: "+n.ts);TS.model.unsent_msgs[n.ts]=true;i.msg_not_sent_sig.dispatch(r,n);return}TS.interop.console.info(e,"removing temp_msg: "+n.ts+" existing_msg:"+a.ts);i||(i=TS.shared.legacyGetControllerForModelOb(r));_.isFunction(i.legacyRemoveMsg)&&i.legacyRemoveMsg(r.id,n);return true}if(!t.hasOwnProperty(r.id))return;t[r.id].forEach(function(e){a(e)});delete t[r.id]},legacyGetControllerForModelOb:function e(t){if(!t)return{};if(t.is_im)return TS.ims;if(t.is_mpim&&t.is_group)return TS.mpims;if(t.is_group)return TS.groups;return TS.channels},legacyGetActiveModelOb:function e(){var t;if(TS.client)TS.model.active_channel_id?t=TS.interop.channels.getChannelById(TS.model.active_channel_id):TS.model.active_im_id?t=TS.interop.channels.getImById(TS.model.active_im_id):TS.model.active_mpim_id?t=TS.interop.channels.getMpimById(TS.model.active_mpim_id):TS.model.active_group_id&&(t=TS.interop.channels.getGroupById(TS.model.active_group_id));else if(TS.boot_data.channel_id)t=TS.interop.channels.getChannelById(TS.boot_data.channel_id);else if(TS.boot_data.im_id)t=TS.interop.channels.getImById(TS.boot_data.im_id);else if(TS.boot_data.mpim_id)t=TS.interop.channels.getMpimById(TS.boot_data.mpim_id);else if(TS.boot_data.group_id)t=TS.interop.channels.getGroupById(TS.boot_data.group_id);else{TS.warn("error getActiveModelOb found no ob");TS.warn("TS.boot_data.channel_id: "+TS.boot_data.channel_id);TS.warn("TS.boot_data.im_id: "+TS.boot_data.im_id);TS.warn("TS.boot_data.group_id: "+TS.boot_data.group_id)}return t},legacyGetShareModelObId:function e(t,n){if(TS.boot_data.feature_file_threads){TS.redux.dispatch(TS.interop.redux.actions.getChannelIdForSharing({channelOrMemberId:t})).then(n);return}var r;var i;var a=function e(t){TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==t&&TS.client.archives.cancel()};if(t&&TS.interop.utility.looksLikeMemberId(t)){r=TS.redux.channels.getImByMemberId(t);if(r){t=r.id;a(t);n(t)}else{var s=function e(i,a,s){if(i){TS.ims.legacyOnOpened(i,a,s);r=TS.redux.channels.getImByMemberId(t);r?n(r.id):TS.web?n(a.channel.id):TS.error("legacyGetShareModelObId opened an IM, but it is not in the model? data.channel.id: "+a.channel.id)}else TS.error("legacyGetShareModelObId try to open an IM, but failed data: "+JSON.stringify(a||null))};TS.api.call("conversations.open",{users:t,return_im:true,reason:"TS.shared.legacyGetShareModelObId"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})}}else if(t&&"C"===t.charAt(0)){i=TS.interop.channels.getChannelById(t);if(i.is_member||i.is_archived){a(t);n(t)}else TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:i.id})).catch(_.noop).finally(function(){n(t)})}else{a(t);n(t)}},legacyMaybeMarkReadIfMuted:function e(t){if(!t)return;if(!t.is_mpim)return;if(!TS.notifs.isCorGMuted(t.id))return;if(!t.unreads.length||t.unread_highlights.length)return;if("hide_read_channels"===TS.prefs.getPref("sidebar_behavior")){if(TS.model.active_cid==t.id)return}else if("hide_read_channels_unless_starred"===TS.prefs.getPref("sidebar_behavior")&&!t.is_starred&&TS.model.active_cid==t.id)return;t.is_mpim?TS.mpims.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.muted):t.is_group?TS.groups.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.muted):TS.channels.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.muted)},legacyMarkReadMsg:function e(t,n,r){var i=TS.redux.channels.getEntityById(t);var a=TS.shared.legacyGetControllerForModelOb(i);_.isFunction(a.markReadMsg)&&a.markReadMsg(i.id,n,r)},moveLastMsgInput:function e(t,n){if(!t.last_msg_input)return;n.last_msg_input=t.last_msg_input;n.has_draft=!!n.last_msg_input;t.last_msg_input="";t.has_draft=!!t.last_msg_input;TS.storage.storeLastMsgInput(t.id,t.last_msg_input);TS.storage.storeLastMsgInput(n.id,n.last_msg_input)},legacyCloseArchivedChannel:function e(t){var n=TS.redux.channels.getEntityById(t);if(!n)return;if(!n.is_archived)return;n.was_archived_this_session=false;TS.client.activeChannelDisplayGoneAway()},legacyGetLastMsg:function e(t){if(!t.msgs||0===t.msgs.length)return null;for(var n=0;n<t.msgs.length;n+=1)if(!TS.interop.rules.messages.isHidden(t.msgs[n])&&!t.msgs[n].is_ephemeral)return t.msgs[n];return null},legacyCheckForOldImsToClose:function e(){var t=TS.model.ims;var n=TS.model.mpims;var r=t.concat(n);var i;var a;var s;var o;var l;var u=0;var d=221;var c=11;var m=6048e5;for(l=0;l<r.length;l+=1){i=r[l];if(!i.is_open&&!i.unread_cnt)continue;u+=1}var f=u-c;if(f<1)return;TS.info("legacyCheckForOldImsToClose might close some. this_too_many:"+f);var p=[];for(l=0;l<r.length;l+=1){i=r[l];TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": model_ob_id: "+i.id);if(TS.interop.rules.channels.isSlackbot(i)){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": don't autoclose slackbot DM");continue}if(TS.interop.rules.channels.isYou(i)){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": don't close messages with self");continue}if(!i.is_open){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if it is not opened we do not have to close it");continue}if(i.unread_cnt){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if there are unreads, we should not close it");continue}if(i.is_starred){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if it is starred, we should not close it");continue}if(i.opened_this_session){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": opened_this_session, it should not be closed this session");continue}if(i==TS.shared.legacyGetActiveModelOb()){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+":  active conversation, we should not close it");continue}if(TS.useReactMessages()){var h=false;var g=TS.redux.messages.getRecentMessagesInChannel(i.id,h);var S=_.map(g,"ts");a=TS.interop.rules.channels.getLatestTs(i,S)}else{a=TS.interop.rules.channels.getLatestMsgTs(i)||"";TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": getLatestMsgTs: "+a);if(i.msgs&&i.msgs.length&&i.msgs[0]&&i.msgs[0].ts>a){a=i.msgs[0].ts;TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": newer TS in message history: "+a)}}if(a){s=TS.interop.datetime.toDateObject(a);TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": activity_date from activity_ts: "+s)}else{s=new Date(1e3*i.created);TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": no activity_ts found, activity date based on model_ob.created: "+s)}o=new Date-s;TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": ms_since_activity: "+o);if(o>m){TS.info(i.id+" "+s+" ms_since_activity:"+o+" allow_elapsed_ms:"+m);TS.has_pri[d]&&TS.log(d,"this IM is older than a week, we can leave the model_ob");p.push({model_ob:i,ms_since_activity:o})}else TS.has_pri[d]&&TS.info(d,"there has been activity in this IM in the past week, do not close")}p.length||TS.info("legacyCheckForOldImsToClose found no candidates for closing");p.sort(function e(t,n){var r=t.ms_since_activity;var i=n.ms_since_activity;if(r<i)return 1;if(r>i)return-1;return 0});p.length=p.length>f?f:p.length;for(l=0;l<p.length;l+=1){i=p[l].model_ob;TS.warn("legacyCheckForOldImsToClose CLOSING:"+i.id+" ms_since_activity:"+p[l].ms_since_activity);(i.is_im||i.is_mpim)&&TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id}))}},promiseToRefetchModelOb:function e(t,n){return new Promise(function(e,r){if(!t||"string"!==typeof t)return e();d(t,n).then(e,r)})},promiseToHaveAllRelevantImIds:function e(){r=r||new Promise(function(e,t){TS.api.callImmediately("im.list").then(function(t){var n=_(_.get(t,"data.ims",[])).map("id").concat(_.map(TS.model.ims,"id")).uniq().value();TS.log(48,"all_im_ids: "+n);e(n)},function(e){r=null;t(e)})});return r},ensureModelObsArePresent:function e(t,n){if(!t||!t.length)return Promise.resolve();var r=t.map(function(e){if("string"!==typeof e)return Promise.resolve();if(TS.channels.temp_list_of_removed_channels[e])return new Promise(function(e,t){t(new Error("This channel is no longer part of this workspace"))});return u(e,n).reflect()});return Promise.all(r).then(function(e){var t=[];e.forEach(function(e){if(e.isFulfilled())return;t.push(e.reason())});if(t.length)return Promise.reject(new Error("some ensureModelObsArePresent c_ids failed:\n"+t.join("\n")));return Promise.resolve()})},legacyEnsureModelObsInDataArePresent:function e(t,n){var r=TS.interop.utility.extractAllModelObIds(t);"search.messages"===n&&TS.boot_data.page_needs_enterprise&&M(t,r);return TS.shared.ensureModelObsArePresent(r,n)},legacyAddMsg:function e(t,n){return l(t,[n])},legacyAddMsgFromModern:function e(t,n){var r=TS.shared.legacyGetControllerForModelOb(t);return r.legacyAddMsg(t.id,n)},legacyRemoveMsgFromModern:function e(t,n){var r=TS.shared.legacyGetControllerForModelOb(t);return r.legacyRemoveMsg(t.id,n)},legacyMsgNotSentFromModern:function e(t,n,r){var i=TS.shared.legacyGetControllerForModelOb(t);TS.model.unsent_msgs[n.ts]=true;i.msg_not_sent_sig.dispatch(t,n,r)},legacyAddMsgs:function e(t,n){if(l(t,n)){var r=false;var i=TS.shared.legacyGetControllerForModelOb(t);_.isFunction(i.legacyCalcUnreadCnts)&&i.legacyCalcUnreadCnts(t,r);TS.utility.msgs.maybeTruncateMsgs(t);if(TS.client)if(TS.model.active_cid!==t.id)TS.has_pri[A]&&TS.log(A,'Got message(s) for "'+t.id+'", but not active_cid "'+TS.model.active_cid+'" (yet.) NOT rebuilding.');else{TS.has_pri[A]&&TS.log(A,"Got messages on active channel, rebuilding.");var a=true;TS.client.msg_pane.rebuildMsgsWithReason("legacyAddMsgs: got messages on active channel "+t.id,a)}return true}return false},legacyKickMember:function e(t,n){var r=t.is_channel||t.is_group&&!t.is_mpim;if(!r)return;if(t.is_group){if(!TS.permissions.members.canKickFromGroups())return}else if(!TS.permissions.members.canKickFromChannels())return;var i=TS.interop.members.getMemberById(n);if(!i)return;var a=true;var s=true;var o=TS.interop.members.getPrefCompliantMemberName(i,a,s);var l=TS.interop.rules.channels.getDisplayNameForChannel(t);TS.interop.membership.ensureChannelMembershipIsKnownForUsers(t.id,[n]).then(function(){var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(t.id,n);if(!e.is_member){TS.generic_dialog.alert(TS.interop.i18n.t("<strong>{user_name}</strong> is not a member of {channel_name}.","shared")({user_name:o,channel_name:l}));return null}var r;r=t.is_group?"<p>"+TS.interop.i18n.t("If you remove <strong>{user_name}</strong> from {channel_name}, they will no longer be able to see any of its messages. To rejoin the private channel, they will have to be re-invited.</p><p>Are you sure you wish to do this?","shared")({user_name:o,channel_name:l})+"</p>":"<p>"+TS.interop.i18n.t("Are you sure you wish to remove <strong>{user_name}</strong> from {channel_name}?","shared")({user_name:o,channel_name:l})+"</p>";var a="conversations.kick";TS.generic_dialog.start({title:TS.interop.i18n.t("Remove {user_name}","shared")({user_name:o}),body:r,go_button_text:TS.interop.i18n.t("Yes, remove them","shared")(),onGo:function e(){TS.api.call(a,{channel:t.id,user:n}).catch(function(e){TS.info("Removing user failed; api="+a+"; error="+e.data.error);setTimeout(function(){var t=i.is_ultra_restricted?TS.interop.i18n.t("Single-channel guests","shared")():TS.interop.i18n.t("Multi-channel guests","shared")();if("cant_kick_from_last_channel"===e.data.error&&TS.model.user.is_admin){TS.generic_dialog.start({title:TS.interop.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:o}),body:TS.interop.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can\u2019t be removed from channels.</p><p>If <strong>{member_display_name}</strong> should no longer have access to your workspace, we suggest deactivating their account.</p>","shared")({account_type:t,member_display_name:o}),go_button_text:TS.interop.i18n.t("Manage Members","shared")(),show_cancel_button:true,onGo:function e(){TS.utility.openInNewTab("/admin#restricted",TS.templates.builders.newWindowName())}});return}var n;switch(e.data.error){case"cant_kick_from_last_channel":n=TS.interop.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can\u2019t be removed from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({account_type:t,member_display_name:o});break;case"restricted_action":n=TS.interop.i18n.t("<p>Hmm, looks like you don\u2019t have permission to kick from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({member_display_name:o});break;default:n=TS.interop.i18n.t("<p>Something\u2019s gone wrong, and we couldn\u2019t remove <strong>{member_display_name}</strong> from {channel}. We suspect this is only temporary. Try again in a bit?</p>","shared")({member_display_name:o,channel:l})}TS.generic_dialog.alert(n,TS.interop.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:o}))},500)})}});return null})},legacyMaybeResetHistoryFetchedOnAll:function e(){if(!TS.client)return;TS.has_pri[A]&&TS.log(A,"legacyMaybeResetHistoryFetchedOnAll()");function t(e){TS.shared.legacyMaybeResetHistoryFetched(e)}_.forEach(TS.model.channels,t);_.forEach(TS.model.ims,t);_.forEach(TS.model.mpims,t);_.forEach(TS.model.groups,t)},legacyMaybeResetHistoryFetched:function e(t){if(!TS.client)return;if(!t){TS.warn("legacyMaybeResetHistoryFetched: WTF no model_ob",t);return}if(!t._history_fetched_since_last_connect)return;TS.has_pri[A]&&t._history_fetched_since_last_connect&&TS.log(A,'resetting history_fetched_since_last_connect for "'+t.id+'"');t._history_fetched_since_last_connect=false},legacyMaybeClearHasAutoScrolled:function e(){var t=TS.shared.legacyGetActiveModelOb();if(t&&t._has_auto_scrolled){TS.has_pri[A]&&TS.log(A,'resetting _has_auto_scrolled for "'+t.id+'"');t._has_auto_scrolled=false}},isRelevantTeam:function e(){var t=true;if(!TS.model.is_our_app||!window.winssb)return t;if(!TS.boot_data.page_needs_enterprise||!TS.model.team||!TS.model.team.enterprise_id||!TS.boot_data.other_accounts)return t;if(!window.winssb)return t;TS.has_pri[P]&&TS.log(P,"isRelevantTeam()");var n=_.get(TS.model.user,"enterprise_user.teams",[]);if(1===n.length)return t;var r=TSSSB.call("getLastActiveTeamIdForTeamIds",n);var i;TS.has_pri[P]&&TS.log(P,"isRelevantTeam(): Got relevant team IDs from SSB",r);if(r instanceof Array&&r.length){i=r[0];TS.has_pri[P]&&TS.log(P,"isRelevantTeam(): Array case - taking the first relevant team id",i,r)}else if(TS.has_pri[P]){TS.log(P,"isRelevantTeam(): relevant_team_ids is not an array, OR, is empty?",r);TS.log(P,"isRelevantTeam(): Electron did not provide any matches for the given team_ids",n)}if(!i){TS.has_pri[P]&&TS.log(P,"Invalid response from SSB lastActiveTeamIdForTeamIds() call? Exiting.");return t}TS.has_pri[P]&&TS.log(P,"comparing most_relevant_team_id ( "+i+") -> TS.model.team_id ("+TS.model.team.id+")");if(i===TS.model.team.id)TS.has_pri[P]&&TS.log(P,"isRelevantTeam(): "+TS.model.team.id+" is relevant. Including.");else{TS.has_pri[P]&&TS.log(P,"isRelevantTeam(): "+TS.model.team.id+" is NOT relevant. Excluding.");t=false}return t},onDisplayEmailAddressesPrefChanged:function e(){if(!TS.model||!TS.model.team)return;TS.info('Team pref "display_email_addresses" -> '+TS.prefs.getTeamPref("display_email_addresses"));var t=0;TS.model.members&&(TS.model.members=_.map(TS.model.members,function(e){if(!e.profile||!e.profile.email)return e;if(e.id===TS.model.user.id)return e;t+=1;TS.prefs.getTeamPref("display_email_addresses")||(e.profile.email=void 0);return e}));TS.prefs.getTeamPref("display_email_addresses")?t||TS.info("display_email_addresses check: pref enabled, but 0 email fields found in TS.model.members."):t?TS.info("display_email_addresses check: found and cleared "+t+" email fields from TS.model.members."):TS.info("display_email_addresses check: TS.model.members is already clear of email fields. \u2713");var n=true;TS.client&&TS.client.ui&&!TS.model.ms_logged_in_once&&TS.client.ui.rebuildAll(n)},lastReadIsOlderThanCurrentHistory:function e(t){t=t||TS.shared.legacyGetActiveModelOb();if(!parseInt(t.last_read,10))return false;if(!t.msgs||!t.msgs.length)return false;if(t.oldest_msg_ts&&t.last_read<t.oldest_msg_ts)return false;return!_.some(t.msgs,function(e){return e.ts<=t.last_read})},dispatchMessageReceived:function e(t,n){var r=TS.shared.legacyGetControllerForModelOb(t);r.message_received_sig.dispatch(t,n)},legacyDispatchUnreadChanged:function e(t){var n=TS.shared.legacyGetControllerForModelOb(t);n.unread_changed_sig.dispatch(t)},legacyDispatchUnreadHighlightChanged:function e(t){var n=TS.shared.legacyGetControllerForModelOb(t);n.unread_highlight_changed_sig.dispatch(t)},legacyDispatchMarkedSig:function e(t){var n=TS.shared.legacyGetControllerForModelOb(t);n.marked_sig.dispatch(t)},legacyBatchUpsertObjects:function e(t){TS.has_pri[D]&&TS.log(D,"Flannel: upserting batch of "+t.length+" objects");var n=[];var r=[];var i=[];_.forEach(t,function(e){TS.interop.utility.looksLikeMemberId(_.get(e,"id"))?TS.redux.members.isMemberKnown(e.id)?n.push(e):r.push(e):x(e)&&i.push(e)});var a=!!r.length;var s=[];function o(e){TS.has_pri[D]&&TS.log(D,"Flannel: upserting and signaling user "+e.id+" from query results");var t=TS.members.legacyUpsertAndSignal(e).member;s.push(t)}function l(e){TS.has_pri[D]&&TS.log(D,"Flannel: upserting user "+e.id+" from query results");var t=TS.members.legacyUpsertMember(e).member;s.push(t)}n.forEach(o);if(a){TS.members.legacyStartBatchUpsert();r.forEach(l);TS.members.legacyFinishBatchUpsert()}if(i.length){TS.useReactMessages()?TS.redux.bots.bulkUpsertBots(i):TS.bots.legacyBatchUpsertAndSignal(i);i.forEach(function(e){TS.has_pri[D]&&TS.log(D,"Flannel: upserting bot "+e.id+" from query results");var t=TS.interop.bots.getBotById(e.id);s.push(t)})}return s},revokeSharedChannelInvite:function e(t,n){return TS.api.call("conversations.revokeSharedInvite",{channel:t.id,target_team:n.id})}});var t={};var n=false;var r;var i={};var a={};var s={};var o={};var l=function e(t,n){var r=false;if(!t._history_fetched_since_last_connect){var i;TS.has_pri[A]&&(i='Defer case: First new message on "'+t.id+'" - ');n&&n.length||TS.warn("_addMsgsWorker("+t.id+"): WTF no msgs to add?");if(t.is_im||t.is_mpim||t.msgs.length)if(!t.is_im&&!t.is_mpim&&t.msgs.length&&a[t.id])TS.has_pri[A]&&TS.log(A,i+"some history, history fetch is already queued up - attaching "+n.length+" message(s) to model.");else if(t.msgs.length){if(t.history_is_being_fetched)TS.pri&&TS.log(58,i+"some history, history fetch is already underway - attaching "+n.length+" message(s) to model.");else if(!t._history_fetched_since_last_connect){TS.pri&&TS.log(58,i+"some history, have not fetched history since last reconnect - attaching "+n.length+" new messages to model.");TS.shared.legacyMaybeFetchHistoryAndThenCheckConsistency(t)}}else if(t.history_is_being_fetched)TS.has_pri[A]&&TS.log(A,i+"no history in model, but history is already pending - adding "+n.length+" message(s) to model.");else if(t._history_fetched_since_last_connect)TS.pri&&TS.has_pri[A]&&TS.log(A,i+"Edge case - "+n.length+" new message(s) to add, but no history and we have called history, too?");else{TS.has_pri[A]&&TS.log(A,i+"no history in model, no history call yet - fetching, and adding "+n.length+" message(s) to model.");TS.shared.legacyMaybeFetchHistoryAndThenCheckConsistency(t)}else TS.has_pri[A]&&TS.log(A,i+"no history in model, no history call yet - waiting for legacyCalcUnreadCnts() which will trigger a delayed history fetch.")}n=_.filter(n,function(e){var n=e.ts&&TS.utility.msgs.getMsg(e.ts,t.msgs);n&&TS.has_pri[A]&&TS.log(A,"Not adding duplicate message "+e.ts+", already in "+t.id);return!n});if(!n.length){TS.has_pri[A]&&TS.log(A,"No messages to add to "+t.id+" - exiting.");return false}TS.has_pri[A]&&TS.log(A,"Adding "+(n.length>1?"messages":"message")+" to "+t.id);n.forEach(function(e){if(TS.utility.msgs.validateMsg(t.id,e,t.msgs)){r=true;TS.utility.msgs.appendMsg(t.msgs,e)}});if(!r)return false;TS.utility.msgs.sortMsgs(t.msgs);TS.utility.msgs.maybeSetOldestMsgsTsAfterMsgAdded(t);return true};var u=function e(t,n){if("string"!==typeof t)return Promise.reject(Error('c_id: "'+t+'" is not a String'));TS.has_pri[O]&&TS.log(O,'_getModelObByIdFromModelOrApi c_id: "'+t+'"');var r=false;var i=TS.redux.channels.getEntityById(t,r);if(i)return Promise.resolve(i);if("C"===t.charAt(0)||"G"===t.charAt(0))return d(t,n);return TS.shared.promiseToHaveAllRelevantImIds().then(function(e){if(-1==e.indexOf(t)){TS.maybeWarn(48,"c_id:"+t+" is not in all_im_ids, not calling the API");return Promise.resolve()}return d(t,n)}).catch(function(e){if(e&&"im.list"===e.method)return d(t,n);return Promise.reject(e)})};var d=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.shared._getModelObByIdFromApi";TS.has_pri[O]&&TS.log(O,'_getModelObByIdFromApi c_id: "'+t+'"');return new Promise(function(e,r){var i=TS.model.incrementUnknownIdHandled(t);var a="conversations.info";if("C"===t.charAt(0)){if(TS.boot_data.page_needs_enterprise&&i>1){TS.warn("Grid: Not calling conversations.info for "+t+" again.");e();return}var s={channel:t,no_members:true,_x_reason:n};TS.api.callImmediately(a,s).then(function(n){e(TS.interop.channels.upsertChannel(n.data.channel));TS.model.reportResultOfUnknownIdHandled(t,true)},function(n){if(TS.boot_data.page_needs_enterprise&&n.data&&n.data.error&&"channel_not_found"===n.data.error){TS.maybeWarn(98765,"_getModelObByIdFromApi called for a channel but it is not found for enterprise. Channel:",t);e();TS.model.reportResultOfUnknownIdHandled(t,true);return}r(Error((n.data&&n.data.error||"unknown error")+" try #"+i+" calling channels.info with channel:"+t));TS.model.reportResultOfUnknownIdHandled(t,false)})}else"G"===t.charAt(0)?TS.api.callImmediately(a,{channel:t,_x_reason:n}).then(function(n){var r=n.data.group||n.data.channel;r.is_mpim?e(TS.interop.channels.upsertMpim(r)):e(TS.interop.channels.upsertGroup(r));TS.model.reportResultOfUnknownIdHandled(t,true)},function(e){r(Error((e.data&&e.data.error||"unknown error")+" try #"+i+" calling groups.info with channel:"+t));TS.model.reportResultOfUnknownIdHandled(t,false)}):TS.api.callImmediately(a,{channel:t,_x_reason:n}).then(function(n){var r=n.data.im||n.data.channel;e(TS.interop.channels.upsertIm(r));TS.model.reportResultOfUnknownIdHandled(t,true)},function(e){r(Error((e.data&&e.data.error||"unknown error")+" try #"+i+" calling im.info with channel:"+t));TS.model.reportResultOfUnknownIdHandled(t,false)})})};var c=function e(t,n){var r={message_timestamp:n.ts,channel_id:t,channel_type:t?t.charAt(0):""};var i=TS.interop.redux.features.messagePane.getChannelSessionId(TS.redux.getState());null!==i&&(r.channel_session_id=i);TS.interop.clog.track("MSG_SENT",r)};var m=null;var f=function e(){var t=TS.client.activeChannelIsHidden()?null:TS.shared.legacyGetActiveModelOb();var n=t&&t.id?t.id:null;TS.redux.dispatch(TS.interop.redux.features.messagePane.updateActiveChannelSessionId(n))};var p=function e(t){var n=TS.client.activeChannelIsHidden()?null:TS.shared.legacyGetActiveModelOb();var r=m;r&&r.id&&g(r);f();if(n&&n.id){h(n,t);var i=n.id.charAt(0);"D"===i&&b(n)}m=n};var h=function e(t,n){var r=t.id;var i=r.charAt(0);var a={channel_id:r,channel_type:i,is_boot:!!n,unread_channel_ids:S(),mentioned_channel_ids:T()};var s=TS.interop.redux.features.messagePane.getChannelSessionId(TS.redux.getState());null!==s&&(a.channel_session_id=s);void 0!==t.is_member&&null!==t.is_member&&(a.is_member=t.is_member);n||(a.num_unreads=t.unread_cnt);TS.interop.clog.track("CHANNEL_SWITCHED",a)};var g=function e(t){var n=t.id;var r=n.charAt(0);var i={channel_id:n,channel_type:r};var a=TS.interop.redux.features.messagePane.getChannelSessionId(TS.redux.getState());null!==a&&(i.channel_session_id=a);void 0!==t.is_member&&null!==t.is_member&&(i.is_member=t.is_member);TS.interop.clog.track("CHANNEL_SWITCHED_OUT",i)};var S=function e(){return v(function(e){return e.unread_cnt>0})};var T=function e(){return v(function(e){return e.unread_highlight_cnt>0})};var v=function e(t){if(!TS.model)return[];var n=[];var r=function e(t){return t.id};TS.model.channels&&(n=n.concat(_.map(_.filter(TS.model.channels,t),r)));TS.model.groups&&(n=n.concat(_.map(_.filter(TS.model.groups,t),r)));TS.model.ims&&(n=n.concat(_.map(_.filter(TS.model.ims,t),r)));return n};var b=function e(t){var n=t.id;var r={};var i=TS.interop.channels.getImById(n);var a=i?TS.interop.members.getMemberById(i.user):null;if(a&&a.is_bot){var s=a.profile.bot_id;var o=TS.interop.bots.getBotById(s);r.app_id=o?o.app_id:"";r.bot_id=s}TS.interop.clog.track("DM_OPEN",r)};var y=function e(){var t=true;p(t)};var w={};var k=function e(t){if(t)return;r=null};var x=function e(t){var n=_.get(t,"id[0]");return"B"===n};var C=function e(t,n){var r={no_sort:true,types:"private_channel",limit:1e3};n&&(r.cursor=n);var i=t||[];return TS.api.callImmediately("conversations.list",r).then(function(t){i=i.concat(t.data.channels);if(!t.data.response_metadata.next_cursor){var n=_(i).map("id").concat(_.map(TS.model.mpims,"id")).concat(_.map(TS.model.groups,"id")).uniq().value();TS.log(48,"all_group_ids: "+n);return n}return e(i,t.data.response_metadata.next_cursor)})};function M(e,t){var n=TS.model.team.id;_.remove(t,function(t){var r=_.find(e.messages.matches,function(e){return e.channel.id==t},this);var i=_.get(r,"channel");var a=TS.interop.rules.channels.isOrgShared(i)||TS.interop.rules.channels.isExternallySharedChannel(i);if(r&&_.get(r,"team")!=n&&_.startsWith(t,"C")&&!a)return t})}function I(e){if(!e)return;return s[e]}var A=58;var E=99;var P=1701;var F=4;var O=529;var D=1989;var H=888;var B=function e(t,n,r,i){var a=t.is_mpim?TS.interop.i18n.t("conversation","shared")():TS.interop.i18n.t("channel","shared")();var s=t.is_mpim?"conversation":"channel";if(!t)return false;if(t.is_archived)return false;var o=TS.interop.channels.getGeneralChannel();var l=function e(t){TS.generic_dialog.alert(t).then(function(){i?TS.ui.replies.focusReplyInput():TS.view.focusMessageInput()});i?TS.ui.replies.populateReplyInput(n):TS.utility.contenteditable.value(TS.client.ui.$msg_input,n)};var u=TS.format.cleanMsg(n);var d=!!i;var c;if(TS.model.everyone_regex.test(u)&&!d){if(!TS.permissions.members.canAtMentionEveryone()){c=TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings()?"<p>"+TS.interop.i18n.t("Usage of <strong>{everyone}</strong> is restricted to Workspace Admins in the large general channel.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>":"<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.permissions.members.canAtChannelOrGroup(t.id)?c+="channel"===s?'<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <strong>{at_label}</strong> instead.","shared")({at_label:TS.templates.builders.atLabel(s)})+"</p>":'<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this conversation, use <strong>{at_label}</strong> instead.","shared")({at_label:TS.templates.builders.atLabel(s)})+"</p>":TS.model.user.is_restricted&&(c="<p>"+TS.interop.i18n.t("Your account is restricted, and you cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>");l(c);return false}if(o&&o.is_member){var m=void 0;m=t.is_mpim?TS.interop.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your entire workspace, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this conversation, use <strong>{channel}</strong> instead.</p>',"shared"):TS.interop.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your entire workspace, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this channel, use <strong>{channel}</strong> instead.</p>',"shared");TS.generic_dialog.start({title:TS.interop.i18n.t("Send {everyone} a message","shared")({everyone:TS.templates.builders.atLabel("everyone")}),body:m({general_channel:TS.interop.i18n.safeString("#"+_.escape(o.name)),conversation_or_channel:a,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, send it","shared")(),onGo:function e(){TS.channels.legacyDisplayChannel({id:o.id,and_send_txt:n})},onCancel:function e(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,n);TS.view.focusMessageInput()}})}else{c="<p>"+TS.interop.i18n.t("You cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";if(TS.permissions.members.canAtChannelOrGroup()){var f=void 0;var p=TS.templates.builders.atLabel(s);f=t.is_mpim?TS.interop.i18n.t("If you just want to address everyone in this conversation, use <strong>{at_label}</strong> instead.","shared")({at_label:p}):TS.interop.i18n.t("If you just want to address everyone in this channel, use <strong>{at_label}</strong> instead.","shared")({at_label:p});c+='<p class="no_bottom_margin">'+f+"</p>"}l(c)}return false}var h=TS.model.here_regex.test(u);var g=(TS.model.channel_regex.test(u)||TS.model.group_regex.test(u))&&!d;if((g||h)&&!TS.permissions.members.canAtChannelOrGroup()){var S=h?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");c="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{key_word}</strong> messages.","shared")({key_word:S})+"</p>";l(c);return false}if(!d&&TS.ui.needToShowAtChannelWarning(t.id,n)){TS.ui.at_channel_warning_dialog.startInMessagePane(t.id,n);return false}return true}})()},11223:function(e,t){(function(){TS.registerModule("teams",{added_sig:new signals.Signal,rename_sig:new signals.Signal,changed_sig:new signals.Signal,unlinked_sig:new signals.Signal,changed_icon_sig:new signals.Signal,onStart:function e(){TS.client&&TS.client.login_sig.add(n);TS.teams.changed_icon_sig.add(i);TS.teams.rename_sig.add(i);TS.teams.added_sig.add(s);TS.team.team_name_changed_sig.add(s)},getTeamById:function e(t){if(!_.isString(t))return null;return TS.redux.teams.getTeamById(t)||TS.redux.teams.getTeamByEnterpriseId(t)||null},isExternal:function e(t){if(!_.isObject(t))return false;if(t.id===TS.model.team.id)return false;if(t._other_account)return false;var n=m();return!(n&&n===t.enterprise_id)},getAllExternalTeams:function e(){return _.pickBy(TS.redux.teams.getAllTeams(),TS.teams.isExternal)},isPartOfMyOrg:function e(t){if(!_.isObject(t))return false;var n=m();return n&&n===t.enterprise_id},getAllEnterpriseTeams:function e(){return _.pickBy(TS.redux.teams.getAllTeams(),TS.teams.isPartOfMyOrg)},getEnterpriseTeams:function e(t){t=_.isObject(t)?t:{};var n=TS.teams.getAllEnterpriseTeams();t.only_member_of&&(n=_.pickBy(n,function(e){return TS.model.user.enterprise_user.teams.indexOf(e.id)>-1}));t.exclude_current_team&&(n=_.omitBy(n,function(e){return e.id===TS.model.team.id}));return n},getTeamByDomain:function e(t){if(!_.isString(t))return null;return TS.redux.teams.getTeamByDomain(t)},getTeamByMsg:function e(t){if(!_.isObject(t))return null;var n=t.source_team_id;if(!n)return null;var r=TS.teams.getTeamById(n);if(r)return r;return null},getTeamNameByMember:function e(t){if(!_.isObject(t))return null;var n=TS.teams.getTeamById(t.team_id);if(n&&n.name)return n.name;return null},getTeamNameByMemberId:function e(t){if(!_.isString(t))return null;var n=TS.interop.members.getMemberById(t);if(!n)return null;var r=TS.teams.getTeamById(n.team_id);if(r&&r.name)return r.name;return null},getTeamNameById:function e(t){var n=TS.teams.getTeamById(t);if(!_.isObject(n))return null;if(n&&n.name)return n.name;return null},updateTeamName:function e(t){if(!t.name)return;var n=TS.teams.getTeamById(t.source_team);if(!n)return;n=_.clone(n);n.name=t.name;TS.teams.upsertAndSignal(n)},updateTeamIcon:function e(t){if(!t.icon)return;var n=TS.teams.getTeamById(t.source_team);if(!n)return;n=_.clone(n);n.icon=t.icon;TS.teams.upsertAndSignal(n)},upsertAndSignal:function e(t){var n=TS.teams.upsertTeam(t);if("CHANGED"===n.status){-1!=n.what_changed.indexOf("icon")&&TS.teams.changed_icon_sig.dispatch(n.team);-1!=n.what_changed.indexOf("name")&&TS.teams.rename_sig.dispatch(n.team);-1!=n.what_changed.indexOf("unlinked")&&TS.teams.unlinked_sig.dispatch(n.team)}else"ADDED"===n.status&&TS.teams.added_sig.dispatch(n.team);return n},upsertTeam:function e(t){var n=TS.teams.getTeamById(t.id);var r="NOOP";var i=[];if(n){n=_.assign({},n);t.hasOwnProperty("_other_account")||(t._other_account=false);for(var a in t)if("icon"===a){if(t[a]&&!TS.utility.areSimpleObjectsEqual(t[a],n[a])){n[a]=t[a];r="CHANGED";i.push(a)}}else if(n[a]!=t[a]&&("boolean"!==typeof t[a]||!t[a]!=!n[a])){n[a]=t[a];r="CHANGED";i.push(a)}t=n}else r="ADDED";"NOOP"!==r&&TS.redux.teams.addTeam(t);return{status:r,team:t,what_changed:i}},ensureTeamsArePresentWhenConvenient:function e(n){if(!_.isArray(n))return;var r=function e(){if(!t.length)return Promise.resolve();var n=_.uniq(_.clone(t));var r="TS.teams.ensureTeamsArePresentWhenConvenient";return TS.teams.ensureTeamsArePresent(n,r).then(function(){_.each(n,function(e){return _.pull(t,e)});return e()}).catch(function(e){e.lazy_batch_team_ids=t;e.lazy_batch_team_ids_getting_fetched=n;TS.console.logError(e,"lazy_batch_fetch_error","lazy_batch_team_error",true);throw e})};!t.length&&n.length&&_.defer(r);t.push.apply(t,n)},ensureTeamsArePresent:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureTeamsArePresent";if(!_.isArray(t))return Promise.reject(Error("t_ids is not an array"));var i=_.filter(t,function(e){var t=TS.teams.getTeamById(e);return!t||t._other_account});if(!i.length)return Promise.resolve();return r(i,n)},ensureTeamsInDataArePresentWhenConvenient:function e(t){var n=TS.interop.utility.extractAllTeamIds(t);TS.teams.ensureTeamsArePresentWhenConvenient(n)},ensureTeamsInDataArePresent:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureTeamsInDataArePresent";var r=TS.interop.utility.extractAllTeamIds(t);return TS.teams.ensureTeamsArePresent(r,n)},ensureSharedTeamsForMember:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureSharedTeamsForMember";if(!t)return Promise.resolve();return TS.teams.ensureTeamsArePresent(o(t),n)},getSharedTeamsForMember:function e(t){if(!t)return[];return _.map(o(t),TS.teams.getTeamById)},getTeamIdsConnectedOnlyByModelOb:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.getTeamIdsConnectedOnlyByModelOb";return TS.api.call("conversations.info",{channel:t.id,include_external_connections:true,_x_reason:n}).then(function(e){var n=_.get(e,"data.channel.external_connections");if(_.isObject(n))return t.shared_team_ids.filter(function(e){return 1===n[e]});return[]})},promiseToSearchTeams:function e(t){if(!m())return Promise.resolve(t);return Promise.resolve(t).then(function(e){if(!e)return Promise.reject(new Error("No search parameters provided"));e=l(e);if(e._is_new||e.num_remaining>0)return d(e);return Promise.resolve(e)})},test:function e(){var t={_getSharedTeamIdsForMember:o};Object.defineProperty(t,"_readyTeamSearcher",{get:function e(){return l},set:function e(t){l=t}});Object.defineProperty(t,"_promiseToSearchTeamsWorker",{get:function e(){return c},set:function e(t){c=t}});Object.defineProperty(t,"_buildPromiseToSearchTeamsArguments",{get:function e(){return u},set:function e(t){u=t}});Object.defineProperty(t,"_getTeamsByIdFromApi",{get:function e(){return r},set:function e(t){r=t}});return t}});var e=100;var t=[];var n=function e(){TS.boot_data&&_.isObject(TS.boot_data.other_accounts)&&_.each(TS.boot_data.other_accounts,function(e){var t={id:e.team_id,domain:TS.interop.url.getTeamSubdomain(e.team_url),icon:e.team_icon,name:e.team_name,url:e.team_url,_other_account:true};TS.teams.upsertTeam(t)})};var r=function e(t,n){if(!_.isArray(t))return Promise.reject(Error("t_ids is not an array"));var r={teams:t,_x_reason:n};return new Promise(function(e,t){TS.api.callImmediately("team.info",r).then(function(t){var n=[];t.data.teams.forEach(function(e){e&&e.id&&"E"===e.id.charAt(0)?TS.warn("EVALUE-1721: team.info response included an Enterprise org of "+e.id+". NOT adding to model. Client requested teams="+r.teams.join(", ")+"."):n.push(TS.teams.upsertAndSignal(e).team)});e(n)},function(e){t(Error(e.data&&e.data.error||"unknown error"))})})};var i=function e(t){t.id!==TS.model.team.id&&a(t);s(t)};var a=function e(t){if(!_.isObject(t))return;var n=TS.utility.teams.getMembersForTeam(t);if(!n.length)return;_.forEach(n,function(e){TS.members.changed_profile_sig.dispatch(e)})};var s=function e(t){if(!_.isObject(t))return;var n=TS.shared.legacyGetActiveModelOb();if(!TS.interop.rules.channels.isExternallySharedChannel(n))return;var r=TS.utility.teams.getTeamsForModelOb(n,{include_pending:true});_.indexOf(r,t)>-1&&TS.channels.shared_teams_updated_sig.dispatch(n)};var o=function e(t){if(!t)return[];if(_.get(t,"enterprise_user"))return _.intersection(_.get(t,"enterprise_user.teams",[]),_.get(TS.model.user,"enterprise_user.teams",[]));if(_.get(t,"team_id")===_.get(TS.model.user,"team_id"))return[t.team_id];return[]};var l=function e(t){t=t||{};t._is_new=false;t.hasOwnProperty("query")||(t.query="");t.hasOwnProperty("additional_args")||(t.additional_args={});if(t._last_query!==t.query){t.hasOwnProperty("_searcher_p")&&t._searcher_p.cancel();t._last_query=t.query;t._is_new=true;t._cursor_mark=null;t.items=[]}if(!_.isEqual(t._last_additional_args,t.additional_args)){t.hasOwnProperty("_searcher_p")&&t._searcher_p.cancel();t._last_additional_args=_.assign({},t.additional_args);t._is_new=true;t._cursor_mark=null;t.items=[]}return t};var u=function t(n){var r=[TS.utility.search.makeClause("is","team")];n.query&&r.push(TS.utility.search.makeClause("fuzzy",n.query));_.get(n,"included_ids.length")&&(1===n.included_ids.length?r.push(TS.utility.search.makeClause("id",_.head(n.included_ids))):r.push(TS.utility.search.makeConjunction("or",_.map(n.included_ids,function(e){return TS.utility.search.makeClause("id",e)}))));var i={count:n.max_api_results||e,query:r.length>1?JSON.stringify(TS.utility.search.makeConjunction("and",r)):JSON.stringify(_.head(r))};_.isEmpty(_.get(n,"additional_args"))||(i=_.merge(i,n.additional_args));n._cursor_mark&&(i.cursor_mark=n._cursor_mark);return i};var d=function e(t){var n=function e(){return c(t)};t._is_new?t._searcher_p=n():t._searcher_p=t._searcher_p.then(n);return t._searcher_p};var c=function e(t){var n=_.get(t,"endpoint","search.enterprise");var r=_.get(t,"response_key","items");return TS.api.call(n,u(t)).then(function(e){if(!t._cursor_mark){t.num_remaining=e.data.num_found;t.num_found=e.data.num_found}if(!e.data[r].length)return Promise.resolve(t);t.num_remaining-=e.data[r].length;t._cursor_mark=e.data.next_cursor_mark;var n=_.keyBy(t.omitted_ids,_.identity);var i=_(e.data[r]).filter(function(e){return!n[e.id]}).map(function(e){return TS.teams.upsertTeam(e)}).map("team").value();t.num_found-=e.data[r].length-i.length;t.items=_.concat(t.items,i);return Promise.resolve(t)})};var m=function e(){return _.get(TS.model,"team.enterprise_id",TS.boot_data.enterprise_id)}})()},11224:function(e,t){(function(){TS.registerModule("utility.teams",{isMemberGuest:function e(t){if(!_.isObject(t))return false;if(t.is_external||t.is_restricted)return true;return false},isMsgFromOtherTeam:function e(t){if(!_.isObject(t))return false;if(!t.source_team_id)return false;if(t.source_team_id&&TS.model.team.id!=t.source_team_id)return true;return false},getMembersForTeam:function e(t){if(!_.isObject(t))return;if(!t.id)return;var n=_.filter(TS.model.members,{team_id:t.id});return n},getTeamsForModelOb:function e(t,n){var r=[];if(!_.isObject(t))return r;n=n||{};if(!TS.interop.rules.channels.isExternallySharedChannel(t)&&!TS.interop.rules.channels.isPendingExternallySharedChannel(t))return r;!n.only_pending&&t.shared_team_ids&&t.shared_team_ids.length&&(r=r.concat(t.shared_team_ids));(n.only_pending||n.include_pending)&&t.pending_shared&&t.pending_shared.length&&(r=_.uniq(r.concat(t.pending_shared)));return _.compact(_.map(r,TS.teams.getTeamById))}})})()},11225:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(function(){TS.registerModule("members",{status_changed_sig:new signals.Signal,presence_changed_sig:new signals.Signal,ds_presence_changed_sig:new signals.Signal,user_color_changed_sig:new signals.Signal,joined_team_sig:new signals.Signal,changed_current_status_sig:new signals.Signal,changed_name_sig:new signals.Signal,changed_real_name_sig:new signals.Signal,changed_deleted_sig:new signals.Signal,changed_profile_sig:new signals.Signal,changed_tz_sig:new signals.Signal,changed_account_type_sig:new signals.Signal,changed_admin_perms_sig:new signals.Signal,changed_owner_perms_sig:new signals.Signal,changed_self_sig:new signals.Signal,lazily_added_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,member_was_upserted_sig:new signals.Signal,user_added_to_team_sig:new signals.Signal,user_removed_from_team_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,legacy_is_in_bulk_upsert_mode:false,onStart:function e(){TS.channels.joined_sig.add(function(){TS.members.invalidateMembersUserCanSeeArrayCaches()});TS.channels.left_sig.add(function(){TS.members.invalidateMembersUserCanSeeArrayCaches()});TS.redux.socket.disconnectedSig.add(M);TS.channels.member_joined_sig.add(function(e,t){var n=true;A(t,n)},TS.members,-1);TS.channels.member_left_sig.add(function(e,t){E(t)},TS.members,-1);TS.channels.joined_sig.add(x);TS.channels.left_sig.add(x);TS.members.lazily_added_sig.add(TS.teams.ensureTeamsInDataArePresentWhenConvenient);TS.client&&TS.client.login_sig.addOnce(function(){TS.members.changed_deleted_sig.add(function(e){var t=!e.deleted;A(e,t)},TS.members,-1)})},legacySetAccessibleUserIds:function e(t,n){u.length=0;TS.model.guest_accessible_user_ids=t;TS.model.need_guest_accessible_user_ids=!!n},legacyMaybeFetchAccessibleUserIds:function e(){if(TS.isPartiallyBooted()&&!TS._did_full_boot)return Promise.resolve();if(!TS.model.user.is_restricted)return Promise.resolve();TS.model.guest_accessible_user_ids=TS.model.guest_accessible_user_ids||[];return TS.api.call("conversations.guestVisibleMembers").then(function(e){var t=e.data;var n=t.members;if(!_.isEqual(_.sortBy(n),_.sortBy(TS.model.guest_accessible_user_ids))){var r=false;TS.members.legacySetAccessibleUserIds(n,r)}k=Date.now()})},legacyUpsertAndSignal:function e(t){var n=TS.members.legacyUpsertMember(t);return H(n,t)},legacyUpsertMember:function t(n){var r=TS.redux.members.isMemberKnown(n.id)&&TS.interop.members.getMemberById(n.id);var i="NOOP";var a=[];n=TS.interop.members.processMemberForUpserting(n);if(r){TS.has_pri[O]&&TS.log(O,'updating existing member "'+n.id+'"');var s=v(r,n);i=s.status;a=s.what_changed;if(_.includes(a,"deleted")){var o=TS.redux.channels.getImByMemberId(n.id);o&&(o.is_archived=n.deleted)}}else if(n.id){i="ADDED";_.includes(d,n.id)&&a.push("is_unknown");b(n);TS.has_pri[O]&&TS.log(O,'adding member "'+n.id+'" color:'+n.color+" member_color:"+n.member_color)}else TS.error("bad error, no member.id");if(n.is_self&&n.deleted){TS.reload(null,"member.is_self && member.deleted");return}if(!TS.members.legacy_is_in_bulk_upsert_mode){TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches()}TS.members.member_was_upserted_sig.dispatch();if("NOOP"!==i&&!TS.members.legacy_is_in_bulk_upsert_mode){TS.redux.dispatch(TS.interop.redux.models.members.addMember(n));TS.redux.dispatch(TS.interop.redux.features.presence.updatePresence({memberId:n.id,presence:n.presence}));("ADDED"===i||_.includes(a,"name"))&&f(n)}var l={status:i,member:n,what_changed:a};TS.members.legacy_is_in_bulk_upsert_mode&&e.push(l);return l},setMemberUserColor:function e(t,n){n=_.escape(n);t.member_color=n||t.color;n&&n!=t.color?TS.model.user_colors[t.id]=n:delete TS.model.user_colors[t.id];TS.members.user_color_changed_sig.dispatch(t)},getActiveMembersWithSelfAndNotSlackbot:function e(){t.length||(t=c(t,{include_self:true,include_slackbot:false,include_bots:true}));return t},getActiveMembersExceptSelfAndSlackbot:function e(){i.length||(i=c(i,{include_self:false,include_slackbot:false,include_bots:true}));return i},getActiveMembersWithSelfAndSlackbot:function e(){s.length||(s=c(s,{include_self:true,include_slackbot:true,include_bots:true}));return s},getMembersWithOptions:function e(t){var n=TS.members.getMembersForUser();var r=_.filter(n,function(e){if(e.is_stranger)return false;if(t.only_admins)return e.is_admin&&!e.deleted;if(t.only_local_team&&!e._is_local)return false;if(!t.include_deleted&&e.deleted)return false;if(!t.include_slackbot&&e.is_slackbot)return false;if(!t.include_self&&e.is_self)return false;if(!t.include_bots&&e.is_bot)return false;return true});return r},getMembersForUser:function e(){if(u.length)return u;if(!TS.model.user.is_restricted){u=_.filter(TS.model.members,function(e){return true!==e.is_stranger});return u}var t={};(TS.model.guest_accessible_user_ids||[]).forEach(function(e){t[e]=true});u=Object.keys(t).filter(TS.redux.members.isMemberKnown).map(TS.interop.members.getMemberById).filter(function(e){return!e.deleted});return u},getPrefCompliantMemberNameLowerCase:function e(t,n){if(!t)return"";var r=function(){var e=TS.interop.members.getMemberRealNameLowerCase(t);!TS.interop.members.shouldDisplayRealNames()&&TS.interop.members.getMemberProfileFieldDisplayNameLowerCase(t)&&(e=TS.interop.members.getMemberProfileFieldDisplayNameLowerCase(t));return e}();return n?_.escape(r):r},invalidateMembersUserCanSeeArrayCaches:function e(){if(!TS.model.user)return;var t=u.length;if(!t)return;u.length=0;TS.members.invalidateActiveMembersArrayCaches()},invalidateActiveMembersArrayCaches:function e(){t.length=0;i.length=0;a.length=0;s.length=0;o.length=0;l.length=0},legacyMemberSorterByActiveWithBotsLast:function e(t){var n=t.filter(function(e){return e.is_bot||e.is_slackbot});var i=n.filter(function(e){return"active"===e.presence});var a=n.filter(function(e){return"away"===e.presence});var s=t.filter(function(e){return!e.is_bot&&!e.is_slackbot});var o=s.filter(function(e){return"active"===e.presence});var l=s.filter(function(e){return"away"===e.presence});var u=o.sort(function(e,t){var n=TS.interop.members.getPrefCompliantMemberName(e)||e.name;var r=TS.interop.members.getPrefCompliantMemberName(t)||t.name;return TS.interop.i18n.sorter(n,r)});var d=l.sort(function(e,t){var n=TS.interop.members.getPrefCompliantMemberName(e)||e.name;var r=TS.interop.members.getPrefCompliantMemberName(t)||t.name;return TS.interop.i18n.sorter(n,r)});var c=i.sort(TS.interop.i18n.mappedSorter("name"));var _=a.sort(TS.interop.i18n.mappedSorter("name"));var m=[];m.push.apply(m,r(u).concat(r(c),r(d),r(_)));return m},legacyEnsureMembersInDataArePresent:function e(t,n){var r=TS.interop.utility.extractAllMemberIds(t);if("T02J3DPUE"===_.get(TS,"model.team.id")&&!_.isEmpty(r)){var i=_.some(r,function(e){return"U"===e[0]});if(i){var a={message:"Fetching U users on W team from source: "+n,stack:TS.console.getStackTrace()};$.post(TS.boot_data.beacon_error_url,{description:"fetch_u_on_w_team",error_json:JSON.stringify(a),team:_.get(TS,"model.team.id","none"),user:TS.boot_data.user_id,version:TS.boot_data.version_ts})}}return TS.interop.members.ensureMembersArePresent(r)},fetchAndUpsertMembersWithQuery:function e(t){return TS.interop.Flannel.fetchRawMembersWithQuery(t).then(function(e){e.objects=TS.shared.legacyBatchUpsertObjects(e.objects);return e})},legacyEnsureMembersArePresentInModelObs:function e(t){var n=[];var r=[];t.forEach(function(e){if(e.is_im){n.push(e.user);r.push(e.id)}else if(e.is_mpim){n.push.apply(n,e.members||[]);r.push.apply(r,_.fill(Array(e.members&&e.members.length||0),e.id))}else if(e.is_channel);else if(e.is_group){n.push.apply(n,e.members||[]);r.push.apply(r,_.fill(Array(e.members&&e.members.length||0),e.id))}else TS.warn("legacyEnsureMembersArePresentInModelObs found an unexpected model_ob type")});if(!n.length)return Promise.resolve();return TS.interop.members.ensureMembersArePresent(n,r)},legacyStartBatchUpsert:function e(){if(TS.members.legacy_is_in_bulk_upsert_mode)return false;TS.members.legacy_is_in_bulk_upsert_mode=true;return true},legacyFinishBatchUpsert:function t(){if(!TS.members.legacy_is_in_bulk_upsert_mode)return false;TS.members.legacy_is_in_bulk_upsert_mode=false;TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches();var n=_.partition(e,function(e){return _.includes(e.what_changed,"is_unknown")});var r=n[0];TS.redux.dispatch(TS.interop.redux.models.members.bulkAddMembers(e.map(function(e){return e.member})));TS.redux.dispatch(TS.interop.redux.features.presence.bulkUpdatePresence(e.map(function(e){return e.member})));r.length>0&&TS.members.changed_is_unknown_sig.dispatch({batch:_.map(r,"member")});e.forEach(function(e){("ADDED"===e.status||_.includes(e.what_changed,"name"))&&f(e.member)});TS.members.batch_upserted_sig.dispatch(e);e=[];return true},legacyAllocateTeamListMembers:function e(t){var n;var r=[];var i=[];var a=[];var s=[];var o=[];var l=[];t.sort(function(e,t){var n=e._real_name_lc||e._name_lc;var r=t._real_name_lc||t._name_lc;if(n>r)return 1;if(r>n)return-1;return 0});for(var u=0;u<t.length;u+=1){n=t[u];n.deleted?n.is_bot?a.push(n):i.push(n):n.is_ultra_restricted?l.push(n):n.is_restricted?o.push(n):n.is_bot||n.is_slackbot?s.push(n):r.push(n)}return{members:r,disabled_members:i,deleted_bots:a,bots:s,restricted_members:o,ultra_restricted_members:l}},promiseToSearchMembers:function e(t){return Promise.resolve(t).then(function(e){if(!e)return Promise.reject(new Error("No search parameters provided"));e.query=e.query&&e.query.trim()||"";e.include_org=!!TS.boot_data.page_needs_enterprise&&!!e.include_org;e.org_team_ids=e.include_org&&Array.isArray(e.org_team_ids)?e.org_team_ids:[];e=p(e,TS.interop.searcher.isNewMemberSearch(e));if(e._is_new||e.num_remaining>0)return h(e);return Promise.resolve(e)})},readyMemberSearcher:function e(t,n){return p(t,n)},buildPromiseToSearchMembersArguments:function e(t){return g(t)},userAddedToTeam:function e(t){var n=_.merge({},TS.model.user);n.enterprise_user.teams=_.uniq(n.enterprise_user.teams.concat(t));TS.members.legacyUpsertMember(n);x();TS.members.user_added_to_team_sig.dispatch(t)},userRemovedFromTeam:function e(t){var n=_.merge({},TS.model.user);n.enterprise_user.teams=n.enterprise_user.teams.filter(function(e){return e!==t});TS.members.legacyUpsertMember(n);x();TS.members.user_removed_from_team_sig.dispatch(t)},legacyEnsureMemberObjectsForUserProfileFields:function e(t){var n=[];t.is_restricted&&t.profile.guest_invited_by&&n.push(t.profile.guest_invited_by);var r=TS.team.getVisibleTeamProfileFieldsForMember(t);var i=_.chain(r).filter({type:"user"}).reduce(function(e,t){return e.concat(t.value.split(/\s*,\s*/))},[]).value();n=_.chain(n).concat(i).compact().uniq().value();if(!n.length)return Promise.resolve();return TS.interop.members.ensureMembersArePresent(n)},maybeUpdateMembersUserCanSee:function e(t){if(!t)return C();return TS.interop.members.ensureMembersArePresent([t]).then(function(){var e=true;return A(TS.interop.members.getMemberById(t),e)})},legacySetMemberUnknown:function e(t){d.push(t)},getAvatarBaseUrl:function e(){return TS.model.team&&TS.model.team.avatar_base_url},test:function e(){var e={};Object.defineProperty(e,"_maybeRefetchAccessibleUserIds",{get:function e(){return x},set:function e(t){x=t}});Object.defineProperty(e,"_is_refetching_accessible_user_ids",{get:function e(){return y},set:function e(t){y=t}});Object.defineProperty(e,"_did_receive_multiple_calls_to_refetch_accessible_user_ids",{get:function e(){return w},set:function e(t){w=t}});Object.defineProperty(e,"_accessible_user_ids_last_fetched_ts",{get:function e(){return k},set:function e(t){k=t}});Object.defineProperty(e,"_setImAndMpimNames",{get:function e(){return f},set:function e(t){f=t}});Object.defineProperty(e,"_processNewMemberForUpserting",{get:function e(){return b},set:function e(t){b=t}});Object.defineProperty(e,"_processExistingMemberForUpserting",{get:function e(){return v},set:function e(t){v=t}});Object.defineProperty(e,"_fillMembersWithOptions",{get:function e(){return c},set:function e(t){c=t}});return e}});var e=[];var t=[];var i=[];var a=[];var s=[];var o=[];var l=[];var u=[];var d=[];var c=function e(t,n){if(!_.isArray(t))throw new TypeError("members passed to _fillMembersWithOptions is not an array!");t.length=0;var r=TS.members.getMembersWithOptions(n);_.each(r,function(e){t.push(e)});return t};var m=function e(t){var n=!!t&&t.is_unknown;t&&t.is_unknown&&(t.is_unknown=false);_.pull(d,t.id);return n};var f=function e(t){TS.ims.setNameFromMember(t);TS.mpims.setNamesFromMember(t)};var p=function e(t,n){t=t||{};t.hasOwnProperty("_searcher_p")&&n&&t._searcher_p.cancel();t.hasOwnProperty("_cursor_mark")&&!n||(t._cursor_mark="");t.hasOwnProperty("full_profile_filter")||(t.full_profile_filter=true);t.hasOwnProperty("include_bots")||(t.include_bots=true);t.hasOwnProperty("include_deleted")||(t.include_deleted=false);t.hasOwnProperty("include_self")||(t.include_self=false);t.hasOwnProperty("include_slackbot")||(t.include_slackbot=true);t.hasOwnProperty("only_local_team")||(t.only_local_team=false);t.hasOwnProperty("only_admins")||(t.only_admins=false);t.hasOwnProperty("items")&&!n||(t.items=[]);t.hasOwnProperty("not_member_of")||(t.not_member_of=[]);t.hasOwnProperty("member_of")||(t.member_of=[]);t.hasOwnProperty("num_found")&&!n||(t.num_found=0);t.hasOwnProperty("num_remaining")&&!n||(t.num_remaining=0);t.hasOwnProperty("num_new")&&!n||(t.num_new=0);t.hasOwnProperty("max_api_results")||(t.max_api_results=100);if(n){t._last_query=t.query;t._last_include_org=t.include_org;t._last_org_team_ids=t.org_team_ids}t._is_new=!!n;return t};var h=function e(t){var n=function e(){return S(t)};t._is_new?t._searcher_p=n():t._searcher_p=t._searcher_p.then(n);return t._searcher_p};var g=function e(t){var n=[TS.utility.search.makeClause("is","user")];if(t._last_query){var r=t._last_query.split(/\s*,\s*|\s+/).map(function(e){return"@"===e.charAt("0")?e.substring(1):e}).filter(function(e){return!!e}).map(function(e){if(1===e.length||!t.full_profile_filter)return TS.utility.search.makeConjunction("OR",[TS.utility.search.makeClause("real_name",e),TS.utility.search.makeClause("display_name",e)]);return TS.utility.search.makeClause("fuzzy_with_email",e)});n=n.concat(r)}if(t.not_member_of&&t.not_member_of.length){var i=t.not_member_of.map(function(e){return TS.utility.search.makeClause("not_member_of",e)});n.push(i.length>1?TS.utility.search.makeConjunction("OR",i):i[0])}if(t.member_of&&t.member_of.length){var a=t.member_of.map(function(e){return TS.utility.search.makeClause("member_of",e)});n.push(a.length>1?TS.utility.search.makeConjunction("OR",a):a[0])}if(t._last_include_org&&t._last_org_team_ids.length){var s=t._last_org_team_ids.map(function(e){return TS.utility.search.makeClause("belongs_to_team_id",e)});n.push(s.length>1?TS.utility.search.makeConjunction("OR",s):s[0])}var o=n.length>1?TS.utility.search.makeConjunction("AND",n):n[0];var l={query:o,count:t.max_api_results,include_bots:t.include_bots,include_deleted:t.include_deleted,ignore_guest_accounts:t.ignore_guest_accounts,only_local_team:t.only_local_team,only_admins:t.only_admins,raw_query:t.query};t._last_include_org&&(l.all_of_org=t._last_include_org);t._cursor_mark&&(l.cursor_mark=t._cursor_mark);t.determine_membership_for_channel&&(l.determine_membership_for_channel=t.determine_membership_for_channel);return l};var S=function e(t){var n=g(t);t.num_new=0;return TS.utility.search.promiseToSearch(n).then(function(e){if(!e.data.items.length)return Promise.resolve(t);if(!t.num_remaining){t.num_remaining=e.data.num_found;t.num_found=e.data.num_found}t.num_remaining-=e.data.items.length;t._cursor_mark=e.data.next_cursor_mark;var n=e.data.items.map(function(e){var n=TS.interop.members.getMemberById(e.id);if(!n){if(t._last_include_org&&e.team_id!==TS.model.team.id){e.is_primary_owner=false;e.is_owner=false;e.is_admin=false}n=TS.members.legacyUpsertMember(e).member}return n}).filter(function(e){if(e.is_self&&!t.include_self||e.is_slackbot&&!t.include_slackbot){t.num_found-=1;return false}if(t.limit_by_model_relevancy)return TS.utility.members.isMemberRelevantToModel(e,t.limit_by_model_relevancy);return true});t.num_new=n.length;t.items.push.apply(t.items,n);return Promise.resolve(t)})};var T=function e(t){if(!_.isObject(t))return t;return _.omitBy(t,function(e,t){return 0===t.indexOf("image_")})};var v=function e(t,r){var i="NOOP";var a=[];Object.keys(r).forEach(function(e){if("profile"===e){var s=T(t.profile);var o=T(r.profile);if(_.isObject(o)){if(s.status_text!==o.status_text||s.status_emoji!==o.status_emoji){i="CHANGED";a.push("current_status")}var l=Object.keys(s).filter(function(e){return"undefined"===typeof o[e]}).concat(["status_text","status_emoji"]);s=_.omit(s,l);o=_.omit(o,l);if(!_.isEqual(s,o)){i="CHANGED";a.push(e)}}}else if("enterprise_user"===e)if(t[e]){for(var u in r[e])if(!_.isEqual(t[e][u],r[e][u])){i="CHANGED";a.push(e)}}else{i="CHANGED";a.push(e)}else if("id"===e){var d=t.id!=r.id&&t.enterprise_user&&r.enterprise_user;if(d){var c=t.enterprise_user.id===t.id;var m=r.id!=r.enterprise_user.id;if(c&&m){i="CHANGED";a.push(e)}}}else if("teams"===e){i="CHANGED";a.push(e)}else if(t[e]!=r[e]){if("is_admin"===e&&TS.has_pri[D]){TS.warn(D,e+"is changing from `"+t[e]+"` to `"+r[e]+"`");TS.console.trace(D)}if(r[e]&&!TS.utility.isScalar(r[e])){t[e]=r[e];TS.warn(e+" is not scalar! it needs to be handled by upsertMember specifically to test if it has changed! "+n(r[e]))}else if("boolean"!==typeof r[e]||!r[e]!=!t[e]){a.push(e);i="CHANGED"}}});m(t)&&a.push("is_unknown");return{status:i,what_changed:a}};var b=function e(t){TS.members.user_color_changed_sig.dispatch(t)};var y=false;var w=false;var k=0;var x=function e(){if(!TS.model.user.is_restricted)return;if(y){w=true;return}y=true;var t=12e4;var n=Date.now()-k;var r;r=n<t?new Promise(function(e){setTimeout(e,t-n)}):Promise.resolve();r.then(function(){w=false;return TS.members.legacyMaybeFetchAccessibleUserIds()}).finally(function(){y=false;if(w){w=false;x()}});return r};var C=function e(){TS.members.invalidateMembersUserCanSeeArrayCaches();return x()};var M=function e(){TS.model.need_guest_accessible_user_ids=true};var I=function e(t){return!t||!TS.model.user||!TS.model.user.is_restricted||!TS.model.guest_accessible_user_ids||!TS.model.guest_accessible_user_ids.length||TS.model.need_guest_accessible_user_ids||y};var A=function e(t,n){if(I(t))return C();if(n){if(_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();TS.model.guest_accessible_user_ids.push(t.id)}else{if(!_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();_.pull(TS.model.guest_accessible_user_ids,t.id)}TS.members.invalidateMembersUserCanSeeArrayCaches();return Promise.resolve()};var E=function e(t){if(I(t))return C();if(!_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();var n=_.concat(_.flatMap(TS.model.mpims,"members"),_.map(TS.model.ims,"user"));if(_.includes(n,t.id))return Promise.resolve();var r=P(t);var i=r[0];var a=r[1];if(a.length>F)return C();if(a.length)return Promise.map(a,function(e){return TS.membership.ensureChannelMembershipIsKnownForUsers(e.model_ob.id,[t.id])}).then(function(){return e(t)});if(_.some(i,"membership.is_member"))return Promise.resolve();_.pull(TS.model.guest_accessible_user_ids,t.id);TS.members.invalidateMembersUserCanSeeArrayCaches();return Promise.resolve()};var P=function e(t){return _(_.concat(TS.interop.redux.models.channels.getPublicChannelsUserIsIn(TS.redux.getState()),TS.model.groups)).map(function(e){var n=TS.interop.membership.getCachedChannelMembershipInfoForUser(e.id,t.id);return{model_ob:e,membership:n}}).partition("membership.is_known").value()};var F=10;var O=4;var D=1975;var H=function e(t,n){if("ADDED"===t.status)TS.members.lazily_added_sig.dispatch(t.member);else if("CHANGED"===t.status){if(-1!==t.what_changed.indexOf("is_unknown")){TS.members.changed_is_unknown_sig.dispatch(t.member);return t}-1!==t.what_changed.indexOf("current_status")&&TS.members.changed_current_status_sig.dispatch(t.member);-1!==t.what_changed.indexOf("profile")&&TS.members.changed_profile_sig.dispatch(t.member);-1===t.what_changed.indexOf("is_restricted")&&-1===t.what_changed.indexOf("is_ultra_restricted")||TS.members.changed_account_type_sig.dispatch(t.member);-1!==t.what_changed.indexOf("real_name")&&TS.members.changed_real_name_sig.dispatch(t.member);-1===t.what_changed.indexOf("member_color")&&-1===t.what_changed.indexOf("color")||TS.members.user_color_changed_sig.dispatch(t.member);-1!==t.what_changed.indexOf("name")&&TS.members.changed_name_sig.dispatch(t.member);-1!==t.what_changed.indexOf("tz")&&TS.members.changed_tz_sig.dispatch(t.member);if(-1!==t.what_changed.indexOf("deleted")){TS.members.changed_deleted_sig.dispatch(t.member);var r=TS.redux.channels.getImByMemberId(t.member.id);r&&TS.ims.legacyCalcUnreadCnts(r,true);TS.groups.legacyCalcActiveMembersForAllGroups()}-1!==t.what_changed.indexOf("presence")&&TS.members.presence_changed_sig.dispatch(t.member);-1!==t.what_changed.indexOf("is_owner")&&TS.members.changed_owner_perms_sig.dispatch(t.member);-1!==t.what_changed.indexOf("is_admin")&&TS.members.changed_admin_perms_sig.dispatch(t.member);-1!==t.what_changed.indexOf("member_visibility")&&x();n.is_self&&TS.members.changed_self_sig.dispatch(t.member)}return t}})()},11226:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("team",{team_profile_changed_sig:new signals.Signal,team_plan_changed_sig:new signals.Signal,team_email_domain_changed_sig:new signals.Signal,team_domain_changed_sig:new signals.Signal,team_name_changed_sig:new signals.Signal,onStart:function e(){TS.interop.Flannel.useSocket()&&TS.redux.socket.connectedSig.add(r,TS.team)},upsertAndSignal:function e(t){if(!t)return;var n=TS.team.upsertTeam(t);if("CHANGED"===n.status){-1!=n.what_changed.indexOf("profile")&&TS.team.team_profile_changed_sig.dispatch(n.team);-1!=n.what_changed.indexOf("email_domain")&&TS.team.team_email_domain_changed_sig.dispatch(n.team);-1!=n.what_changed.indexOf("domain")&&TS.team.team_domain_changed_sig.dispatch(n.team)}return n},upsertTeam:function e(t){a(t);var r=_.assign({profile:{fields:[]}},TS.model.team);var i="NOOP";var l=[];if(t){TS.has_pri[4]&&TS.log(4,'updating team "'+t.id+'"');for(var u in t)if("profile"===u){if(t.profile.fields&&t.profile.fields.length){var d=_.clone(r.profile.fields);"object"===n(t.profile.fields[0])?d=s(d,t.profile.fields):"string"===typeof t.profile.fields[0]&&(d=o(d,t.profile.fields));if(t.profile.fields[0]){r.profile=_.assign({},r.profile,{fields:d});l.push(u);i="CHANGED"}}}else if("prefs"===u){TS.redux.prefs.setTeamPrefs(t.prefs);delete t.prefs}else if("icon"===u||"cannot_leave_reasons"===u)r[u]=t[u];else if(r[u]!=t[u])if(t[u]&&!TS.utility.isScalar(t[u])){r[u]=t[u];TS.warn(u+" is not scalar! it needs to be handled by upsertTeam specifically to test if it has changed! "+n(t[u]))}else if("boolean"!==typeof t[u]||!t[u]!=!r[u]){r[u]=t[u];l.push(u);i="CHANGED"}TS.teams.upsertTeam(r)}return{status:i,team:r,what_changed:l}},ensureTeamProfileFields:function e(){if(t)return t;t=TS.api.call("team.profile.get").then(function(e){TS.team.upsertTeam(_.assign({id:TS.boot_data.team_id},{profile:e.data.profile}))});return t},getTeamProfileFieldById:function e(t){TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getTeamProfileFieldById");for(var n=0;n<TS.model.team.profile.fields.length;n+=1)if(TS.model.team.profile.fields[n].id===t)return TS.model.team.profile.fields[n];return null},getVisibleTeamProfileFields:function e(){TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFields");return TS.model.team.profile.fields.filter(function(e){return!e.is_hidden})},getHiddenTeamProfileFields:function e(){TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getHiddenTeamProfileFields");return TS.model.team.profile.fields.filter(function(e){return e.is_hidden})},getTeamCustomStatusPresets:function e(){return _.map(TS.prefs.getTeamPref("custom_status_presets"),function(e){if(TS.boot_data.feature_i18n_custom_status)return{text:e[1],canonical:e[2],emoji:e[0]};return{text:e[1],emoji:e[0]}})},sortTeamProfileFieldsByOrdering:function e(t){if(t&&t.length)return _.clone(t).sort(function(e,t){return e.ordering-t.ordering});TS.warn("Ensure profile fields exist before calling sortTeamProfileFieldsByOrdering")},getVisibleTeamProfileFieldsForMember:function e(t,n){if(!(t&&t.profile))return[];TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFieldsForMember");return TS.model.team.profile.fields.filter(function(e){return(n||_.get(t.profile,["fields",e.id,"value"]))&&!e.is_hidden}).map(function(e){var n=_.get(t.profile,["fields",e.id,"value"]);var r=_.get(t.profile,["fields",e.id,"alt"]);var i=n&&"date"===e.type?TS.interop.datetime.convertISOtoUTCReadableDate(n):r;return $.extend(true,{value:n,alt:i},e)})},isEntireTeamLoaded:function t(){return e}});var e=false;var t;var r=function e(){t=null};var i=function e(t){t&&t.length&&_.remove(t,function(e){return!e});return!(t&&t.length)};var a=function e(t){if(!t)return;if(_.get(window,"TS.model.team.profile.fields"))return;_.set(t,"profile.fields",_.get(t,"profile.fields",[]));TS.teams.upsertTeam(t)};var s=function e(t,n){if(i(n))return;var r=false;var a=false;var s=t.reduce(function(e,t){e[t.id]=t;return e},{});n.forEach(function(e){var n=s[e.id];if(n){a=a||u(n,e);r=r||n.ordering!==e.ordering;$.extend(true,n,e)}else{t.push(e);TS.model.members&&"options_list"===e.type&&(a=true)}});r&&(t=TS.team.sortTeamProfileFieldsByOrdering(t));a&&l(n);return t};var o=function e(t,n){if(i(n))return;_.remove(t,function(e){return-1!==n.indexOf(e.id)});l(n);return t};var l=function e(t){if(!t||!t.length)return;if(!TS.model.members)return;t.forEach(function(e){TS.model.members.forEach(function(t){if(t.profile.fields&&t.profile.fields[e.id||e]){if(e.id){if("options_list"!==e.type)return;var n=-1!==e.possible_values.indexOf(t.profile.fields[e.id].value);if(n)return}var r=$.extend(true,{},t);delete r.profile.fields[e.id||e];TS.members.legacyUpsertMember(r)}})})};var u=function e(t,n){if(TS.model.members&&"options_list"===n.type)return n.possible_values.some(function(e){return-1===t.possible_values.indexOf(e)});return false}})()},11227:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("apps",{onStart:function t(){var n=true;e=TS.utility.throttleFunc(e,3e3,n)},isCanvasesEnabled:function e(){return TS.boot_data.feature_canvases},isAppmin:function e(){var t=false;var n=_.get(TS,"model.user");if(n&&!n.is_restricted){var r=TS.prefs.getTeamPref("who_can_manage_integrations");_.isUndefined(r)&&(r={});if(r){var i=r.type||[];(i.indexOf("admin")&&n.is_admin||i.indexOf("owner")&&n.is_owner)&&(t=true);var a=r.subteam||[];var s=Object.keys(TS.model.your_user_group_regex);_.intersection(a,s).length>0&&(t=true);var o=r.user||[];-1!==o.indexOf(n.id)&&(t=true)}}return t},isCurrentModelViewAnApp:function e(){var t=TS.shared.legacyGetActiveModelOb();if(!t)return false;var n=TS.interop.members.getMemberById(_.get(t,"user"));var r=_.get(n,"profile.bot_id");return!!r},resetUpApps:function t(){TS.storage.storeApps("");e()},setUp:function e(){return TS.apps.fetchApps()},ingestApp:function e(t){if(!t||!t.id)return;TS.model.apps[t.id]=t;TS.storage.storeApps({data:TS.model.apps,cache_ts:TS.model.apps_cache_ts})},ingestApps:function e(t){if("object"!==("undefined"===typeof t?"undefined":n(t))||!t)return;TS.storage.storeApps({data:t,cache_ts:TS.model.apps_cache_ts});TS.model.apps={};_.forEach(t,function(e){TS.model.apps[e.id]=e})},fetchApps:function e(){var t=TS.storage.fetchApps();if(t&&TS.model.apps_cache_ts==t.cache_ts){TS.model.did_we_load_with_app_cache=true;TS.apps.ingestApps(t.data);return Promise.resolve()}return TS.api.call("apps.list").then(function(e){TS.model.apps_cache_ts=e.data.cache_ts;TS.apps.ingestApps(e.data.apps)}).catch(_.noop)},getAppById:function e(t){if(!_.isString(t))return null;var n=TS.model.apps;if(!n){TS.warn("Trying to look up app by id ("+t+") but TS.model.apps is not present.");return null}var r=_.find(TS.model.apps,{id:t});if(r){r.is_app=true;return r}TS.warn("Trying to look up app by id ("+t+") but it is not present.");return null},legacyGetAppByName:function e(t){if(!_.isString(t))return null;var n=TS.model.apps;if(!n){TS.warn("Trying to look up app by name ("+t+") but TS.model.apps is not present.");return null}var r=_.find(TS.model.apps,function(e){return e.name.toLowerCase()==t.toLowerCase()});if(r){r.is_app=true;return r}TS.warn("Trying to look up app by name ("+t+") but it is not present.");return null},startFlexPaneByAppId:function e(t,n,r){return TS.apps.promiseToGetFullAppProfile(null,t,n,r).then(function(e){TS.client.ui.app_profile.openWithApp(e,null,t,r);TS.client.flexDisplaySwitched("apps",e.id,true,true)}).catch(function(){TS.client.ui.flex.hideFlex()})},startFlexPaneByBotId:function e(t,n,r){return TS.apps.promiseToGetFullAppProfile(n,t,null,r).then(function(e){TS.client.ui.app_profile.openWithApp(e,n,t,r);TS.client.flexDisplaySwitched("apps",n,true,true)}).catch(function(){TS.client.ui.flex.hideFlex()})},promiseToGetFullAppProfile:function e(t,n,r,i){if(t&&!_.isString(t))return null;if(r&&!_.isString(r))return null;return new Promise(function(e,a,s){var o=TS.api.call("apps.profile.get",{bot:t,bot_home_team:n,app:r,show_auth_summary:!!i}).then(function(n){if(n.data.ok&&n.data.app_profile){var r=n.data.app_profile;TS.apps.ingestApp(r);e(r)}else{a(n.data.error);TS.warn("Trying to look up app by bot id ("+t+") but it failed.")}}).catch(function(e){TS.warn("Trying to look up app by bot id ("+t+") but it failed.");a(e.data)});s(function(){o.cancel()})})},constructTemplateArgsForCardAndProfile:function e(t,n,r,i,a){if(!t)return TS.warn("Trying to build app card but it failed.");void 0==a&&(a=true);var s=n?"/services/"+n:"/apps/"+t.id;var o={settings_url:s,name:t.name,desc:t.desc,app_icons:t.icons,app_id:t.id,bot_id:n,is_slack_integration:t.is_slack_integration,is_directory_published:t.is_directory_published,is_distributed:t.is_distributed,commands:_.toArray(t.commands),is_external_app:t.is_external,app_team_id:i,is_xoxa_app:t.is_xoxa_app};var l=_.get(t,"bot_user.id");var u;r&&(u=TS.interop.members.getMemberById(r));var d;if(t.app_card_color){o.color=TS.utility.hex2rgb(t.app_card_color);o.color.hex=t.app_card_color}if(t.config&&t.config.is_custom_integration){if(t.config.icons)if(t.config.icons.emoji){var c=TS.emoji.graphicReplace(_.escape(t.config.icons.emoji),{force_img:true});o.emoji_img_tag=new Handlebars.SafeString(c)}else o.bot_icons=t.config.icons;d=t.config.real_name?t.config.real_name:t.bot_user?t.bot_user.username:t.config.username;o.name=d;o.desc=t.config.descriptive_label;o.username=t.config.username;o.custom_integration_type=t.config.custom_integration_type;o.date_created=t.config.date_created;var m='<a class="bold member charcoal_grey" data-member-id='+t.config.created_by+">"+TS.interop.members.getPrefCompliantMemberNameById(t.config.created_by,true,true)+"</a>";o.custom_integration_creator=new Handlebars.SafeString(m)}_.get(t.config,"icons")?t.config.icons.image_72?o.avatar=t.config.icons.image_72:o.avatar=t.config.icons.image_48:t.icons&&(t.is_slack_integration?o.avatar=t.icons.image_192:o.avatar=t.icons.image_96);t.screenshots&&(o.screenshots=t.screenshots);if(t.youtube_url){var f=TS.utility.getYoutubeIdFromURL(t.youtube_url);o.youtube_url=t.youtube_url;o.youtube_id=f}var p=t.screenshots||t.youtube_url;o.has_screenshots=p;if(_.get(t.config,"date_deleted")>0||true===_.get(t.auth,"revoked")){o.deleted=true;o.app_id=t.id}t.is_slack_integration?t.is_slack_integration&&(t.is_slack_integration&&t.is_external?o.disabled=false:t.config&&1===parseInt(t.config.is_active,10)&&0===parseInt(t.config.date_deleted,10)||(o.disabled=true)):t.is_external?o.disabled=false:i!==TS.model.team.id?o.disabled=false:t.auth&&!t.auth.revoked||(o.disabled=true);!a||t.is_external||!l&&t.is_slack_integration||t.is_xoxa_app||(o.show_settings_section=true);if(TS.model.user.is_restricted||TS.model.user.is_ultra_restricted){o.user_is_restricted=true;o.show_settings_section=false;o.disabled=false}if(t.installation_summary&&!t.is_xoxa_app){var h=t.installation_summary.replace(/<@([A-Z0-9]+)>/g,function(e,t){if(TS.interop.members.getMemberById(t))return'<span class="app_card_member_link" data-member-profile-link='+t+">"+TS.interop.members.getPrefCompliantMemberNameById(t,true,true)+"</span>";return'<span class="app_card_member_link" data-member-profile-link='+t+">A user</span>"});h=h.replace(/#([a-z0-9-]+)/g,function(e,t){var n=TS.redux.channels.getPublicChannelByName(t);if(n){var r=TS.templates.builders.makeChannelPrefix(n);return'<span class="app_card_channel_link internal_channel_link" data-channel-id="'+n.id+'">'+r+t+"</span>"}return t});o.installation_summary=new Handlebars.SafeString(h)}if(l){o.bot_user=t.bot_user.id;o.username=t.bot_user.username;o.bot_user_channel_count=t.bot_user.memberships_count;t.bot_user.memberships_count<1&&t.is_slack_integration&&(o.show_settings_section=false)}else u&&u.is_bot&&!u.is_stranger&&(o.allow_dm=true);if(l||o.is_xoxa_app){if(!o.disabled){TS.model.user.is_ultra_restricted||(o.show_channel_invite=true);o.allow_dm=true}true===o.deleted&&(o.hide_link_to_app_profile=true)}t.long_desc_formatted&&(o.long_description=new Handlebars.SafeString(t.long_desc_formatted));t.long_desc&&(o.long_description_raw=new Handlebars.SafeString(t.long_desc));t.support_url&&(o.support_url=t.support_url);t.url&&(o.website_url=t.url);t.user_can_manage&&(o.user_can_manage=t.user_can_manage);var g=_.isEmpty(_.get(t,"commands"));(t.is_slack_integration&&g||TS.utility.strGetWordCount(t.long_desc)<350||!p&&g)&&(o.hide_expand_button=true);return o}});var e=function e(){TS.apps.setUp()}})()},11228:function(e,t){(function(){TS.registerModule("apps.permissions",{onStart:function e(){TS.client&&TS.client.login_sig.addOnce(s)},test:function e(){var t={_initPermissionModal:n};Object.defineProperty(t,"_initPermissionModal",{get:function e(){return n},set:function e(t){n=t}});return t},app_resource_membership_changed_sig:new signals.Signal,app_wildcard_changed_sig:new signals.Signal,xoxa_apps_installed_sig:new signals.Signal,areXoxaAppsInstalled:function t(){return e},addAppToResource:function e(t,r,i){var a;if(!_.isObject(t))throw new Error("Expected app user to be an object");if(!_.isObject(r))throw new Error("Expected model_ob to be an object");return TS.api.call("apps.permissions.internal.add",{channel:r.id,app_user:t.id,send_ephemeral_error_message:true}).then(function(e){return new Promise(function(i,s){if(_.get(e,"data.should_confirm")){a=_.get(e,"data.scope_info",[]);n(t,a,r,i,function(){TS.api.call("apps.permissions.internal.denyAdd",{channel:r.id,app_user:t.id})})}else s(new Error("Call to apps.permissions.internal.add failed"))})}).then(function(){var e={channel:r.id,app_user:t.id,did_confirm:true,send_ephemeral_error_message:true};return TS.api.call("apps.permissions.internal.add",e)}).catch(function(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,i)})},addAppToResourceFromInviteMessageTS:function e(t,r,i,a){if(!_.isObject(t))throw new Error("Expected app user to be an object");if(!_.isObject(r))throw new Error("Expected model_ob to be an object");if(!i||!_.isArray(i))throw new Error("addAppToResourceFromInviteMessageTS Expects scope_info from MS");n(t,i,r,function(){var e={channel:r.id,app_user:t.id,did_confirm:true,send_ephemeral_error_message:true};a&&(e.invite_message_ts=a);return TS.api.call("apps.permissions.internal.add",e)},function(){TS.api.call("apps.permissions.internal.denyAdd",{channel:r.id,app_user:t.id,invite_message_ts:a})})},removeAppFromResource:function e(t,n,a){if(!_.isObject(t))throw new Error("Expected app user to be an object");if(!_.isObject(n))throw new Error("Expected model_ob to be an object");var s=n.id;var o=t.id;return new Promise(function(e,a){TS.interop.membership.ensureChannelMembershipIsKnownForUsers(s,[o]).then(function(){var l=TS.interop.membership.getCachedChannelMembershipInfoForUser(s,o);l.is_known&&l.is_member?r(e,t,n):i(a,t)})}).then(function(){return TS.api.call("apps.permissions.internal.remove",{channel:s,app_user:t.id,send_ephemeral_error_message:true})}).catch(function(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,a)})},requestPermissions:function e(t,r,i){var a=_.flatten(r.map(function(e){return e.scopes})).join(",");var s=TS.interop.members.getMemberById(t);var o=function e(t){return TS.api.call("apps.permissions.internal.addScope",{trigger_id:i,scopes:a,did_confirm:t}).catch(function(){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Hmm, something went wrong, try again?","apps")(),{slackbot_feels:"sad_surprise"})})};n(s,r,null,function(){o(true)},function(){o(false)})},addAppOrBotToActiveResource:function e(t){if(!TS.apps.permissions.areXoxaAppsInstalled()||!t)return;var n=TS.shared.legacyGetActiveModelOb();if(t.is_app_user){TS.apps.permissions.addAppToResource(t,n);return}TS.api.call("conversations.invite",{channel:n.id,users:t.id})},removeAppOrBotFromActiveResource:function e(t){if(!TS.apps.permissions.areXoxaAppsInstalled())return;var n=TS.shared.legacyGetActiveModelOb();if(t.is_app_user){TS.apps.permissions.removeAppFromResource(t,n);return}TS.shared.legacyKickMember(n,t.id)},canAppOrBotBeAddedToResource:function e(t,n){if(!t||!TS.apps.permissions.areXoxaAppsInstalled())return false;var r=TS.interop.members.getMemberById(t);if(!r)return false;if((n.is_im||n.is_mpim)&&!r.is_app_user)return false;var i=TS.interop.membership.getCachedChannelMembershipInfoForUser(n.id,t);return i.is_known&&!i.is_member},buildAddAppsTitle:function e(t){return TS.interop.i18n.t("Add apps to {channel_name}","apps")({channel_name:a(t)})}});var e=false;var t=function e(t){return TS.interop.i18n.safeString("<@"+t.id+">")};var n=function e(t,n,r,i,a){var s=t.real_name;var o=t.profile.image_48;TS.interop.openAppPermissionDialog({onAuthorize:i,onDismiss:a,appName:s,appIcon:o,scopeInfo:n,channelId:r?r.id:void 0})};var r=function e(t,n,r){var i=n.real_name;TS.interop.openAppRemoveDialog({appName:i,channelId:r.id,onConfirm:t})};var i=function e(n,r){TS.boot_data.feature_xoxa_channel_authorization?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("{app_user} isn\u2019t in this conversation, so you can\u2019t remove it.","apps")({app_user:t(r)}),{slackbot_feels:"sad_surprise"}):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("{app_user} isn\u2019t part of this channel or conversation, so you can\u2019t kick it out.","apps")({app_user:t(r)}),{slackbot_feels:"sad_surprise"});n(new Error("App is not in this conversation"))};var a=function e(t){var n="";t.is_mpim?n='<i class="ts_icon ts_icon_multiparty_dm_'+TS.mpims.getMemberCount(t)+'"></i>':t.is_group&&(n='<i class="ts_icon ts_icon_lock"></i>');return n+_.escape(TS.interop.rules.channels.getDisplayNameForChannel(t))};var s=function t(){if(!TS.boot_data.feature_app_permissions_backend_enterprise&&TS.boot_data.page_needs_enterprise)return;TS.interop.Flannel.query("user_counts_request").then(function(t){e=_.get(t,"counts.apps",0)>0;if(e)TS.apps.permissions.xoxa_apps_installed_sig.dispatch();else{var n=function t(n){if(n.is_app_user){e=true;TS.apps.permissions.xoxa_apps_installed_sig.dispatch();TS.members.joined_team_sig.remove(t)}};TS.members.joined_team_sig.add(n)}})}})()},11229:function(e,t){(function(){TS.registerModule("apps.splash",{onStart:$.noop,create:function t(n){if(!n||n&&0===n.length)return;if(TS.boot_data.feature_app_directory_home_page_redesign){l.drive.headline=TS.interop.i18n.t("Share and search files...","pages_apps_directory")();l.drive.image_alt_text=TS.interop.i18n.t("New Hire Onboarding document shared from {app_name}.","pages_apps_directory")({app_name:"Google Drive"});l.zoom.headline=TS.interop.i18n.t("Start an instant meeting...","pages_apps_directory")();l.zoom.image_alt_text=TS.interop.i18n.t("{app_name}: Bruce started a meeting. Summer Offsite Prep","pages_apps_directory")({app_name:"Zoom"});l.jira.headline=TS.interop.i18n.t("Preview issues and get updates...","pages_apps_directory")();l.jira.image_alt_text=TS.interop.i18n.t("{app_name}. Issue-123: Update rocketship fins. Status: Ready for QA.","pages_apps_directory")({app_name:"Jira Cloud"});l.salesforce.headline=TS.interop.i18n.t("Quickly find account details...","pages_apps_directory")();l.salesforce.image_alt_text=TS.interop.i18n.t("{app_name}: Sunny Farms Account. Show Account.","pages_apps_directory")({app_name:"Salesforce"})}return new e(n)}});function e(e){this.$element=e;this.$buttons=e.find(".splash_interactive__button");this.icons=["drive","zoom","jira","salesforce"];this.active_index=0;this.timeouts=[];this.$buttons.on("click",r.bind(this));n.bind(this)();this.timeouts.push(setInterval(n.bind(this),6e3));o()}function t(e){$("[data-window-link]").unbind("click");$("[data-window-link]").on("click",function(){var t=l[e].link;TS.interop.clog.track("APP_DIRECTORY_HOME_SPLASH",{link_to:t,data_tag_identifier:"splash_interactive__window_link",contexts:{ui_context:{step:"app_directory_home",action:"click",ui_element:e}}});t&&(window.location=t)})}function n(){var e=this.icons[this.active_index];i.bind(this,e)();a.bind(this,e)();this.active_index+=1;this.active_index===this.icons.length&&(this.active_index=0)}function r(e){if(this.timeouts.length){s(this.timeouts);this.timeouts=[]}var t=$(e.target).data("icon");i.bind(this,t)();a.bind(this,t)()}function i(e){this.$buttons.removeClass("splash_interactive__button--active");$(".splash_interactive__button--"+e).addClass("splash_interactive__button--active")}function a(e){var n=l[e];var r=$("[data-js='window_content_container']");var i=$("[data-js='window_message']");var a=$("[data-js='window_response']");var s=$("[data-js='window_message_content_text']");var o=$("[data-js='splash_color_border']");var u=$("[data-window-link]");var d=$("[data-js='window_headline']");var c=$("[data-js='window_message_content_username']");var _=$("[data-js='window_message_image']");r.addClass("splash_interactive__window_content_container--hide");i.removeClass("splash_interactive__window_message--show");a.removeClass("splash_interactive__window_response--show");s.removeClass("splash_interactive__window_message_content_text--typing");s.removeClass("splash_interactive__window_message_content_text--drive");o.removeClass("splash_color_border--filled");a.removeClass("splash_interactive__window_response--drive");u.attr({href:n.link});t(e);this.timeouts.push(setTimeout(function(){d.html(n.headline);c.html(n.message_profile_name);s.find("span").html(n.message_content);_.css({"background-image":"url("+n.message_profile_image_url+")"});a.attr({srcset:n.response_image_url_1x+" 1x, "+n.response_image_url_2x+" 2x",src:n.response_image_url_2x,alt:n.image_alt_text});i.addClass("splash_interactive__window_message--show");a.addClass("splash_interactive__window_response--show");r.removeClass("splash_interactive__window_content_container--hide");if(n.use_typing_animation){s.addClass("splash_interactive__window_message_content_text--typing");setTimeout(function(){s.removeClass("splash_interactive__window_message_content_text--typing")},2e3)}else{a.addClass("splash_interactive__window_response--drive");s.addClass("splash_interactive__window_message_content_text--drive")}},400))}function s(e){return e.map(function(e){return clearInterval(e)&&clearTimeout(e)})}function o(){$("[data-track]").map(function(e,t){var n=_.get($(t).data(),"track");var r=$(t).attr("href")?$(t).attr("href"):"no_link";n||(n="splash_log_error");return TS.interop.clog.trackClick('[data-track="'+n+'"]',"APP_DIRECTORY_HOME_SPLASH",{link_to:r,data_tag_identifier:n,contexts:{ui_context:{step:"app_directory_home",action:"click",ui_element:n}}})})}var l={drive:{headline:"Share and search files...",message_profile_image_url:"/img/apps/profile_drive@2x.png",message_profile_name:"Lisa Zhang",message_content:"shared this file",response_image_url_1x:"/img/apps/response_drive_2.0@1x.png",response_image_url_2x:"/img/apps/response_drive_2.0@2x.png",link:"https://slack.com/apps/A6NL8MJ6Q-google-drive",use_typing_animation:false,image_alt_text:"New Hire Onboarding document shared from Google Drive."},zoom:{headline:"Start an instant meeting...",message_profile_image_url:"/img/apps/profile_zoom@2x.png",message_profile_name:"Bruce Olson",message_content:"/zoom meeting Summer Offsite Prep",response_image_url_1x:"/img/apps/response_zoom_4.0@1x.png",response_image_url_2x:"/img/apps/response_zoom_4.0@2x.png",link:"https://slack.com/apps/A5GE9BMQC-zoom",use_typing_animation:true,image_alt_text:"Zoom: Bruce started a meeting. Summer Offsite Prep"},jira:{headline:"Preview issues and get updates...",message_profile_image_url:"/img/apps/profile_jira_2.0@2x.png",message_profile_name:"Angela Zamfir",message_content:"Can we get ISSUE-123 prioritized today?",response_image_url_1x:"/img/apps/response_jira_2.0@1x.png",response_image_url_2x:"/img/apps/response_jira_2.0@2x.png",link:"https://slack.com/apps/A2RPP3NFR-jira-cloud",use_typing_animation:true,image_alt_text:"Jira Cloud. Issue-123: Update rocketship fins. Status: Ready for QA."},salesforce:{headline:"Quickly find account details...",message_profile_image_url:"/img/apps/profile_salesforce@2x.png",message_profile_name:"Arcadio Buend\xeda",message_content:"/salesforce sunny farms",response_image_url_1x:"/img/apps/response_salesforce_2.0@1x.png",response_image_url_2x:"/img/apps/response_salesforce_2.0@2x.png",link:"https://slack.com/apps/A2DAS7NNR-salesforce",use_typing_animation:true,image_alt_text:"Salesforce: Sunny Farms Account. Show Account."}};e.prototype.destroy=function(){this.$element.off();this.$element.remove()}})()},11230:function(e,t){(function(){TS.registerModule("bots",{changed_sig:new signals.Signal,legacyBatchUpsertAndSignal:function e(t){var n=TS.interop.bots.getBotState();TS.redux.bots.bulkUpsertBots(t);var r=TS.interop.bots.getBotState();n!==r&&TS.bots.changed_sig.dispatch()},legacyEnsureBotsInDataArePresent:function e(t){var n=TS.interop.utility.extractAllBotIds(t);return TS.interop.bots.ensureBotsArePresent(n)},legacyFetchAndUpsertBotsWithQuery:function e(t){return TS.interop.Flannel.fetchRawMembersWithQuery(t).then(function(e){e.objects=TS.shared.legacyBatchUpsertObjects(e.objects);return e})}})})()},11231:function(e,t){(function(){TS.registerModule("members.view",{team_filter_changed_sig:new signals.Signal,filter_timer:null,onStart:function e(){E=TS.web&&TS.web.admin;var t=500;l=TS.utility.debounceWithPromise(w,t);u=TS.utility.debounceWithPromise(w,t);d=TS.utility.debounceWithPromise(w,t)},switchTabs:function e(t){E&&"invites"===TS.web.admin.view?$("#"+t+"_invites_tab").trigger("click"):TS.client?$("#"+t+"_members_tab").find("a").trigger("click"):$("#"+t+"_members_tab").trigger("click")},bindTeamFilter:function t(n,r,i){i=i||{};var a=$(n);var s=a.find("input.member_filter");var o=a.find(".icon_close");f(r,i);e=null;i.full_profile_filter&&!i.is_long_list_view&&s.on("focus",function(){TS.team.ensureTeamProfileFields()});s.bind("keyup update-team-filter",function(){var t=s.val();TS.members.view.filter_timer&&window.clearTimeout(TS.members.view.filter_timer);var a=function a(){t.trim().toLocaleLowerCase()!==e&&TS.members.view.filterTeam(t,n,r,i).then(function(){TS.view&&TS.view.rebuildUserGroupList()});o.toggleClass("hidden",!t.trim())};i.is_long_list_view?a():TS.members.view.filter_timer=window.setTimeout(a,TS.members.getMembersForUser().length>500?250:50)});o.bind("click",function(){TS.members.view.clearFilter(n,r);TS.view&&TS.view.rebuildUserGroupList();e=null;setTimeout(function(){s.focus()},0)})},filterTeam:function e(t,n,r,i){var a=p(r);if(_.get(i,"full_profile_filter")||_.get(a,"full_profile_filter"))return TS.team.ensureTeamProfileFields().then(function(){if(m(a))return T(t,n,r,a);k(t,n,r,i);return Promise.resolve()});k(t,n,r);return Promise.resolve()},getTeamFilter:function t(){return e},selectMatch:function e(t){var n=$(t);var r=n.data("list-items-id");var i=$(r);var a=i.find(".member_item");var s=a.filter(".active");if(1==s.length){var o=s.first();var l=o.data("member-id");if(l){TS.ims.legacyStartImByMemberId(l);TS.menu.end()}}},clearFilter:function n(r,i){var a=p(i);var s=$(r);var o=s.find("input.member_filter");var l=s.find(".icon_close");var u=s.data("list-items-id");var d=$(u);var c=d.find(".member_item");e="";TS.storage.storeFilterState(e);if(TS.members.view.filter_timer){window.clearTimeout(TS.members.view.filter_timer);TS.members.view.filter_timer=null}o.val("");l.addClass("hidden");if(m(a)){S(i);TS.members.view.filterTeam(e,r,i,a)}else{$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").removeClass("hidden");d.find(".no_results").addClass("hidden");c.addClass("active");if(t[i]){t[i].detachEvents();delete t[i]}d.find(".member_item.clone").remove();d.find(".filter_header").remove();TS.members.view.team_filter_changed_sig.dispatch("",TS.members.getMembersForUser().length);if(TS.client&&i){var _=$(i);_.trigger("resize-immediate");TS.ui.utility.updateClosestMonkeyScroller(_)}}},onTeamDirectoryItemClick:function e(t){if($(t.target).closest("a").length)return;var n=$(this);var r=n.data("member-id");var i=TS.interop.members.getMemberById(r);if(!i)return;TS.client&&TS.client.ui.previewMember(r)},findMatchesInMemberList:function e(t,n,r){return P(t,n,r)},getHeaderLabelForMatchKey:function e(t){return x(t)}});var e="";var t={};var n={};var r={};var i={};var a={members:{},restricted:{},deleted:{}};var s=100;var o=TS.client?92:116;var l;var u;var d;var c=function e(){if("list"===_.get(TS,"web.admin.view")&&TS.boot_data.page_needs_enterprise)return false;return TS.boot_data.page_needs_enterprise};var m=function e(t){if(TS.boot_data.page_needs_enterprise&&t&&t.is_long_list_view)return true;if("list"===_.get(TS,"web.admin.view")&&(TS.boot_data.page_needs_enterprise||TS.boot_data.feature_api_admin_page_not_ent))return true};var f=function e(t,n){r[t]=n};var p=function e(t){var n=r[t];if(!n){TS.error("Missing arguments for a bound filter");return}_.isFunction(n)&&(n=n()||{});n.include_org=c();return n};var h=function e(t){var n=$(t).find(".ts_icon_search");if(n.next().is(t+"_spinner"))return;var r=TS.templates.loading_indicator({id:t.substring(1)+"_spinner"});n.after(r);n.addClass("hidden")};var g=function e(t){$(t).find(".ts_icon_search").removeClass("hidden");$(t+"_spinner").remove()};var S=function e(t){a.filter_p&&a.filter_p.cancel();a.filtered_items&&(a.filtered_items={});a.filter_last_query=null;a.filter_last_include_org=null;a.members.filter_cursor_mark="";a.members.filter_num_remaining=0;a.members.filter_num_found=0;a.members.filter_scroll_mark=0;a.restricted.filter_cursor_mark="";a.restricted.filter_num_remaining=0;a.restricted.filter_num_found=0;a.restricted.filter_scroll_mark=0;a.deleted.filter_cursor_mark="";a.deleted.filter_num_remaining=0;a.deleted.filter_num_found=0;a.deleted.filter_scroll_mark=0;TS.client?$(t).off("scroll.filter").scrollTop(0):TS.web&&$(window).off("scroll.filter").scrollTop(0)};var T=function t(n,r,i,s){var o=n.trim();e=o.toLocaleLowerCase();TS.storage.storeFilterState(e);var l=a.filter_last_query!==e||a.filter_last_include_org!==s.include_org||a.filter_last_sort!==s.sort||a.filter_last_sort_dir!==s.sort_dir;if(l){S(i);a.filter_last_query=e;a.filter_last_include_org=s.include_org;s.sort&&(a.filter_last_sort=s.sort);s.sort_dir&&(a.filter_last_sort_dir=s.sort_dir)}h(r);var u=function t(){return Promise.resolve().then(function(){return v(a,l,e,s)}).then(function(t){g(r);return b(t,a,l,e,o,r,i,s)}).finally(function(){TS.utility.rAF(function(){TS.client&&TS.ui.utility.updateClosestMonkeyScroller($(i))})})};a.filter_p=l?u():a.filter_p.then(u);return a.filter_p};var v=function e(t,n,r,i){var a=n||"active_members"===TS.model.ui_state.tab_name&&t.members.filter_num_remaining;var s=n||"restricted_members"===TS.model.ui_state.tab_name&&t.restricted.filter_num_remaining;var o=n||"disabled_members"===TS.model.ui_state.tab_name&&t.members.filter_num_remaining;if(!a&&!s&&!o)return Promise.resolve(t.filtered_items);var c=_.assign({},i,{restricted:false});t.members.filter_p=a?l(t.members,r,c):Promise.resolve([]);var m=_.assign({},i,{restricted:true});t.restricted.filter_p=s?u(t.restricted,r,m):Promise.resolve([]);var f=_.assign({},i,{include_deleted:2,include_restricted_and_full_members:true});t.deleted.filter_p=o?d(t.deleted,r,f):Promise.resolve([]);return Promise.join(t.members.filter_p,t.restricted.filter_p,t.deleted.filter_p,function(e,r,a){var s=(i.sort?A:TS.members.legacyAllocateTeamListMembers)(e.concat(r,a));s.members=_.uniqBy(s.members,function(e){return e.id});s.disabled_members=_.uniqBy(s.disabled_members,function(e){return e.id});s.restricted_members=_.uniqBy(s.restricted_members,function(e){return e.id});s.ultra_restricted_members=_.uniqBy(s.ultra_restricted_members,function(e){return e.id});if(n)t.filtered_items=s;else{t.filtered_items.members.push.apply(t.filtered_items.members,s.members);t.filtered_items.disabled_members.push.apply(t.filtered_items.disabled_members,s.disabled_members);t.filtered_items.deleted_bots.push.apply(t.filtered_items.deleted_bots,s.deleted_bots);t.filtered_items.bots.push.apply(t.filtered_items.bots,s.bots);t.filtered_items.restricted_members.push.apply(t.filtered_items.restricted_members,s.restricted_members);t.filtered_items.ultra_restricted_members.push.apply(t.filtered_items.ultra_restricted_members,s.ultra_restricted_members)}return Promise.resolve(t.filtered_items)})};var b=function e(t,n,r,l,u,d,c,m){if(!t)return;if(_.get(TS,"web.admin"))return TS.web.admin.setLongListAdminListItems({items:t,no_dividers:!!l,query:l,new_query:!!r,num_found:{members:a.members.filter_num_found||0,restricted:a.restricted.filter_num_found||0,disabled:a.deleted.filter_num_found||0},remaining:{members:a.members.filter_num_remaining||0,restricted:a.restricted.filter_num_remaining||0,disabled:a.deleted.filter_num_remaining||0}},function(){T(l,d,c,m)});TS.client&&(i=TS.view.buildLongListTeamListItems(t,!!l));var f=false;"disabled_members"===TS.model.ui_state.tab_name&&0===(a.deleted.filter_num_found||0)&&(f=true);"restricted_members"===TS.model.ui_state.tab_name&&0===(a.restricted.filter_num_found||0)&&(f=true);var p=TS.model.user_groups.filter(function(e){return!e.date_delete});"user_groups"===TS.model.ui_state.tab_name&&0===p.length&&(f=true);if(f){TS.model.ui_state.tab_name="active_members";TS.storage.storeUIState(TS.model.ui_state);$("#active_members_tab").trigger("click")}var h=$("#active_members_list");if(h.length){h.longListView("setItems",i.active_members_list_items);r&&h.longListView("scrollToTop")}var g=$("#restricted_members_list");if(g.length){g.longListView("setItems",i.restricted_members_list_items);r&&g.longListView("scrollToTop")}var S=$("#deleted_members_list");if(S.length){S.longListView("setItems",i.deleted_members_list_items);r&&S.longListView("scrollToTop")}var v=t.members.concat(t.bots);var b=t.restricted_members.concat(t.ultra_restricted_members);var y=t.disabled_members.concat(t.deleted_bots);var w=[{name:"active",label:TS.interop.i18n.t("full members","members_view")(),matches:v},{name:"restricted",label:TS.interop.i18n.t("multi-channel guests","members_view")(),matches:b},{name:"disabled",label:TS.interop.i18n.t("deactivated accounts","members_view")(),matches:y}];w.forEach(function(e){var t=$("#"+e.name+"_no_results");function n(){var n={query:u,tab:e,active_matches:v,show_active_matches:"active"!==e.name&&v.length>0,restricted_matches:b,show_restricted_matches:"restricted"!==e.name&&b.length>0,disabled_matches:y,show_disabled_matches:"disabled"!==e.name&&y.length>0};var r=TS.templates.team_list_no_results(n);t.removeClass("hidden").html(r);t.find(".clear_members_filter").one("click",function(){TS.members.view.clearFilter(d,c)})}e.matches.length>0||!l?t.addClass("hidden").empty():n()});if(r){if("#team_list_scroller"===c)if(TS.client){var k=$(c);var x=k.find("#team_list_members_wrapper");k.on("scroll.filter",function(){var e=k.scrollTop()+k.height()+o;var t;if("active_members"===TS.model.ui_state.tab_name){if(e<=n.members.filter_scroll_mark)return;t=x.height();if(e>t&&n.members.filter_p&&n.members.filter_p.isResolved()){T(l,d,c,m);n.members.filter_scroll_mark=e}}if("restricted_members"===TS.model.ui_state.tab_name){if(e<=n.restricted.filter_scroll_mark)return;t=x.height();if(e>t&&n.restricted.filter_p&&n.restricted.filter_p.isResolved()){T(l,d,c,m);n.restricted.filter_scroll_mark=e}}})}else TS.web&&$(window).off("scroll.filter").on("scroll.filter",_.throttle(function(){var e=0;var t=0;var r=0;var u=null;if("active_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#active_members_list > .list_items").css("height"));t=_.reject(i.active_members_list_items,{is_divider:true}).length;r=n.members.filter_num_remaining;u=n.members.filter_p}if("restricted_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#restricted_members_list > .list_items").css("height"));t=_.reject(i.restricted_members_list_items,{is_divider:true}).length;r=n.restricted.filter_num_remaining;u=n.restricted.filter_p}if("disabled_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#disabled_members_list > .list_items").css("height"));t=_.reject(i.deleted_members_list_items,{is_divider:true}).length;r=n.deleted.filter_num_remaining;u=a.deleted.filter_p}var f=.9*Math.min(t,s);e=_.isNaN(e)?0:e;e-=f*o;e&&r&&$(this).scrollTop()>e&&u&&u.isResolved()&&T(l,d,c,m)},50,{leading:true}));var C=(n.members.filter_num_found||0)+(n.restricted.filter_num_found||0)+(n.deleted.filter_num_found||0);TS.members.view.team_filter_changed_sig.dispatch(u,C)}};var y=function e(t,n,r){var i=[];n&&(i=n.split(/\s*,\s*|\s+/).map(function(e){return"@"===e.charAt("0")?e.substring(1):e}).filter(function(e){return!!e}).map(function(e){if(1===e.length||!r.full_profile_filter){var t=TS.utility.search.makeClause("real_name",e);var n=TS.utility.search.makeClause("display_name",e);var i=TS.utility.search.makeConjunction("OR",[t,n]);return i}return TS.utility.search.makeClause("fuzzy_with_email",e)}));i.push(TS.utility.search.makeClause("is","user"));if(r.restricted){var a=TS.utility.search.makeClause("level","restricted");var o=TS.utility.search.makeClause("level","ultra_restricted");i.push(TS.utility.search.makeConjunction("OR",[a,o]))}var l=i.length>1?TS.utility.search.makeConjunction("AND",i):i[0];var u={query:l,count:s,include_bots:r.include_bots,exclude_slackbot:r.exclude_slackbot,include_deleted:r.include_deleted};r.sort&&(u.sort=r.sort);r.sort_dir&&(u.sort_dir=r.sort_dir);r.include_org&&(u.all_of_org=r.include_org);t.filter_cursor_mark&&(u.cursor_mark=t.filter_cursor_mark);r.endpoint&&(u.endpoint=r.endpoint);TS.web&&(u.solr=true);return u};var w=function e(t,n,r){var i=y(t,n,r);i.raw_query=n;return TS.utility.search.promiseToSearch(i).then(function(i){if(!t.filter_num_remaining){t.filter_num_remaining=i.data.num_found;t.filter_num_found=i.data.num_found}t.filter_num_remaining-=i.data.items.length;t.filter_cursor_mark=i.data.next_cursor_mark;if(!i.data.items.length)return Promise.resolve([]);var a=i.data.items.map(function(e){var t=TS.interop.members.getMemberById(e.id);t&&_.isEqual(t,e)||(t=TS.members.legacyUpsertMember(e).member);return t});r.restricted||r.include_restricted_and_full_members||(a=a.filter(function(e){return!e.is_restricted}));if(a.length)return Promise.resolve(a);if(t.filter_num_remaining)return e(t,n,r);return Promise.resolve([])})};var k=function n(r,i,a,s){var o=$(i);var l=r.trim();e=l.toLocaleLowerCase();var u=o.data("list-items-id");var d=$(u);var c=d.find(".member_item:not(.clone)");var _=c.filter(".active");var m=d.find(".member_item.clone");var f=d.find(".filter_header");var p=!TS.web&&"#team_filter"===i;var h={};var g;var S;var T;TS.storage.storeFilterState(e);var v=false;var b;E&&"#team_filter"===i&&(b=d.find(".tab_pane.selected"));b||TS.web||"#team_filter"!==i||(b=$("#team_list_members"));b&&b.length&&b.addClass("hidden");if(v){g=c.parent();S=document.activeElement?$(document.activeElement):null;c.detach()}if(t[a]){t[a].detachEvents();delete t[a]}m.remove();f.remove();_.removeClass("active");d.find(".no_results").addClass("hidden");if(v){g.append(c);S&&S.focus()}var y;if(E&&"invites"===TS.web.admin.view){var w=[];var k=[];var x=[];$.each(c,function(e,t){var n;t=$(t);n=t.data("invite-id");h[n]=t});k=P(TS.web.admin.pending_invites,e).name||[];x=P(TS.web.admin.accepted_invites,e).name||[];w=k.concat(x);if(w.length>0){$.each(w,function(e,t){t&&t.member&&t.member.id&&h[t.member.id]&&h[t.member.id].addClass("active")});a&&$(a).trigger("resize")}y=[{name:"pending",label:TS.interop.i18n.t("pending invitations","members_view")(),matches:k},{name:"accepted",label:TS.interop.i18n.t("accepted invitations","members_view")(),matches:x}];y.forEach(function(e){var t=$("#"+e.name+"_no_results");if(e.matches.length>0){t.addClass("hidden").empty();return}var n={query:l,tab:e,pending_matches:k,show_pending_matches:"pending"!==e.name&&k.length>0,accepted_matches:x,show_accepted_matches:"accepted"!==e.name&&x.length>0};var r=TS.templates.team_list_no_results(n);t.removeClass("hidden").html(r);t.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter(i,a)})});T=w}else{var C;var M=[];var A=[];var F=[];C=E?r.length?TS.members.getMembersForUser():TS.web.admin.getMembersForUser():TS.members.getMembersForUser();$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").toggleClass("hidden",!!e);$.each(c,function(e,t){var n;t=$(t);n=t.data("member-id");h[n]=t});w=P(C,e,s.full_profile_filter);var O=Object.keys(w);if(O.length>0){I(w,O,h,F,A,M,p?a:"");if(a){var D=$(a);D.trigger("resize");TS.ui.utility.updateClosestMonkeyScroller(D)}}else if("#file_member_filter"===i){d.find(".query").text(l);d.find(".no_results").removeClass("hidden")}if("#team_filter"===i){y=[{name:"active",label:TS.interop.i18n.t("full members","members_view")(),matches:M},{name:"restricted",label:TS.interop.i18n.t("multi-channel guests","members_view")(),matches:A},{name:"disabled",label:TS.interop.i18n.t("deactivated accounts","members_view")(),matches:F}];y.forEach(function(e){var t=$("#"+e.name+"_no_results");function n(){var n={query:l,tab:e,active_matches:M,show_active_matches:"active"!==e.name&&M.length>0,restricted_matches:A,show_restricted_matches:"restricted"!==e.name&&A.length>0,disabled_matches:F,show_disabled_matches:TS.web&&"disabled"!==e.name&&F.length>0};var r=TS.templates.team_list_no_results(n);t.removeClass("hidden").html(r);t.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter(i,a)})}if(e.matches.length>0){t.addClass("hidden").empty();return}n()})}T=M.concat(A,F)}b&&b.length&&b.removeClass("hidden");TS.ui.utility.updateClosestMonkeyScroller($(a));TS.members.view.team_filter_changed_sig.dispatch(l,T.length)};var x=function e(t){return n[t]||t};var C=function e(t,n){var r=document.createElement("div");var i=document.createElement("strong");r.classList.add("filter_header");i.appendChild(document.createTextNode(t));n.length&&i.appendChild(document.createTextNode(": "));r.appendChild(i);n.forEach(function(e,t){r.appendChild(e);t<n.length-1&&r.appendChild(document.createTextNode(", "))});return r};var M=function e(t,n){var r=document.createElement("span");var i=document.createElement("strong");var a=t.split(n);i.appendChild(document.createTextNode(n));r.appendChild(document.createTextNode(a.shift()));r.appendChild(i);r.appendChild(document.createTextNode(a.join(n)));return r};var I=function e(r,i,a,s,o,l,u){var d=$(u);var c=document.createDocumentFragment();var _=document.createDocumentFragment();var m=document.createDocumentFragment();var f;var p;var h;var g=E&&TS.web.admin.isSubsetCase();i.sort(function(e,t){return TS.interop.i18n.sorter(n[e],n[t])}).forEach(function(e){var t=document.createDocumentFragment();var n=document.createDocumentFragment();var i=document.createDocumentFragment();var u=[];var d=[];var S=[];var T={};var v={};var b={};if(g&&!h){h=$("#active_members > div:first-of-type");p=$("#restricted_members > div:first-of-type");f=$("#disabled_members > div:first-of-type")}r[e].forEach(function(r){var c=r.member;var _;var m=false;if(c&&c.id){_=a[c.id];if(!_&&g){_=$(TS.web.admin.buildMemberHTML(c,false,false));m=true}if(_)if("name"!==e||m)if(c.deleted){f||(f=_.parent());r.value&&!T[r.value]&&(T[r.value]=u.push(M(r.value,r.match)));t.appendChild(_.clone().addClass("active clone").get(0))}else if(c.is_restricted){p||(p=_.parent());r.value&&!v[r.value]&&(v[r.value]=d.push(M(r.value,r.match)));n.appendChild(_.clone().addClass("active clone").get(0))}else{h||(h=_.parent());r.value&&!b[r.value]&&(b[r.value]=S.push(M(r.value,r.match)));i.appendChild(_.clone().addClass("active clone").get(0))}else _.addClass("active");c.deleted?s.push(c):c.is_restricted?o.push(c):l.push(c)}});if(t.childNodes&&t.childNodes.length){c.appendChild(C(x(e),u));c.appendChild(t)}if(n.childNodes&&n.childNodes.length){_.appendChild(C(x(e),d));_.appendChild(n)}if(i.childNodes&&i.childNodes.length){m.appendChild(C(x(e),S));m.appendChild(i)}t=null;n=null;i=null;u=null;d=null;S=null;T=null;v=null;b=null});f&&f.append(c);p&&p.append(_);h&&h.append(m);if(d.length){var S=d.find(".member_item.clone");t[u]=S.find(".lazy").lazyload({container:d,ignore_when_hidden_element:d,all_images_same_size:true});S.one("remove",function(){if(t[u]){t[u].detachEvents();delete t[u]}})}if(g){if(TS.web.admin.lazyload&&TS.web.admin.lazyload.detachEvents){TS.web.admin.lazyload.detachEvents();TS.web.admin.lazyload=null}TS.web.admin.lazyload||(TS.web.admin.lazyload=$("#admin_list").find(".lazy").lazyload())}c=null;_=null;m=null;f=null;p=null;h=null};var A=function e(t){return _.reduce(t,function(e,t){t.deleted?t.is_bot?e.deleted_bots.push(t):e.disabled_members.push(t):t.is_ultra_restricted?e.ultra_restricted_members.push(t):t.is_restricted?e.restricted_members.push(t):t.is_bot||t.is_slackbot?e.bots.push(t):e.members.push(t);return e},{members:[],disabled_members:[],deleted_bots:[],bots:[],restricted_members:[],ultra_restricted_members:[]})};var E;var P=function e(t,r,i){var a=new RegExp("^"+TS.utility.regexpEscape(r),"i");var s=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(r),"i");var o={};var l=i&&r?TS.team.getVisibleTeamProfileFields():[];n={title:"What I Do",name:"Name"};t.forEach(function(e){var t;t=e._real_name_lc&&(e._real_name_lc.match(a)||e._real_name_lc.match(s))||e.email&&(e.email.match(a)||e.email.match(s))||e.profile&&e.profile.email&&(e.profile.email.match(a)||e.profile.email.match(s))||e.profile&&e.profile.real_name_normalized&&(e.profile.real_name_normalized.match(a)||e.profile.real_name_normalized.match(s))||e.profile&&e.profile.real_name&&(e.profile.real_name.match(a)||e.profile.real_name.match(s))||e.profile&&e.profile.display_name_normalized&&(e.profile.display_name_normalized.match(a)||e.profile.display_name_normalized.match(s))||e.profile&&e.profile.preferred_name&&(e.profile.preferred_name.match(a)||e.profile.preferred_name.match(s));if(t){o.name||(o.name=[]);o.name.push({member:e})}if(i&&r){t=e.profile&&e.profile.title&&(e.profile.title.match(a)||e.profile.title.match(s));if(t){o.title||(o.title=[]);o.title.push({member:e})}}l.length&&e.profile&&e.profile.fields&&l.forEach(function(r){var i=e.profile.fields[r.id];if(!i)return;t=null;if("user"===r.type){if(i.value){var l="";i.value.split(/\s*,\s*/).some(function(e){l=TS.interop.members.getPrefCompliantMemberNameById(e,false);return l.match(a)||l.match(s)});if(t){o[r.id]||(o[r.id]=[]);o[r.id].push({member:e,value:l,match:t[0]})}}}else{t=i.value&&(i.value.match(a)||i.value.match(s));if(t){o[r.id]||(o[r.id]=[]);o[r.id].push({member:e,value:i.value,match:t[0]})}else{t=i.alt&&(i.alt.match(a)||i.alt.match(s));if(t){o[r.id]||(o[r.id]=[]);o[r.id].push({member:e,value:i.alt,match:t[0]})}}}t&&!n[r.id]&&(n[r.id]=r.label)})});return o}})()},11232:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("prefs",{all_notifications_prefs_changed_sig:new signals.Signal,highlight_words_changed_sig:new signals.Signal,seen_welcome_2_changed_sig:new signals.Signal,emoji_mode_changed_sig:new signals.Signal,obey_inline_img_limit_changed_sig:new signals.Signal,messages_theme_changed_sig:new signals.Signal,expand_inline_imgs_changed_sig:new signals.Signal,expand_internal_inline_imgs_changed_sig:new signals.Signal,expand_non_media_attachments_changed_sig:new signals.Signal,webapp_spellcheck_changed_sig:new signals.Signal,color_names_in_list_changed_sig:new signals.Signal,search_only_my_channels_changed_sig:new signals.Signal,search_exclude_channels_changed_sig:new signals.Signal,search_exclude_bots_changed_sig:new signals.Signal,search_only_current_team_changed_sig:new signals.Signal,box_enabled_changed_sig:new signals.Signal,dropbox_enabled_changed_sig:new signals.Signal,read_changed_sig:new signals.Signal,push_changed_sig:new signals.Signal,time24_changed_sig:new signals.Signal,sidebar_behavior_changed_sig:new signals.Signal,dtop_notif_changed_sig:new signals.Signal,muted_channels_changed_sig:new signals.Signal,mac_ssb_bullet_changed_sig:new signals.Signal,team_hide_referers_changed_sig:new signals.Signal,sidebar_theme_changed_sig:new signals.Signal,no_invites_widget_in_sidebar_changed_sig:new signals.Signal,k_key_omnibox_auto_hide_count_changed_sig:new signals.Signal,display_real_names_override_changed_sig:new signals.Signal,team_display_real_names_changed_sig:new signals.Signal,team_perms_pref_changed_sig:new signals.Signal,privacy_policy_seen_changed_sig:new signals.Signal,two_factor_update_seen_changed_sig:new signals.Signal,compliance_export_start_changed_sig:new signals.Signal,team_disallow_public_file_urls_changed_sig:new signals.Signal,msg_preview_changed_sig:new signals.Signal,mentions_exclude_at_channels_changed_sig:new signals.Signal,mentions_exclude_at_user_groups_changed_sig:new signals.Signal,team_auth_mode_changed_sig:new signals.Signal,team_sso_auth_restrictions_changed_sig:new signals.Signal,team_posts_migrating_changed_sig:new signals.Signal,preferred_skin_tone_changed_sig:new signals.Signal,separate_private_channels_changed_sig:new signals.Signal,separate_shared_channels_changed_sig:new signals.Signal,whats_new_read_changed_sig:new signals.Signal,team_dnd_enabled_changed_sig:new signals.Signal,team_dnd_start_hour_changed_sig:new signals.Signal,team_dnd_end_hour_changed_sig:new signals.Signal,team_invites_only_admins_changed_sig:new signals.Signal,tz_changed_sig:new signals.Signal,keyboard_changed_sig:new signals.Signal,msg_input_send_btn_changed_sig:new signals.Signal,msg_input_send_btn_auto_set_changed_sig:new signals.Signal,team_allow_calls_changed_sig:new signals.Signal,team_calling_app_name_changed_sig:new signals.Signal,team_calling_app_id_changed_sig:new signals.Signal,frecency_jumper_changed_sig:new signals.Signal,jumbomoji_changed_sig:new signals.Signal,hide_hex_swatch_changed_sig:new signals.Signal,channel_sort_changed_sig:new signals.Signal,show_memory_instrument_changed_sig:new signals.Signal,enable_unread_view_changed_sig:new signals.Signal,enable_react_emoji_picker_changed_sig:new signals.Signal,team_disable_file_editing_changed_sig:new signals.Signal,team_disable_file_deleting_changed_sig:new signals.Signal,team_display_email_addresses_changed_sig:new signals.Signal,all_unreads_sort_order_changed_sig:new signals.Signal,email_alerts_changed_sig:new signals.Signal,team_uses_customized_custom_status_presets_changed_sig:new signals.Signal,team_loud_channel_mentions_limit_changed_sig:new signals.Signal,locale_changed_sig:new signals.Signal,enable_shared_channels_changed_sig:new signals.Signal,a11y_animations_changed_sig:new signals.Signal,prefs_loaded:false,setPrefs:function e(t){var n=TS.prefs.getPref("muted_channels");TS.redux.prefs.setUserPrefs(t);TS.prefs.prefs_loaded=true;TS.prefs.mergeEmojiUse(TS.prefs.getPref("emoji_use"));TS.prefs.mergeFrecencyJumper(TS.ui.frecency.isEnterprise()?TS.prefs.getPref("frecency_ent_jumper"):TS.prefs.getPref("frecency_jumper"));TS.prefs.setUserColors(TS.prefs.getPref("user_colors"));TS.prefs.setLoudChannels(TS.prefs.getPref("loud_channels"));TS.prefs.setSuppressedChannels(TS.prefs.getPref("at_channel_suppressed_channels"));TS.prefs.setPushSuppressedChannels(TS.prefs.getPref("push_at_channel_suppressed_channels"));TS.prefs.setNeverChannels(TS.prefs.getPref("never_channels"));TS.prefs.setMutedChannels(TS.prefs.getPref("muted_channels"),n);TS.prefs.setLoudChannelsSet(TS.prefs.getPref("loud_channels_set"));TS.prefs.setPushLoudChannels(TS.prefs.getPref("push_loud_channels"));TS.prefs.setPushMentionChannels(TS.prefs.getPref("push_mention_channels"));TS.prefs.setPushLoudChannelsSet(TS.prefs.getPref("push_loud_channels_set"));TS.prefs.setSearchExcludeChannels(TS.prefs.getPref("search_exclude_channels"));TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort"));TS.prefs.setSidebarThemeCustomValues(TS.utility.parseJSONOrElse(TS.prefs.getPref("sidebar_theme_custom_values"),void 0));TS.emoji.setEmojiMode();TS.prefs.setTheme();TS.prefs.setPrefLocal("emoji_autocomplete_big",false);TSSSB.call("runFromTray",!!TS.prefs.getPref("winssb_run_from_tray"));TSSSB.call("windowFlashBehavior",TS.prefs.getPref("winssb_window_flash_behavior"))},setChannelSort:function e(t){TS.model.channel_sort=t},setHighlightWords:function e(t){TS.prefs.setPrefLocal("highlight_words",t);TS.model.highlight_words=[];TS.model.highlight_words.push("<@"+TS.model.user.id);t&&"string"===typeof t&&(TS.model.highlight_words=TS.model.highlight_words.concat(t.split(",")));TS.model.highlight_words_regex=null},setSuppressedChannels:function e(t){TS.prefs.setPrefLocal("at_channel_suppressed_channels",t);TS.model.at_channel_suppressed_channels=[];t&&"string"===typeof t&&(TS.model.at_channel_suppressed_channels=TS.model.at_channel_suppressed_channels.concat(t.split(",")))},setPushSuppressedChannels:function e(t){TS.prefs.setPrefLocal("push_at_channel_suppressed_channels",t);TS.model.push_at_channel_suppressed_channels=[];t&&"string"===typeof t&&(TS.model.push_at_channel_suppressed_channels=TS.model.push_at_channel_suppressed_channels.concat(t.split(",")))},setLoudChannels:function e(t){TS.prefs.setPrefLocal("loud_channels",t);TS.model.loud_channels=[];t&&"string"===typeof t&&(TS.model.loud_channels=TS.model.loud_channels.concat(t.split(",")))},setNeverChannels:function e(t){TS.prefs.setPrefLocal("never_channels",t);TS.model.never_channels=[];t&&"string"===typeof t&&(TS.model.never_channels=TS.model.never_channels.concat(t.split(",")))},setMutedChannels:function t(n,r){var i;r||(r=TS.prefs.getPref("muted_channels"));if(r===n&&e)return;i=TS.prefs.getPref("muted_channels")&&"string"===typeof TS.prefs.getPref("muted_channels")?TS.prefs.getPref("muted_channels").split(","):[];TS.prefs.setPrefLocal("muted_channels",n);e=true;var a;var s;var o=[];var l=[];if(n&&"string"===typeof n){o=o.concat(n.split(","));l=_.difference(i,o)}for(a=0;a<o.length;a+=1){s=TS.redux.channels.getEntityById(o[a]);if(!s)continue;if(!s.unread_cnt)continue;s._show_in_list_even_though_no_unreads=true}TS.model.channels.forEach(function(e){if(TS.notifs.isCorGMuted(e.id))return;e._show_in_list_even_though_no_unreads=false});TS.model.groups.forEach(function(e){if(TS.notifs.isCorGMuted(e.id))return;e._show_in_list_even_though_no_unreads=false});TS.redux.channels.updateMutedChannels(o);return l},setLoudChannelsSet:function e(t){TS.prefs.setPrefLocal("loud_channels_set",t);TS.model.loud_channels_set=[];t&&"string"===typeof t&&(TS.model.loud_channels_set=TS.model.loud_channels_set.concat(t.split(",")))},setPushLoudChannels:function e(t){TS.prefs.setPrefLocal("push_loud_channels",t);TS.model.push_loud_channels=[];t&&"string"===typeof t&&(TS.model.push_loud_channels=TS.model.push_loud_channels.concat(t.split(",")))},setPushMentionChannels:function e(t){TS.prefs.setPrefLocal("push_mention_channels",t);TS.model.push_mention_channels=[];t&&"string"===typeof t&&(TS.model.push_mention_channels=TS.model.push_mention_channels.concat(t.split(",")))},setPushLoudChannelsSet:function e(t){TS.prefs.setPrefLocal("push_loud_channels_set",t);TS.model.push_loud_channels_set=[];t&&"string"===typeof t&&(TS.model.push_loud_channels_set=TS.model.push_loud_channels_set.concat(t.split(",")))},setSearchExcludeChannels:function e(t){TS.prefs.setPrefLocal("search_exclude_channels",t);TS.model.search_exclude_channels=[];t&&"string"===typeof t&&(TS.model.search_exclude_channels=TS.model.search_exclude_channels.concat(t.split(",")))},mergeFrecencyJumper:function e(t){t&&"object"===("undefined"===typeof t?"undefined":n(t))||(t=TS.utility.parseJSONOrElse(t||null)||{});TS.model.frecency_jumper=t;return true},mergeEmojiUse:function e(t){TS.model.emoji_names&&TS.model.emoji_names.length||TS.emoji.makeMenuLists();if(!t||"object"!==("undefined"===typeof t?"undefined":n(t))){t=TS.utility.parseJSONOrElse(t||null)||{};t=_.pickBy(t,function(e,t){return _.includes(TS.model.emoji_names,t)})}var r=false;for(var i in t)if(!TS.model.emoji_use.hasOwnProperty(i)||t[i]>TS.model.emoji_use[i]){TS.model.emoji_use[i]=t[i];r=true}if(!r){TS.has_pri[777]&&TS.log(777,"mergeEmojiUse TS.model.emoji_use unchanged");return false}TS.has_pri[777]&&TS.dir(777,TS.model.emoji_use,"mergeEmojiUse TS.model.emoji_use set to:");return true},setUserColors:function e(t){TS.prefs.setPrefLocal("user_colors",t);var n=t?JSON.parse(t):{};TS.model.user_colors=n||{}},setTheme:function e(){"default"===TS.prefs.getPref("messages_theme")&&TS.prefs.setPrefLocal("messages_theme","light_with_avatars");TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",true);if("dense"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","dense");TS.prefs.setPrefLocal("avatars",false)}else if("light"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",false)}else if("light_with_avatars"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",true)}},onTeamPrefChanged:function e(t){if("msg_edit_window_mins"===t.name)TS.prefs.setTeamPrefLocal("msg_edit_window_mins",t.value);else if("allow_message_deletion"===t.name)TS.prefs.setTeamPrefLocal("allow_message_deletion",!!t.value);else if("hide_referers"===t.name){TS.prefs.setTeamPrefLocal("hide_referers",!!t.value);TS.prefs.team_hide_referers_changed_sig.dispatch()}else if("display_real_names"===t.name){TS.prefs.setTeamPrefLocal("display_real_names",!!t.value);TS.prefs.team_display_real_names_changed_sig.dispatch()}else if("display_email_addresses"===t.name){TS.prefs.setTeamPrefLocal("display_email_addresses",!!t.value);TS.prefs.team_display_email_addresses_changed_sig.dispatch()}else if(0===t.name.indexOf("who_can_")){if(TS.prefs.getTeamPref(t.name)!=t.value){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_perms_pref_changed_sig.dispatch(t.name)}}else if("compliance_export_start"===t.name){if(TS.prefs.getTeamPref("compliance_export_start")!=t.value){TS.prefs.setTeamPrefLocal("compliance_export_start",t.value);TS.prefs.compliance_export_start_changed_sig.dispatch()}}else if("disallow_public_file_urls"===t.name){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",!!t.value);TS.prefs.team_disallow_public_file_urls_changed_sig.dispatch()}else if("auth_mode"===t.name){TS.prefs.setTeamPrefLocal("auth_mode",t.value);TS.prefs.team_auth_mode_changed_sig.dispatch()}else if("sso_auth_restrictions"===t.name){TS.prefs.setTeamPrefLocal("sso_auth_restrictions",t.value);TS.prefs.team_sso_auth_restrictions_changed_sig.dispatch()}else if("posts_migrating"===t.name){TS.prefs.setTeamPrefLocal("posts_migrating",t.value);TS.prefs.team_posts_migrating_changed_sig.dispatch()}else if("dnd_enabled"===t.name){TS.prefs.setTeamPrefLocal("dnd_enabled",t.value);TS.prefs.team_dnd_enabled_changed_sig.dispatch()}else if("dnd_start_hour"===t.name){TS.prefs.setTeamPrefLocal("dnd_start_hour",t.value);TS.prefs.team_dnd_start_hour_changed_sig.dispatch()}else if("dnd_end_hour"===t.name){TS.prefs.setTeamPrefLocal("dnd_end_hour",t.value);TS.prefs.team_dnd_end_hour_changed_sig.dispatch()}else if("invites_only_admins"===t.name){TS.prefs.setTeamPrefLocal("invites_only_admins",t.value);TS.prefs.team_invites_only_admins_changed_sig.dispatch()}else if("allow_calls"===t.name){TS.prefs.setTeamPrefLocal("allow_calls",t.value);TS.prefs.team_allow_calls_changed_sig.dispatch()}else if("calling_app_id"===t.name){TS.prefs.setTeamPrefLocal("calling_app_id",t.value);TS.prefs.team_calling_app_id_changed_sig.dispatch()}else if("calling_app_name"===t.name){TS.prefs.setTeamPrefLocal("calling_app_name",t.value);TS.prefs.team_calling_app_name_changed_sig.dispatch()}else if("disable_file_editing"===t.name){TS.prefs.setTeamPrefLocal("disable_file_editing",t.value);TS.prefs.team_disable_file_editing_changed_sig.dispatch()}else if("disable_file_deleting"===t.name){TS.prefs.setTeamPrefLocal("disable_file_deleting",t.value);TS.prefs.team_disable_file_deleting_changed_sig.dispatch()}else if("who_can_post_general"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);var n=TS.interop.channels.getGeneralChannel().id;TS.permissions.members.canPostInGeneral()?TS.channels.read_only.removeChannelFromList(n):TS.channels.read_only.addChannelToList(n)}else if("uses_customized_custom_status_presets"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_uses_customized_custom_status_presets_changed_sig.dispatch()}else if("loud_channel_mentions_limit"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_loud_channel_mentions_limit_changed_sig.dispatch()}else if("enable_shared_channels"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.enable_shared_channels_changed_sig.dispatch()}else TS.prefs.setTeamPrefLocal(t.name,t.value)},getPref:function e(t){return TS.redux.prefs.getUserPref(t)},setPrefLocal:function e(t,n){TS.redux.prefs.setUserPref(t,n)},getTeamPref:function e(t){return TS.redux.prefs.getTeamPref(t)},setTeamPrefLocal:function e(t,n){TS.redux.prefs.setTeamPref(t,n)},setMultiplePrefs:function e(t){TS.redux.prefs.setMultipleUserPrefs(t)},onPrefChanged:function e(t){switch(t.name){case"all_notifications_prefs":TS.prefs.setPrefLocal("all_notifications_prefs",t.value);TS.prefs.all_notifications_prefs_changed_sig.dispatch(t.value);break;case"locale":TS.prefs.setPrefLocal("locale",t.value);TS.prefs.locale_changed_sig.dispatch(t.value);break;case"flannel_server_pool":TS.prefs.setPrefLocal("flannel_server_pool",t.value);break;case"color_names_in_list":TS.prefs.setPrefLocal("color_names_in_list",!!t.value);TS.prefs.color_names_in_list_changed_sig.dispatch();break;case"display_real_names_override":TS.prefs.setPrefLocal("display_real_names_override",t.value);TS.prefs.display_real_names_override_changed_sig.dispatch();break;case"growls_enabled":TS.prefs.setPrefLocal("growls_enabled",!!t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"sidebar_theme":if(TS.prefs.getPref("sidebar_theme")!==t.value){TS.prefs.setPrefLocal("sidebar_theme",t.value);TS.prefs.sidebar_theme_changed_sig.dispatch()}break;case"sidebar_theme_custom_values":if(TS.prefs.getPref("sidebar_theme_custom_values")!==t.value){TS.prefs.setSidebarThemeCustomValues(JSON.parse(t.value));TS.prefs.sidebar_theme_changed_sig.dispatch()}break;case"expand_inline_imgs":TS.prefs.setPrefLocal("expand_inline_imgs",!!t.value);TS.prefs.expand_inline_imgs_changed_sig.dispatch();break;case"webapp_spellcheck":TS.prefs.setPrefLocal("webapp_spellcheck",!!t.value);TS.prefs.webapp_spellcheck_changed_sig.dispatch();break;case"expand_internal_inline_imgs":TS.prefs.setPrefLocal("expand_internal_inline_imgs",!!t.value);TS.prefs.expand_internal_inline_imgs_changed_sig.dispatch();break;case"expand_non_media_attachments":TS.prefs.setPrefLocal("expand_non_media_attachments",!!t.value);TS.prefs.expand_non_media_attachments_changed_sig.dispatch();break;case"messages_theme":TS.prefs.setPrefLocal("messages_theme",t.value);TS.prefs.setTheme();TS.prefs.messages_theme_changed_sig.dispatch();break;case"highlight_words":TS.prefs.setHighlightWords(t.value);TS.prefs.highlight_words_changed_sig.dispatch();break;case"at_channel_suppressed_channels":TS.prefs.setSuppressedChannels(t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_at_channel_suppressed_channels":TS.prefs.setPushSuppressedChannels(t.value);TS.prefs.push_changed_sig.dispatch();break;case"loud_channels":TS.prefs.setLoudChannels(t.value);break;case"never_channels":TS.prefs.setNeverChannels(t.value);break;case"muted_channels":var n=TS.prefs.setMutedChannels(t.value);TS.view.prefs.mutedChannelsChanged(n);TS.prefs.muted_channels_changed_sig.dispatch();break;case"loud_channels_set":TS.prefs.setLoudChannelsSet(t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_loud_channels":TS.prefs.setPushLoudChannels(t.value);break;case"push_mention_channels":TS.prefs.setPushMentionChannels(t.value);break;case"push_loud_channels_set":TS.prefs.setPushLoudChannelsSet(t.value);TS.prefs.push_changed_sig.dispatch();break;case"emoji_use":TS.prefs.mergeEmojiUse(t.value)&&TS.emoji.maybeRemakeMenuListsIfFrequentsChanged();break;case"user_colors":_.each(_.keys(TS.model.user_colors),function(e){var t=TS.interop.members.getMemberById(e);t&&TS.members.setMemberUserColor(t,t.color)});TS.prefs.setUserColors(t.value);_.forOwn(TS.model.user_colors,function(e,t){var n=TS.interop.members.getMemberById(t);n&&TS.members.setMemberUserColor(n,e)});break;case"graphic_emoticons":TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("graphic_emoticons",t.value);TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();break;case"ss_emojis":TS.prefs.setPrefLocal("ss_emojis",t.value);TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"emoji_mode":TS.rxns.clearHandyRxnsDisplayDataCache();if(TS.useReactMessages()){var r=t.value;TS.boot_data.feature_emoji5&&"as_text"!==t.value&&(r=TS.interop.rules.emoji.getEmojiMode({forceDisplay:true}));TS.emoji.setEmojiMode(r)}TS.prefs.setPrefLocal("emoji_mode",t.value);TS.useReactMessages()||TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"obey_inline_img_limit":TS.prefs.setPrefLocal("obey_inline_img_limit",t.value);TS.prefs.obey_inline_img_limit_changed_sig.dispatch();break;case"search_only_my_channels":TS.prefs.setPrefLocal("search_only_my_channels",!!t.value);TS.prefs.search_only_my_channels_changed_sig.dispatch();break;case"search_only_current_team":TS.prefs.setPrefLocal("search_only_current_team",!!t.value);TS.prefs.search_only_current_team_changed_sig.dispatch();break;case"search_exclude_channels":TS.prefs.setSearchExcludeChannels(t.value);TS.prefs.search_exclude_channels_changed_sig.dispatch();break;case"search_exclude_bots":TS.prefs.setPrefLocal("search_exclude_bots",!!t.value);TS.prefs.search_exclude_bots_changed_sig.dispatch();break;case"has_uploaded":TS.prefs.setPrefLocal("has_uploaded",!!t.value);break;case"has_invited":TS.prefs.setPrefLocal("has_invited",!!t.value);break;case"has_created_channel":TS.prefs.setPrefLocal("has_created_channel",!!t.value);break;case"no_joined_overlays":TS.prefs.setPrefLocal("no_joined_overlays",!!t.value);break;case"no_created_overlays":TS.prefs.setPrefLocal("no_created_overlays",!!t.value);break;case"seen_welcome_2":TS.prefs.setPrefLocal("seen_welcome_2",!!t.value);TS.prefs.seen_welcome_2_changed_sig.dispatch();break;case"box_enabled":TS.prefs.setPrefLocal("box_enabled",!!t.value);TS.prefs.box_enabled_changed_sig.dispatch();break;case"dropbox_enabled":TS.prefs.setPrefLocal("dropbox_enabled",!!t.value);TS.prefs.dropbox_enabled_changed_sig.dispatch();break;case"mark_msgs_read_immediately":if(TS.prefs.getPref("mark_msgs_read_immediately")!==!!t.value){TS.prefs.setPrefLocal("mark_msgs_read_immediately",!!t.value);TS.prefs.read_changed_sig.dispatch()}break;case"start_scroll_at_oldest":if(TS.prefs.getPref("start_scroll_at_oldest")!==!!t.value){TS.prefs.setPrefLocal("start_scroll_at_oldest",!!t.value);TS.prefs.read_changed_sig.dispatch()}break;case"mac_ssb_bullet":if(TS.prefs.getPref("mac_ssb_bullet")!==!!t.value){TS.prefs.setPrefLocal("mac_ssb_bullet",!!t.value);TS.prefs.mac_ssb_bullet_changed_sig.dispatch()}break;case"all_channels_loud":if(TS.prefs.getPref("all_channels_loud")!==!!t.value){TS.prefs.setPrefLocal("all_channels_loud",!!t.value);TS.prefs.dtop_notif_changed_sig.dispatch()}break;case"push_everything":if(TS.prefs.getPref("push_everything")!==!!t.value){TS.prefs.setPrefLocal("push_everything",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"push_mention_alert":if(TS.prefs.getPref("push_mention_alert")!==!!t.value){TS.prefs.setPrefLocal("push_mention_alert",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"push_dm_alert":if(TS.prefs.getPref("push_dm_alert")!==!!t.value){TS.prefs.setPrefLocal("push_dm_alert",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"time24":if(TS.prefs.getPref("time24")!==!!t.value){TS.prefs.setPrefLocal("time24",!!t.value);TS.prefs.time24_changed_sig.dispatch()}break;case"sidebar_behavior":if(TS.prefs.getPref("sidebar_behavior")!=t.value){TS.prefs.setPrefLocal("sidebar_behavior",t.value);TS.prefs.sidebar_behavior_changed_sig.dispatch()}break;case"two_factor_update_seen":if(TS.model.two_factor_update_seen!=t.value){TS.mode.prefs.two_factor_update_seen=t.value;TS.prefs.two_factor_update_seen_changed_sig.dispatch()}break;case"privacy_policy_seen":if(TS.prefs.getPref("privacy_policy_seen")!=t.value){TS.prefs.setPrefLocal("privacy_policy_seen",t.value);TS.prefs.privacy_policy_seen_changed_sig.dispatch()}break;case"last_seen_at_channel_warning":TS.prefs.getPref("last_seen_at_channel_warning")!=t.value&&TS.prefs.setPrefLocal("last_seen_at_channel_warning",t.value);break;case"msg_preview":if(TS.prefs.getPref("msg_preview")!=t.value){TS.prefs.setPrefLocal("msg_preview",t.value);TS.prefs.msg_preview_changed_sig.dispatch()}break;case"msg_preview_persistent":if(TS.prefs.getPref("msg_preview_persistent")!=t.value){TS.prefs.setPrefLocal("msg_preview_persistent",t.value);TS.prefs.msg_preview_changed_sig.dispatch()}break;case"winssb_run_from_tray":if(TS.prefs.getPref("winssb_run_from_tray")!=t.value){TS.prefs.setPrefLocal("winssb_run_from_tray",t.value);TSSSB.call("runFromTray",!!TS.prefs.getPref("winssb_run_from_tray"))}break;case"winssb_window_flash_behavior":if(TS.prefs.getPref("winssb_window_flash_behavior")!=t.value){TS.prefs.setPrefLocal("winssb_window_flash_behavior",t.value);TSSSB.call("windowFlashBehavior",TS.prefs.getPref("winssb_window_flash_behavior"))}break;case"mentions_exclude_at_channels":if(TS.prefs.getPref("mentions_exclude_at_channels")!=t.value){TS.prefs.setPrefLocal("mentions_exclude_at_channels",t.value);TS.prefs.mentions_exclude_at_channels_changed_sig.dispatch()}break;case"mentions_exclude_at_user_groups":if(TS.prefs.getPref("mentions_exclude_at_user_groups")!=t.value){TS.prefs.setPrefLocal("mentions_exclude_at_user_groups",t.value);TS.prefs.mentions_exclude_at_user_groups_changed_sig.dispatch()}break;case"no_invites_widget_in_sidebar":if(TS.prefs.getPref("no_invites_widget_in_sidebar")!=t.value){TS.prefs.setPrefLocal("no_invites_widget_in_sidebar",t.value);TS.prefs.no_invites_widget_in_sidebar_changed_sig.dispatch()}break;case"k_key_omnibox_auto_hide_count":if(TS.prefs.getPref("k_key_omnibox_auto_hide_count")!=t.value){TS.prefs.setPrefLocal("k_key_omnibox_auto_hide_count",t.value);TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.dispatch()}break;case"show_sidebar_quickswitcher_button":TS.prefs.getPref("show_sidebar_quickswitcher_button")!=t.value&&TS.prefs.setPrefLocal("show_sidebar_quickswitcher_button",t.value);break;case"preferred_skin_tone":if(TS.prefs.getPref("preferred_skin_tone")!=t.value){TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("preferred_skin_tone",t.value);TS.prefs.preferred_skin_tone_changed_sig.dispatch()}break;case"separate_private_channels":if(TS.prefs.getPref("separate_private_channels")!=t.value){TS.prefs.setPrefLocal("separate_private_channels",t.value);TS.prefs.separate_private_channels_changed_sig.dispatch()}break;case"separate_shared_channels":if(TS.prefs.getPref("separate_shared_channels")!=t.value){TS.prefs.setPrefLocal("separate_shared_channels",t.value);TS.prefs.separate_shared_channels_changed_sig.dispatch()}break;case"whats_new_read":if(TS.prefs.getPref("whats_new_read")!=t.value){TS.prefs.setPrefLocal("whats_new_read",t.value);TS.prefs.whats_new_read_changed_sig.dispatch()}break;case"tz":if(TS.prefs.getPref("tz")!=t.value){TS.prefs.setPrefLocal("tz",t.value);TS.prefs.tz_changed_sig.dispatch()}break;case"keyboard":if(TS.prefs.getPref("keyboard")!=t.value){TS.prefs.setPrefLocal("keyboard",t.value);TS.prefs.keyboard_changed_sig.dispatch()}break;case"msg_input_send_btn":if(TS.prefs.getPref("msg_input_send_btn")!=t.value){TS.prefs.setPrefLocal("msg_input_send_btn",t.value);TS.prefs.msg_input_send_btn_changed_sig.dispatch()}break;case"msg_input_send_btn_auto_set":if(TS.prefs.getPref("msg_input_send_btn_auto_set")!=t.value){TS.prefs.setPrefLocal("msg_input_send_btn_auto_set",t.value);TS.prefs.msg_input_send_btn_auto_set_changed_sig.dispatch()}break;case"frecency_jumper":if(TS.ui.frecency.isEnterprise())break;TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_TEAM_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),t.value);TS.prefs.mergeFrecencyJumper(t.value)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"frecency_ent_jumper":TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_ORG_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),t.value);TS.log(666,"Received a pref_change event for frecency_ent_jumper.");TS.prefs.mergeFrecencyJumper(t.value)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"jumbomoji":if(TS.prefs.getPref("jumbomoji")!=t.value){TS.prefs.setPrefLocal("jumbomoji",t.value);TS.prefs.jumbomoji_changed_sig.dispatch()}break;case"hide_hex_swatch":if(TS.prefs.getPref("hide_hex_swatch")!=t.value){TS.prefs.setPrefLocal("hide_hex_swatch",t.value);TS.prefs.hide_hex_swatch_changed_sig.dispatch()}break;case"a11y_animations":if(TS.prefs.getPref("a11y_animations")!==t.value){TS.prefs.setPrefLocal("a11y_animations",t.value);TS.prefs.a11y_animations_changed_sig.dispatch();TS.client&&TS.interop.clog.track("PREF_USER_CLIENT_UPDATE",{a11y_animations:TS.prefs.getPref("a11y_animations")})}break;case"show_memory_instrument":if(TS.prefs.getPref("show_memory_instrument")!==t.value){TS.prefs.setPrefLocal("show_memory_instrument",t.value);TS.prefs.show_memory_instrument_changed_sig.dispatch()}break;case"channel_sort":if(TS.prefs.getPref("channel_sort")!==t.value){TS.prefs.setPrefLocal("channel_sort",t.value);TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort"));TS.prefs.channel_sort_changed_sig.dispatch()}break;case"enable_unread_view":if(TS.prefs.getPref("enable_unread_view")!==t.value){TS.prefs.setPrefLocal("enable_unread_view",t.value);TS.prefs.enable_unread_view_changed_sig.dispatch()}break;case"enable_react_emoji_picker":if(TS.prefs.getPref("enable_react_emoji_picker")!==t.value){TS.prefs.setPrefLocal("enable_react_emoji_picker",t.value);TS.prefs.enable_react_emoji_picker_changed_sig.dispatch()}break;case"client_logs_pri":TS.prefs.setPrefLocal(t.name,t.value);TS.console.setAppropriatePri();break;case"email_alerts":TS.prefs.setPrefLocal(t.name,t.value);TS.prefs.email_alerts_changed_sig.dispatch();break;default:TS.prefs.setPrefLocal(t.name,t.value)}},hex_regex:new RegExp(/^#?([0-9a-f]{6})$/i),conditionallyClogFrecencyDueToSizeChange:function e(t,n,r){r.length/n.length<.1&&TS.interop.clog.track(t,{updated_user_client_prefs:{existing_frecency:n,new_frecency:r}})},setSidebarThemeCustomValues:function e(t){var r=false;t&&"object"===("undefined"===typeof t?"undefined":n(t))&&void 0===t.length&&_.forOwn(t,function(e,n){r=false;if(!e)return false;if(!e.substr)return false;t[n]=e.substr(0,7);if(!e.match(TS.prefs.hex_regex))return false;r=true});if(r)TS.prefs.setPrefLocal("sidebar_theme_custom_values",JSON.stringify(t));else{TS.prefs.setPrefLocal("sidebar_theme","default");TS.prefs.setPrefLocal("sidebar_theme_custom_values",JSON.stringify(TS.sidebar_themes.default_themes.default_theme))}},setMultiPrefsByAPI:function e(t,n){var r="";_.forOwn(t,function(e,t){r+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e)});if(!r){TS.error(" no prefs to set?");return}var i={prefs:r};return TS.prefs.setPrefByAPI(i,n)},setPrefByAPI:function e(t,n){return TS.api.callImmediately("users.prefs.set",t).then(function(e){var t=true;var r=e.data,i=e.args;if(n)return n(t,r,i)}).catch(function(e){var t=e.args;var n;t.hasOwnProperty("name")?n="pref name: "+t.name:t.prefs&&(n="(multiple prefs)");TS.logError(n,"TS.prefs.setPrefByAPI call got a not ok rsp","API response error");setTimeout(function(){t.prefs?TS.error("multi preferences setting failed."):TS.error('"'+t.name+'" preference setting failed.')},0)})},setTeamPrefByAPI:function e(t,n,r){return TS.api.callImmediately("team.prefs.set",{prefs:JSON.stringify(t)}).then(function(e){var n=e.data;if(TS.web){r=r||[];var i=Object.keys(t).concat(r);i.forEach(function(e){n.prefs.hasOwnProperty(e)&&(t.hasOwnProperty(e)||TS.prefs.getTeamPref(e)!==n.prefs[e])&&TS.prefs.onTeamPrefChanged({name:e,value:n.prefs[e]})})}return Promise.resolve(n.prefs)}).catch(function(e){var t=e.data;n&&n(t);return Promise.reject(t)})},saveHighlightWords:function e(n,r){var i=t(n);if(r||TS.notifs.getGlobalHighlightWords()!=i)return TS.notifs.setGlobalHighlightWords(i);return Promise.resolve()},getReadStateTrackingPref:function e(){var t="default";TS.prefs.getPref("mark_msgs_read_immediately")&&TS.prefs.getPref("start_scroll_at_oldest")?t="immediate_scroll":TS.prefs.getPref("mark_msgs_read_immediately")&&(t="immediate");return t},setReadStateTrackingPref:function e(t,n){var r={};if("immediate_scroll"===t||"immediate"===t){r.mark_msgs_read_immediately=true;TS.prefs.setPrefLocal("mark_msgs_read_immediately",true);if("immediate_scroll"===t){r.start_scroll_at_oldest=true;TS.prefs.setPrefLocal("start_scroll_at_oldest",true)}else{r.start_scroll_at_oldest=false;TS.prefs.setPrefLocal("start_scroll_at_oldest",false)}}else{r.mark_msgs_read_immediately=false;TS.prefs.setPrefLocal("mark_msgs_read_immediately",false);r.start_scroll_at_oldest=false;TS.prefs.setPrefLocal("start_scroll_at_oldest",false)}TS.prefs.setMultiPrefsByAPI(r,n)},removeTeamFromEnterpriseExcluedTeamPref:function e(t){if(!TS.boot_data.page_needs_enterprise)return;var n=TS.prefs.getPref("enterprise_excluded_app_teams");if(!n)return;var r=n?n.split(","):[];_.pull(r,t);TS.prefs.setPrefByAPI({name:"enterprise_excluded_app_teams",value:r.join(",")})},test:function e(){return{_cleanHighlightWords:t}}});var e=false;var t=function e(t){if(!_.isString(t))return"";t=TS.format.replaceUnicodeDoppelgangers(t);var n=TS.boot_data.feature_cjk_highlight_words?/[,\uff0c\u3001]/:/,/;return _(t).split(n).map(_.trim).compact().join(",")}})()},11233:function(e,t){(function(){TS.registerModule("search",{search_dispatched_sig:new signals.Signal,quick_search_results_fetched_sig:new signals.Signal,all_search_results_fetched_sig:new signals.Signal,message_search_results_fetched_sig:new signals.Signal,file_search_results_fetched_sig:new signals.Signal,autosuggest_search_results_fetched_sig:new signals.Signal,search_filter_set_sig:new signals.Signal,search_filetype_filter_set_sig:new signals.Signal,search_sort_set_sig:new signals.Signal,search_channel_set_sig:new signals.Signal,search_group_set_sig:new signals.Signal,search_member_set_sig:new signals.Signal,message_search_more_results_fetched_sig:new signals.Signal,query:"",query_string:"",query_string_for_display:"",last_search_query:"",previous_query:"",sort:"timestamp",filter:"all",filetype:"all",results:{},submit_tim:0,delay:500,suggestions:[],input:"",from_regex:/from:[@*\-.\w]+/gi,member:null,from:null,in_regex:/in:[#*\-.\w]+/gi,channel:null,group:null,im:null,per_page:-1,keyword_modifiers:["after","before","bot","during","from","to","has","in","on"],keyword_modifier_pair_regex:null,keyword_modifier_extract_regex:null,search_query_max_length:250,skip_next_search:false,refinement_version:1,onStart:function e(){TS.search.keyword_modifier_pair_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\S+$");TS.search.keyword_modifier_extract_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\w*");TS.search.per_page=parseInt(TS.qs_args.search_count,10)||20;TS.client&&(TS.search.delay=10);TS.client?TS.client.login_sig.add(TS.search.loggedIn,TS.search):TS.web&&TS.web.login_sig.add(TS.search.loggedIn,TS.search);TS.search.search_channel_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_group_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_member_set_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_only_my_channels_changed_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_only_current_team_changed_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_exclude_bots_changed_sig.add(TS.search.searchAll,TS.search);TS.files.team_file_changed_sig.add(f);TS.qs_args.delay&&(TS.search.delay=TS.qs_args.delay);"treatment"==TS.experiment.getGroup("sli_all_tab")&&(TS.search.filter="messages");TS.search.input=$("#search_terms");var t=[];TS.search.autocomplete||(t=["members"]);TS.utility.contenteditable.create(TS.search.input,{modules:{slacksearch:true,tabcomplete:{completers:t,isSearchInput:true,matchOptions:{allowed_preceding_symbols:[":"]},searchOptions:{include_deleted:true},onEnter:function e(){TS.search.submitSearch();TS.search.autocomplete.triggerInputEvent("on-enter")},positionMenu:function e(t){var n=$(TS.search.input);var r=n.offset();var i=355;var a=31;var s=i-n.outerWidth();var o=r.left-s+a;var l=12;var u=r.top+n.height()+l;t.style.width=i+"px";t.style.top=u+"px";t.style.left=o+"px"},render:function e(t,n,r){var i=_.filter(r,function(e){if(e.is_usergroup)return false;return true});var a=_.remove(i,function(e){return e.deleted});var s={menu_type:"user",noResults:!i&&!a,users:i,users_deleted:a,show_ja_modifier_subtitle:"ja-JP"==TS.interop.i18n.locale};return TS.templates.search_menu(s)},onRender:function e(){TS.tips.texty.hide();TS.utility.rAF(function(){$("#chat_input_tab_ui").addClass("search_menu");p()})}},keyboard:{useFormattingCommands:false}},singleLineInput:true,placeholder:TS.interop.i18n.t("Search","page_client")(),ariaLabel:TS.interop.i18n.t("Search","page_client")(),onFocus:function e(){$("#client-ui").addClass("search_focused");TS.utility.contenteditable.setCursorAtEnd(TS.search.input);if(TS.client.ui.search_in_react.isEnabled()&&TS.client.ui.search_in_react.isOpen())return;TS.search.autocomplete.setUpMenu();TS.search.autocomplete.onInputFocus();TS.search.autocomplete.triggerInputEvent("focus")},onBlur:function e(){$("#client-ui").removeClass("search_focused");TS.search.autocomplete.maybeLogSearchInputBlur();TS.search.autocomplete.triggerInputEvent("blur")},onEnter:function e(){TS.search.autocomplete.triggerInputEvent("on-enter");TS.search.skip_next_search||TS.search.submitSearch();TS.search.skip_next_search=false;return true},onTextChange:function e(){var t=TS.utility.contenteditable.isEmpty(TS.search.input);$("#header_search_form").toggleClass("active",!t);if(TS.client.ui.search_in_react.isEnabled())return;TS.search.autocomplete.triggerInputEvent("input")},onEscape:function e(){$(".search_menu").is(":visible")||TS.utility.contenteditable.blur(TS.search.input);TS.search.autocomplete.triggerInputEvent("on-escape")},onTab:function e(){TS.search.autocomplete.triggerInputEvent("on-tab");return true}})},loggedIn:function e(){"recency"===TS.experiment.getGroup("sli_default_sorting")?TS.search.sort="timestamp":"relevance"===TS.experiment.getGroup("sli_default_sorting")?TS.search.sort="score":TS.search.sort="timestamp"},startSearchTimer:function e(t,n,r,i,a){clearTimeout(TS.search.submit_tim);TS.search.submit_tim=setTimeout(TS.search.dispatchSearch,TS.search.delay,t,n,r,i,null,a);TS.search.search_dispatched_sig.dispatch()},getNextPageOfSearchResults:function e(t,n,r){TS.search.dispatchSearch(t,n,TS.search.per_page,TS.search.onSearchAll,r,null)},getNextPageOfMessageResults:function e(t,n,r){u("search.messages",t,n,TS.search.per_page,r,d,null)},getNextPageOfFileResults:function e(t,n,r){u("search.files",t,n,TS.search.per_page,r,c,null)},extractNonModifierSearchTxt:function e(t){var n="";var r=t.split(" ");r.forEach(function(e){if(e.match(TS.search.keyword_modifier_extract_regex))return;n+=" "+e});n=$.trim(n);return n},dispatchSearch:function e(t,n,r,i,a,s){if(TS.isPartiallyBooted()){if(!l){var o=this;var d=function e(){TS.search.dispatchSearch.apply(o,l);l=void 0};TS.redux.socket.connectedSig.addOnce(d)}l=arguments;return}if(!a||1===a){var c=TS.search.extractNonModifierSearchTxt(t);c&&TSSSB.call("writeFindString",c)}TS.search.updateSessionsUponSearch();if(TS.search.separateMessagesAndFiles()){a&&1!==a||(TS.search.results[t]=null);var _=m();u("search.messages",t,n,r,a,_.msgs,s);u("search.files",t,n,r,a,_.files,s)}else u("search.all",t,n,r,a,i,s)},setFilter:function e(t){TS.search.filter=t;TS.search.search_filter_set_sig.dispatch()},setFiletypeFilter:function e(t){TS.search.filetype=t;TS.search.search_filetype_filter_set_sig.dispatch()},getModuleSort:function e(){if("files"==TS.search.filter)return"auto";if("messages"==TS.search.filter)return TS.search.sort;return null},getLastRequestId:function e(){if("files"==TS.search.filter)return TS.search.last_files_request_id;if("messages"==TS.search.filter||"all"==TS.search.filter)return TS.search.last_request_id;return null},hasCachedRelevantResults:function e(){return("messages"===TS.search.filter||"all"===TS.search.filter)&&_.has(TS.search.results[TS.search.query].messages,"modules.score")},hasCachedRecentResults:function e(){return("messages"===TS.search.filter||"all"===TS.search.filter)&&_.has(TS.search.results[TS.search.query].messages,"timestamp_messages")},switchToRelevant:function e(t){var n=TS.search.results[TS.search.query].messages;TS.search.results[TS.search.query].messages=n.modules.score;TS.search.results[TS.search.query].messages.timestamp_messages=n;TS.search.results[TS.search.query].messages.order=0;TS.search.search_sort_set_sig.dispatch(t);TS.search.view.renderResults(true)},switchToRecent:function e(){TS.search.results[TS.search.query].messages=TS.search.results[TS.search.query].messages.timestamp_messages;TS.search.view.renderResults(true)},topResultsFeedback:function e(t,n){var r=[":bow:"];if("top_results_useful"===n){var i=Math.floor(5*Math.random())+2;r=[":tada:",":raised_hands::skin-tone-"+i+":"]}var a=r[Math.floor(Math.random()*r.length)];$(t).closest(".top_results_feedback").html("Thanks for your feedback! "+TS.emoji.graphicReplace(a));TS.interop.clog.track("SEARCH_FEEDBACK",{search_feedback_value:n,request_id:TS.search.last_request_id,search_session_id:TS.search.getSearchSessionId()})},setSort:function e(t,n){if(TS.search.sort===t)return;$(".search_toggle").toggleClass("active");TS.search.sort=t;TS.search.search_sort_set_sig.dispatch();"score"!==t&&"model"!==t&&(t="timestamp");TS.prefs.setPrefByAPI({name:"search_sort",value:t});"timestamp"===t&&TS.search.hasCachedRecentResults()?TS.search.switchToRecent():"score"===t&&TS.search.hasCachedRelevantResults()?TS.search.switchToRelevant():n||TS.search.searchAll()},setChannel:function e(t){var n=TS.interop.channels.getChannelById(t);if(n){TS.search.channel=n;TS.search.group=null;TS.search.im=null}else TS.search.channel=null;TS.search.search_channel_set_sig.dispatch()},setGroup:function e(t){var n=TS.interop.channels.getGroupById(t);if(n){TS.search.group=n;TS.search.channel=null;TS.search.im=null}else TS.search.group=null;TS.search.search_group_set_sig.dispatch()},setMember:function e(t){var n=TS.interop.members.getMemberById(t);if(n)TS.search.member=n;else{TS.search.member=null;TS.search.from=null;var r=TS.utility.contenteditable.value(TS.search.input).trim();var i=r.match(TS.search.from_regex);if(i){$.each(i,function(e,t){r=$.trim(r.replace(t,""))});TS.utility.contenteditable.value(TS.search.input,r)}}TS.search.search_member_set_sig.dispatch()},searchAll:function e(t,n){if(window.desktop&&desktop.teams&&desktop.teams.getCurrentTeam&&desktop.teams.getCurrentTeam().team_id&&desktop.teams.getCurrentTeam().team_id!=TS.model.team.id)return;TS.client||clearTimeout(TS.search.widget.key_tim);TS.search.previous_query=TS.search.query;TS.search.query_string=t?_.trim(t):_.trim(TS.utility.contenteditable.value(TS.search.input));TS.search.query=TS.interop.texty.convertContentsStringForEncodedMembers(TS.search.query_string,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());TS.search.query=TS.interop.search_conversions.convertContentsStringForEncodedChannels(TS.redux.getState(),TS.search.query);TS.search.query_string_for_display=TS.interop.texty.convertContentsStringToDisplayString(TS.search.query_string,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());if(TS.search.query_string){TS.search.view.searchIsVisible()||TS.search.view.renderResults();TS.search.startSearchTimer(TS.search.query,TS.search.query_string,TS.search.per_page,TS.search.onSearchAll,n)}else{TS.search.view.updateOptions();TS.client?TS.search.autocomplete.stopSpinner():TS.search.widget.stopSpinner()}},onSearchAll:function e(t,n,r){if("1"===TS.qs_args.force_search_fail){window.failed_once=true;t=false;n={ok:false,error:"solr_failed"}}if(!t){var i=n&&n.error?n.error:"unknown_error";n||(n={ok:false,error:i});n.query=n.query||r.query;n.messages=n.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]};n.files=n.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(r.query!==TS.search.query&&(!TS.search.results[r.query]||!TS.search.results[r.query].error))return;TS.search.last_search_query=r.query;TS.client&&TS.search.upsertFiles(n);TS.search.expandChannelsAndCheckForMsgsInModel(n);if(1===r.page){TS.search.results[r.query]=n;TS.search.results[r.query]._time_of_search=Date.now();TS.search.all_search_results_fetched_sig.dispatch(n,r);TS.search.getNextPageOfSearchResults(r.query,r.query_string,2)}else{var a=TS.search.results[r.query];a.messages.matches&&(n.messages.matches=a.messages.matches.concat(n.messages.matches));a.files.matches&&(n.files.matches=a.files.matches.concat(n.files.matches));TS.search.results[r.query]=n;TS.search.all_search_results_fetched_sig.dispatch(n,r)}},searchSuggest:function e(t){var n=TS.search.getQuerySessionId();var r=(new Date).getTime();TS.api.call("search.autocomplete",{query:t,client_request_id:n,search_session_id:TS.search.getSearchSessionId()}).then(function(e){var t=e.data,i=e.args,a=e.request_id;var s=true;TS.search.onSearchSuggest&&TS.search.onSearchSuggest(s,t,i,a);TS.interop.clog.track("SEARCH_AUTOCOMPLETE",{client_request_id:n,search_session_id:TS.search.getSearchSessionId(),request_duration_ms:(new Date).getTime()-r});return{data:t,args:i,request_id:a}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.search.onSearchSuggest&&TS.search.onSearchSuggest(i,t,n,r);return{data:t,args:n,request_id:r}})},onSearchSuggest:function e(t,n,r,i){if(!TS.client&&TS.search.widget.suppress_suggestions){TS.search.widget.suppress_suggestions=false;return}if(!t)return;TS.search.suggestions=[];if(n.suggestions[0]===TS.search.query&&1===n.suggestions.length)TS.search.suggestions=[];else{var a=/<@([^>]+)>/gi;var s=[];n.suggestions.forEach(function(e){e.replace(a,function(e,t){s.push(t)})});s=_.uniq(s);TS.interop.members.ensureMembersArePresent(s).then(function(){for(var e=0;e<n.suggestions.length;e+=1){var t=n.suggestions[e];t=t.replace(a,function(e,t){var n=TS.interop.members.getMemberById(t);if(n)return TS.interop.texty.getMemberAsContentsString(n);return e});TS.search.suggestions[e]={value:t,highlighted:TS.search.highlightSuggestion(_.escape(t))};n.suggestions[e]=t}TS.search.autosuggest_search_results_fetched_sig.dispatch(n,r,i)})}},highlightSuggestion:function e(t){var n=TS.utility.contenteditable.value(TS.search.input);var r=new RegExp("("+TS.utility.preg_quote(n)+")","gi");var i=t.replace(r,"<b>$1</b>");return i},expandChannelsAndCheckForMsgsInMatch:function e(t){var n;var r=t.channel.id;var i;o(t,r);s.forEach(function(e){if(!t[e])return;o(t[e],r)});i=TS.rxns.getExistingRxnsByKey(t._rxn_key);i&&!t.reactions?TS.warn("msg:"+t.ts+" has reactions in local model, but we got an object in search results that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);n=TS.redux.channels.getEntityById(r);if(n){"im"!==t.type||TS.interop.channels.isImWithDeletedMember(n.id)||(t.im_exists=true);n.msgs?t.is_loaded=!!TS.utility.msgs.getMsg(t.ts,n.msgs):TS.client&&TS.warn(n.id+" has no msgs");t.channel=n;t.permalink||(t.permalink=TS.utility.msgs.constructMsgPermalink(n,t.ts))}},expandChannelsAndCheckForMsgsInModel:function e(t){var n;var r;if(!t.messages||!t.messages.matches)return;for(r=0;r<t.messages.matches.length;r+=1){n=t.messages.matches[r];if(!n)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(n)}if(t.messages.modules&&t.messages.modules.score){for(r=0;r<t.messages.modules.score.matches.length;r+=1){n=t.messages.modules.score.matches[r];if(!n)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(n)}if(t.messages.modules.score.top_results)for(r=0;r<t.messages.modules.score.top_results.length;r+=1){n=t.messages.modules.score.top_results[r];if(!n)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(n)}}},upsertFiles:function e(t){if(!t.files||!t.files.matches)return;for(var n=0;n<t.files.matches.length;n+=1){if(t.files.matches[n].preview){t.files.matches[n].preview_search=t.files.matches[n].preview;delete t.files.matches[n].preview}var r=null;if(t.files.matches[n].title){r=t.files.matches[n].title;t.files.matches[n].title=t.files.matches[n].title.replace(/[\ue000\ue001]/g,"")}var i=null;if(t.files.matches[n].name){i=t.files.matches[n].name;t.files.matches[n].name=t.files.matches[n].name.replace(/[\ue000\ue001]/g,"")}t.files.matches[n]=$.extend({},TS.files.upsertFile(t.files.matches[n]).file,{title:r||t.files.matches[n].title,name:i||t.files.matches[n].name})}},getResultsByQuery:function e(t){return TS.search.results[t]},getMatchByQueryAndTs:function e(t,n){return TS.search.getMatchByQueryByThings(t,n)},getMatchByQueryAndChannelAndTs:function e(t,n,r){return TS.search.getMatchByQueryByThings(t,r,n)},getMatchByQueryAndChannelAndTsAndModule:function e(t,n,r,i,a){var s=TS.search.getResultsByQuery(n);if(!s){TS.error("WTF no results?");return null}if(!s.messages.modules){TS.error("WTF no results.messages.modules?");return null}s.messages.modules[a]||TS.error("WTF no results.messages.modules."+a+"?");var o;for(var l=0;l<s.messages.modules[a].top_results.length;l+=1){o=s.messages.modules[a].top_results[l];if(!o){TS.error("WTF no match?");continue}if((!r||o.channel.id===r)&&o.ts===i){if(t)return{match:o,index:l};return o}}return null},getMatchByQueryByThings:function e(t,n,r){var i=TS.search.getResultsByQuery(t);if(!i){TS.error("WTF no results?");return null}return TS.search.getMatchFromResultsByThings(true,i,n,r)},getMatchFromResultsByThings:function e(t,n,r,i){if(!n){TS.error("WTF no results?");return null}if(!n.messages){TS.error("WTF no results.messages?");return null}if(!n.messages.matches){TS.error("WTF no results.messages.matches?");return null}var a;for(var s=0;s<n.messages.matches.length;s+=1){a=n.messages.matches[s];if(!a){TS.error("WTF no match?");continue}if((!i||a.channel.id===i)&&a.ts===r){if(t)return{match:a,index:s};return a}}return null},truncateQuery:function e(t){if(t.length>TS.search.search_query_max_length)return t.substring(0,TS.search.search_query_max_length);return t},resetSearchOptions:function e(){TS.search.channel=null;TS.search.group=null;TS.search.im=null;TS.search.member=null;TS.search.from=null;TS.search.searchAll()},saveSearch:function e(t,n){if(!t.terms)return;t.terms=$.trim(t.terms);if(TS.search.keyword_modifier_pair_regex.test(t.terms))return;TS.api.call("search.save",t).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n&&n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n&&n(a,t,r,i);return{data:t,args:r,request_id:i}})},separateMessagesAndFiles:function e(){return!!TS.client},setInputVal:function e(t){TS.client.ui.search_in_react.isEnabled()&&TS.redux.dispatch(TS.interop.searchUi.setSearchInputBoxQueryString(t));TS.utility.contenteditable.value(TS.search.input,t);TS.client.ui.search_in_react.isEnabled()||TS.utility.contenteditable.focus(TS.search.input)},submitSearch:function e(){TS.search.input.closest("form").trigger("submit")},searchSessionExpired:function n(){var r=e;e=new Date;return!r||Date.now()-r>t},querySessionExpired:function e(){return TS.search.searchSessionExpired()},getSearchSessionId:function e(){(null==n||TS.search.searchSessionExpired())&&(n=TS.utility.uuidv4());return n},maybeSetQuerySessionId:function e(){if(null==i||TS.search.querySessionExpired()){i=TS.utility.uuidv4();TS.interop.clog.track("SEARCH_QUERY_SESSION",{request_id:TS.search.last_request_id,search_session_id:TS.search.getSearchSessionId(),client_request_id:i})}},getQuerySessionId:function e(){TS.search.maybeSetQuerySessionId();return i},getSearchSessionIdForResults:function t(){TS.search.getSearchSessionId()==r&&(e=new Date);return r},getQuerySessionIdForResults:function e(){return a},querySessionEnd:function e(){i=null},searchSessionEnd:function e(){n=null;TS.search.querySessionEnd()},updateSessionsUponSearch:function e(){a=TS.search.getQuerySessionId();r=TS.search.getSearchSessionId();TS.search.querySessionEnd()},debugQuery:function e(t,n){var r="/mc/search_eval_query.php?team_id="+t+"&user_id="+n+"&query="+encodeURIComponent(TS.search.query);window.open(r)},debugFileQuery:function e(t,n){var r="/mc/search_eval_file_query.php?team_id="+t+"&user_id="+n+"&active_cid="+TS.model.active_cid+"&query="+encodeURIComponent(TS.search.query);window.open(r)},getSort:function e(t){return"search.files"===t?"auto":TS.search.sort},shouldGetTopResults:function e(t){if("recency"===TS.experiment.getGroup("sli_default_sorting"))return false;if("relevance"===TS.experiment.getGroup("sli_default_sorting"))return false;return 1==t?1:0}});var e;var t=3e5;var n=null;var r=null;var i=null;var a=null;var s=["next","next_2","previous","previous_2"];var o=function e(t,n){t._rxn_key=TS.rxns.getRxnKey("message",t.ts,n);TS.utility.msgs.processAttachments(t.attachments);t.extracts&&t.extracts.length&&t.extracts.forEach(function(e){e._rxn_key=t._rxn_key})};var l;var u=function e(t,n,r,i,a,s,o){var l=t.replace(".","_");var u="start_dispatch_"+l;TS.metrics.mark(u);var d=a||1;var c={query:TS.emoji.maybeGetCanonicalEmojiString(n),query_string:r,highlight:true,count:i,types:[TS.search.filetype],sort:TS.search.getSort(t),page:d,extracts:1,extra_message_data:1,max_extract_len:150,highlight_attachments:1,active_cid:TS.model.active_cid,top_results:TS.search.shouldGetTopResults(d),experts:1==d?1:0,locale:TS.interop.i18n.isPseudoLocale?"pseudo":TS.interop.i18n.locale,search_tab_open:"search"==TS.model.ui.active_tab_id,search_tab_filter:TS.search.filter,search_tab_sort:TS.search.getModuleSort(TS.search.filter),client_req_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults(),no_user_profile:true};"search.all"===t&&(c.no_posts=1);"search.files"!==t&&(c.more_matches=true);if("search.messages"===t){TS.boot_data.feature_search_query_refinements&&(c.refinement_version=TS.search.refinement_version);if(o){o.refinement_client_request_id&&(c.refinement_client_request_id=o.refinement_client_request_id);o.refinement_iid&&(c.refinement_iid=o.refinement_iid);o.refinement_session_id&&(c.refinement_session_id=o.refinement_session_id);o.refinement_request_id&&(c.refinement_request_id=o.refinement_request_id);o.suppress_refinements&&(c.suppress_refinements=1)}}if(TS.boot_data.page_needs_enterprise&&TS.boot_data.enterprise_api_token){c.enterprise_token=TS.boot_data.enterprise_api_token;"search.messages"===t&&(c.team=TS.model.team.id)}TS.boot_data.feature_search_skip_context&&(c.skip_context=1);TS.api.call(t,c).then(function(e){var t=e.data,n=e.args,r=e.request_id;TS.metrics.measure(l+"_response",u);var i=true;s&&s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s&&s(i,t,n,r);return{data:t,args:n,request_id:r}})};var d=function e(t,n,r,i){if(!t||!n.messages){var a=n&&n.error?n.error:"unknown_error";n||(n={ok:false,error:a});n.query=n.query||r.query;n.messages=n.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(r.query!==TS.search.query&&(!TS.search.results[r.query]||!TS.search.results[r.query].error))return;TS.search.last_search_query!==r.query&&delete TS.search.results[TS.search.last_search_query];TS.search.last_search_query=r.query;TS.search.last_request_id=i;TS.search.expandChannelsAndCheckForMsgsInModel(n);var s=TS.search.results[r.query];if(1==r.page){if(s)$.extend(s,n);else{TS.search.results[r.query]=n;s=n}s.initial_messages_total=n.messages.total;s.messages.pages=[{start:0,count:_.get(n.messages,"matches.length",0)}];_.has(s,"messages.modules.score.matches")&&(s.messages.modules.score.pages=[{start:0,count:_.get(s.messages.modules.score,"matches.length",0)}]);s._time_of_search=Date.now();TS.search.message_search_results_fetched_sig.dispatch(s,r)}else{if(s.messages&&s.messages.matches){n.messages.matches=s.messages.matches.concat(n.messages.matches);n.messages.pages=s.messages.pages.concat([{start:s.messages.matches.length,count:_.get(n.messages,"matches.length",0)}])}$.extend(s,n);TS.search.message_search_results_fetched_sig.dispatch(s,r)}};var c=function e(t,n,r,i){if(!t||!n.files){var a=n&&n.error?n.error:"unknown_error";n||(n={ok:false,error:a});n.query=n.query||r.query;n.files=n.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}n.query=TS.emoji.maybeGetLocalizedEmojiString(n.query);r.query=TS.emoji.maybeGetLocalizedEmojiString(r.query);if(r.query!==TS.search.query&&(!TS.search.results[r.query]||!TS.search.results[r.query].error))return;TS.search.last_search_query!==r.query&&delete TS.search.results[TS.search.last_search_query];TS.search.last_search_query=r.query;TS.search.last_files_request_id=i;TS.client&&TS.search.upsertFiles(n);var s=TS.search.results[r.query];if(1===r.page){if(s)$.extend(s,n);else{TS.search.results[r.query]=n;s=n}s.initial_files_total=n.files.total;s._time_of_search=Date.now();TS.search.file_search_results_fetched_sig.dispatch(s,r)}else{s.files&&s.files.matches&&(n.files.matches=s.files.matches.concat(n.files.matches));$.extend(s,n);TS.search.file_search_results_fetched_sig.dispatch(s,r)}};var m=function e(){var t=false;var n=false;var r=function e(){t&&n&&TS.search.all_search_results_fetched_sig.dispatch()};return{msgs:function e(){t=true;d.apply(this,arguments);r()},files:function e(){n=true;c.apply(this,arguments);r()}}};var f=function e(t){var n=$("#search_results_items");var r=TS.files.containerHasFileListItem(t,n);var i=TS.interop.files.fileNeedsUpdate(t.id);if(i&&r){TS.interop.files.fileIsUpdating(t.id)||TS.files.fetchFileInfo(t.id,null,"TS.search._teamFileChanged needs updated files.info");return}r&&TS.files.updateFileListItem(t,n)};var p=function e(){var t=$(".reveal_hidden_items");t.one("click enter",function(e){var n=$(".results .deleted");if(n){e.stopPropagation();n.removeClass("deleted");t.remove()}})}})()},11234:function(e,t){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};(function(){TS.registerModule("ms.msg_handlers",{getMsgHandlers:function e(){return TS.ms.msg_handlers},onStart:function e(){a=window.performance&&TS.boot_data&&TS.boot_data.feature_ms_msg_handlers_profiling;if(TS.client&&TS.client.stats){TS.client.stats.start_collecting_sig.add(function(){p.enableStatsCollecting()});TS.client.stats.stop_collecting_sig.add(function(){p.disableStatsCollecting()})}if(TS.web&&!TS.web.space)return;b()&&TS.shouldLog(2017)&&setInterval(function(){TS.log(2017,"**Periodic** getIdletimeInMs reads: "+window.desktop.app.getIdleTimeInMs())},15e3)},message:function e(t){if(!TS.client)return;TS.has_pri[h]&&TS.log(h,"recved message type "+t.type);t.is_ephemeral&&!t.ts&&(t.ts=TS.interop.datetime.makeTsStamp());var n;var r="subtype__"+t.subtype;if(r in TS.ms.msg_handlers){if(TS.boot_data.feature_channel_eventlog_client){if("message_changed"===t.subtype||"message_deleted"===t.subtype||"channel_history_changed"===t.subtype||"group_history_changed"===t.subtype||"im_history_changed"===t.subtype||"mpim_history_changed"===t.subtype||"message_replied"===t.subtype){t.type=t.subtype;delete t.subtype;a&&(n=p.start(t.type));TS.ms.msg_handlers[t.type](t);n&&n();return}if(t.hidden){TS.error(2,"WE SHOULD NOT BE GETTING ANY HIDDEN MESSAGES ANYMORE");TS.console.dir(2,0,t)}}a&&(n=p.start(r));TS.ms.msg_handlers[r](t);n&&n()}a&&(n=p.start(t.type));var i=TS.utility.msgs.processImsg(t,t.channel);if(TS.interop.channels.getImById(t.channel)){if("start_profile_AAAAAA"===t.text)TS.model.profiling_keys=true;else if("end_profile_AAAAAA"===t.text){TS.model.profiling_keys=false;if(TS.model.profiling_key_times){TS.files.upload({text:JSON.stringify(TS.model.profiling_key_times,null,"\t"),title:"auto profile",filetype:"javascript",channels:[t.channel],initial_comment:""});delete TS.model.profiling_key_times}}TS.ims.legacyAddMsg(t.channel,i)}else TS.interop.channels.getMpimById(t.channel)?TS.mpims.legacyAddMsg(t.channel,i):TS.interop.channels.getGroupById(t.channel)?TS.groups.legacyAddMsg(t.channel,i):TS.channels.legacyAddMsg(t.channel,i);TS.boot_data.feature_http_sendmsg&&TS.interop.sendMessage.resolveMessage(TS.redux.getState,TS.redux.dispatch,i,t);var s=TS.redux.channels.getEntityById(t.channel);var o=TS.interop.members.getMemberById(i.user);o&&s&&TS.redux.dispatch(TS.interop.typing.memberEndedTyping({channelId:s.id,memberId:o.id}));n&&n()},subtype__file_share:function e(t){if(!t.file)return;t.file.id==TS.files.polling_file_id&&TS.files.uploadProcessingOver(true,t.file.id)},message_changed:function e(t){TS.has_pri[h]&&TS.log(h,"recved message type "+t.type);TS.boot_data.feature_modern_message_changed&&TS.boot_data.feature_modern_process_imsg||C(t)},subtype__message_changed:function e(t){TS.has_pri[h]&&TS.log(h,"recved subtype "+t.subtype);TS.boot_data.feature_channel_eventlog_client&&TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.boot_data.feature_modern_message_changed&&TS.boot_data.feature_modern_process_imsg||C(t)},message_deleted:function e(t){TS.has_pri[h]&&TS.log(h,"recved message type "+t.type);M(t)},subtype__message_deleted:function e(t){TS.has_pri[h]&&TS.log(h,"recved subtype "+t.subtype);TS.boot_data.feature_channel_eventlog_client&&TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);M(t)},subtype__sh_room_created:function e(t){if(!t.room)return;TS.dir(441,t)},subtype__sh_room_shared:function e(t){if(!t.room)return;TS.dir(441,t)},channel_changed:function e(t){if(!t.channel)return;TS.channels.backfills.updateBackfillingList(t.channel)},channel_updated:function e(t){if(!t.channel){TS.error("No channel id sent");return}var n=TS.interop.channels.getChannelById(t.channel);if(!n){TS.error('unknown channel: "'+t.channel);return}if(!t.updates){TS.error('nothing changed in channel: "'+t.channel);return}var r=t.updates;r.id=t.channel;n=TS.interop.channels.upsertChannel(r);if(TS.interop.rules.channels.isExternallySharedChannel(n)&&!TS.interop.rules.channels.isPendingExternallySharedChannel(n)){TS.channels.shared_invite_accepted_sig.dispatch(n);var i=TS.shared.legacyGetActiveModelOb();i.id===n.id&&TS.channels.converted_to_shared_sig.dispatch(n)}else TS.interop.rules.channels.isPendingExternallySharedChannel(n)&&r.pending_shared.length?TS.channels.shared_invite_pending_sig.dispatch(n):TS.interop.rules.channels.isExternallySharedChannel(n)||TS.interop.rules.channels.isPendingExternallySharedChannel(n)||TS.channels.unshared_sig.dispatch(n)},channel_converted_to_shared:function e(t){if(!TS.boot_data.page_needs_enterprise)return;if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}var n=TS.interop.channels.getChannelById(t.channel.id);if(!n){TS.error('unknown channel: "'+t.channel.id);return}delete t.channel.is_member;TS.interop.channels.upsertChannel(t.channel);n._name_lc!==_.toLower(t.channel.name)&&TS.channels.channelRenamed(t.channel);var r=TS.shared.legacyGetActiveModelOb();r.id===n.id&&TS.channels.converted_to_shared_sig.dispatch(n)},channel_unshared:function e(t){if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}delete t.channel.is_member;var n=TS.interop.channels.upsertChannel(t.channel);TS.channels.unshared_sig.dispatch(n)},channel_shared_invite_pending:function e(t){if(!TS.boot_data.page_needs_enterprise)return;if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}delete t.channel.is_member;var n=TS.interop.channels.upsertChannel(t.channel);TS.channels.shared_invite_pending_sig.dispatch(n)},channel_shared_invite_revoked:function e(t){if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}delete t.channel.is_member;var n=TS.interop.channels.upsertChannel(t.channel);TS.channels.shared_invite_revoked_sig.dispatch(n)},channel_shared_invite_accepted:function e(t){if(!TS.boot_data.page_needs_enterprise)return;if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}delete t.channel.is_member;var n=TS.interop.channels.upsertChannel(t.channel);TS.channels.shared_invite_accepted_sig.dispatch(n)},group_converted_to_shared:function e(t){if(!t.group||!t.group.id){TS.error("No group info sent");return}var n=TS.interop.channels.getGroupById(t.group.id);if(!n){TS.error('unknown group: "'+t.group.id);return}n.is_member&&(t.group.is_member=true);TS.interop.channels.upsertGroup(t.group);var r=TS.shared.legacyGetActiveModelOb();r.id===n.id&&TS.groups.converted_to_shared_sig.dispatch(n)},teams_joined_shared_channel:function e(t){if(!TS.boot_data.page_needs_enterprise){TS.error("org-shared channel event sent to non-enterprise team:"+t.channel);return}var n=TS.interop.channels.getChannelById(t.channel);n||(n=TS.interop.channels.getGroupById(t.channel));if(!n){TS.error('unknown channel or group: "'+t.channel);return}if(!TS.interop.rules.channels.isOrgShared(n)){TS.error("org-shared channel event sent for non-org-shared channel:"+t.channel);return}TS.channels.temp_list_of_removed_channels[n.id]&&delete TS.channels.temp_list_of_removed_channels[n.id];if(t.is_global_shared)n.is_global_shared=t.is_global_shared;else{var r=_(n.shared_team_ids).concat(t.teams).uniq().value();TS.redux.dispatch(TS.interop.channels.upsertChannelSharesLocally({channelId:n.id,teamsIds:r,orgWide:t.is_global_shareds}))}var i=TS.shared.legacyGetActiveModelOb();if(!i.id===n.id)return;n.is_group?TS.groups.shared_teams_updated_sig.dispatch(n):TS.channels.shared_teams_updated_sig.dispatch(n)},teams_left_shared_channel:function e(t){if(!TS.boot_data.page_needs_enterprise){TS.error("org-shared channel event sent to non-enterprise team:"+t.channel);return}var n=TS.interop.channels.getChannelById(t.channel);n||(n=TS.interop.channels.getGroupById(t.channel));if(!n){TS.error('unknown channel or group: "'+t.channel);return}if(!TS.interop.rules.channels.isOrgShared(n)){TS.error("org-shared channel event sent for non-org-shared channel:"+t.channel);return}if(t.teams.indexOf(TS.model.team.id)<0){TS.redux.dispatch(TS.interop.redux.models.channels.removeChannels({ids:[n.id]}));return}TS.redux.dispatch(TS.interop.channels.upsertChannelSharesLocally({channelId:n.id,teamsIds:t.teams,orgWide:t.is_global_shareds}));var r=TS.shared.legacyGetActiveModelOb();if(!r.id===n.id)return;n.is_group?TS.groups.shared_teams_updated_sig.dispatch(n):TS.channels.shared_teams_updated_sig.dispatch(n)},enterprise_rename:function e(t){var n=t.name;TS.redux.enterprise.updateEnterpriseOrgName(n);var r=$(".team_menu.slack_menu");r.find(".slack_menu_header .current_team_name").text(n);r.find(".menu_list .enterprise_logout_url a strong").text(n);$(".enterprise-name").text(n)},enterprise_team_added:function e(t){if(!t.team||!TS.boot_data.page_needs_enterprise)return;TS.teams.upsertTeam(t.team)},channel_marked:function e(t){if(!TS.client)return;var n=TS.interop.channels.getChannelById(t.channel);if(!n){TS.error('unknown channel: "'+t.channel+'"');return}TS.redux.dispatch(TS.interop.redux.models.channelsMeta.inviters.removeInviter(n.id));TS.useReactMessages()||delete TS.model.last_reads_set_by_client[n.id+"_"+t.ts];TS.has_pri[g]&&n.last_read!==t.ts&&TS.log(g,"channel_marked for "+n.id+", "+n.last_read+" -> "+t.ts);TS.channels.setLastRead(n,t.ts)},channel_history_changed:function e(t){w(t)},subtype__channel_history_changed:function e(t){TS.boot_data.feature_channel_eventlog_client&&TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);w(t)},subtype__mpim_join:function e(t){var n=t.user;var r=TS.redux.members.isMemberKnown(n)&&TS.interop.members.getMemberById(n);if(!r){TS.error('unknown member: "'+n+'"');v("subtype__mpim_join");return}T("subtype__mpim_join");TS.info(r.id+" joined mpim "+t.channel)},mpim_open:function e(t){var n=TS.interop.channels.getMpimById(t.channel);n||(n=TS.interop.channels.getChannelById(t.channel));if(!n){TS.error("unknown mpim! "+t.channel);return}n.is_open=true;if(TS.model.requested_mpim_opens[t.channel]){n.is_channel?TS.channels.legacyDisplayChannel({id:n.id,and_send_txt:TS.model.requested_mpim_opens[t.channel].and_send_txt}):TS.mpims.legacyDisplayMpim({id:n.id,and_send_txt:TS.model.requested_mpim_opens[t.channel].and_send_txt});delete TS.model.requested_mpim_opens[t.channel]}n.opened_this_session=true;n.is_channel?TS.channels.created_sig.dispatch(n):TS.mpims.opened_sig.dispatch(n);TS.client&&TS.shared.legacyCheckInitialMsgHistory(n,TS.shared.legacyGetControllerForModelOb(n))},mpim_close:function e(t){var n=TS.interop.channels.getMpimById(t.channel);n||(n=TS.interop.channels.getChannelById(t.channel));if(!n){TS.error('unknown mpim: "'+t.channel+'"');return}n.is_open=false;var r=t.converted_to;if(r&&TS.interop.channels.getGroupById(r)){n.latest=null;TS.shared.moveLastMsgInput(n,TS.interop.channels.getGroupById(r))}TS.model.active_cid==t.channel&&(TS.client&&r&&TS.interop.channels.getGroupById(r)?TS.groups.legacyDisplayGroup({id:r}):TS.client&&TS.client.activeChannelDisplayGoneAway())},mpim_marked:function e(t){if(!TS.client)return;var n=TS.interop.channels.getMpimById(t.channel);if(!n){TS.error('unknown mpim: "'+t.channel+'"');return}TS.redux.dispatch(TS.interop.redux.models.channelsMeta.inviters.removeInviter(n.id));TS.has_pri[g]&&n.last_read!==t.ts&&TS.log(g,"mpim_marked for "+n.id+", "+n.last_read+" -> "+t.ts);TS.useReactMessages()||delete TS.model.last_reads_set_by_client[n.id+"_"+t.ts];TS.mpims.setLastRead(n,t.ts)},mpim_history_changed:function e(t){I(t)},subtype__mpim_history_changed:function e(t){TS.boot_data.feature_channel_eventlog_client&&TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);I(t)},group_open:function e(t){if(TS.interop.channels.getMpimById(t.channel))return TS.ms.msg_handlers.mpim_open(t);var n=TS.interop.channels.getGroupById(t.channel);if(!n){TS.error("unknown group! "+t.channel);return}n.is_open=true;if(TS.model.requested_group_opens[t.channel]){TS.groups.legacyDisplayGroup({id:n.id,and_send_txt:TS.model.requested_group_opens[t.channel].and_send_txt});delete TS.model.requested_group_opens[t.channel]}n.opened_this_session=true;TS.groups.opened_sig.dispatch(n);TS.client&&TS.shared.legacyCheckInitialMsgHistory(n,TS.groups)},group_marked:function e(t){if(!TS.client)return;if(TS.interop.channels.getMpimById(t.channel))return TS.ms.msg_handlers.mpim_marked(t);var n=TS.interop.channels.getGroupById(t.channel);if(!n){TS.error('unknown group: "'+t.channel+'"');return}TS.redux.dispatch(TS.interop.redux.models.channelsMeta.inviters.removeInviter(n.id));TS.has_pri[g]&&n.last_read!==t.ts&&TS.log(g,"group_marked for "+n.id+", "+n.last_read+" -> "+t.ts);TS.useReactMessages()||delete TS.model.last_reads_set_by_client[n.id+"_"+t.ts];TS.groups.setLastRead(n,t.ts)},group_close:function e(t){if(TS.interop.channels.getMpimById(t.channel))return;var n=TS.interop.channels.getGroupById(t.channel);if(!n){TS.error('unknown group: "'+t.channel+'"');return}n.is_open=false;TS.model.active_group_id==t.channel&&TS.client&&TS.client.activeChannelDisplayGoneAway();TS.groups.closed_sig.dispatch(n)},group_history_changed:function e(t){k(t)},subtype__group_history_changed:function e(t){TS.boot_data.feature_channel_eventlog_client&&TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);k(t)},im_created:function e(t){if(TS.boot_data.feature_m11n_channel_rtm_handlers)return;TS.interop.channels.upsertIm(t.channel);var n=TS.interop.channels.getImById(t.channel.id);if(!n){TS.error("error why can we not find this im: "+t.channel.id);return}var r=TS.interop.members.getMemberById(t.user);if(!r){TS.error('unknown member: "'+t.user+'"');v("im_created");return}T("im_created");TS.members.invalidateMembersUserCanSeeArrayCaches();if(n.is_open){if(TS.interop.redux.features.pendingOpenIm.getShouldBecomeActive(TS.redux.getState(),r.id)){TS.ims.legacyDisplayIm(n.id,false,TS.interop.redux.features.pendingOpenIm.getPendingMsgForIm(TS.redux.getState(),r.id));TS.redux.dispatch(TS.interop.redux.features.pendingOpenIm.clearPendingOpenIm({memberId:r.id}))}TS.ims.opened_sig.dispatch(n)}n.opened_this_session=true},im_open:function e(t){if(TS.boot_data.feature_m11n_channel_rtm_handlers)return;var n=TS.interop.channels.getImById(t.channel);if(!n){TS.error("unknown im! "+t.channel);return}n.is_open=true;var r=TS.redux.members.isMemberKnown(t.user)&&TS.interop.members.getMemberById(t.user);if(!r){TS.error('unknown member: "'+t.user+'"');v("im_open");return}T("im_open");if(TS.interop.redux.features.pendingOpenIm.getShouldBecomeActive(TS.redux.getState(),r.id)){TS.ims.legacyDisplayIm(n.id,false,TS.interop.redux.features.pendingOpenIm.getPendingMsgForIm(TS.redux.getState(),r.id));TS.redux.dispatch(TS.interop.redux.features.pendingOpenIm.clearPendingOpenIm({memberId:r.id}))}n.opened_this_session=true;TS.ims.opened_sig.dispatch(n);TS.client&&TS.shared.legacyCheckInitialMsgHistory(n,TS.ims)},im_marked:function e(t){if(!TS.client)return;var n=TS.interop.channels.getImById(t.channel);if(!n){TS.error('unknown im: "'+t.channel+'"');return}TS.has_pri[g]&&n.last_read!==t.ts&&TS.log(g,"im_marked for "+n.id+", "+n.last_read+" -> "+t.ts);TS.useReactMessages()||delete TS.model.last_reads_set_by_client[n.id+"_"+t.ts];TS.ims.setLastRead(n,t.ts)},im_close:function e(t){var n=TS.interop.channels.getImById(t.channel);if(!n){TS.error('unknown im: "'+t.channel+'"');return}if(!n.is_open)return;n.is_open=false;TS.model.active_im_id==t.channel&&TS.client&&TS.client.activeChannelDisplayGoneAway();TS.ims.closed_sig.dispatch(n)},im_history_changed:function e(t){x(t)},subtype__im_history_changed:function e(t){TS.boot_data.feature_channel_eventlog_client&&TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);x(t)},manual_presence_change:function e(t){y(t);if("away"!==t.presence&&"active"!==t.presence){TS.error('unknown presence: "'+t.presence+'"');return}var r=n({},TS.model.user,{presence:t.presence,manual_presence:t.presence});TS.redux.dispatch(TS.interop.redux.models.members.addMember(r));TS.members.presence_changed_sig.dispatch(r)},presence_change:function e(n){y(n);n.team=n.team||TS.model.team.id;n.hasOwnProperty("users")&&_.isArray(n.users)?n.users.forEach(function(e){t(e,n.presence)}):t(n.user,n.presence)},status_change:function e(t){var n=TS.redux.members.isMemberKnown(t.user)&&TS.interop.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');v("status_change");return}T("status_change");if(n.status==t.status)return;n.status=t.status;TS.members.status_changed_sig.dispatch(n)},pref_change:function e(t){if(TS.boot_data.feature_prefs_modernization)return;TS.prefs.onPrefChanged(t)},team_pref_change:function e(t){TS.prefs.onTeamPrefChanged(t)},team_profile_change:function e(t){TS.team.upsertAndSignal({profile:t.profile})},team_profile_reorder:function e(t){TS.team.upsertAndSignal({profile:t.profile})},team_profile_delete:function e(t){TS.team.upsertAndSignal({profile:t.profile})},file_created:function e(t){var n=TS.files.getFileById(t.file.id);n?TS.warn("we already know about this file, which probably means the files.upload response came in before this message (so np) "+t.file.id):TS.files.upsertAndSignal(t.file)},file_public:function e(t){if(TS.boot_data.feature_no_files_info)return;TS.files.upsertAndSignal(t.file)},file_private:function e(t){if(TS.boot_data.feature_no_files_info)return;TS.files.fetchFileInfo(t.file_id)},file_change:function e(t){if(TS.boot_data.feature_no_files_info)return;TS.files.upsertAndSignal(t.file);TS.files.fileWasMaybeRefreshed(t.file)},file_shared:function e(t){if(TS.boot_data.feature_no_files_info)return;TS.files.upsertAndSignal(t.file);TS.files.team_file_shared_sig.dispatch(t.file)},file_unshared:function e(t){if(TS.boot_data.feature_no_files_info)return;TS.files.upsertAndSignal(t.file)},file_comment_added:function e(t){var n=TS.files.getFileById(t.file_id);if(!n)return;TS.files.editCommentOnFile(t.comment,n)||TS.files.addCommentToFile(t.comment,n)},file_comment_edited:function e(t){var n=TS.files.getFileById(t.file_id);if(!n)return;TS.files.editCommentOnFile(t.comment,n)},file_comment_deleted:function e(t){var n=TS.files.getFileById(t.file_id);if(!n)return;TS.files.deleteCommentOnFile(t.comment,n)},team_join:function e(t){var n=t.user;TS.info(n.id+" joined the team");TS.members.legacyUpsertMember(n);n=TS.interop.members.getMemberById(n.id);if(!n){TS.error("team_join: wtf no member "+n.id+"?");v("team_join");return}T("team_join");TS.members.joined_team_sig.dispatch(n);TS.client&&TS.view.showProperTeamPaneFiller()},star_added:function e(t){if(!t.item){TS.error(t.type+" has no item");return}var n=TS.redux.members.isMemberKnown(t.user)&&TS.interop.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');v("star_added");return}T("star_added");if(!n.is_self)return;TS.stars.userStarStatusHasChanged(true,t.item,t.type);TS.stars.maybeUpdateUserStarredList({delta:1})},star_removed:function e(t){if(!t.item){TS.error(t.type+" has no item");return}var n=TS.redux.members.isMemberKnown(t.user)&&TS.interop.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');return}if(!n.is_self)return;TS.stars.userStarStatusHasChanged(false,t.item,t.type);TS.stars.maybeRemoveStarredListItem(t.item)},email_domain_changed:function e(t){TS.team.upsertAndSignal({email_domain:t.email_domain});TS.client&&TS.view.showProperTeamPaneFiller()},team_domain_change:function e(t){TS.team.upsertAndSignal({domain:t.domain});TS.model.last_team_domain=TS.model.team.domain;TSSSB.call("teamDomainChanged",t.url)},slack_broadcast:function e(t){var n=null;var r=t.title||TS.interop.i18n.t("Broadcast message","msg_handlers")();var i=t.body||"";var a="";var s=t.button||(t.reload?"Reload":"OK");var o=false;if(t.reload){if(t.force_reload){TS.info("reloading because imsg.force_reload");o=true}else if(TS.boot_data.version_ts){if("dev"===t.version_ts){TS.info("reloading because dev");o=true}else if(parseInt(TS.boot_data.version_ts,10)<parseInt(t.version_ts,10)){TS.info("reloading because "+TS.boot_data.version_ts+" < "+t.version_ts);o=true}}else{TS.info("reloading because we dont have an version_ts");o=true}if(!o)return;n=function e(){TS.client&&TS.reload()}}if(o){var l=_.random(10,20);var u=TS.interop.i18n.t('(You will be auto reloaded in <span id="auto_secs">{secs}</span> seconds.)',"msg_handlers")({secs:l});a='<p class="top_margin">'+u+"</p>";setTimeout(function(){TS.client&&TS.reload()},1e3*l);setInterval(function(){l-=1;if(l<1)return;$("#auto_secs").text(l)},1e3)}TS.generic_dialog.start({title:TS.format.formatNoHighlightsNoSpecials(r),body:TS.format.formatNoHighlightsNoSpecials(i)+a,go_button_text:s,show_cancel_button:false,esc_for_ok:true,onGo:n})},team_rename:function e(t){if(t.source_team&&t.source_team!==TS.model.team.id)TS.teams.updateTeamName(t);else{$("#team_name").text(t.name);document.title=document.title.replace(TS.model.last_team_name,t.name);TS.ui.growls.original_document_title&&(TS.ui.growls.original_document_title=TS.ui.growls.original_document_title.replace(TS.model.last_team_name,t.name));TS.model.team.name=t.name;TS.model.last_team_name=TS.model.team.name;TS.team.team_name_changed_sig.dispatch(TS.model.team);TSSSB.call("teamNameChanged",t.name)}},team_icon_change:function e(t){if(!t.icon)return;if(t.source_team&&t.source_team!==TS.model.team.id)TS.teams.updateTeamIcon(t);else{TS.model.team.icon=t.icon;TS.teams.changed_icon_sig.dispatch(TS.model.team);TS.client&&TS.client.updateTeamIcon()}},issue_change:function e(t){TS.help.onIssueChange(t.issue)},emoji_changed:function e(t){switch(t.subtype){case"add":if(!t.hasOwnProperty("name")||!t.hasOwnProperty("value")){TS.warn("Bad emoji_changed__add event; expected `name` and `value` to be present");return}TS.emoji.addCustomEmoji(t.name,t.value,t.event_ts);break;case"remove":if(!_.isArray(t.names)){TS.warn("Bad emoji_changed__remove event; expected `names` to be an array");return}t.names.forEach(function(e){TS.emoji.removeCustomEmoji(e,t.event_ts)});break;case"rename":if(!t.hasOwnProperty("old_name")||!t.hasOwnProperty("new_name")||!t.hasOwnProperty("value")){TS.warn("Bad emoji_changed__rename event; expected `old_name`, `new_name` and `value` to be present");return}TS.emoji.renameCustomEmoji(t.old_name,t.new_name,t.value,t.event_ts);break;default:TS.logError("error_updating_emoji","Recieved emoji_changed event without a recognized subtype: "+t.subtype+".")}},commands_changed:function e(t){if(!t.commands_removed&&!t.commands_updated){i("commands_changed",t.event_ts,function(e){e&&(TS.model.commands_cache_ts=e);TS.cmd_handlers.resetUpCmds()});return}_.isArray(t.commands_removed)&&t.commands_removed.forEach(function(e){TS.cmd_handlers.removeCommand(e.name,t.event_ts)});_.isArray(t.commands_updated)&&t.commands_updated.forEach(function(e){TS.cmd_handlers.updateCommand(e,t.event_ts)})},accounts_changed:function e(){setTimeout(TS.refreshTeams,1e3)},pin_added:function e(t){var n=TS.redux.channels.getEntityById(t.channel_id);if(n){var r=false;if(TS.boot_data.feature_less_pins&&"message"!==t.item.type){t.item.file=TS.files.getFileById(t.item.file_id);r=!t.item.file}if(r){TS.pins.clearHavePinsBeenFetched(n);TS.pins.updateCount(n,t.pin_count)}else{TS.pins.pinStatusHasChanged(true,t.item,t.item.type,n,t.pin_count);n.has_pins=true}}},pin_removed:function e(t){var n=TS.redux.channels.getEntityById(t.channel_id);if(n){var r=false;if(TS.boot_data.feature_less_pins&&"message"!==t.item.type){t.item.file=TS.files.getFileById(t.item.file_id);r=!t.item.file}if(r){TS.pins.clearHavePinsBeenFetched(n);TS.pins.updateCount(n,t.pin_count)}else{TS.pins.pinStatusHasChanged(false,t.item,t.item.type,n,t.pin_count);false===t.has_pins&&(n.has_pins=false)}}},sh_room_join:function e(t){TS.dir(441,t);TS.rooms.upsertAndSignal(t.room)},sh_room_leave:function e(t){TS.dir(441,t);TS.rooms.upsertAndSignal(t.room)},sh_room_update:function e(t){TS.dir(441,t);TS.rooms.upsertAndSignal(t.room)},subteam_updated:function e(t){TS.user_groups.upsertUserGroupAndSignal(t.subteam)},subteam_members_changed:function e(t){if(!TS.boot_data.feature_subteam_members_diff)return;TS.info("TS.ms.msg_handlers.subteam_members_changed",t);TS.user_groups.userGroupMembersChanged(t)},subteam_created:function e(t){TS.user_groups.upsertUserGroupAndSignal(t.subteam)},subteam_deleted:function e(t){TS.user_groups.removeUserGroupAndSignal(t.subteam)},subteam_self_added:function e(t){TS.user_groups.upsertSelfUserGroup(t.subteam_id)},subteam_self_removed:function e(t){TS.user_groups.removeSelfUserGroup(t.subteam_id)},apps_changed:function e(t){t.event_ts&&(TS.model.apps_cache_ts=t.event_ts);TS.apps.ingestApp(t.app)},apps_installed:function e(t){t.app&&t.app.app_user_id&&TS.shared.legacyGetActiveModelOb().is_im&&TS.shared.legacyGetActiveModelOb().user==t.app.app_user_id&&TS.view.checkIfInputShouldBeDisabledAndPopulate()},dnd_override:function e(t){TS.dnd.dndOverride(t.channel,t.timestamp)},dnd_updated:function e(t){var n=TS.redux.members.isMemberKnown(t.user)&&TS.interop.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');return}TS.dnd.updateUserPropsAndSignal(n.id,t.dnd_status)},dnd_updated_user:function e(t){var n=TS.redux.members.isMemberKnown(t.user)&&TS.interop.members.getMemberById(t.user);if(!n){TS.log(2002,'unknown member in dnd_updated_user: "'+t.user+'"');v("dnd_updated_user");return}T("dnd_updated_user");TS.dnd.updateUserPropsAndSignal(n.id,t.dnd_status)},message_replied:function e(t){if(TS.boot_data.feature_sonic_rtm_message_replied&&TS.boot_data.feature_modern_process_imsg)return;var n=t.message;var r;n&&n.latest_reply?r=n.latest_reply:n&&n.replies&&n.replies.length&&(r=_.maxBy(n.replies,"ts").ts);var i=TS.redux.channels.getEntityById(t.channel);if(r&&i&&i.msgs){var a=TS.utility.msgs.findMsg(n.ts,i.id);if(a&&a.reply_count){var s;a&&a.latest_reply?s=a.latest_reply:a&&a.replies&&a.replies.length&&(s=_.maxBy(a.replies,"ts").ts);if(r<s){TS.log(2004,"Not processing older message_replied event, "+r+" < "+s+", in "+t.channel);return}}}C(t)},subtype__message_replied:function e(t){TS.has_pri[h]&&TS.log(h,"recved subtype "+t.subtype);TS.boot_data.feature_channel_eventlog_client&&TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);C(t)},thread_subscribed:function e(t){var n=t.subscription;if(!n||"thread"!==n.type)return;if(!n.channel||!n.thread_ts)return;TS.replies.threadSubscribed(n.channel,n.thread_ts,n)},thread_unsubscribed:function e(t){var n=t.subscription;if(!n||"thread"!==n.type)return;if(!n.channel||!n.thread_ts)return;TS.replies.threadUnsubscribed(n.channel,n.thread_ts,n)},thread_marked:function e(t){var n=t.subscription;if(!n||"thread"!==n.type)return;if(!n.channel||!n.thread_ts)return;TS.replies.threadMarked(n.channel,n.thread_ts,n.last_read,n.unread_count)},desktop_notification:function e(t){if(!TS.ui||!TS.ui.growls)return;TS.ui.growls.handleDesktopNotificationMessage(t)},app_conversation_invite_request:function e(t){if(!TS.interop.client_action_token.check(t.client_token))return;var n=TS.redux.members.isMemberKnown(t.app_user)&&TS.interop.members.getMemberById(t.app_user);var r=TS.redux.channels.getEntityById(t.channel_id);var i=t.invite_message_ts;var a=t.scope_info;TS.apps.permissions.addAppToResourceFromInviteMessageTS(n,r,a,i)},update_thread_state:function e(t){if(!TS.client)return;TS.client.threads.updateThreadState(t.has_unreads,t.mention_count,t.timestamp,t.mention_count_by_channel);TS.replies.updateThreadStateReceived()},app_permission_request:function e(t){if(!TS.interop.client_action_token.check(t.client_token))return;TS.apps.permissions.requestPermissions(t.app_user,t.scope_info,t.trigger_id)},dialog_opened:function e(t){if(!TS.interop.client_action_token.check(t.client_token))return;var n=TS.interop.client_action_token.getTimeDelta(t.client_token),r=n.delta,i=n.nowTs,a=n.tokenTs;TS.interop.clog.track("APP_DIALOG_OPEN_ATTEMPTED",{app_id:t.app_id,debug_date_now_fn:_.get(Date,"now","function not defined").toString(),dialog_id:t.dialog_id,dialog_client_token_ts:a,dialog_ms_event_received_ts:i});if(r>=t.timeout_range){TS.statsd.timing("app_dialog.initiation_to_timeout_delta",r);return}TS.statsd.timing("app_dialog.initiation_to_open_delta",r);TS.interop.openAppDialog({appId:t.app_id,id:t.dialog_id,submitLabel:t.dialog_submit_label,title:t.dialog_title})}});var e=function e(t,n){var r=TS.redux.channels.getEntityById(t.channel);if(!r){TS.error('unknown model_ob: "'+t.channel+'"');return}if(TS.useReactMessages()){TS.redux.messages.channelHistoryChanged(r.id);return}r.history_changed=true;n.legacyFetchHistory(r,{channel:r.id,latest:t.latest,inclusive:true,count:_.clamp(r.msgs.length,TS.model.initial_msgs_cnt,1e3)},function(e,i,a){if(e){TS.info("_history_changed: dumping old messages for "+r.id);r.is_limited=false;TS.utility.msgs.resetOldestMsgsTs(r);TS.warn("imsg.latest: "+t.latest);for(var s=r.msgs.length-1;s>-1;s-=1){var o=r.msgs[s];if(o.ts<t.latest)continue;i.messages.unshift(o)}r.msgs.length=0}else TS.error("could not retrieve history for "+r.id);n.legacyOnHistory(e,i,a);if(!r.latest){TS.info("history_changed: latest not set for "+r.id,t,r);var l=TS.interop.rules.channels.getLatestMsgTs(r);if(!l){TS.warn("history_changed: could not find latest via TS.interop.rules.channels.getLatestMsgTs(), using live msgs");l=r&&r.msgs.length?r.msgs[r.msgs.length-1]:null}if(l){if(l){TS.info("history_changed: assigning latest of "+l+" to model_ob",l,r);r.latest=l}}else TS.warn("history_changed: still no latest ts for "+r.id+"?",l)}r.history_changed=false})};var t=function e(t,r){if("away"!==r&&"active"!==r){TS.error('unknown presence: "'+r+'"');return}var i=TS.redux.members.isMemberKnown(t)&&TS.interop.members.getMemberById(t);if(!i){v("presence_change");return}T("presence_change");var a=TS.redux.presence.getPresenceByMemberId(i.id);if(a==r)return;_.get(i,"profile.always_active")&&(r="active");i.is_self&&(i._presence_last_changed=new Date);i.presence=r;TS.redux.dispatch(TS.interop.redux.models.members.addMember(n({},i)));TS.redux.presence.updatePresenceForMember(i);TS.members.presence_changed_sig.dispatch(i)};var r={};var i=function e(t,n,i){r[t]=r[t]||{};var a=r[t];n&&(a.cache_ts=n);if(a.timer)return;var s=_.random(0,5e3);TS.info("Waiting "+s+" ms before handling "+t+" event");a.timer=setTimeout(function(){delete r[t];i(a.cache_ts)},s)};var a=false;var s=false;var o=1e3;var l=null;var u=6e4;var d={};var c={};var m=0;var f=0;var p={start:function e(t,n){if(!s)return;n=n&&parseInt(n,10)||o;var r={start:performance.now(),end:0};var i=function e(i){i=!!i;r.end=performance.now();var a=r.end-r.start;a>n&&TS.warn("'"+t+"' msg_handler took "+_.round(a,2)+"ms"+(n!==o?" (threshold = "+n+")":""));p.count(t,a,i)};return i},count:function e(t,n,r){c.start_time||(c.start_time=performance.now());d[t]||(d[t]={call_count:0,elapsed_time:0,async:!!r});r&&(d[t].async=r);d[t].call_count+=1;d[t].elapsed_time+=n;p.maybeReport()},report:function e(){p.finish();if(_.size(d)){var t=_.sum(_.map(d,"call_count"));TS.has_pri[S]&&TS.log(S,"\ud83c\udfd4\ufe0f MS message stats: "+t+" handler calls in "+parseInt(c.elapsed_time/1e3,10)+"s window, "+m+" imsgs since "+new Date(f),d);p.beacon()}p.reset()},beacon:function e(){var t="ms_handler_";_.each(d,function(e,n){n=e.async?t+"async_"+n:t+n;TS.metrics.count(n+"_count",e.call_count);TS.metrics.store(n+"_time",e.elapsed_time)});TS.metrics.store(t+"imsgs_received_total",m,{is_count:true})},finish:function e(){c.end_time=performance.now();c.elapsed_time=c.end_time-c.start_time},reset:function e(){d={};c={};l=null},maybeReport:function e(){if(l)return;l=window.setTimeout(p.report,u)},enableStatsCollecting:function e(){TS.has_pri[S]&&TS.log(S,"\ud83c\udfd4\ufe0f MS message handler stat collecting enabled");s=true},disableStatsCollecting:function e(){TS.has_pri[S]&&TS.log(S,"\ud83c\udfd4\ufe0f MS message handler stat collecting disabled");s=false}};var h=2;var g=141;var S=808;var T=function e(t){TS.utility.enableFeatureForUser(1)&&TS.metrics.count("ms_event_handled_"+t)};var v=function e(t){TS.utility.enableFeatureForUser(1)&&TS.metrics.count("ms_event_dropped_"+t)};var b=function e(){return window.desktop&&window.desktop.app&&window.desktop.app.getIdleTimeInMs};var y=function e(t){TS.log(2017,"*--------------------------------*");TS.log(2017,"MS Event: "+t.type);TS.log(2017,"Presence set to: "+t.presence);b()&&TS.log(2017,"getIdleTimeInMs reads: "+window.desktop.app.getIdleTimeInMs());TS.log(2017,"*--------------------------------*")};var w=function t(n){TS.info("channel_history_changed for "+n.channel);return e(n,TS.channels)};var k=function t(n){if(n.is_mpim)return;TS.info("group_history_changed for "+n.channel);return e(n,TS.groups)};var x=function t(n){TS.info("im_history_changed for "+n.channel);return e(n,TS.ims)};var C=function e(t){if(!t.message){TS.error("no message?");return}TS.mentions.replaceMsg(t.message);var n=TS.redux.channels.getEntityById(t.channel);if(!n){TS.error("unknown imsg.channel:"+t.channel);return}TS.pins&&TS.pins.replaceMsg(t.message,n);(t.message.imgs||TS.utility.msgs.hasImgs(t.message))&&(TS.model.show_inline_img_size_pref_reminder=true);var r=true;var i=false;TS.utility.msgs.replaceMsg(n,t.message,r,i,t._from_evt_log)};var M=function e(t){if(!t.deleted_ts){TS.error("no deleted_ts?");return}TS.mentions.legacyRemoveMsg(t.deleted_ts);var n=TS.interop.channels.getChannelById(t.channel);var r;var i;var a;n||(r=TS.interop.channels.getImById(t.channel));n||r||(a=TS.interop.channels.getMpimById(t.channel));n||r||a||(i=TS.interop.channels.getGroupById(t.channel));if(!r&&!n&&!a&&!i){TS.error("unknown imsg.channel:"+t.channel);return}var s=r||n||a||i;TS.pins&&TS.pins.legacyRemoveMsg(t.deleted_ts,s);var o=TS.utility.msgs.getMsg(t.deleted_ts,s.msgs);!o&&s._archive_msgs&&(o=TS.utility.msgs.getMsg(t.deleted_ts,s._archive_msgs));o||(o=TS.client.unread.getMessage(s,t.deleted_ts));o||(o=TS.ui.replies.getActiveMessage(s,t.deleted_ts));o||(o=TS.client.threads.getMessage(s,t.deleted_ts));if(TS.useReactMessages()){TS.redux.messages.removeMessage({channel:t.channel,ts:t.deleted_ts},t._from_evt_log);TS.redux.messages.recordDeletedMessage(t.channel,t.deleted_ts)}if(!o)return;r?TS.ims.legacyRemoveMsg(s.id,o):n?TS.channels.legacyRemoveMsg(s.id,o):a?TS.mpims.legacyRemoveMsg(s.id,o):i&&TS.groups.legacyRemoveMsg(s.id,o)};var I=function t(n){TS.info("mpim_history_changed for "+n.channel);return e(n,TS.mpims)}})()},11236:function(e,t){(function(){TS.registerModule("ds",{last_pong_time:0,sent_map:{},connected_sig:new signals.Signal,disconnected_sig:new signals.Signal,trouble_sig:new signals.Signal,reconnecting_sig:new signals.Signal,pong_sig:new signals.Signal,on_msg_sig:new signals.Signal,reconnect_requested_sig:new signals.Signal,onStart:function e(){b(TS.model.ui.is_window_focused||false);TS.ui.window_focus_changed_sig.add(b);setInterval(function(){if(!TS.model.ds_connected)return;if(TS.model.rtd_start_throttler<1)return;TS.model.rtd_start_throttler-=1},6e4)},send:function e(t,n,r){g+=1;t.id=g;TS.ds.sent_map[t.id.toString()]={msg:t,handler:n,ts:Date.now(),temp_ts:r};if("ping"===t.type||"pong"===t.type)TS.has_pri[$]&&TS.log($,"DS TS.ds ping --\x3e\n"+JSON.stringify(t,null,"  "));else{TS.model.last_net_send=Date.now();TS.has_pri[$]&&TS.log($,"TS.ds --\x3e\n"+JSON.stringify(t,null,"  "))}h&&TS.model.ds_connected?h.send(JSON.stringify(t)):TS.ds.Q.push(t);return t.id},Q:[],sendTyping:function e(t){var n='{"type":"typing", "channel":"'+t+'"}';h.send(n)},handleMsg:function e(t){var n=t.reply_to&&!("ok"in t)&&"message"===t.type;var r;if(t.reply_to)if(t.reply_to.toString()in TS.ds.sent_map){r=TS.ds.sent_map[t.reply_to];t.SENT_MSG=r.msg;delete TS.ds.sent_map[t.reply_to]}else n||TS.error('received msg "'+t.reply_to+'" with type "'+t.type+'" but we have no record of it in sent_map');if("ping"===t.type||"pong"===t.type){if(TS.has_pri[$]){TS.log($,"DS msg "+t.type+" time: "+(Date.now()-r.ts)+"ms");TS.log($,"DS TS.ds ping <--\n"+JSON.stringify(t,null,"  "))}TS.ds.last_pong_time=Date.now();TS.ds.pong_sig.dispatch();S=false}else{if(r){var i=t.type||t.SENT_MSG.type||"";TS.has_pri[$]&&TS.log($,"msg "+(i?'"'+i+'" ':"")+"rsp time "+(Date.now()-r.ts)+"ms")}TS.has_pri[$]&&TS.log($,"TS.ds <-- \n"+JSON.stringify(t,null," "))}if("error"===t.type)O(t);else if(!t.reply_to){TS.ds.on_msg_sig.dispatch(t);"hello"===t.type&&D(t)}if(r){t.ok||(t.error=t.error||{code:0,msg:"unknown error (not specified by MS)"});n&&(t.ok=true);r.handler&&r.handler(t.ok,t)}},onFailure:function t(r){r&&M("You got disconnected, so here are some details:\n>>>"+r);S=false;I();if(TS.model.ds_connected){TS.info("Disconnected from DS, TS.model.rtd_start_throttler:"+TS.model.rtd_start_throttler);TS.ds.logConnectionFlow("on_connected_failure");TS.model.ds_reconnect_ms=100;TS.ds.disconnect()}else{TS.ds.logConnectionFlow("on_notconnected_failure");TS.model.ds_reconnect_ms=1.3*(TS.model.ds_reconnect_ms+1e3);var i=TS.model.ds_reconnect_ms;TS.model.ds_reconnect_ms>4e3&&(TS.model.ds_reconnect_ms=_.random(i,i+i/3));TS.model.ds_reconnect_ms=Math.min(TS.model.ds_reconnect_ms,3e5)}if(TS.model.rtd_start_throttler>5){var a=2e3*TS.model.rtd_start_throttler;if(TS.model.ds_reconnect_ms<a){TS.info("because TS.model.rtd_start_throttler:"+TS.model.rtd_start_throttler+" we are increasing time until next login call");TS.model.ds_reconnect_ms=a}}if(TS.model.ds_connected){TS.model.ds_connected=false;TS.ds.disconnected_sig.dispatch()}TS.model.ds_connected=false;clearInterval(n);clearInterval(e);if(TS.model.ds_asleep){TS.warn("NOT doing startReconnection(), we are asleep");return}TS.ds.startReconnection()},startReconnection:function e(){TS.model.ds_reconnect_time=Date.now()+TS.model.ds_reconnect_ms;TS.info("Attempting to reconnect in "+TS.model.ds_reconnect_ms+"ms");clearInterval(m);m=setInterval(A,f);A();clearTimeout(p);p=setTimeout(function(){TS.model.window_unloading||TS.ds.reconnect_requested_sig.dispatch()},TS.model.ds_reconnect_ms)},manualReconnectNow:function e(){TS.ds.logConnectionFlow("manual_reconnect");clearTimeout(p);clearInterval(m);clearTimeout(i);v=0;if(!TS.model.window_unloading){TS.ds.reconnect_requested_sig.dispatch();TS.ds.reconnecting_sig.dispatch(0)}},disconnect:function e(){if(h&&TS.model.ds_connected){TS.ds.logConnectionFlow("disconnect");h.close()}else TS.warn("TS.ds.disconnect called, but _websocket="+h+" TS.model.ds_connected="+TS.model.ds_connected)},logConnectionFlow:function e(t){var n=TS.model.ds_conn_log;var r=Date.now();n.push({name:t,time:r,delta:n.length?r-n[n.length-1].time:0});TS.has_pri[$]&&TS.log($,"logConnectionFlow "+t+" "+n[n.length-1].delta)},getConnectionFlowLog:function e(){var t=TS.model.ds_conn_log;var n=[];for(var r=0;r<t.length;r+=1)n.push(encodeURIComponent(t[r].name+"-"+(t[r].delta?Math.round(t[r].delta/1e3):0)+"-"+Math.round(t[r].time/1e3)));TS.dir(2,TS.model.ds_conn_log);var i="_x_connection_log="+n.join(",");return i},connect:function e(){window.WebSocket||(window.WebSocket=window.MozWebSocket);if(window.WebSocket){var t;try{TS.ds.logConnectionFlow("connect");t=TS.web.space.login_data.ws;var n=1==TS.qs_args.simulate_old_token?"&TRIGGER_OLD_TOKEN=1":"";t+="?version_uid="+TS.boot_data.version_uid+n;t=TS.utility.appendLogToUrlWithLimit(t,TS.ds.getConnectionFlowLog());TS.info("Connecting to: "+t);if(1==TS.qs_args.simulate_first_connect_failure&&!window.already_simulated_first_connect_failure){t=t.replace("e","w");TS.info("simulate_first_connect_failure url:"+t);window.already_simulated_first_connect_failure=true}a=window.WEB_SOCKET_USING_FLASH?o:s;clearTimeout(i);i=setTimeout(P,a);TS.ds.last_url=t;TS.ds.last_start_ms=Date.now();I();h=new WebSocket(t)}catch(e){TS.warn("failed to create new WebSocket");TS.error(e);TS.ds.onFailure("failed to create new WebSocket");return}TS.model.ds_connecting=true;1==TS.qs_args.simulate_first_connect_timeout&&v<1?TS.info("simulate_first_connect_timeout url:"+t):h.onopen=w;h.onclose=C;h.onerror=F}else alert(TS.interop.i18n.t("Your browser does not support Web Sockets.","ds")())},sleep:function e(){if(TS.model.ds_asleep)return;if(!TS.model.ds_connected)return;TS.model.ds_asleep=true;TS.ds.disconnect()},wake:function e(){if(!TS.model.ds_asleep)return;TS.model.ds_asleep=false;TS.ds.startReconnection()}});var e=0;var t=3e3;var n=0;var r=1e4;var i=0;var a=0;var s=1e4;var o=2e4;var l=0;var u=3e4;var d=0;var c=5e3;var m=0;var f=1e3;var p=0;var h=null;var g=0;var S=false;var T=0;var v=0;var b=function e(t){T=t?1e4:6e4;T+=r;TS.has_pri[$]&&TS.log($,"DS _pong_timeout_ms set to:"+T+" has_focus:"+t)};var y=function e(t){var n=JSON.parse(t.data);TS.ds.handleMsg(n)};var w=function e(){clearTimeout(i);v=0;if(1!=TS.qs_args.simulate_hello_timeout||window.already_simulated_hello_timeout)h.onmessage=y;else{TS.info("simulate_hello_timeout");window.already_simulated_hello_timeout=true}TS.model.ds_conn_log.length=0;TS.info("DS WS connected!");TS.ds.logConnectionFlow("on_connect");clearTimeout(l);l=setTimeout(E,u)};var k=function e(){if(!S)return;var t=Date.now()-TS.ds.last_pong_time;TS.has_pri[$]&&TS.log($,"DS MS since_last_pong_ms:"+t+" pong_timeout_ms:"+T);if(t<T)return;TS.warn("since_last_pong_ms too long! "+t+" > "+T);TS.warn("calling disconnect(), expect to get an onDisconnect() callback");TS.ds.logConnectionFlow("on_ping_timeout");TS.ds.trouble_sig.dispatch();S=false;M("You are on team Tiny Speck, so here are some pong details:\n>>>since_last_pong_ms too long! "+t+" > "+T+" ... calling disconnect(), expect to get an onDisconnect() callback");try{TS.ds.disconnect();clearTimeout(d);d=setTimeout(function(){TS.info("called disconnect, no onDisconnect callback happened in "+c+"ms, so calling _onDisconnect() manually now");C(null,"since_last_pong_ms too long! then called disconnect, but no onDisconnect callback happened in "+c+"ms, so calling _onDisconnect() manually now")},c)}catch(e){TS.info("since_last_pong_ms too long! then an error calling disconnect, going to assume it is because it is already closed, calling _onDisconnect() manually now");TS.warn(e);C(null,"error calling disconnect, going to assume it is because it is already closed, calling _onDisconnect() manually now")}};var x=function e(){TS.ds.send({type:"ping"});S=true};var C=function e(t,n){n=n||"_onDisconnect called with event:"+t;TS.info("DS WS disconnected");TS.ds.logConnectionFlow("on_disconnect");clearTimeout(d);clearTimeout(l);clearTimeout(i);t?TS.info("_onDisconnect event.code:"+t.code):TS.info("no event");TS.ds.onFailure(n)};var M=function e(t){TS.warn("_reportDisconnect reason_str:"+t)};var I=function e(){if(!h)return;h.onmessage=null;h.onopen=null;h.onerror=null;h.onclose=null;try{h.close()}catch(e){}};var A=function e(){var t=TS.model.ds_reconnect_time-Date.now();var n=Math.round(t/1e3);n>=0&&TS.ds.reconnecting_sig.dispatch(n);TS.model.window_unloading&&clearInterval(m)};var E=function e(){var t="socket received no hello msg "+u+"ms after connection";TS.warn(t);TS.ds.logConnectionFlow("_onHelloTimeout");TS.ds.onFailure(t)};var P=function e(){v+=1;var t="socket not connected "+a+"ms after creation. _connect_timeout_count:"+v;TS.warn(t);TS.ds.logConnectionFlow("_onConnectTimeout");if(3==v){TS.client.showConnectionTroubleDialog();return}if(2==v)if(window.WEB_SOCKET_USING_FLASH);else if(TS.model.is_chrome_desktop){s=2e4;return}TS.ds.onFailure(t)};var F=function e(t){var n="";if(t){t.name&&(n+=" e.name="+t.name);t.message&&(n+=" e.message="+t.message);t.data&&(n+=" e.data="+t.data)}TS.warn("_onError err_str: "+n);TS.dir(0,t)};var O=function e(t){if(t.error)if(1==t.error.code)TS.ds.logConnectionFlow("msg_error_code_1");else{TS.info("_onErrorMsg websocket is connected but we got an error message: "+JSON.stringify(t));TS.ds.onFailure("_onErrorMsg imsg.error:"+t.error)}else TS.info("_onErrorMsg: "+(t?JSON.stringify(t):"no imsg?"))};var D=function i(){clearTimeout(l);var a=Date.now()-TS.ds.last_pong_time;TS.info("Hello msg recvd, since_last_pong_ms:"+a);TS.ds.logConnectionFlow("on_hello");clearInterval(m);S=true;TS.ds.last_pong_time=Date.now();clearInterval(e);e=setInterval(k,t);clearInterval(n);n=setInterval(x,r);TS.model.ds_connecting=false;TS.model.ds_connected=true;var s;for(var o=0;o<TS.ds.Q.length;o+=1){s=TS.ds.Q.shift();TS.has_pri[$]&&TS.log($,"TS.ds (Q) --\x3e\n"+JSON.stringify(s,null,"  "));h.send(JSON.stringify(s))}TS.ds.connected_sig.dispatch();x()};var $=2})()},11237:function(e,t){(function(){TS.registerModule("templates",{onStart:function t(){n();TS.members&&TS.members.user_color_changed_sig.add(TS.templates.memberUserColorChanged,TS.templates);TS.prefs&&TS.prefs.sidebar_behavior_changed_sig.add(TS.templates.sidebarBehaviorPrefChanged,TS.templates);TS.environment.retina_changed_sig.add(e)},makeUnreadMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_messages_"+t.id)},makeRxnKeyDomClass:function e(t){return TS.utility.makeSafeForDomId("rxns_key_"+t)},makeUnreadGroupMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_group_messages_"+t.id)},makeUnreadDmsDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_dms_"+t.id)},makeSentMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_messages_"+t.id)},makeSentGroupMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_group_messages_"+t.id)},makeIssueListDomId:function e(t){return"issue_list_"+t},makeSentDmsDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_dms_"+t.id)},makeMsgDomId:function e(t){return TS.utility.makeSafeForDomId("msg_"+t)},makeMsgLabelDomId:function e(t){return TS.utility.makeSafeForDomId("msg_"+t+"_label")},makeMsgAttachmentTextExpanderDomId:function e(t,n){return TS.utility.makeSafeForDomId("msg_rest_text_expander_"+t+"_"+n)},makeMSRDomId:function e(t){return TS.utility.makeSafeForDomId("MSR_"+t.channel.id+"_"+t.ts)},makeMSRDomIdWithModule:function e(t,n){return TS.utility.makeSafeForDomId("MSR_"+t.channel.id+"_"+t.ts+"_"+n)},makeSHRoomClass:function e(t){return TS.utility.makeSafeForDomId("screenhero_room_"+t)},makeChannelDomId:function e(t){return"channel_"+t.id},makeChannelDragData:function e(t){return JSON.stringify({id:t.id,name:t.name,is_channel:t.is_channel||false,is_group:t.is_group||false,is_im:t.is_im||false,is_mpim:t.is_mpim||false,is_self_im:TS.interop.rules.channels.isYou(t)||false,is_slackbot_im:TS.interop.rules.channels.isSlackbot(t)||false,purpose:t.purpose?t.purpose.value:"",topic:t.topic?t.topic.value:""})},makeFileDragData:function e(t){return JSON.stringify({id:t.id,name:t.name,title:t.title,mimetype:t.mimetype,filetype:t.filetype,size:t.size})},makeDayDividerDomId:function e(t){return TS.utility.makeSafeForDomId("day_divider_"+t)},makeGroupDomId:function e(t){return"group_"+t.id},makePriorityIconDomId:function e(t){return"priority_"+t.id},makeStarredIconDomId:function e(t){return"starred_"+t.id},makeMutedIconDomId:function e(t){return"muted_"+t.id},makeMemberDomId:function e(t){if(!t)return;return TS.templates.makeMemberDomIdById(t.id)},makeMemberDomIdById:function e(t){if(!t)return;return"member_"+t},makeMpimDomId:function e(t){return"mpim_"+t.id},makeChannelListDomId:function e(t){return"channel_"+t.id+"_member_list"},makeFileDomId:function e(t){return"file_"+t.id},makeFileCommentsDomId:function e(t){return"file_comments_"+t.id},makeFileContentsDomId:function e(t){return"file_contents_"+t.id},makeUnreadMsgsDomId:function e(t){return"unread_msg_"+t.id},makeUnreadHighlightDomId:function e(t){if(!t)return;return"unread_highlight_"+t.id},makeMemberPresenceDomClass:function e(t){return"member_presence_"+t},makeMemberPresenceStateClass:function e(t){var n=TS.redux.presence.getPresenceByMemberId(t.id);TS.dnd.isMemberInDnd(t)&&(n+=" dnd");return n},makeMemberPresenceStateAriaLabel:function e(t){var n=TS.redux.presence.getPresenceByMemberId(t.id);var r="";"active"===n?r+="active":"away"===n&&(r+="away");TS.dnd.isMemberInDnd(t)&&(r+=", do not disturb");return r},makeMemberPresenceIcon:function e(t){if(t.deleted)return"";var n=TS.templates.makeMemberPresenceDomClass(t.id);var r="ts_icon_presence";var i=TS.redux.presence.getPresenceByMemberId(t.id);var a="active"===i?TS.interop.i18n.t("active","templates_helpers")():TS.interop.i18n.t("away","templates_helpers")();if(t.is_ultra_restricted){n+=" ura";r="ts_icon_presence_ura"}else if(t.is_restricted){n+=" ra";r="ts_icon_presence_ra"}else if(TS.interop.members.isExternal(t)){n+=" external";r="ts_icon_presence_external"}else t.is_slackbot&&(r="ts_icon_heart");var s='<i aria-hidden="true" class="ts_icon '+r+' presence_icon"></i>';var o=TS.templates.makeMemberPresenceStateClass(t);var l='<span data-member-presence="'+t.id+'" class="presence '+o+" "+n+'" title="'+a+'">'+s+"</span>";return l},makeMemberStatusDomClass:function e(t){return"member_status_"+t},memberUserColorChanged:function e(t){var n="color_"+t.id;if(t.color==t.member_color){var r="color_rule_"+n;var i=$("#"+r);i.remove();return}TS.templates.makeUserColorRule(t)},makeUserColorRule:function e(t){var n="color_"+t.id;var r="#"+_.escape(t.member_color);var i;i=TS.client?"\t\t\t\t."+n+":not(.nuc), \t\t\t\t#col_channels ul li:not(.active):not(.away) > ."+n+":not(.nuc) {\t\t\t\t\tcolor:"+r+";\t\t\t\t}\t\t\t":"\t\t\t\t."+n+":not(.nuc) {\t\t\t\t\tcolor:"+r+";\t\t\t\t}\t\t\t";var a="color_rule_"+n;var s=$("#"+a);s.length?s.text(i):$('<style type="text/css" id="'+a+'">'+i+"</style>").appendTo("body")},sidebarBehaviorPrefChanged:function e(){TS.templates.makeSidebarBehaviorRule()},makeSidebarBehaviorRule:function e(){var t;var n="sidebar_behavior";var r=$("#"+n);"hide_read_channels"===TS.prefs.getPref("sidebar_behavior")?t="\t\t\t\t.channels_list_holder ul li:not(.unread):not(.active):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}":"hide_read_channels_unless_starred"===TS.prefs.getPref("sidebar_behavior")&&(t="\t\t\t\t.channels_list_holder div:not(#starred_div)>ul li:not(.unread):not(.active):not(.is_starred):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}");t?r.length?r.text(t):$('<style type="text/css" id="'+n+'">'+t+"</style>").appendTo("head"):$("#"+n).remove()},makeMsgDomIdInConversation:function e(t){return TS.templates.makeMsgDomId(t)+"_conversation"},makeMsgDomIdInSearch:function e(t,n){return TS.templates.makeMsgDomId(t)+"_"+TS.templates.makeMSRDomId(n)},makeMsgDomIdInSearchTopResults:function e(t,n,r){return TS.templates.makeMsgDomId(t)+"_"+TS.templates.makeMSRDomId(n)+"_"+r},makeMsgDomIdInUnreadView:function e(t){return TS.templates.makeMsgDomId(t)+"_unread_view"},makeMsgDomIdInThreadsView:function e(t){return TS.templates.makeMsgDomId(t)+"_threads_view"},promiseToRenderAsync:function e(t,n){if(!t)return Promise.reject(new Error("No template to render"));return Promise.resolve(n).then(function(e){return t(e)})}});var e=function e(){var t;var n;var r;var i;$(".member_image").each(function(){i=$(this);t=i.data("member-id");n=i.data("thumb-size");r=!i.is("a");t&&n&&$(this).replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(t,n,false,r))});i=null};var t=/{{\s*i18n_ns\s*('|")[a-zA-Z0-9]+('|")\s*}}/;var n=function e(){Object.keys(TS.raw_templates).forEach(function(e){TS.templates[e]=r(e,TS.raw_templates[e]);Handlebars.registerPartial(e,TS.templates[e])});delete TS.raw_templates};var r=function e(n,r){if(!r){TS.warn(n+" was passed no html");return null}t.test(r)&&(r+=" {{_i18n_ns_end}}");var i=Handlebars.compile(r);return function(e){e=e||{};return i(e)}}})()},11238:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("templates.builders",{debug_items:{},debug_items_index:0,buildStarComponents:function e(n,r,i,a){return t(n,r,i,a)},fileHTML:function e(t,n){n=n||{};var r=TS.utility.members.getEntityFromFile(t);var i=TS.files.getFileActions(t);var a;var s="hosted"===t.mode||"external"===t.mode;var o={member:r,file:t,for_search:n.for_search,is_enterprise:n.is_enterprise,for_files_list:!n.for_share_dialog,show_channel_name:n.show_channel_name,icon_class:TS.utility.getImageIconClass(t,"thumb_80"),is_email:"email"===t.mode,is_space:"space"===t.mode,is_post:"post"===t.mode,is_arugula:"docs"===t.mode,is_snippet:"snippet"===t.mode,is_hosted_or_external:s,has_image:s&&t.thumb_80&&!t.has_rich_preview,can_share:!!i.share};TS.client&&(o.info_pane_visible="details"===TS.model.ui_state.flex_name);o.supports_line_clamp=TS.environment.supports_line_clamp;"external"===t.mode&&(o.external_filetype_html=TS.templates.builders.makeExternalFiletypeHTML(t));if("email"===t.mode){o.to_more_count=t.to.length-1;o.cc_more_count=t.cc.length-1}a=TS.templates.file_list_item(o);return a},buildReplyBarHTML:function e(t,n){var r={msg:t,model_ob:n,conversation_permalink:TS.utility.msgs.constructConversationPermalink(n,t.thread_ts)};var i=t.replies;if(t.reply_users){r.num_replies=t.reply_count;r.first_repliers=_.chain(t.reply_users).take(5).map(function(e){return TS.redux.members.getPotentiallyUnknownMemberById(e)}).compact().value();r.additional_reply_count=t.reply_users_count-r.first_repliers.length}else if(i&&i.length){r.num_replies=i.length;var a=_.chain(i).uniqBy("user").map(function(e){return TS.redux.members.getPotentiallyUnknownMemberById(e.user)}).compact().value();r.first_repliers=_.take(a,5);r.additional_reply_count=a.length-r.first_repliers.length}if(r.num_replies){var s=t.latest_reply?t.latest_reply:i&&i.length&&_.last(i).ts;var o=TS.interop.datetime.toDateObject(s);TS.interop.datetime.isSameDay(o,new Date)?1===r.num_replies?r.last_reply_at=TS.interop.i18n.t("Today at {time}","threads")({time:TS.interop.datetime.toTime(s,{do24hrTime:TS.utility.date.do24hrTime()})}):r.last_reply_at=TS.interop.i18n.t("Last reply today at {time}","threads")({time:TS.interop.datetime.toTime(s,{do24hrTime:TS.utility.date.do24hrTime()})}):1===r.num_replies?r.last_reply_at=TS.interop.datetime.toTimeAgo(s):r.last_reply_at=TS.interop.i18n.t("Last reply {time_ago}","threads")({time_ago:TS.interop.datetime.toTimeAgo(s)})}return TS.templates.message_reply_bar(r)},formatSoundUrl:function e(t,n){return""},buildAttachmentActions:function e(t,n,r){var i=t.actions.map(function(e){switch(e.type){case"button":return TS.templates.builders.buildAttachmentActionButtonHTML(e,r);case"select":return TS.templates.builders.buildAttachmentActionSelectHTML(e,r,n,t.id);default:break}return});var a=i.join("");return a},buildAttachmentHTML:function e(t){var n=t.msg_dom_id||TS.templates.makeMsgDomId(t.msg.ts);var r=t.attachment;var i=t.model_ob||TS.shared.legacyGetActiveModelOb();if(TS.templates.builders.shouldDoSimpleAttachment(r,t.msg)){if(r.video_html)return TS.templates.builders.buildInlineVideoTogglerAndDiv(r.from_url,n);if(r.image_url)return TS.templates.builders.buildInlineImgTogglerAndDiv(r.from_url,n,t);if(r.audio_url)return" "+TS.templates.builders.formatSoundUrl(r,t.msg)}if(r.color){"number"===typeof r.color&&(r.color=r.color.toString());if(r.color.indexOf)r.color=r.color.replace(/#/g,"");else{TS.warn("msg "+t.msg.ts+" has an invalid (non string) color:"+r.color+" (removed in client)");delete r.color}}var a=[];var s=[];if(r.fields){var o;var l;var u;for(var d=0;d<r.fields.length;d+=1){l=true;o=r.fields[d];u&&o.short&&u.short&&u._new_row&&(l=false);o._new_row=l;u=o;o.short?a.push(o):s.push(o)}}var c=!r._always_expand&&r._short_text&&!TS.inline_attachments.shouldExpandText(TS.templates.makeMsgAttachmentTextExpanderDomId(t.msg.ts,r._index));var m=!!r.more;var f=r.from_url||r.ts_link||r.title_link||r.author_link;var p="reply_broadcast"===_.get(t.msg,"subtype");var h=r.thumb_link||f;var g=false;i?false!==t.can_delete&&(g=(r.id||0===r.id)&&(r.from_url||t.msg.text)&&(TS.model.user.is_admin&&!i.is_im||TS.model.user.id==t.msg.user)&&"pinned_item"!==t.msg.subtype&&!p):TS.warn("need to get model_ob passed in here somehow! for expanding messages in activity feed");var S=r.thumb_url&&!r.image_url&&!r.video_html&&!r.audio_html;var T=S?r.proxied_thumb_url||r.thumb_url:null;var v=false;var b="";if(r.is_msg_unfurl){var y=TS.utility.msgs.getMsg(r.ts,i.msgs);if(y&&y.pinned_to&&y.pinned_to.length>0){v=_.some(y.pinned_to,function(e){return e===i.id});v&&!p&&(b=TS.templates.builders.buildPinInfoHtml(y))}}var w=false;p&&(w=r.ts?TS.interop.datetime.toTime(r.ts,{do24hrTime:TS.utility.date.do24hrTime()}):TS.interop.datetime.toTime(t.msg.ts,{do24hrTime:TS.utility.date.do24hrTime()}));var k=r.from_url&&t.has_container;p&&(k=true);var x={is_text_collapsed:c,has_more:m,attachment:r,attachment_meta:w,pin_html:b,short_fields:a,long_fields:s,msg:t.msg,msg_dom_id:n,real_src:TS.utility.attachments.getMediaSource(r),is_standalone:!t.msg.text||t.msg.ignore_if_attachments_supported||!r.pretext,show_fields_table:"0"!=TS.qs_args.show_fields_table,can_delete:g,thumb_link:h,small_thumb_url:T,show_fallback:TS.model.show_attachment_fallback,enable_slack_action_links:true===t.enable_slack_action_links};if(!t.from_post){var C="web"===TS.boot_data.app||true!==t.enable_slack_action_links;var M;C&&(M="web"===TS.boot_data.app?"ARCHIVES":TS.shared.legacyGetActiveModelOb().is_channel&&!TS.shared.legacyGetActiveModelOb().is_member?"CHANNEL_PREVIEW":"OTHER");x=_.assign(x,{attachment:r,has_actions:!!(!_.isEmpty(r.actions)||!_.isEmpty(r.legacy_actions)),has_source:_.some(r._source),has_border:t.has_border,has_indent:r.indent,has_container:t.has_container,has_media:t.show_media_caret,has_text_content:!!(r.text||r.title),has_thumb:!!S,has_footer:!!(r.footer||r.footer_icon||r.ts||r._attribution)&&!p,disable_actions:C,disable_actions_reason:M,border_color:r.color&&"#"+r.color||null,break_border:t.break_border,caret_location:TS.utility.attachments.getMediaCaretLocation(r)});x.applied_classes=TS.utility.getAppliedClasses({inline_attachment:true,standalone:x.is_standalone,has_thumb:x.has_thumb,can_delete:x.can_delete,clickable:k,message_unfurl:r._unfurl_type_message,reply_broadcast:p,is_pinned:v});if(r.callback_id){var I=TS.attachment_actions.client_buttons.fetchClientButtonData(t.msg);if(I){x.client_buttons=TS.attachment_actions.client_buttons.generateActions(I,r);x.has_text_content=!x.client_buttons.actions}}if(x.has_footer&&x.attachment.is_msg_unfurl){var A=TS.utility.attachments.getSlackMessageFooterText(x.attachment,x.msg);A&&(x.attachment.footer=A)}return TS.templates.message_attachment(x)}var E=true;var P="";if(t.show_initial_caret||t.show_media_caret){var F=TS.utility.attachments.getMediaType(r);switch(F){case"video":var O=TS.model.inline_videos[r.from_url||r.thumb_url];if(O){var D=true;P=TS.templates.builders.buildInlineVideoToggler(r.from_url||r.thumb_url,n,D);E=TS.inline_videos.shouldExpand(n,O)}break;case"audio":var $=TS.model.inline_audios[r.audio_html||r.audio_url];if($){P=TS.templates.builders.buildInlineAudioToggler(r.audio_html||r.audio_url,n);E=TS.inline_audios.shouldExpand(n,$)}break;case"other":var H=TS.model.inline_others[r.other_html];if(H){P=TS.templates.builders.buildInlineOtherToggler(r.other_html,n);E=TS.inline_others.shouldExpand(n,H)}break;case"image":var B=TS.model.inline_imgs[r.from_url||r.image_url];if(B){var j=!t.show_media_caret;P=TS.templates.builders.buildInlineImgToggler(r.from_url||r.image_url,n,j);E=TS.inline_imgs.shouldExpand(n,B)}break;default:var R=TS.model.inline_attachments[r.from_url];if(R){P=TS.templates.builders.buildInlineAttachmentToggler(r.from_url,n);E=TS.inline_attachments.shouldExpand(n,R)}else TS.warn("no inline_attachment for "+r.from_url);break}}_.assign(x,{initial_caret_html:t.show_initial_caret?new Handlebars.SafeString(P):"",media_caret_html:t.show_media_caret?new Handlebars.SafeString(P):"",expand_media:!t.show_media_caret||E,expand_it:!t.show_initial_caret||E,bg_color:r.color||"e3e4e6",thumb_at_top:!window.attach_thumb_align_title,ts_link:f,small_thumb:S,max_width_class:S?"right_thumb_max_w":"",show_action_links:true===t.enable_slack_action_links,has_content:t.has_content});return TS.templates.spaces_attachment(x)},buildAttachmentActionButtonHTML:function e(t,n){n=true===n;var r={_disabled:n,_loading:false,id:"",name:"",style:"default",text:"",value:""};var i={default:"",primary:"btn_primary",danger:"btn_danger"};var a=t.clicked&&t.clicked_text?t.clicked_text:t.text;var s=TS.emoji.graphicReplace(a);var o=_.merge({},r,t,{btn_class:i[t.style],current_text:a,formatted_text:new Handlebars.SafeString(s)});o.data_qa_value="button-"+o.name.replace("_","-");return TS.templates.attachment_actions_button(o)},buildAttachmentActionSelectHTML:function e(t,n,r,i){var a=TS.attachment_actions.select.getActionModel(t,n);if(a._disabled){var s='ts-message[data-ts="'+r+'"]';var o='[data-attachment-id="'+i+'"]';var l='[data-action-id="'+t.id+'"]';var u=[s,o,l].join(" ");var d=$(u).next(".lazy_filter_select");if(!d.length)return"";var c=d.clone().addClass("disabled");return c[0].outerHTML}return TS.templates.attachment_actions_select(a)},shouldDoSimpleAttachment:function e(t,n){var r=false;if(n.standalone_attachment)return false;if((t.image_url||t.audio_url)&&t.from_url){if(n&&n.text){-1!=n.text.indexOf(t.from_url)&&(r=true);TS.model.ampersands_are_inconsistent_in_from_urls&&-1!=n.text.indexOf(t.from_url.replace(/&/g,"&amp;"))&&(r=true)}(t.service_name||t.title)&&(r=false)}return r},formatAttachments:function e(t,n,r,i){if(!t.attachments)return"";var a="";var s;var o=[];var l;var u=t.attachments.length;var d=20;if(t.attachments.length>=d){t._shown_attachments||(t._shown_attachments=d);u=t._shown_attachments}for(s=0;s<u;s+=1){l=t.attachments[s];(l.pretext||0===s)&&o.push([]);_.last(o).push(l)}for(s=0;s<o.length;s+=1)a+=TS.templates.builders.formatAttachmentGroup(o[s],t,r,i,n);t._shown_attachments<t.attachments.length&&(a+=TS.templates.builders.getShowMoreAttachmentHTML(t));return a},formatAttachmentGroup:function e(t,n,r,i,a){r=true===r;var s="";var o=false;t=t.map(function(e){return TS.utility.attachments.getDecoratedAttachment(e,n)});var l=n&&"reply_broadcast"===n.subtype;l&&(o=true);var u=o&&_.some(t,TS.utility.attachments.getMediaType);var d=!o||_.some(t,"color");var c=_.some(t,"from_url");var m=_.some(t,"indent");var f=false;if(l){var p=n.channel_id||_.get(t[1],"channel_id");var h=n.broadcast_thread_ts;if((!p||!/\d+\.\d+/.test(h))&&t[1]&&t[1].from_url){var g=t[1].from_url;var S=TS.interop.url.urlQueryStringParse(g);S.cid&&(p=S.cid);S.thread_ts&&(h=S.thread_ts)}a=TS.redux.channels.getEntityById(p);if(a&&h){h.indexOf(".")<0&&(h=h.substr(0,10)+"."+h.substr(10));var T={thread_ts:h,model_ob_id:a.id,convo_href:TS.utility.msgs.constructConversationPermalink(a,h)};f=TS.templates.reply_broadcast_preamble(T);f=new Handlebars.SafeString(f)}}var v;for(var b=0;b<t.length;b+=1){v=t[b];if(!v){TS.info("formatAttachments bad attach");TS.dir(0,n);continue}if(v.from_url&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(v,n))){s+="";continue}v.ts&&(v.ts_link=TS.utility.msgs.constructMsgPermalink(a,v.ts.toString()));if(!TS.inline_attachments.legacyShouldShow(v,n)){s+="";continue}if(v.actions&&v.actions.length){var y=["button","select"];var w;var k=[];var x=[];for(var C=0;C<v.actions.length;C+=1){w=v.actions[C];_.includes(y,w.type)?x.push(w):k.push(w)}k.length&&(v.legacy_actions=k);x.length&&(v.actions=x)}var M=TS.utility.attachments.hasContent(v,["pretext"]);if(M){var I=t[b+1];s+=TS.templates.builders.buildAttachmentHTML({model_ob:a,attachment:v,has_border:d,has_indent:m,has_container:o,break_border:d&&I&&v.color!=I.color,url:null,msg:n,msg_dom_id:i,show_initial_caret:TS.templates.builders.shouldDoSimpleAttachment(v,n),show_media_caret:v.video_html||v.image_url||v.audio_html||v.audio_url||v.other_html,enable_slack_action_links:r,has_content:M})}l&&0===b&&(s+=TS.templates.reply_broadcast_count(v))}if(s||v.pretext)return TS.templates.attachment_group({model_ob:a,first_attachment:t[0],preamble:f,msg:n,has_border:d,has_indent:m,has_container:o,has_link:c,use_shrink_wrap:u,attachments_html:s&&new Handlebars.SafeString(s),enable_slack_action_links:r});return s},getShowMoreAttachmentHTML:function e(t){var n=t.attachments.length-t._shown_attachments;var r="";var i=t.ts;var a=TS.shared.legacyGetActiveModelOb();var s=false;if(!TS.client||a.is_channel&&!a.is_member)r=TS.interop.i18n.t("{count, plural, =1 {# more attachment} other {# more attachments}}","attachments")({count:n});else{s=true;r=t.attachments.length-t._shown_attachments>20?TS.interop.i18n.t("Show next 20 items","attachments")():TS.interop.i18n.t("{count, plural, =1 {Show remaining # item} other {Show remaining # items}}","attachments")({count:n})}return TS.templates.show_more_attachment({ts:i,btn_text:r,clickable_show_more_link:s})},formatMessageAsAttachment:function e(t,n){var r;var i;var a;t.user?i=t.user:"file_comment"===t.subtype&&t.comment&&t.comment.user?i=t.comment.user:t.bot_id&&(a=t.bot_id);if(!t.text&&t.attachments&&t.attachments.length>=1&&t.attachments[0].is_share)r={author_name:t.attachments[0].author_name,author_subname:t.attachments[0].author_subname,author_icon:t.attachments[0].author_icon,author_link:t.attachments[0].author_link};else if(i){var s=TS.interop.members.getMemberById(i);r={};r.author_name=TS.interop.members.getPrefCompliantMemberName(s);s.profile&&(r.author_icon=s.profile.image_24);r.author_link="/team/"+i}else if(a){var o=TS.redux.bots.getBotByMsg(t);r={author_subname:t.username||o.name,author_icon:o&&o.icons&&o.icons.image_48,author_link:"/services/"+a};t.icons&&t.icons.emoji&&t.icons.image_64&&(r.author_icon=t.icons.image_64)}if(!r){TS.error("no author for msg "+t.ts);return""}var l=_.extend({},r,{is_msg_unfurl:true,id:1,ts:t.ts,from_url:TS.utility.msgs.constructAbsoluteMsgPermalink(n,t.ts),msg_subtype:t.subtype});if(t.text){l.text=t.text;l.mrkdwn_in_hash={text:true}}else if(t.attachments&&t.attachments.length>=1){var u=t.attachments[0];l.text=u.text||u.pretext}TS.inline_attachments.massageAttachment(l,0);l=TS.utility.attachments.getDecoratedAttachment(l,t);var d=TS.templates.builders.buildAttachmentHTML({attachment:l,msg:t,can_delete:false,has_content:true,has_border:true});d=TS.templates.attachment_group({msg:t,attachments_html:new Handlebars.SafeString(d)});return d},getMemberCurrentStatusForDisplay:function e(t,n){var r=TS.interop.members.getMemberCurrentStatus(t,TS.team.getTeamCustomStatusPresets(),TS.boot_data.feature_i18n_custom_status);var i="";r.text&&(i+='<span class="prevent_copy_paste" aria-label=" "></span>'+TS.format.formatCurrentStatus(r.text,void 0,n));var a=TS.format.formatCurrentStatus(r.emoji,void 0,_.assign({transform_missing_emoji:true},n));return a+i},buildSHRoomAttachment:function e(t){var n=t.participants.map(function(e){return TS.redux.members.getPotentiallyUnknownMemberById(e)});var r=t.created_by===TS.model.user.id;var i=TS.model.active_im_id?TS.interop.members.getMemberById(TS.interop.channels.getImById(TS.model.active_im_id).user):null;var a=i?TS.interop.members.getPrefCompliantMemberName(i):"";var s=t.date_end?t.date_end-t.date_start:0;var o=TS.interop.i18n.t("Shared a call","calls")();t.channels&&t.channels[0]===TS.model.active_cid&&(o=TS.interop.i18n.t("Started a call","calls")());var l="";l=t.date_end?t.is_dm_call&&t.was_missed?t.was_rejected?r?TS.interop.i18n.t("{name} declined the call","calls")({name:a}):TS.interop.i18n.t("You declined the call","calls")():r?TS.interop.i18n.t("{name} missed the call","calls")({name:a}):TS.interop.i18n.t("You missed the call","calls")():TS.interop.i18n.t("This call has ended","calls")():t.is_dm_call?2===t.participants.length?TS.interop.i18n.t("On a call with {name}","calls")({name:a}):(r?TS.interop.i18n.t("Calling {name}","calls"):TS.interop.i18n.t("{name} is calling you","calls"))({name:a}):-1!=t.participants.indexOf(TS.model.user.id)?TS.interop.i18n.t("You are on this call","calls")():TS.interop.i18n.t("Join this call","calls")();var u;u=t.name?TS.interop.i18n.t("{room_name} call","calls")({room_name:t.name}):TS.interop.i18n.t("Untitled","calls")();return TS.templates.message_screenhero_attachment({room:t,participants:n,room_url:TS.utility.calls.getUrlForRoom(t),meta_room_name:_.escape(u),room_name:_.escape(t.name),title:o,description:l,show_description_ellipsis:2===t.participants.length,show_room_link:!t.date_end,expand_it:TS.inline_room_previews.shouldExpand(t.id),duration:s})},buildBotStr:function e(t,n){var r;r=TS.interop.utility.isModelObjectExternal(n)||TS.interop.rules.channels.isOrgShared(n)?t.bot_link?TS.interop.bots.getBotNameByBotLink(t.bot_link):TS.interop.bots.getBotNameByBotLink(t.text):TS.interop.bots.getBotNameById(t.bot_id);var i=_.escape(r);var a=TS.interop.i18n.safeString("<"+TS.boot_data.team_url+"services/"+t.bot_id+"/|"+i+">");switch(t.subtype){case"bot_add":return TS.interop.i18n.t("added an integration to this channel: {bot_url}","templates_builders")({bot_url:a});case"bot_enable":return TS.interop.i18n.t("enabled an integration in this channel: {bot_url}","templates_builders")({bot_url:a});case"bot_disable":return TS.interop.i18n.t("disabled an integration in this channel: {bot_url}","templates_builders")({bot_url:a});case"bot_remove":return TS.interop.i18n.t("removed an integration from this channel: {bot_url}","templates_builders")({bot_url:a});default:return TS.interop.i18n.t("updated an integration in this channel: {bot_url}","templates_builders")({bot_url:a})}},formatMessageByType:function e(t,n,r,i,a){var s="";var o;if(t.ignore_if_attachments_supported)return s;n=true===n;r=true===r;var l;var u;var d;var c;var m;var f;var p;var h;var g;var S;var T;var v;var b="TS.shared.legacyCloseArchivedChannel";if(t._jl_rollup_hash&&t.user in t._jl_rollup_hash.users){var y=false;var w=true;var k=function e(t){t=t.map(function(e){return e.id});var n=_.remove(t,function(e){return!TS.redux.members.isMemberKnown(e)});if(0===t.length)return[];var r;var i=100;if(t.length>i+1){var a=t.length-i+n.length;t=t.splice(0,i);r=TS.interop.i18n.t("{count, plural, =1 {# other} other {# others}}","joined_left")({count:a})}else n.length&&(r=TS.interop.i18n.t("{count, plural, =1 {# other} other {# others}}","joined_left")({count:n.length}));t=t.map(function(e){return TS.interop.members.getPrefCompliantMemberNameById(e,false,y)});r&&t.push(r);return t};var x=function e(t){var n=TS.interop.members.getPrefCompliantMemberNameById(t,w,y);return'<button type="button" class="btn_unstyle internal_member_link member_preview_link" data-member-id="'+t+'">'+n+"</button>"};var C;var M;var I;var A;var E;var P={joined:[],joined_left:[],left:[],left_rejoined:[]};for(var F in t._jl_rollup_hash.users)if(F!==t.user){A=t._jl_rollup_hash.users[F];var O={id:F,inviter:A.inviter};A.is_in?A.left&&A.joined?P.left_rejoined.push(O):P.joined.push(O):A.joined&&A.left?P.joined_left.push(O):P.left.push(O)}c=i.is_group||i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:"no_name";A=t._jl_rollup_hash.users[t.user];if(A.is_in)if(A.left&&A.joined)if(A.inviter){var D=P.left_rejoined.filter(function(e){return e.inviter===A.inviter});P.left_rejoined=P.left_rejoined.filter(function(e){return e.inviter===A.inviter});C=D.length?D[0].id:null;E=k(D);s=TS.interop.i18n.t('left and rejoined {channel_name, select, no_name {the channel} other {{channel_name}}} by invitation from {inviter}{count, plural, =0 {} =1 {, along with {user}} other {, along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:D.length,user:x(C),channel_name:c,inviter:x(A.inviter),others:TS.interop.i18n.listify(E).join(""),classes:E.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}else{C=P.left_rejoined.length?P.left_rejoined[0].id:null;E=k(P.left_rejoined);s=TS.interop.i18n.t('left and rejoined {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:P.left_rejoined.length,user:x(C),channel_name:c,others:TS.interop.i18n.listify(E).join(""),classes:E.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});P.joined_left=[]}else if(A.inviter){var $=P.joined.filter(function(e){return e.inviter===A.inviter});P.joined=P.joined.filter(function(e){return e.inviter!==A.inviter});C=$.length?$[0].id:null;E=k($);s=TS.interop.i18n.t('joined {channel_name, select, no_name {the channel} other {{channel_name}}} by invitation from {inviter}{count, plural, =0 {} =1 {, along with {user}} other {, along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:$.length,user:x(C),channel_name:c,inviter:x(A.inviter),others:TS.interop.i18n.listify(E).join(""),classes:E.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}else{C=P.joined.length?P.joined[0].id:null;E=k(P.joined);s=TS.interop.i18n.t('joined {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:P.joined.length,user:x(C),channel_name:c,others:TS.interop.i18n.listify(E).join(""),classes:E.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});P.joined=[]}else if(A.joined&&A.left){C=P.joined_left.length?P.joined_left[0].id:null;E=k(P.joined_left);s=TS.interop.i18n.t('joined and left {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:P.joined_left.length,user:x(C),channel_name:c,others:TS.interop.i18n.listify(E).join(""),classes:E.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});P.joined_left=[]}else{C=P.left.length?P.left[0].id:null;E=k(P.left);s=TS.interop.i18n.t('left {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:P.left.length,user:x(C),channel_name:c,others:TS.interop.i18n.listify(E).join(""),classes:E.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});P.left=[]}var H=true;if(P.left_rejoined.length){M=P.left_rejoined.shift().id;I=P.left_rejoined.length?P.left_rejoined[0].id:null;var B=H?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left and rejoined.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left and rejoined.',"joined_left");H=false;E=k(P.left_rejoined);s+=" ";s+=B({count:P.left_rejoined.length,userA:x(M),userB:x(I),others:TS.interop.i18n.listify(E).join(""),classes:E.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(P.joined.length){M=P.joined.shift().id;I=P.joined.length?P.joined[0].id:null;var j=H?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined.',"joined_left");H=false;E=k(P.joined);s+=" ";s+=j({count:P.joined.length,userA:x(M),userB:x(I),others:TS.interop.i18n.listify(E).join(""),classes:E.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(P.joined_left.length){M=P.joined_left.shift().id;I=P.joined_left.length?P.joined_left[0].id:null;var R=H?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined and left.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined and left.',"joined_left");H=false;E=k(P.joined_left);s+=" ";s+=R({count:P.joined_left.length,userA:x(M),userB:x(I),others:TS.interop.i18n.listify(E).join(""),classes:E.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(P.left.length){M=P.left.shift().id;I=P.left.length?P.left[0].id:null;var L=H?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left.',"joined_left");H=false;E=k(P.left);s+=" ";s+=L({count:P.left.length,userA:x(M),userB:x(I),others:TS.interop.i18n.listify(E).join(""),classes:E.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}}else if("channel_join"===t.subtype||"app_conversation_join"===t.subtype){u=TS.interop.members.getMemberById(t.inviter);C=TS.interop.members.getMemberById(t.user);c=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();if(u){m="<@"+u.id+"|"+u.name+">";o=TS.boot_data.feature_wta_client_support&&C&&C.is_app_user?TS.interop.i18n.t("was added to this conversation by {inviter}.","templates_builders")({inviter:m}):TS.interop.i18n.t("joined {channel_name} from an invitation by {inviter}","templates_builders")({channel_name:c,inviter:m});s=TS.format.formatNoHighlightsNoSpecials(o,t)}else s=TS.interop.i18n.t("joined {channel_name}","templates_builders")({channel_name:c})}else if("channel_leave"===t.subtype||"app_conversation_leave"===t.subtype){u=TS.interop.members.getMemberById(t.inviter);C=TS.interop.members.getMemberById(t.user);c=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();if(TS.boot_data.feature_wta_client_support&&u&&C&&C.is_app_user){m="<@"+u.id+"|"+u.name+">";o=TS.interop.i18n.t("was removed from this conversation by {inviter}.","templates_builders")({inviter:m});s=TS.format.formatNoHighlightsNoSpecials(o,t)}else s=TS.interop.i18n.t("left {channel_name}","templates_builders")({channel_name:c})}else if("channel_name"===t.subtype)s=TS.interop.i18n.t('renamed the channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:t.old_name,new_name:t.name});else if("channel_topic"===t.subtype)if(t.topic){p=_.unescape(t.topic);p=TS.format.formatWithOptions(t.topic,t,{no_highlights:true});s=TS.interop.i18n.t('set the channel topic: <span class="topic no_jumbomoji">{topic}</span>',"templates_builders")({topic:p})}else s=TS.interop.i18n.t("cleared the channel topic","templates_builders")();else if("channel_purpose"===t.subtype)if(t.purpose){h=_.unescape(t.purpose);h=TS.format.formatWithOptions(h,t,{no_highlights:true});s=TS.interop.i18n.t('set the channel purpose: <span class="purpose no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:h})}else s=TS.interop.i18n.t("cleared the channel purpose","templates_builders")();else if("group_join"===t.subtype){l=i;f=l?TS.model.group_prefix+l.name:TS.interop.i18n.t("the private channel","templates_builders")();u=TS.interop.members.getMemberById(t.inviter);if(u){m="<@"+u.id+"|"+u.name+">";o=TS.interop.i18n.t("joined {group_name} from an invitation by {inviter}","templates_builders")({group_name:f,inviter:m});s=TS.format.formatNoHighlightsNoSpecials(o,t)}else s=TS.interop.i18n.t("joined {group_name}","templates_builders")({group_name:f})}else if("group_leave"===t.subtype){l=i;f=l?TS.model.group_prefix+l.name:TS.interop.i18n.t("the private channel","templates_builders")();s=TS.interop.i18n.t("left {group_name}","templates_builders")({group_name:f})}else if("group_name"===t.subtype)s=TS.interop.i18n.t('renamed the private channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:t.old_name,new_name:t.name});else if("group_topic"===t.subtype)if(t.topic){p=TS.format.formatWithOptions(t.topic,t,{no_highlights:true});s=TS.interop.i18n.t('set the channel topic: <span class="no_jumbomoji">{topic}</span>',"templates_builders")({topic:p})}else s=TS.interop.i18n.t("cleared the channel topic","templates_builders")();else if("group_purpose"===t.subtype)if(t.purpose){h=TS.format.formatWithOptions(t.purpose,t,{no_highlights:true});s=TS.interop.i18n.t('set the channel purpose: <span class="no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:h})}else s=TS.interop.i18n.t("cleared the channel purpose","templates_builders")();else if("group_archive"===t.subtype){l=i;f=l?TS.model.group_prefix+l.name:TS.interop.i18n.t("the private channel","templates_builders")();g=TS.interop.i18n.safeString(_.escape(TS.redux.enterprise.getEnterpriseOrgName()));T=TS.interop.i18n.t("your workspace admin","templates_builders")();if(t.user){S=TS.interop.members.getMemberById(t.user);T=TS.format.formatNoHighlightsNoSpecials("<@"+S.id+"|"+S.name+">")}if(TS.client&&l&&l.is_archived)if(TS.model.archive_view_is_showing)s=1==l.is_moved?TS.interop.i18n.t("moved {group_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({group_name:f,enterprise_name:g,mover_name:T,name_for_url:l.id}):TS.interop.i18n.t("archived {group_name}. The contents will still be browsable and available in search.","templates_builders")({group_name:f,name_for_url:l.id});else{var N="'"+l.id+"'";s=1==l.is_moved?TS.interop.i18n.t("moved {group_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({group_name:f,enterprise_name:g,mover_name:T,name_for_url:l.id}):TS.interop.i18n.t('archived {group_name}. The contents will still be browsable and available in search. \t\t\t\t\t\t\tIt can also be un-archived at any time. To close it now, <a onclick="{method}({group_id})">click here</a>.',"templates_builders")({group_name:f,name_for_url:l.id,method:b,group_id:N})}else 1==l.is_moved?s=TS.interop.i18n.t("moved {group_name} to another {enterprise_name} workspace","templates_builders")({group_name:f,enterprise_name:g}):0==l.is_moved&&(s=TS.interop.i18n.t("archived {group_name}","templates_builders")({group_name:f}))}else if("group_unarchive"===t.subtype){l=i;f=l?TS.model.group_prefix+l.name:TS.interop.i18n.t("the private channel","templates_builders")();s=TS.interop.i18n.t("un-archived {group_name}","templates_builders")({group_name:f})}else if("channel_archive"===t.subtype){var U="'"+i.id+"'";c=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();g=TS.interop.i18n.safeString(_.escape(TS.redux.enterprise.getEnterpriseOrgName()));if(TS.client&&1==i.is_moved){if(t.user){S=TS.interop.members.getMemberById(t.user);T=TS.format.formatNoHighlightsNoSpecials("<@"+S.id+"|"+S.name+">")}s=TS.model.archive_view_is_showing?TS.interop.i18n.t("moved {channel_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({channel_name:c,enterprise_name:g,mover_name:T,name_for_url:i.id}):TS.interop.i18n.t('moved {channel_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search. \t\t\t\t\t\tTo close it now, <a onclick="{method}({channel_id})">click here</a>.',"templates_builders")({channel_name:c,enterprise_name:g,mover_name:T,name_for_url:i.id,channel_id:U,method:b})}else TS.client&&i?s=TS.model.archive_view_is_showing?TS.interop.i18n.t("archived {channel_name}. The contents will still be browsable and available in search.","templates_builders")({channel_name:c,name_for_url:i.id}):TS.interop.i18n.t('archived {channel_name}. The contents will still be browsable and available in search. \t\t\t\t\t\tIt can also be un-archived at any time. To close it now, <a onclick="{method}({channel_id})">click here</a>.',"templates_builders")({channel_name:c,name_for_url:i.id,channel_id:U,method:b}):i&&1==i.is_moved&&(s=TS.interop.i18n.t("moved {channel_name} to another {enterprise_name} workspace","templates_builders")({channel_name:c,enterprise_name:g}))}else if("channel_unarchive"===t.subtype){c=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();s=TS.interop.i18n.t("un-archived {channel_name}","templates_builders")({channel_name:c})}else if("me_message"===t.subtype)s="<i>"+TS.format.formatWithOptions(t.text,t,{do_inline_imgs:n})+"</i>";else if("play_sound"===t.subtype)s=TS.interop.i18n.t('played "{msg_sound}"',"templates_builders")({msg_sound:t.sound});else if("sh_room_shared"===t.subtype||"sh_room_created"===t.subtype){"sh_room_shared"===t.subtype;!a&&t._room_id&&(d=TS.rooms.getRoomById(t._room_id));a?s+="<span>"+TS.interop.i18n.t("Shared a call","templates_builders")()+"</span>":d&&(s+=TS.templates.builders.buildSHRoomAttachment(d))}else if("bot_add"===t.subtype||"bot_enable"===t.subtype||"bot_updated"===t.subtype||"bot_disable"===t.subtype||"bot_remove"===t.subtype){v=TS.templates.builders.buildBotStr(t,i);s=TS.format.formatWithOptions(v,t,{do_inline_imgs:n,enable_slack_action_links:r,no_highlights:true})}else s="reminder_add"===t.subtype||"reminder_delete"===t.subtype?TS.format.formatWithOptions(t.text,t,{do_inline_imgs:n,enable_slack_action_links:r,no_highlights:true}):TS.format.formatWithOptions(t.text,t,{do_inline_imgs:n,enable_slack_action_links:r});if(!s&&""!==s){TS.warn("no html msg.subtype:"+t.subtype);return""}s=TS.utility.msgs.handleSearchHighlights(s);return s},msgHtmlForSearch:function e(t,n,r,i,a,s,o){"bot_message"!==t.subtype&&(t.subtype=null);var l="";if("extract"===r){l+='<div class="search_result_with_extract '+("context"===i?"last_extract_message_in_group":"")+" "+("context"===a?"first_extract_message_in_group":"")+'">';l+='<div class="extract_expand_text">'+TS.interop.i18n.t("Expand","template_builders")()+"</div>";l+='<div class="extract_expand_icons blue"><i class="ts_icon ts_icon_chevron_up up_arrow"></i><i class="ts_icon ts_icon_chevron_down down_arrow"></i></div>'}else l+="context"===r?'<div class="search_result_for_context">':'<div class="search_result_for_extra_context">';l+=TS.templates.builders.msgs.buildHTML({msg:t,msg_dom_id:TS.templates.makeMsgDomIdInSearch(t.ts,s),model_ob:n,container_id:"search_message_results",standalone:true,for_search_display:true,search_result_type:r,prev_msg:o});l+="</div>";return l},msgHtmlForSearchTopResults:function e(t){"bot_message"!==t.subtype&&(t.subtype=null);var n=(!t.extracts||0==t.extracts.length)&&t.attachments;var r=TS.templates.builders.msgs.buildHTML({msg:t,msg_dom_id:TS.templates.makeMsgDomIdInSearchTopResults(t.ts,t,t.module_name),model_ob:t.channel,container_id:"search_message_results",standalone:true,for_top_results_search_display:true,no_attachments:!n});return r},buildMsgHTMLForSearchTopResults:function e(t){return TS.templates.builders.msgHtmlForSearchTopResults(t)},buildMsgHTMLForSearch:function e(t){var n=t.channel;var r="";var i=[];t.previous_2&&i.push(t.previous_2);t.previous&&i.push(t.previous);i.push(t);t.next&&i.push(t.next);t.next_2&&i.push(t.next_2);if(i.length>1&&!TS.search.view.resultHasExtracts(t)){t.force_extract_type="extract";t.previous&&(t.previous.force_extract_type="context");t.next&&(t.next.force_extract_type="context")}var a;i.forEach(function(e,s){var o;o=e.force_extract_type?e.force_extract_type:TS.search.view.determineMessageResultType(i,s);var l=i[s-1]?TS.search.view.determineMessageResultType(i,s-1):null;var u=i[s+1]?TS.search.view.determineMessageResultType(i,s+1):null;!e.permalink&&t.permalink&&"extract"!==o&&(e.permalink=t.permalink);!e.team&&t.team&&(e.team=t.team);!e.channel&&t.channel&&(e.channel=t.channel);r+=TS.templates.builders.msgHtmlForSearch(e,n,o,u,l,t,a,s);a=e});return r},search_ellipsis:'<span class="extract_ellipsis">&hellip;</span>',buildStar:function e(n,r,i){var a=t(n,r,i);if(!_.isObject(a))return{};return TS.templates.star(a)},buildStarWithTip:function e(n,r,i){var a=t(n,r,i);if(!_.isObject(a))return{};return TS.templates.star_with_tip(a)},buildMentionHTML:function e(t){var n=t.message;var r="";if(!n)return r;if(("file_share"===n.subtype||"file_mention"===n.subtype||"file_comment"===n.subtype||"file_reaction"===n.subtype)&&!n.file)return r;var i=TS.redux.channels.getEntityById(t.channel);if(!i)return r;var a;var s=4;var o=[];var l="";var u="";var d="";var c="reaction"===t.type;u=TS.templates.builders.strBuilder('<button type="button" class="btn_link msg_right_link msg_jump" data-cid="${cid}">'+TS.interop.i18n.t("Jump","templates_builders")()+"</button>",{cid:i.id});d=TS.templates.builders.msgs.buildHTML({msg:n,model_ob:i,standalone:true,jump_link:u,no_attachments:!!n.text,for_mention_display:true,for_mention_rxn_display:c});r=d;if(c){var _=TS.rxns.getRxnKeyByMsgType(n);a=TS.rxns.getExistingRxnsByKey(_);if(!a)return"";var m=a[a.length-1];var f=m.users[m.users.length-1];if(!TS.rxns.getRxnFromRxns(a,m.name))return"";var p=TS.redux.members.getPotentiallyUnknownMemberById(f);var h=TS.rxns.getAllUniqueRxners(a,f);var g=h.length+1;var S="file_reaction"===n.subtype;var T;if(2==g){var v=TS.redux.members.getPotentiallyUnknownMemberById(h[0]);T=p.is_self?S?TS.interop.i18n.t('<span class="mention_rxn_summary_members">You & {another_user}</span> reacted to your file.',"rxn"):TS.interop.i18n.t('<span class="mention_rxn_summary_members">You & {another_user}</span> reacted to your message.',"rxn"):v.is_self?S?TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & you</span> reacted to your file.',"rxn"):TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & you</span> reacted to your message.',"rxn"):S?TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & {another_user}</span> reacted to your file.',"rxn"):TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & {another_user}</span> reacted to your message.',"rxn");l=T({user:TS.templates.builders.makeMemberPreviewLink(p,true),another_user:TS.templates.builders.makeMemberPreviewLink(v)})}else if(g>2){var b=false;var y=false;var w=h.map(function(e){return TS.interop.members.getPrefCompliantMemberNameById(e,b,y)});var k=g-1;T=S?TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & <span class="ts_tip ts_tip_float ts_tip_multiline ts_tip_lazy ts_tip_top" title="{names}">{count, plural, =1 {# other} other {# others}}</span></span> reacted to your file.',"rxn"):TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user} & <span class="ts_tip ts_tip_float ts_tip_multiline ts_tip_lazy ts_tip_top" title="{names}">{count, plural, =1 {# other} other {# others}}</span></span> reacted to your message.',"rxn");l=T({user:TS.templates.builders.makeMemberPreviewLink(p,true),names:TS.interop.i18n.listify(w).join(""),count:k})}else{T=S?TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user}</span> reacted to your file.',"rxn"):TS.interop.i18n.t('<span class="mention_rxn_summary_members">{user}</span> reacted to your message.',"rxn");l=T({user:TS.interop.i18n.safeString(TS.templates.builders.makeMemberPreviewLink(p,true))})}o=a.filter(function(e){return TS.emoji.isValidName(e.name)}).slice(0,s).map(function(e){return new Handlebars.SafeString(TS.emoji.graphicReplace(":"+e.name+":"))});var x={ts:n.ts,rxns_to_display:o,msg_html:new Handlebars.SafeString(d),rxn_members:new Handlebars.SafeString(l),jump_link_html:new Handlebars.SafeString(u),is_file_reaction:S};n.thread_ts&&(x.thread_ts=n.thread_ts);r=TS.templates.mentions_rxn(x)}return r},buildMentions:function e(){TS.mentions.weaveInRxnRecords();var t="";var n=null;var r=TS.mentions.getAllMentions();if(!r||!r.length)return t;$.each(r,function(e,r){var i;try{i=TS.templates.builders.buildMentionHTML(r)}catch(e){TS.error("Problem building mention html for "+r.message.ts+" in "+r.channel);TS.error(e)}if(!i)return;var a="";var s=TS.redux.channels.getEntityById(r.channel);var o=r.message;var l=!n;n&&!TS.interop.datetime.isSameDay(TS.interop.datetime.toDateObject(n.rxn_ts||n.message.ts),TS.interop.datetime.toDateObject(r.rxn_ts||o.ts))&&(l=true);if(l){n&&(a="</div>");a+='<div class="mention_day_container_div">'+TS.templates.messages_day_divider({ts:r.rxn_ts||o.ts})}var u=n&&n.channel;s&&(s.is_channel||s.is_mpim||s.is_group)&&(u!=s.id||l)&&(a+=TS.templates.mentions_item({model_ob:s}));t+=a+i;n=r});t&&(t+="</div>");return t},buildStarredItemHTML:function e(t){var n="<div class='star_item'>";var r={star:t,current_user_id:TS.model.user.id};var i;if("message"===t.type){var a=t.message;var s=false;i=TS.redux.channels.getEntityById(t.channel);if(!i){TS.warn("channel "+t.channel+" for this starred message was probably deleted");return""}if(i.is_im){var o=TS.interop.members.getMemberById(i.user);t.message.recipient=o;TS.interop.channels.isImWithDeletedMember(i.id)&&(s=true)}var l="";s||(l=TS.templates.builders.strBuilder('<button type="button" class="btn_unstyle star_jump msg_right_link btn btn_outline" data-cid="${cid}">'+TS.interop.i18n.t("Jump","templates_builders")()+"</button>",{cid:i.id}));n+=TS.templates.builders.msgs.buildHTML({msg:a,model_ob:i,standalone:true,starred_items_list:true,starred_items_actions:true,jump_link:l,no_attachments:!!a.text,full_date:true})}else if("file"===t.type)n+=TS.templates.builders.fileHTML(t.file);else if("channel"===t.type||"group"===t.type){i=TS.redux.channels.getEntityById(t.channel);if(!i){TS.warn("channel or group "+t.channel+" was probably deleted");return""}r.model_ob=i;n+=TS.templates.star_item(r)}else{r.from_starred_item=true;n+=TS.templates.star_item(r)}n+="</div>";return n},buildPinInfoHtml:function e(t){var n={};var r=TS.interop.channels.getChannelPinnedItemByMessage({message:t,channel:TS.shared.legacyGetActiveModelOb()});var i={};if(r.createdBy&&r.createdTs){i=TS.redux.members.getPotentiallyUnknownMemberById(r.createdBy);n.user=i;n.ts=r.createdTs;n.complete_data=n.user&&n.ts}else n.complete_data=false;n.unknown_member_token=new Handlebars.SafeString(TS.templates.unknown_member({id:i.id}));var a=TS.templates.pinned_message_info(n);return new Handlebars.SafeString(a)},buildHighlightsInfoHtml:function e(t){var n=TS.templates.highlights_message_info(t);return new Handlebars.SafeString(n)},buildInlineImgTogglerAndDiv:function e(t,n,r){var i=TS.model.inline_imgs[t];if(!i)return"";return TS.templates.builders.buildInlineImgToggler(t,n)+" "+TS.templates.builders.buildInlineImgDiv(t,n,r)},buildInlineImgToggler:function e(t,n,r,i){var a=TS.model.inline_imgs[t];if(!a){TS.warn(8675309,"buildInlineImgToggler did not find anything in TS.model.inline_imgs for key:"+t);return""}var s=TS.inline_imgs.shouldExpand(n,a,i);var o=a.link_url||t;var l=a.bytes&&a.bytes>TS.model.inline_img_byte_limit;var u=a.width&&a.height&&a.width*a.height>TS.model.inline_img_pixel_limit;var d=!u;var c="";var m="";if(!s&&(!TS.prefs.getPref("obey_inline_img_limit")||l)||u){var f=!a.internal_file_id&&TS.prefs.getPref("expand_inline_imgs")&&false!==TS.model.expandable_state["img_"+n+a.src];if(f&&u){d=false;m=TS.interop.i18n.t("(Not automatically expanded because {img_width}x{img_height} is too large to display inline.)","templates_builders")({img_width:a.width,img_height:a.height});c='<span class="too_large_for_auto_expand"> '+m+"</span>"}else if(f&&l){var p=TS.interop.i18n.t("Open original in new tab","templates_builders")();var h="<a "+TS.utility.makeRefererSafeLink(o)+' target="_blank" title="'+p+'">';if(TS.model.show_inline_img_size_pref_reminder&&!TS.model.shown_inline_img_size_pref_reminder_once){m=TS.interop.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>. \t\t\t\t\t\tYou can also <a class="cursor_pointer" onclick="TS.ui.prefs_dialog.start(\'messages_media\', \'#prefs_inline_media\')">change your preferences</a> to allow images of any file size to auto expand.)',"templates_builders")({file_size:TS.interop.utility.convertFilesize(a.bytes),real_src:TS.interop.i18n.safeString(_.escape(a.src)),referer_link_a_tag:h});TS.model.shown_inline_img_size_pref_reminder_once=true}else m=TS.interop.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>.)',"templates_builders")({file_size:TS.interop.utility.convertFilesize(a.bytes),real_src:TS.interop.i18n.safeString(_.escape(a.src)),referer_link_a_tag:h});c='<span class="too_large_for_auto_expand"> '+m+"</span>"}}var g=a.bytes&&true!==r?'<span class="inline_img_bytes '+(c?"hidden":"")+'"> ('+TS.interop.utility.convertFilesize(a.bytes)+")</span>":"";var S={collapser_class:"msg_inline_img_collapser",expander_class:"msg_inline_img_expander",real_src:a.src,expand_it:s};var T=TS.templates.inline_attachment_toggler({inline_attachment:S});return g+c+(d?T:"")},buildInlineImgDiv:function e(t,n,r){r=r||{};var i=TS.model.inline_imgs[t];if(!i)return"";var a=TS.inline_imgs.shouldExpand(n,i,r);var s=i.link_url||t;var o=!r.flush_with_attachment&&i.width>0&&i.height>0;var l;i.internal_file_id&&(l=TS.files.getFileById(i.internal_file_id));var u="";var d="clear_both msg_inline_img_holder msg_inline_holder";a||(d+=" hidden");var c=i.height<50;var m=i.width<200;var f=m||c;if(f){d+=" overflow_preview_actions";m&&(d+=" overflow_preview_actions_width")}l&&(d+=" file_container");d+=" msg_inline_holder_rounded";o||(d+=" file_container_fixed_dimensions");u+='<div data-real-src="'+_.escape(i.src)+'" class="'+d+'" ';i.internal_file_id&&(u+='data-file-id="'+i.internal_file_id+'" ');o&&(u+='style="width:'+i.width+'px;" ');u+=">";var p="ctrl";TS.model.is_mac&&(p="cmd");var h=TS.interop.i18n.t("{cmd_key}+click to open original in new tab","templates_builders")({cmd_key:p});var g=!r||!r.hasOwnProperty("maybe_show_file_viewer")||r.maybe_show_file_viewer;var S;if(i.internal_file_id)if(l&&0===l.mimetype.indexOf("image/")){S=g;if("dropbox"===l.external_type||"gdrive"===l.external_type||"box"===l.external_type||"onedrive"===l.external_type){var T=l.thumb_720?l.thumb_720:l.thumb_360;u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+h+'" class="file_viewer_external_link" data-src="'+_.escape(T)+'"data-link-url="'+_.escape(s)+'">'}else u+=S?'<a href="'+s+'" target="_blank" class="file_viewer_channel_link file_viewer_link" data-file-id="'+i.internal_file_id+'">':'<a href="'+s+'" target="_blank" title="'+h+'" class="file_preview_link thumbnail_link" data-file-id="'+i.internal_file_id+'">'}else u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" class="'+l.filetype+'">';else{var v="";var b="";g?v="file_viewer_external_link":b=TS.interop.i18n.t("Click to open original in new tab","templates_builders")();u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+b+'" class="'+v+'" data-src="'+_.escape(i.src)+'" data-link-url="'+_.escape(i.link_url)+'"';i.width&&(u+=' data-width="'+_.escape(i.width)+'"');i.height&&(u+=' data-height="'+_.escape(i.height)+'"');i.rotation&&(u+=' data-rotation="'+_.escape(i.rotation)+'"');i.content_type&&(u+=' data-content-type="'+_.escape(i.content_type)+'"');u+=">"}o&&(u=u.replace("<a ",'<a style="width:'+i.width+'px;" '));u+='<div class="msg_inline_img_container">';u+='<div class="file_preview_preserve_aspect_ratio" ';if(o)if(l&&f)u+='style="padding-top: '+i.height+'px;" ';else{var y="calc("+i.height+" / "+i.width+" * 100% )";u+='style="padding-top: -moz-'+y+"; padding-top: -webkit-"+y+"; padding-top: "+y+';" '}else{var w=574;var k=300;var x=w/k;var C=i.display_w||i.width;var M=i.display_h||i.height;var I=C/M;var A;var E;if(C<=w&&M<=k){A=C;E=M}else if(x>I){A=C*k/M;E=k}else{A=w;E=M*w/C}u+='style="width: '+Math.round(A)+"px; height: "+Math.round(E)+'px;"'}u+=">";i.proxied_src=TS.utility.getImgProxyURLWithOptions(i.src,{rotate:true});var P=_.escape(i.proxied_src||i.src);var F="msg_inline_img msg_inline_child";var O="style=\"background-image:url('"+P+"');\"";var D='src="'+P+'"';u+='<figure class="'+F+'" '+O+">";u+="<img "+D+" />";u+="</figure>";u+="</div>";u+="</div>";u+="</a>";l&&(u+=TS.templates.message_file_preview_actions({file:l,download:"hosted"===l.mode,new_window:true,external_file_author:TS.files.isFileAuthorExternal(l)}));u+="</div>";return u},buildInlineEmailDiv:function e(t,n){var r=TS.files.getFileById(t);if(!r)return"";var i={file:r,is_message:true,to_more_count:r.to.length-1,cc_more_count:r.cc.length-1,msg_dom_id:n};return TS.templates.file_email(i)},buildInlineAttachmentToggler:function e(t,n){var r=TS.model.inline_attachments[t];if(!r)return"";var i=TS.inline_attachments.shouldExpand(n,r);var a={real_src:r.from_url,expand_it:i};var s=TS.templates.inline_attachment_toggler({inline_attachment:a});return s},buildInlineRoomPreviewToggler:function e(t){var n=TS.inline_room_previews.shouldExpand(t);var r={collapser_class:"msg_inline_room_preview_collapser",expander_class:"msg_inline_room_preview_expander",expand_it:n};var i=TS.templates.inline_attachment_toggler({inline_attachment:r});return" "+i},buildInlineAudioToggler:function e(t,n){var r=TS.model.inline_audios[t];if(!r)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_audios.shouldExpand(n,r),src:r.src,media_type:"audio"})},buildInlineAudioDiv:function e(t,n,r){var i=TS.model.inline_audios[t];if(!i)return"";var a=TS.inline_audios.shouldExpand(n,i);var s={src:i.src,expand_it:a,content:r};var o=TS.templates.attachment_inline_audio_div({inline_audio:s});return o},buildInlineOtherToggler:function e(t,n){var r=TS.model.inline_others[t];if(!r)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_others.shouldExpand(n,r),src:r.src,media_type:"other"})},buildInlineOtherDiv:function e(t,n,r){var i=TS.model.inline_others[t];if(!i)return"";var a=TS.inline_others.shouldExpand(n,i);return'<div data-real-src="'+_.escape(i.src)+'" class="clear_both msg_inline_other_holder msg_inline_holder '+(a?"":"hidden")+'">'+r+"</div>"},buildInlineVideoTogglerAndDiv:function e(t,n){var r=TS.model.inline_videos[t];if(!r)return"";return TS.templates.builders.buildInlineVideoToggler(t,n)+" "+TS.templates.builders.buildInlineVideoDiv(t,n)},buildInlineVideoToggler:function e(t,n,r){var i=TS.model.inline_videos[t];if(!i)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_videos.shouldExpand(n,i),src:i.src,title:r?"":i.title,media_type:"video",is_keyboard_navigable:true})},buildInlineVideoDiv:function e(t,n){var r=TS.model.inline_videos[t];if(!r)return"";var i=TS.inline_videos.shouldExpand(n,r);var a=r.link_url||t;var s=true;r.html||(s=false);var o={real_src:r.src,data_url:t,referrer_safe_url_attributes:TS.utility.makeRefererSafeLink(a),show_play:s,proxied_src_or_src:r.proxied_src||r.src,display_w:r.display_w,display_h:r.display_h,expand_it:i};var l=TS.templates.message_inline_video({inline_video:o});return l},buildComments:function e(t){var n;var r=t.comments;var i="";for(var a=0;a<r.length;a+=1){n=TS.redux.members.getPotentiallyUnknownMemberById(r[a].user);i+=TS.templates.builders.buildCommentHTML({file:t,comment:r[a],show_comment_actions:true,member:n})}return i},buildCommentHTML:function e(t){return TS.templates.comment(t)},buildCommentStandalone:function e(t,n){var r=TS.utility.members.getEntityFromFile(n);var i;"snippet"===n.mode?i="snippet":"post"===n.mode?i="post":"space"===n.mode?i="space":"hosted"!==n.mode&&"external"!==n.mode||(i="file");return TS.templates.comment_standalone({comment:t,file:n,file_type:i,entity:r,current_user_id:TS.model.user.id})},buildTeamListHTML:function e(t,n,r){var i=t.filter(function(e){return!TS.interop.members.isExternal(e)});var a=TS.members.legacyAllocateTeamListMembers(i);var s=a.members;var o=a.disabled_members;var l=a.deleted_bots;var u=a.bots;var d=a.restricted_members;var c=a.ultra_restricted_members;var _=false;(u.length||l.length)&&(_=true);var m=false;(d.length||c.length||r)&&(m=true);var f=false;(o.length||r)&&(f=true);var p=false;var h=false;var g;p=""!==TS.model.team.plan&&!TS.model.user.is_restricted;g=TS.model.user_groups.filter(function(e){return!e.date_delete});h=!g.length;var S=$("#team_tabs");var T=TS.permissions.members.canEditUserGroups();var v=TS.permissions.members.canCreateAndDeleteUserGroups();S.html(TS.templates.user_group_tabs({show_members:!!s.length,members:r?[]:s,show_restricted_members:m,restricted_members:r?[]:d.concat(c),show_disabled_members:f,disabled_members:r?[]:o,show_user_groups:p,user_groups:g,show_user_groups_edit:T,show_user_groups_add:v,is_enterprise:TS.boot_data.page_needs_enterprise}));var b={full_profile_filter:true,is_long_list_view:n,include_bots:true,include_deleted:false};TS.members.view.bindTeamFilter("#team_filter","#team_list_scroller",b);$("#team_filter input").bind("focus",function(){$("#team_filter .icon_search").addClass("indifferent_grey")}).bind("blur",function(){$("#team_filter .icon_search").removeClass("indifferent_grey")});if(p){var y=S.find(".tab_action:not(#search)");var w=$("#team_block");S.find("li a").on("click",function(){var e=$(this).data("action");var t=TS.permissions.members.canEditUserGroups();var n=TS.permissions.members.canCreateAndDeleteUserGroups();y.addClass("hidden");if("user_group_edit"===e){if(!t&&!n)return;y.removeClass("hidden");w.addClass("hidden")}else w.removeClass("hidden");S.find("#"+e).removeClass("hidden")})}$("#team_tabs").find("li.tab").on("click",function(e){var t=$(e.currentTarget).find("a").data("name");TS.model.ui_state.tab_name=t;TS.storage.storeUIState(TS.model.ui_state);var n=$("#search");TS.client&&TS.ui.utility.updateClosestMonkeyScroller($("#team_list_members"));$("#team_list_members").trigger("resize");if("user_groups"===t){TS.view.rebuildUserGroupList();n.toggleClass("hidden",!TS.model.user_groups.length)}else n.removeClass("hidden")});return TS.templates.team_list({members:s,bots:u,show_bots:_,show_restricted_members:m,restricted_members:d,ultra_restricted_members:c,show_disabled_members:f,disabled_members:o,deleted_bots:l,show_user_groups:p,user_groups:g,show_user_groups_help:h,is_long_list_view:n})},buildUserGroupHTML:function e(t,n){return TS.templates.user_group_list_item({user_group:t,is_flexpane:n})},buildUserGroupListHTML:function e(t,n){var r;var i=[];var a=[];var s=TS.permissions.members.canCreateAndDeleteUserGroups();for(var o=0;o<t.length;o+=1){r=t[o];if(r.date_delete){r.can_delete=!r.auto_type&&!r.is_external;a.push(r)}else i.push(r)}var l=!n&&!i.length&&!a.length||n&&!i.length;return TS.templates.user_group_list({user_groups:i,disabled_user_groups:a,show_toggle:s,is_flexpane:n,show_user_groups_help:l})},makeChannelPrefix:function e(t){if(!t)return"";if(t.is_mpim||t.is_im)return"";if(t.is_group||t.is_private)return'<ts-icon class="ts_icon_lock"></ts-icon>';if(t.is_channel)return"#";return""},makeModelObNameForDisplay:function e(t,n){if(!t)return"ERROR: MISSING CHANNEL";n=n||{};var r=_.trim(TS.templates.builders.maybeMakeSharedIcon(t,n.show_tooltip,n.tooltip_position,n.inherit_font_size));var i=TS.templates.builders.makeChannelPrefix(t);var a;a=t.is_im?TS.interop.members.getPrefCompliantMemberNameById(t.user):t.is_mpim?TS.mpims.legacyGetDisplayName(t):_.escape(t.name);var s=n.allow_wrap?"<span>":'<span class="no_wrap">';n.overflow_ellipsis&&(s+='<span class="overflow_ellipsis">');s+=n.omit_prefix?"":i;s+=a;n.overflow_ellipsis&&(s+="</span>");s+=r+"</span>";return s},makeChannelLink:function e(t,n){if(!t)return"ERROR: MISSING CHANNEL";n=n||{};var r=t.id;var i=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+r+'"':"";var a=TS.templates.builders.makeModelObNameForDisplay(t,n);if(n.overflow_ellipsis)return'<a href="/archives/'+r+'" '+i+' class="channel_link display_flex flex_wrap_none" data-channel-id="'+t.id+'">'+a+"</a>";return'<a href="/archives/'+r+'" '+i+' class="channel_link" data-channel-id="'+t.id+'">'+a+"</a>"},maybeMakeSharedIcon:function e(t,n,r,i){var a="";!TS.interop.rules.channels.isOrgShared(t)||t.is_mpim||t.is_im?!TS.interop.rules.channels.isExternallySharedChannel(t)||t.is_mpim||t.is_im||(a=TS.templates.shared_channels_icon({model_ob:t,tooltip:_.isUndefined(n)||n,tooltip_position:r,shared_team_ids:TS.interop.rules.channels.isPendingExternallySharedChannel(t)?t.pending_shared:t.shared_team_ids,inherit:i})):a=TS.templates.shared_channel_icon({tooltip:n,tooltip_position:r});return new Handlebars.SafeString(a)},makeChannelLinkEnterpriseSearchResult:function e(t,n){var r=t.permalink;var i=TS.templates.builders.makeModelObNameForDisplay(t.channel,n);var a='target="'+TS.templates.builders.newWindowName()+'"';return'<a href="'+r+'"'+a+' data-channel-id="'+t.channel.id+'">'+i+"</a>"},makeChannelPath:function e(t){return"/messages/"+t.id},makeChannelLinkAriaLabelSafe:function t(n){n||TS.warn("No valid channel to make channel link aria label");var r=_.escape(n.name);var i=TS.model.active_channel_id===n.id?TS.interop.i18n.t("active channel","templates_builders")():TS.interop.i18n.t("channel","templates_builders")();var a=e(n);var s=null;TS.templates.builders.showDraftIcon(n)&&(s=TS.interop.i18n.t("draft","messages")());var o=r+", "+i+(a?", "+a:"")+(s?", "+s:"");return new Handlebars.SafeString(o)},makeGroupLink:function e(t,n){if(!t)return"ERROR: MISSING GROUP";n=n||{};var r=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+t.id+'"':"";var i=TS.templates.builders.makeModelObNameForDisplay(t,n);if(n.overflow_ellipsis)return'<a href="/archives/'+t.id+'" '+r+' class="group_link display_flex flex_wrap_none" data-group-id="'+t.id+'">'+i+"</a>";return'<a href="/archives/'+t.id+'" '+r+' class="group_link" data-group-id="'+t.id+'">'+i+"</a>"},makeGroupLinkAriaLabelSafe:function t(n){n||TS.warn("No valid group to make private channel link aria label");var r=_.escape(n.name);var i=TS.model.active_group_id===n.id?TS.interop.i18n.t("active channel","templates_builders")():TS.interop.i18n.t("channel","templates_builders")();var a=e(n);var s=null;TS.templates.builders.showDraftIcon(n)&&(s=TS.interop.i18n.t("draft","messages")());var o=r+", "+i+(a?", "+a:"")+(s?", "+s:"");return new Handlebars.SafeString(o)},makeMpimLink:function e(t,n){if(!t)return"ERROR: MISSING MPIM";var r;var i;var a="/archives/"+t.id;TS.utility.shouldLinksHaveTargets()&&(r="/archives/"+t.id);if(n){var s=TS.mpims.legacyGetMembersInDisplayOrder(t);var o=s.map(function(e){if(e.profile.real_name)return e.profile.real_name;return e.name});var l=o.join(", ");i=l===TS.mpims.legacyGetDisplayName(t)?"":l}return TS.templates.mpim_link({target:r,href:a,title:i,mpim:t})},makeMemberPreviewLink:function e(t,n){if(!t)return"";true!==n&&(n=false);var r=TS.templates.builders.makeMemberColorClass(t);var i;var a;if(t.is_service){a=TS.utility.shouldLinksHaveTargets()?'target="/services/'+t.id+'"':"";r+=" app_preview_link";i='<a href="/services/'+t.id+'" '+a+' data-bot-id="'+t.id+'" class="message_sender service_link '+r+'">'}else{a=TS.utility.shouldLinksHaveTargets()?'target="/team/'+t.id+'"':"";r+=t.is_bot?" app_preview_link":" member member_preview_link";r+=" "+TS.templates.builders.makeMemberTypeBadgeClass(t);i='<a href="/team/'+t.id+'" '+a+' class="message_sender '+r+'" data-member-id="'+t.id+'">'}n&&t.id==TS.model.user.id?i+=TS.interop.i18n.t("You","templates_builders")():i+=TS.interop.members.getPrefCompliantMemberName(t,true);i+=TS.templates.builders.makeMemberTypeBadgeCompact(t,false);i+="</a>";(t.is_bot||t.is_service)&&(i+='<span class="c-app_label">'+TS.interop.i18n.t("APP","templates_builders")()+"</span>");t.is_unknown&&(i=TS.templates.unknown_member({id:t.id}));return i},showDraftIcon:function e(t){if(!_.isObject(t))return false;var n;var r=t.id;n=t.last_msg_input;if(TS.interop.utility.looksLikeMemberId(t.id)){var i=TS.redux.channels.getImByMemberId(t.id);if(!i)return false;n=i&&i.last_msg_input;r=i&&i.id}var a=TS.shared.legacyGetActiveModelOb();if(a){var s=a.id;s&&s==r&&!TS.client.activeChannelIsHidden()&&(n=null)}t.is_channel&&(!t.is_archived&&t.is_member||(n=null));t.is_group&&!t.is_mpim&&t.is_archived&&(n=null);TS.permissions.members.canPostInChannel(t)||(n=null);if(_.trim(n))return true;return false},makeProfileImage:function e(t,n){if(_.isString(t)){var r=TS.interop.members.getMemberById(t);t=r||TS.interop.bots.getBotById(t)}if(!t)return false;var i=n.hash.is_lazy||false;var a=t.profile||t.icons||{};var s=n.hash.title||false;var o;o=a.emoji?"64":"48";var l=n.hash.size||o;var u=Object.keys(TS.constants.avatar_size_map).reduce(function(e,t){if(t===l&&m(a,t))return t;return e},o);var d={entity:t,size:l,css_classes:f(t,l),image:c(t,m(a,u)),is_lazy:i,is_targettable:TS.utility.shouldLinksHaveTargets(),title:s};function c(e,t){var n=[];n.push("url('"+t+"')");return n.join(",")}function m(e,t){var n="image_"+t;if(e.hasOwnProperty(n)){if(TS.environment.is_retina)return e[TS.constants.avatar_size_map[t].retina]||e[TS.constants.avatar_size_map[t].standard];return e[TS.constants.avatar_size_map[t].standard]}return false}function f(e,t){var n=[];n.push("thumb_"+t);if(e.is_bot){n.push("is_bot");n.push("app_preview_link")}else n.push("member_preview_link");return n.join(" ")}return new Handlebars.SafeString(TS.templates.member_profile_image(d))},makeMemberPreviewLinkImage:function e(t,r,i,a,s,o,l){var u;u="object"===("undefined"===typeof t?"undefined":n(t))?t:TS.redux.members.getPotentiallyUnknownMemberById(t);if(!u||!u.profile)return"";i=true===i;a=true===a;s=true===s;o=true===o;l="string"===typeof l&&l;"USLACKBOT"===t&&l&&(u=TS.utility.slackbot.getWithFeels(l));var d=TS.templates.builders.getImageStyleForMemberPreviewImage(u,r,i);var c={omit_link:a,omit_badge:s,lazy:i,member:u,size:r,include_restricted_overlay:!o||true,bg_img_style:d};return TS.templates.member_preview_link_image(c)},getImageStyleForMemberPreviewImage:function e(t,n,r){var i;var a;var s;a="background-image: ";s=[];switch(n){case 20:i=TS.environment.is_retina?t.profile.image_48:t.profile.image_24;break;case 24:i=TS.environment.is_retina?t.profile.image_48:t.profile.image_24;break;case 32:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_32;break;case 36:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;break;case 48:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;break;case 72:i=TS.environment.is_retina?t.profile.image_192:t.profile.image_72;break;case 192:i=TS.environment.is_retina?t.profile.image_512||t.profile.image_192:t.profile.image_192;break;case 512:i=TS.environment.is_retina?t.profile.image_1024||t.profile.image_512||t.profile.image_192:t.profile.image_512||t.profile.image_192;break;default:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;break}s.push("url('"+i+"')");if(512===n){var o=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;s.push("url('"+o+"')")}a=r?s.length?s.join(", "):"":s.length?a+s.join(", "):"";return a},makeMemberPreviewCardLinkImage:function e(t){var n=TS.redux.members.getPotentiallyUnknownMemberById(t);if(!n||!n.profile)return"";var r=TS.templates.builders.makeMemberPreviewCardLinkImageBackground(t);var i=TS.utility.shouldLinksHaveTargets()?'target="/team/'+n.id+'"':"";return'<a href="/team/'+n.id+'" '+i+' class="member_preview_link member_image thumb_512" data-member-id="'+n.id+'" data-thumb-size="512" style="background-image: '+r+'" aria-hidden="true"></a>'},makeMemberPreviewCardLinkImageBackground:function e(t){var n=TS.redux.members.getPotentiallyUnknownMemberById(t);if(!n||!n.profile)return"";var r;r=TS.environment.is_retina?n.profile.image_1024||n.profile.image_512||n.profile.image_192:n.profile.image_512||n.profile.image_192;var i=TS.environment.is_retina?n.profile.image_72:n.profile.image_48;var a=!TS.model.mac_version||0!==TS.utility.compareSemanticVersions(TS.model.mac_version,"10.7")&&0!==TS.utility.compareSemanticVersions(TS.model.mac_version,"10.8")?"":"-webkit-";var s=[a+"linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0) 34%, rgba(0,0,0,0.2) 66%, rgba(0,0,0,0.2) 83%, rgba(0,0,0,0.6))","url('"+r+"')","url('"+i+"')"];return s.join(", ")},makeMemberLinkAriaLabelSafe:function t(n){n||TS.warn("No valid direct message object to make member link aria label");var r=n.member;var i=n.model_ob;var a="";if(r&&i){var s=_.escape(TS.ims.getDisplayNameOfUserForIm(i));var o=TS.model.active_im_id===r.id?TS.interop.i18n.t("active direct message","templates_builders")():TS.interop.i18n.t("direct message","templates_builders")();var l=TS.templates.makeMemberPresenceStateAriaLabel(r);var u=e(i);var d=null;TS.templates.builders.showDraftIcon(i)&&(d=TS.interop.i18n.t("draft","messages")());a=s+", "+o+", "+l+(u?", "+u:"")+(d?", "+d:"")}return new Handlebars.SafeString(a)},makePendingUserImage:function e(t,n){if(!t||!n)return"";var r=48;36===n&&(r=72);var i="/img/new_channel_modal/airplane_"+r.toString()+".png";var a="url('"+vvv(i)+"')";var s={restricted:t.invite_prefs&&"restricted"===t.invite_prefs.type,img_url:a,size:n};return TS.templates.pending_user_image(s)},newWindowName:function e(){if("web"===TS.boot_data.app||"calls"===TS.boot_data.app)return"_self";return"new_"+r.toString()},getBotIdentifier:function e(t){if(!t.bot_id&&!t.username)return null;var n=TS.redux.bots.getBotByMsg(t);var r=!t.username&&n&&n.name?n.name:t.username;var i=n?n.id:"NOBOTID";return i+"_"+r},getBotName:function e(t){var n=t.username;if(!n){var r=TS.redux.bots.getBotByMsg(t);r&&r.name&&(n=r.name)}return n},getBotNameWithLink:function e(t){var n=t.username;var r=TS.redux.bots.getBotByMsg(t);var i=TS.templates.builders.makeBotLink(r);n||(r&&r.name?n=r.name:t.bot_profile&&t.bot_profile.name&&(n=t.bot_profile.name));return new Handlebars.SafeString(i.start_a+_.escape(n)+i.end_a)},makeBotLink:function e(t,n){var r="";var i="";var a=n||{};if(t&&!t.deleted){r='<a class="app_preview_link '+(a.classes?a.classes:" ")+'" target="/services/'+t.id+'" style="'+(a.style?a.style:" ")+'" href="/services/'+t.id+'">';i=(a.external_badge?a.external_badge:" ")+"</a>"}else{r='<a class="app_preview_link">';i="</a>"}return{start_a:r,end_a:i}},makeFiletypeHTML:function e(t){if(t.external_type)return TS.templates.builders.makeExternalFiletypeHTML(t);var n="";n+='<a href="'+t.url_private_download+'" ';n+='target="'+t.url_private_download+'" ';n+='title="'+TS.interop.i18n.t("Download this file","templates_builders")()+'" ';n+='data-file-id="'+t.id+'" ';n+='class="subtle_silver file_ssb_download_link">';n+=TS.interop.utility.convertFilesize(t.size)+" ";n+="<span>"+t.pretty_type+"</span>";"snippet"===t.mode&&(n+=" "+TS.interop.i18n.t("snippet","templates_builders")());n+="</a>";return n},makeExternalFiletypeHTML:function e(t){if(!t.is_external)return;var n="";switch(t.external_type){case"gdrive":switch(t.filetype){case"gsheet":n=TS.interop.i18n.t("Spreadsheet from Google Drive","templates_builders")();break;case"gdoc":n=TS.interop.i18n.t("Document from Google Drive","templates_builders")();break;case"gpres":n=TS.interop.i18n.t("Presentation from Google Drive","templates_builders")();break;case"gdraw":n=TS.interop.i18n.t("Drawing from Google Drive","templates_builders")();break;default:n=TS.interop.i18n.t("<span>{file_type}</span> from Google Drive","templates_builders")({file_type:t.pretty_type})}break;case"dropbox":n=TS.interop.i18n.t("<span>{file_type}</span> from Dropbox","templates_builders")({file_type:t.pretty_type});break;case"box":n=TS.interop.i18n.t("<span>{file_type}</span> from Box","templates_builders")({file_type:t.pretty_type});break;case"onedrive":n=TS.interop.i18n.t("<span>{file_type}</span> from OneDrive","templates_builders")({file_type:t.pretty_type});break;default:n=TS.interop.i18n.t("File","templates_builders")()}return n},makeUnshareLink:function e(t,n){var r=(t.is_channel?"#":"")+t.name;var i=TS.interop.i18n.t("Unshare from {channel}","templates_builders")({channel:r});return'<a class="unshare_link ts_tip ts_tip_top ts_tip_float ts_tip_unshare_link ts_tip_multiline" onclick="TS.files.promptForFileUnshare(\''+n.id+"', '"+t.id+'\')"><span class="ts_tip_tip"><span class="ts_tip_multiline_inner">'+i+'</span></span><i class="ts_icon ts_icon_minus_circle_small"></i></a>'},updateFileShareLabels:function e(t){var n=$('.file_share_label[data-file-id="'+t.id+'"]');n.each(function(){$(this).replaceWith(TS.templates.builders.makeFileShareLabel(t))});if(t.is_shared){$('.file_share_shared_label[data-file-id="'+t.id+'"]').removeClass("hidden");$('.file_share_unshared_label[data-file-id="'+t.id+'"]').addClass("hidden")}else{$('.file_share_shared_label[data-file-id="'+t.id+'"]').addClass("hidden");$('.file_share_unshared_label[data-file-id="'+t.id+'"]').removeClass("hidden")}if(t.is_public){$('.file_share_private_label[data-file-id="'+t.id+'"]').addClass("hidden");$('.file_share_public_label[data-file-id="'+t.id+'"]').removeClass("hidden")}else{$('.file_share_private_label[data-file-id="'+t.id+'"]').removeClass("hidden");$('.file_share_public_label[data-file-id="'+t.id+'"]').addClass("hidden")}},makeFileShareLabel:function e(t){var n='<span class="file_share_label" data-file-id="'+t.id+'">';var r=TS.templates.builders.makeFileGroupChannelList(t);r.length?n+=TS.interop.i18n.t("in {share_list}","templates_builders")({share_list:TS.interop.i18n.safeString(r)}):t.is_public||t.user===TS.model.user.id||(n+=TS.interop.i18n.t("shared with you","templates_builders")());n+="</span>";return n},makeFileGroupChannelList:function e(t){var n=[];var r;var i;var a;var s=_.get(t,"channels.length",0);for(a=0;a<s;a+=1){i=TS.interop.channels.getChannelById(t.channels[a]);if(!i)continue;if(i.is_mpim)continue;r='<span class="no_wrap">';r+=TS.templates.builders.makeChannelLink(i,{inherit_font_size:true});r+="&nbsp;"+TS.templates.builders.makeUnshareLink(i,t);r+="</span>";n.push(r)}var o;var l=_.get(t,"groups.length",0);for(a=0;a<l;a+=1){o=TS.interop.channels.getGroupById(t.groups[a]);if(!o)continue;r='<span class="no_wrap">';r+=TS.templates.builders.makeGroupLink(o,{inherit_font_size:true});r+="&nbsp;"+TS.templates.builders.makeUnshareLink(o,t);r+="</span>";n.push(r)}if(!n.length)return"";return n.join(", ")},makeFileCommentHelpHTML:function e(t){if(t&&t.is_public&&(t.channels&&t.channels.length||t.groups&&t.groups.length)){var n=[];t.channels&&t.channels.length&&(n=n.concat(t.channels));t.groups&&t.groups.length&&(n=n.concat(t.groups));n=_.chain(n).map(TS.redux.channels.getEntityById).filter(function(e){return e&&!e.is_im&&!e.is_mpim&&!TS.interop.rules.channels.isExternallySharedChannel(e)}).value();if(n.length<1)return"";return TS.interop.i18n.t("Commenting in {channel_names}","templates_builders")({channel_names:TS.interop.i18n.safeString(TS.templates.builders.makeLinksFromModelObs(n))})}return""},makeLinksFromModelObs:function e(t,n){n=n||{};t=TS.utility.parseJSONOrElse(t,t);t=_.isArray(t)?t:[t];var r=0;t=_.chain(t).map(function(e){if(_.isString(e))return TS.redux.channels.getEntityById(e);return e}).filter(function(e){e||(r+=1);return e&&!e.is_im&&!e.is_mpim}).value();var i=TS.sorter.search("",{groups:t},{allow_empty_query:true});var a=i.sort().map(function(e){var t=n.new_lines?'<span class="block">':"";t+=e.is_channel?TS.templates.builders.makeChannelLink(e,{overflow_ellipsis:n.overflow_ellipsis,inherit_font_size:n.inherit_font_size}):TS.templates.builders.makeGroupLink(e,{overflow_ellipsis:n.overflow_ellipsis,inherit_font_size:n.inherit_font_size});t+=n.new_lines?"</span>":"";return t});if(r){var s=TS.interop.i18n.t("{private_channel_or_group_count, plural, =1{# private channel}other{# private channels}}","templates_builders")({private_channel_or_group_count:r});a.push('<span class="no_wrap'+(n.new_lines?" block":"")+'">'+s+"</span>")}if(n.new_lines)return a.join("");return TS.interop.i18n.listify(a,{noEscape:true}).join("")},makeMessageShareLabelSafe:function e(t){var n='<span class="message_share_label">';var r="";if(t.is_channel)r=TS.templates.builders.makeChannelLink(t,{inherit_font_size:true});else{if(!t.is_group)return"";r=TS.templates.builders.makeGroupLink(t,{inherit_font_size:true})}n+=TS.interop.i18n.t("in {channel}","templates_builders")({channel:r});n+="</span>";return new Handlebars.SafeString(n)},makeMessageLinkLabelSafe:function e(t){var n=TS.interop.i18n.t("From URL:","templates_builders")()+" <a "+TS.utility.makeRefererSafeLink(t)+' class="external_link"title="'+_.escape(t)+'"target="_blank">'+_.escape(t)+"</a>";return new Handlebars.SafeString(n)},makeSHRoomParticipantList:function e(t){var n=t.date_end?t.participant_history:t.participants;var r=_.compact(n.map(function(e){var t=TS.interop.members.getMemberById(e);if(t&&t.is_unknown)return TS.templates.unknown_member({id:t.id});if(t)return _.escape(TS.interop.members.getPrefCompliantMemberName(t));return})).join(", ");return new Handlebars.SafeString(r)},makeSHRoomSharedList:function e(t){if(!t.channels||!t.channels.length)return"";var n=[];var r;var i;var a;for(var s=0;s<t.channels.length;s+=1){a=TS.redux.channels.getEntityById(t.channels[s]);if(!a)continue;if(a.is_channel)r=TS.templates.builders.makeChannelLink(a);else if(a.is_group)r=TS.templates.builders.makeGroupLink(a);else{if(!a.is_im)continue;i=TS.interop.members.getMemberById(a.user);if(!i)continue;r=TS.templates.builders.makeMemberPreviewLink(i)}n.push(r)}if(!n.length)return"";return n.join(", ")},buildFileSharingControls:function e(t,n,r,i,a){var s;TS.client?TS.client.activeChannelIsHidden()||(s=TS.shared.legacyGetActiveModelOb()):TS.web&&TS.web.space&&(s=TS.redux.channels.getEntityById(TS.web.space.getOriginChannel()));s&&TS.interop.rules.channels.isRequired(s)&&!TS.permissions.members.canPostInChannel(s)&&(s={});var o=[];var l=[];var u=[];r=r||"";$("#file_sharing_div").remove();var d=false;var c=false;if(t){if(t.user===TS.model.user.id)d=true;else if(t.user){var m=TS.interop.members.getMemberById(t.user);m&&m.is_external&&(c=TS.teams.getTeamNameByMember(m))}}else d=true;if(t&&t.id&&TS.files.isFilePrivate(t)&&!d&&!t.bot_id)var f=new Handlebars.SafeString(TS.interop.i18n.t("This file was sent to you privately. You may want to check with <strong>{user_names}</strong> before sharing it.","files")({user_names:TS.interop.i18n.safeString(_.escape(TS.interop.members.getPrefCompliantMemberNameById(t.user))),file_owners_count:1,file_count:1,file_title:t.title?TS.format.formatNoSpecials(t.title||"Untitled"):""}));if(TS.interop.rules.channels.isExternallySharedChannel(s)&&!TS.interop.rules.channels.isPendingExternallySharedChannel(s)&&s.shared_team_ids&&s.shared_team_ids.length){var p=TS.interop.i18n.listify(_.map(s.shared_team_ids,TS.teams.getTeamNameById)).join("");var h=new Handlebars.SafeString(TS.interop.i18n.t("<strong>This is a Shared channel</strong>. Messages and files sent here will be seen by members of <strong>{shared_teams_list}</strong>.","shared_channels")({shared_teams_list:p}))}var g=TS.web&&TS.web.space&&d&&!TS.prefs.getTeamPref("disable_file_editing")&&!t.channels.concat(t.groups).concat(t.ims).length;if(t&&t&&t.mimetype&&-1!=t.mimetype.indexOf("application/vnd.google-apps")){var S=t.pretty_type?t.pretty_type.replace(/GDocs /,""):null;if(S){var T={teamFileSpreadsheet:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Spreadsheet","templates_builders"),teamFilePresentation:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Presentation","templates_builders"),teamFileDocument:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Document","templates_builders"),fileSpreadsheet:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Spreadsheet","templates_builders"),filePresentation:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Presentation","templates_builders"),fileDocument:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Document","templates_builders"),fallback:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google file","templates_builders")};var v;TS.model.team.name?S&&"Document"===S?v=T.teamFileDocument({team_name:TS.model.team.name}):S&&"Spreadsheet"===S?v=T.teamFileSpreadsheet({team_name:TS.model.team.name}):S&&"Presentation"===S&&(v=T.teamFilePresentation({team_name:TS.model.team.name})):TS.model.team.name?v=T.fallback():S&&"Document"===S?v=T.fileDocument():S&&"Spreadsheet"===S?v=T.fileSpreadsheet():S&&"Presentation"===S&&(v=T.filePresentation())}}return TS.templates.file_sharing({channels:o,groups:l,members:u,model_ob:s,file:t,shared_channel_warning:h,file_sharing_notice:v,is_owner:d,owner_team:c,reshare_private_file:f,has_title:i,hide_checkbox:n,comment:r,selection:a,show_channel_join_note:s&&s.is_channel&&!s.is_member&&!s.is_archived,disable_file_sharing_dialog_comment:c||s&&TS.interop.utility.isModelObjectExternal(s),enable_collab_editing:g})},buildNonDefaultNotificationBlock:function e(t){t=t||"";var n="";var r;var i=TS.notifs.getCorGsNotUsingGlobalNotificationSetting();if(i.everything.length){n+='<div class="'+t+'">'+TS.interop.i18n.t("Set to notify for <strong>all activity</strong>:","templates_builders")();for(r=0;r<i.everything.length;r+=1)n+=" "+("C"===i.everything[r].id.charAt(0)?"#":"")+i.everything[r].name+(r!=i.everything.length-1?",":"");n+="</div>"}if(i.mentions.length){n+='<div class="'+t+'">'+TS.interop.i18n.t("Set to notify only for <strong>Highlight Words</strong>:","templates_builders")();for(r=0;r<i.mentions.length;r+=1)n+=" "+("C"===i.mentions[r].id.charAt(0)?"#":"")+i.mentions[r].name+(r!=i.mentions.length-1?",":"");n+="</div>"}if(i.nothing.length){n+='<div class="'+t+'">'+TS.interop.i18n.t("Set to <strong>never notify</strong>:","templates_builders")();for(r=0;r<i.nothing.length;r+=1)n+=" "+("C"===i.nothing[r].id.charAt(0)?"#":"")+i.nothing[r].name+(r!=i.nothing.length-1?",":"");n+="</div>"}return n},strBuilder:function e(t,n){return t.replace(/\${([a-z_]+)}/g,function(e,t){if(t.indexOf("_html")>-1)return n[t];return _.escape(n[t])})},buildRxnTitle:function e(t,n){if(!n&&!TS.web)return;var r;var i=":"+t.name+":";TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&(i=TS.emoji.maybeGetLocalizedEmojiString(i));if(t.is_handy||t.is_poll&&!t.count){r=_.escape(i||t.name);return TS.interop.i18n.t("Add reaction {emoji}","rxn")({emoji:TS.interop.i18n.safeString(r)})}var a=false;var s=false;var o=true;r=_.escape(i||t.name);TS.emoji.isValidName(t.name)||t.url||(r+=" "+TS.interop.i18n.t("(emoji has been removed)","rxn")());if(1===t.count){if(t.user_reacted)return TS.interop.i18n.t('You (click to remove) <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({emoji:r});return TS.interop.i18n.t('{user} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({user:TS.interop.i18n.safeString(_.escape(TS.interop.members.getPrefCompliantMemberNameById(t.member_ids[0],a,s,o))),emoji:TS.interop.i18n.safeString(r)})}var l=false;var u=t.member_ids.length!=t.count;var d=t.member_ids.map(function(e,t){var n;if(TS.model.user.id===e){l=true;n=0===t?TS.interop.i18n.t("You","rxn")():TS.interop.i18n.t("you","rxn")()}else n=TS.interop.members.getPrefCompliantMemberNameById(e,a,s,o);return n});u&&d.push(TS.interop.i18n.t("others","rxn")());if(l)return TS.interop.i18n.t('{users_and_you} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users_and_you:TS.interop.i18n.safeString(_.escape(TS.interop.i18n.listify(d,{noEscape:true}).join(""))),emoji:TS.interop.i18n.safeString(r)});return TS.interop.i18n.t('{users} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users:TS.interop.i18n.safeString(_.escape(TS.interop.i18n.listify(d,{noEscape:true}).join(""))),emoji:TS.interop.i18n.safeString(r)})},buildRxnHtml:function e(t){var n;var r=TS.emoji.isValidName(t.name)||TS.emoji.shouldRenderEmoji5(t.name);if(t.url)n='<span class="emoji-outer emoji-sizer emoji-bg-contain" style="background-image: url('+t.url+');"></span>';else if(r){var i=t.is_handy&&TS.emoji.isNameSkinToneModifiable(t.name)?TS.emoji.getChosenSkinToneModifier():"";n=TS.emoji.graphicReplace(":"+t.name+":"+i,{no_skin_tone_squares:t.is_handy,obey_emoji_mode_pref:TS.useReactMessages()})}else n=TS.emoji.MISSING_EMOJI_HTML;var a=TS.templates.builders.buildRxnTitle(t);var s=[];t.user_reacted&&s.push("user_reacted");t.is_handy&&s.push("is_handy");t.is_hidden&&s.push("hidden");TS.useReactMessages()&&"as_text"===TS.prefs.getPref("emoji_mode")&&s.push("plain_text");return TS.templates.rxns_rxn({name:t.name,url:t.url,css_classes:s.join(" "),emoji_html:new Handlebars.SafeString(n),title:new Handlebars.SafeString(a||""),count:t.count,is_handy:!!t.is_handy,is_web:!!TS.web})},updateRxnHtml:function e(t,n){var r=t.children('.rxn[data-emoji="'+n.name+'"]');if(r.length){r.find(".emoji_rxn_count").attr("aria-label",n.count);r.toggleClass("user_reacted",n.user_reacted);var i=true;var a=TS.templates.builders.buildRxnTitle(n,i);var s;var o=r.find(".ts_tip_tip_inner");o.length||(o=r.find(".ts_tip_multiline_inner"));if(o.length){s=o.html();s!=a&&TS.tips.updateTipTitle(r,a)}else{s=r.prop("title");s!=a&&TS.tips.updateTipTitle(r,a)}n.animate_it_dramatically?setTimeout(n.animate_callback,0):n.animate_it&&setTimeout(n.animate_callback,0)}else{t.children(".rxn_hover_container").before($(TS.templates.builders.buildRxnHtml(n)));r=t.children('.rxn[data-emoji="'+n.name+'"]');n.animate_it_dramatically?r.css("opacity",0).transition({opacity:1},300,n.animate_callback):n.animate_it&&r.css("opacity",0).transition({opacity:1},300,n.animate_callback)}},updateRxnPanels:function e(t,n,r){var i=TS.rxns.getExistingRxnsByKey(t);var a=$("."+TS.templates.makeRxnKeyDomClass(t));var s=function e(a){var s;var o;i&&i.forEach(function(e){s=e.name==n;o=s&&r==TS.model.user.id;TS.templates.builders.updateRxnHtml(a,{animate_it:s,animate_it_dramatically:o,name:e.name,url:e.url,count:e.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(i,e.name),member_ids:e.users,rxn_key:t})});var l=a.children(".rxn");l.each(function(e,t){var n=$(t);var r=String(n.data("emoji"));if(!TS.rxns.doesRxnsHaveRxn(i,r)){n.addClass("going_away");n.transition({opacity:0},300,function(){n.remove()})}});TS.ui.messages.maybeUpdateMessageHoverContainer(a.closest("ts-message"));var u=a.children(".rxn_hover_container").find(".rxn.is_handy");u.each(function(e,t){var n=$(t);var r=String(n.data("emoji"));n.toggleClass("hidden",TS.rxns.doesRxnsHaveSkinlessRxn(i,r))})};a.each(function(e,n){var r=$(n);if(!i){r.empty();TS.ui.messages.maybeUpdateMessageHoverContainer(r.closest("ts-message"));return}r.children().length||(r=$(TS.templates.builders.rxnPanel(t)).replaceAll(r));s(r)})},rxnPanel:function e(t){if(!t)return;var n=[];var r={};var i="";var a=TS.rxns.getExistingRxnsByKey(t);var s="";var o=function e(){if(a){a=_.sortBy(a,function(e){return TS.emoji.isValidName(e.name)?0:1});a.forEach(function(e){s+=TS.templates.builders.buildRxnHtml({name:e.name,url:e.url,count:e.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(a,e.name),member_ids:e.users,rxn_key:t})})}_.each(_.keys(r.items),function(e){i+=TS.templates.builders.buildRxnHtml({name:e,is_handy:true,is_hidden:TS.rxns.doesRxnsHaveSkinlessRxn(a,e),rxn_key:t})})};o();return TS.templates.rxns_panel({css_classes:n.join(" "),rxn_key:t,rxns_html:new Handlebars.SafeString(s),handy_rxns_html:new Handlebars.SafeString(i),id_class:TS.templates.makeRxnKeyDomClass(t),has_hovers:!r.is_poll})},filePreviewBackIcon:function e(){return'<i class="ts_icon ts_icon_chevron_medium_left back_icon"></i>'},buildQuickSwitcherBtnHtml:function e(){var t=TS.interop.i18n.t("Quick Switcher","templates_builders")();(TS.model.is_our_app||TS.prefs.getPref("k_key_omnibox"))&&(t+=[" ",'<span class="subtle_silver">(',TS.model.is_mac?"&#8984K":"Ctrl+K",")</span>"].join(""));return'<i class="ts_icon ts_icon_filter"></i><span id="quick_switcher_label" class="ts_tip_tip">'+t+"</span>"},atLabel:function e(t){"group"===t&&(t="channel");var n=(_.keyBy(TS.model.BROADCAST_KEYWORDS,"ms_name")[t]||{}).name||"channel";return"@"+n},makeMemberTypeBadge:function e(t,n,r,i){if(!TS.boot_data.page_needs_enterprise)return"";n=parseInt(n,10);isNaN(n)&&(n=16);"boolean"!==typeof r&&(r=false);"boolean"!==typeof i&&(i=false);var a={size:"member_type_badge_"+n,big:n>=20,is_standalone:r,with_tooltip:i};if(t.is_external)return"";if(t.is_ultra_restricted)return TS.templates.member_type_guest_badge(a);if(t.is_restricted)return TS.templates.member_type_restricted_badge(a);return""},makeMemberTypeBadgeClass:function e(t){if(!TS.boot_data.page_needs_enterprise)return"";if(!t.is_restricted)return"";return"has_member_type_badge"},makeMemberColorClass:function e(t){var n="color_";n+=t?t.id+" color_"+t.color:"unknown";return n},makeMemberTypeBadgeCompact:function e(t,n){if(!TS.boot_data.page_needs_enterprise)return"";"boolean"!==typeof n&&(n=false);var r={icon_class:"",with_tooltip:n,tooltip:{member_type:"",type_description:""}};var i=TS.boot_data.page_needs_enterprise?TS.interop.i18n.t("organization directory","templates_builders")():TS.interop.i18n.t("workspace directory","templates_builders")();if(t.is_external)return"";if(t.is_ultra_restricted){r.icon_class="ts_icon_single_channel_guest";r.tooltip.member_type=TS.interop.i18n.t("Single-Channel Guests","templates_builders")();r.tooltip.type_description=TS.interop.i18n.t("see a partial {directory_name} and can only access messages and files from the channel they belong to.","templates_builders")({directory_name:i});return TS.templates.member_type_icon(r)}if(t.is_restricted){r.icon_class="ts_icon_restricted_user";r.tooltip.member_type=TS.interop.i18n.t("Multi-Channel Guests","templates_builders")();r.tooltip.type_description=TS.interop.i18n.t("see only a partial {directory_name} and can only access messages and files from selected channels.","templates_builders")({directory_name:i});return TS.templates.member_type_icon(r)}return""},getMemberTypeClass:function e(t){if(t.is_restricted)return" ra";return""},makeTeamlabel:function e(t){if(!t)return"ERROR: MISSING TEAM ID";var n="";var r=TS.teams.getTeamById(t);if(!r)return"ERROR: UNABLE TO GET TEAM INFO";n='<span class="org_team_tag_name">'+_.escape(r.name)+"</span>";return n},loadingHTML:function e(){var t=cdn_url+"/9c217/img/loading_hash_animation_@2x.gif";var n=cdn_url+"/9c217/img/loading_hash_animation.gif";var r=TS.interop.i18n.t("loading&hellip;","templates_builders")();return'<div class="loading_hash_animation"><img src="'+t+'" alt="'+r+'" srcset="'+n+" 1x, "+t+' 2x" /><br />'+r+"</div>"},buildThreadMsgHTML:function e(t,n,r,i){var a=!!_.get(i,"inline");var s=a?TS.templates.makeMsgDomId(t.ts):TS.templates.makeMsgDomIdInThreadsView(t.ts);return TS.templates.builders.msgs.buildHTML({msg_dom_id:s,model_ob:n,msg:t,is_threads_view:true,is_new_reply:TS.interop.messages.isReply(t)&&r&&t.ts>r.initial_last_read,relative_ts:true,enable_slack_action_links:true})},buildThreadParticipantListHTML:function e(t){var n;if(t.reply_users)n=t.reply_users;else{n=_.map(t.replies,"user");var r=_.map(t.replies,"bot_id");n=n.concat(r)}n=_.without(n,"U00",void 0);"tombstone"!==t.subtype&&t.user&&n.unshift(t.user);n=_.uniq(n);if(_.includes(n,TS.model.user.id)){n=_.without(n,TS.model.user.id);n.push(TS.model.user.id)}var i=_.map(n,function(e){var t;t="B"===e.charAt(0)?TS.interop.bots.getBotNameById(e):e===TS.model.user.id?TS.interop.i18n.t("you","threads")():TS.interop.members.getPrefCompliantMemberNameById(e);return t});if(1===n.length){if(n[0]===TS.model.user.id)return TS.interop.i18n.t("Just you","threads")();return _.escape(i[0])}if(2===n.length){if(n[1]===TS.model.user.id)return TS.interop.i18n.t("{user_name} and you","threads")({user_name:_.escape(i[0])});return TS.interop.i18n.t("{user_name1} and {user_name2}","threads")({user_name1:TS.interop.i18n.safeString(_.escape(i[0])),user_name2:TS.interop.i18n.safeString(_.escape(i[1]))})}if(3===n.length){if(n[2]===TS.model.user.id)return TS.interop.i18n.t("{user_name1}, {user_name2}, and you","threads")({user_name1:TS.interop.i18n.safeString(_.escape(i[0])),user_name2:TS.interop.i18n.safeString(_.escape(i[1]))});return TS.interop.i18n.t("{user_name1}, {user_name2}, and {user_name3}","threads")({user_name1:TS.interop.i18n.safeString(_.escape(i[0])),user_name2:TS.interop.i18n.safeString(_.escape(i[1])),user_name3:TS.interop.i18n.safeString(_.escape(i[2]))})}if(n.length>3){var a=t.reply_users_count?t.reply_users_count:n.length;var s=a-2;var o=_.drop(i,2);if(t.reply_users_count&&o.length<s)o.push(TS.interop.i18n.t("others","threads")());else{var l=25;if(o.length>l){o=_.take(o,l);o.push(TS.interop.i18n.t("others","threads")())}}var u=TS.interop.i18n.listify(o,{noEscape:true}).join("");return TS.templates.thread_participants_with_overflow({num_others:s,user_name1:i[0],user_name2:i[1],other_names:u})}},buildBroadcastRepliersSummaryHTML:function e(t){var n=t.reply_count;var r;var i;if(t.reply_users){r=t.reply_users;i=t.reply_users_count}else{var a=t.replies;if(!a||!a.length)return"";r=_.map(a,"user");r=_.uniq(r);i=r.length}var s=_.map(r,function(e){if("U00"===e)return null;var t=e.charAt(0);var n;n="B"===t?TS.interop.bots.getBotById(e):TS.redux.members.getPotentiallyUnknownMemberById(e);return n});s=_.compact(s);if(!n||!s.length)return"";if(1===n)return TS.interop.i18n.t("1 reply","threads")();var o=!!_.find(s,{is_self:true});if(o){s=_.reject(s,{is_self:true});s.push(TS.model.user)}var l=_.map(s,function(e){if(e.is_bot)return e.name;if(e.is_self)return TS.interop.i18n.t("you","threads")();return TS.interop.members.getPrefCompliantMemberName(e)});if(1===s.length){if(o)return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from you","threads")({reply_count:n});return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name}","threads")({reply_count:n,user_name:TS.interop.i18n.safeString(_.escape(l[0]))})}if(2===s.length){if(o)return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name} and you","threads")({reply_count:n,user_name:TS.interop.i18n.safeString(_.escape(l[0]))});return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1} and {user_name2}","threads")({reply_count:n,user_name1:TS.interop.i18n.safeString(_.escape(l[0])),user_name2:TS.interop.i18n.safeString(_.escape(l[1]))})}if(3===s.length){if(o)return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and you","threads")({reply_count:n,user_name1:TS.interop.i18n.safeString(_.escape(l[0])),user_name2:TS.interop.i18n.safeString(_.escape(l[1]))});return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and {user_name3}","threads")({reply_count:n,user_name1:TS.interop.i18n.safeString(_.escape(l[0])),user_name2:TS.interop.i18n.safeString(_.escape(l[1])),user_name3:TS.interop.i18n.safeString(_.escape(l[2]))})}if(s.length>3){var u=_.drop(l,2);u.length<i-2&&u.push(TS.interop.i18n.t("others","threads")());var d=TS.interop.i18n.listify(u,{noEscape:true}).join("");return TS.templates.thread_broadcast_repliers_with_overflow({reply_count:n,num_others:i-2,user_name1:l[0],user_name2:l[1],other_names:d})}return""},replaceEmojiForPosts:function e(t){if(t.childNodes)for(var n=0;n<t.childNodes.length;n+=1)TS.templates.builders.replaceEmojiForPosts(t.childNodes[n]);if(t.nodeType==Node.TEXT_NODE){var r=_.escape(t.textContent);var i=TS.emoji.graphicReplace(TS.emoji.replaceEmoticons(r),{include_title:true,include_text:false});if(i!==r){var a=$("<span>").html(i)[0];[].slice.apply(a.childNodes).forEach(function(e){t.parentNode.insertBefore(e,t)});t.parentNode.removeChild(t)}}},formatPostsForModern:function e(t){var n=$("<div>").html(t);TS.templates.builders.replaceEmojiForPosts(n[0]);TS.utility.makeSureAllLinksHaveTargets(n);return n.html()},proxyImgUrlsForEmails:function e(t){t.find("img").each(function(){var e=$(this).attr("src");var t=$(this).attr("width");var n=$(this).attr("height");var r;r=t&&n?TS.utility.getImgProxyURL(e,t,n):TS.utility.getImgProxyURL(e);$(this).attr("src",r)})},formatEmailsForModern:function e(t){var n=$("<div>").html(t);TS.templates.builders.proxyImgUrlsForEmails(n);TS.utility.makeSureAllLinksHaveTargets(n);return n.html()},formatFileTitle:function e(t){if(!t||!t.title)return"";var n=t.title;n=_.unescape(n);n=_.escape(n);return TS.format.formatWithOptions(n,null,{no_specials:true})},test:function e(){var n={};Object.defineProperty(n,"_buildStarComponents",{get:function e(){return t},set:function e(n){t=n}});return n}});function e(e){var t="";var n=e.unread_highlight_cnt;var r=e.unread_cnt;n&&!e.is_im?t+=n+" "+TS.interop.i18n.t("unread highlight","templates_builders")()+" ":r&&(t+=r+" "+TS.interop.i18n.t("unread","templates_builders")()+" ");r&&(t+=TS.interop.i18n.t("{count, plural, =1 {message} other {messages}}","templates_builders")({count:r}));return t}function t(e,t,n,r){if(!e)return{};!t||"string"!==typeof t||"channel"!==e&&"group"!==e&&"mpim"!==e&&"im"!==e||(t=TS.redux.channels.getEntityById(t));if(!t)return{};if("message"===e&&n&&"string"===typeof n){var i=n;n=TS.interop.channels.getChannelById(i);n||(n=TS.interop.channels.getImById(i));n||(n=TS.interop.channels.getGroupById(i))}var a={};var s=[];var o=[];o=["star","ts_icon","ts_icon_star_o","ts_icon_inherit"];var l="ts_tip_top";var u=t.id||t.ts;var d=n?n.id:null;if("message"===e){if(!d)return{};a["data-msg-id"]=u;a["data-c-id"]=d;TS.interop.rules.messages.isTempMsg(t)&&o.push("invisible")}else if("file"===e)a["data-file-id"]=u;else if("file_comment"===e){a["data-comment-id"]=u;a["data-file-id"]=d;o.push("star_comment")}else if("channel"===e){l="ts_tip_bottom";a["data-channel-id"]=u}else if("group"===e){l="ts_tip_bottom";a["data-group-id"]=u}else if("im"===e){TS.interop.apps.isAppSpaceEnabled()&&TS.apps.isCurrentModelViewAnApp()&&(e="app");l="ts_tip_bottom";a["data-im-id"]=u}else{if("mpim"!==e){TS.error("buildStar needs to handle star item type:"+e);return{}}l="ts_tip_bottom";a["data-mpim-id"]=u}o=_.concat(o,l);if(t.is_starred){o.push("starred","ts_icon_star");o.splice(o.indexOf("ts_icon_star_o"),1)}o.push("star_"+e);$.each(a,function(e,t){s.push(e+'="'+t+'"')});var c={message:TS.interop.i18n.t("message","templates_builders")(),file:TS.interop.i18n.t("file","templates_builders")(),file_comment:TS.interop.i18n.t("file comment","templates_builders")(),channel:TS.interop.i18n.t("channel","templates_builders")(),group:TS.interop.i18n.t("channel","templates_builders")(),im:TS.interop.i18n.t("direct message","templates_builders")(),app:TS.interop.i18n.t("app","templates_builders")(),mpim:TS.interop.i18n.t("direct message","templates_builders")()};var m;var f;switch(e){case"message":if(r){m=TS.interop.i18n.t("Star message","templates_builders")();f=TS.interop.i18n.t("Unstar message","templates_builders")()}else{m=TS.interop.i18n.t("Star this message","templates_builders")();f=TS.interop.i18n.t("Unstar this message","templates_builders")()}break;case"file":if(r){m=TS.interop.i18n.t("Star file","templates_builders")();f=TS.interop.i18n.t("Unstar file","templates_builders")()}else{m=TS.interop.i18n.t("Star this file","templates_builders")();f=TS.interop.i18n.t("Unstar this file","templates_builders")()}break;case"file_comment":if(r){m=TS.interop.i18n.t("Star file comment","templates_builders")();f=TS.interop.i18n.t("Unstar file comment","templates_builders")()}else{m=TS.interop.i18n.t("Star this file comment","templates_builders")();f=TS.interop.i18n.t("Unstar this file comment","templates_builders")()}break;case"channel":case"group":if(r){m=TS.interop.i18n.t("Star channel","templates_builders")();f=TS.interop.i18n.t("Unstar channel","templates_builders")()}else{m=TS.interop.i18n.t("Star this channel","templates_builders")();f=TS.interop.i18n.t("Unstar this channel","templates_builders")()}break;case"im":case"mpim":if(r){m=TS.interop.i18n.t("Star direct message","templates_builders")();f=TS.interop.i18n.t("Unstar direct message","templates_builders")()}else{m=TS.interop.i18n.t("Star this direct message","templates_builders")();f=TS.interop.i18n.t("Unstar this direct message","templates_builders")()}break;case"app":if(r){m=TS.interop.i18n.t("Star app","templates_builders")();f=TS.interop.i18n.t("Unstar app","templates_builders")()}else{m=TS.interop.i18n.t("Star this app","templates_builders")();f=TS.interop.i18n.t("Unstar this app","templates_builders")()}break;default:m=TS.interop.i18n.t("Star","templates_builders")();f=TS.interop.i18n.t("Unstar","templates_builders")();break}return{attributes:s,class_names:o,html_attrs:a,readable_type:c[e],type:e,is_starred:t.is_starred,star_str:m,unstar_str:f}}var r=Date.now()})()},11239:function(e,t,n){(function(){TS.registerModule("templates.builders.msgs",{buildHTML:function t(n,r){r&&TS.dir(0,n);try{var i=n.msg;var a=n.model_ob;var s=n.prev_msg;var o=!!n.highlight;var l=!!n.no_attachments;var u=!!n.standalone;var d=!!(u||n.hide_actions);var c=!!n.full_date;TS.prefs.getPref("fuller_timestamps")&&!c&&(c=!TS.interop.datetime.isSameDay(TS.interop.datetime.toDateObject(i.ts),new Date));var m=!!n.relative_ts;var f=n.jump_link?new Handlebars.SafeString(n.jump_link):"";var p=!!n.starred_items_list;var h=n.starred_items_actions;var g=n.container_id?"#"+n.container_id:"";var S=!!n.enable_slack_action_links;var T=!!(n&&n.highlight_as_new);var v="";var b=TS.utility.members.getEntityFromMessage(i);var y=true;var w=TS.interop.datetime.toDateObject(i.ts);var k=false;var x=false;var C=!!i.is_pending;var M=i.user;var I;var A=i.is_ephemeral;var E=TS.templates.makeMsgDomId(i.ts);var P=TS.utility.msgs.getMsgActions(i,a);M||(M=TS.templates.builders.getBotIdentifier(i));var F=TS.utility.msgs.shouldHaveBotLabel(i,b);var O;var D;var H;var B;E=n.msg_dom_id||E;var j=!!n.is_in_conversation;var R=!!n.is_threads_view;false;if(F){var L=TS.interop.bots.getBotInfoByMsg(i);if(L){O=_.get(L,"appId");D=_.get(L,"botId");H=_.get(L,"teamId")?L.teamId:_.get(i,"source_team_id")}B=true}if(s){I="file_comment"===s.subtype&&s.comment?s.comment.user:s.user;I||(I=TS.templates.builders.getBotIdentifier(s))}if(!i.no_display&&!u)if(s){var N=TS.interop.datetime.toDateObject(s.ts);i.subtype&&"file_comment"===i.subtype&&i.comment&&(M=i.comment.user);var U=TS.interop.rules.messages.isAutomatedSubtype(i.subtype);if(U||"thread_broadcast"===i.subtype)y=true;else if(I==M&&!U)if(!i.subtype&&s.subtype&&"file_comment"===s.subtype)y=true;else{if(!s.subtype||TS.templates.builders.getBotIdentifier(s)){var q=s.thread_ts||s.ts;var G=i.thread_ts==q;var W=!i.thread_ts&&!s.thread_ts;(G||W)&&(y=false)}!TS.interop.rules.messages.isTempMsg(i)||"bot_message"!==i.type&&"USLACKBOT"!==i.user||(y=true)}if(!C&&!TS.interop.datetime.isSameDay(w,N)&&!j){k=true;var z=$(g+" div.day_divider");if(z.length>0){var K;var V=$(z[z.length-1]);if(V.length){K="";try{K=TS.templates.messages_day_divider({ts:V.data("ts")})}catch(e){e.message||(e.message="");e.message+=" $last_divider.data('ts'):"+V.data("ts");TS.info("Problem with TS.templates.messages_day_divider 2.1: "+JSON.stringify(e))}V.replaceWith(K)}if(z.length>1){var Y=$(z[z.length-2]);if(Y.length){K="";try{K=TS.templates.messages_day_divider({ts:Y.data("ts")})}catch(e){e.message||(e.message="");e.message+=" $second_last_divider.data('ts'):"+Y.data("ts");TS.info("Problem with TS.templates.messages_day_divider 3.1: "+JSON.stringify(e))}Y.replaceWith(K)}}}}!C&&TS.interop.datetime.distanceInMinutes(w,N)>TS.model.msg_activity_interval&&(x=true)}else j||(x=true);x&&(y=true);"message"!==i.type&&(y=true);("me_message"===i.subtype||s&&"me_message"===s.subtype)&&(y=true);var J=true;u&&(J=false);var Q=false;var X=TS.rxns.getExistingRxnsByKey(i._rxn_key);X&&(Q=true);n.for_mention_rxn_display&&(y=false);var Z;var ee;var te="#msgs_div"===g||"#unread_msgs_div"===g;if(TS.client&&TS.client.highlights&&!u){Z=te&&TS.client.highlights.msgIsHighlight(a.id,i.ts);ee=te&&TS.client.highlights.msgIsHighlightUnfurl(a.id,i.ts)}d=!!(d||C);var ne={msg:i,model_ob:a,member:b,actions:P,show_user:y,unprocessed:C,highlight:o,do_inline_imgs:J,msg_dom_id:E,standalone:u,hide_actions:d,full_date:c,relative_ts:m,jump_link:f,show_resend_controls:i.ts in TS.model.display_unsent_msgs,starred_items_list:p,starred_items_actions:h,no_attachments:l,is_ephemeral:A,enable_slack_action_links:S,is_bot:F,bot_id:D,app_id:O,team_id:H,is_app_data_enabled:B,highlight_as_new:T,show_star:!TS.boot_data.feature_react_messages&&!p&&!A,has_rxns:Q,for_mention_display:n.for_mention_display,for_mention_rxn_display:n.for_mention_rxn_display,for_search_display:n.for_search_display,for_top_results_search_display:n.for_top_results_search_display,ts_tip_delay_class:"ts_tip_delay_600",is_root_msg:n.is_root_msg,is_in_conversation:j,is_threads_view:R,file_title_only:"file_reaction"===i.subtype,is_slackbot_response:"slackbot_response"===i.subtype,show_channel_highlight:Z,is_highlighted_unfurl:ee,show_briefing_feedback:n.briefing||o};var re=TS.utility.msgs.getFileOnMsg(i);(P.add_rxn||P.add_file_rxn||P.add_file_comment_rxn)&&(ne.show_rxn_action=true);ne.star_components=TS.templates.builders.buildStarComponents("message",i,a);var ie=true;u&&(ie=false);TS.interop.rules.messages.isFile(i)&&(ie=false);ne.selectable=ie;j&&(ne.msg_dom_id=TS.templates.makeMsgDomIdInConversation(i.ts));if(TS.interop.messages.isReply(i))ne.show_reply_action=false;else{var ae=true;ne.show_reply_action=TS.replies.canReplyToMsg(a,i,ae)&&!n.is_root_msg;!ne.show_reply_action&&TS.interop.rules.messages.isFile(i)&&re&&(ne.show_comment_action=true)}var se=i.ts==i.thread_ts;if((se||!i.thread_ts)&&j&&TS.client){ne.format_for_thread_root=true;a.is_im||a.is_mpim?ne.model_ob_name=TS.interop.i18n.t("Direct message","messages")():ne.model_ob_name=TS.interop.i18n.t("in {channel_display_name}","messages")({channel_display_name:TS.interop.rules.channels.getDisplayNameForChannel(a)});ne.file_title_only=TS.interop.messages.shouldRenderFileThread(i)}!se||!i.reply_count||j||u||n.for_search_display||n.for_top_results_search_display||n.is_threads_view||(ne.show_reply_bar=true);ne.is_tombstone="tombstone"===i.subtype;ne.is_new_reply=!!n.is_new_reply;if(TS.interop.messages.isReply(i)&&"thread_broadcast"===i.subtype&&!j&&!u&&!n.is_threads_view){ne.is_broadcast=true;ne.show_reply_action=true}if(ne.is_broadcast&&i.root){ne.root_repliers_summary=new Handlebars.SafeString(TS.templates.builders.buildBroadcastRepliersSummaryHTML(i.root));if("tombstone"!==i.root.subtype){var oe=i.root.text;var le=_.first(i.root.attachments);if(_.get(le,"is_msg_unfurl")){var ue=le.from_url&&i.root.text==="<"+le.from_url+">";oe&&!ue||(oe=le.text)}if(oe){var de=TS.format.formatBroadcastExcerpt(oe,i.root);de.length>150&&(de=TS.utility.truncateHTML(de,150));ne.root_excerpt=new Handlebars.SafeString(de)}}}var ce;ce="file_share"===i.subtype||"file_mention"===i.subtype||TS.boot_data.feature_file_threads&&!i.subtype&&re?re:"file_comment"===i.subtype?i.comment:i;ce&&ce.pinned_to&&ce.pinned_to.length>0?ne.is_pinned=_.some(ce.pinned_to,function(e){return e===a.id}):ne.is_pinned=false;ne.is_pinned?ne.pin_html=TS.templates.builders.buildPinInfoHtml(i):ne.pin_html="";if(TS.client&&TS.client.highlights&&!u){ne.is_recap=Z;if(TS.client.highlights.shouldRenderHighlightsUI(a.id,i.ts)){var _e=TS.client.highlights.getHighlight(a.id,i.ts);var me=_e.justification;ne.highlights_html=TS.templates.builders.buildHighlightsInfoHtml({recap:{data:TS.client.highlights.getHighlight(a.id,i.ts),justification:me?TS.format.formatWithOptions(me||"",void 0,{no_linking:true}):"",isLeavingFeedback:TS.client.highlights.msgIsLeavingFeedback(a.id,i.ts)}})}ne.show_recap_debug=TS.client.highlights.canShowRecapDebug(a.id,i.ts);ne.highlight_is_leaving_feedback=TS.client.highlights.msgIsLeavingFeedback(a.id,i.ts)}TS.highlights_briefing&&n.briefing&&(ne.show_recap_debug="sli_debug_info"===TS.highlights_briefing.sli_recaps_debug_group);!i.subtype&&(n.for_search_display||n.for_top_results_search_display)&&re&&(i.comment?ne.star_components=TS.templates.builders.buildStarComponents("file_comment",i.comment,re):ne.star_components=TS.templates.builders.buildStarComponents("file",re,null));if(!TS.interop.rules.messages.isTempMsg(i)&&!i.is_ephemeral){ne.permalink=TS.utility.msgs.constructMsgPermalink(a,i.ts,i.thread_ts);ne.abs_permalink=TS.utility.msgs.constructAbsoluteMsgPermalink(a,i.ts,i.thread_ts)}if((n.for_top_results_search_display||n.for_search_display)&&TS.boot_data.page_needs_enterprise){ne.abs_permalink=i.permalink;ne.archive_link=i.permalink;ne.permalink=i.permalink}if("file_share"===i.subtype||"file_mention"===i.subtype||"file_reaction"===i.subtype||TS.interop.messages.shouldRenderFileThread(i)&&re){if(re){ne.file=re;ne.edit=TS.files.getFileActions(re).edit;ne.download=!("snippet"===re.mode||"post"===re.mode||"space"===re.mode||re.is_external);ne.new_window=!ne.edit&&!ne.download;ne.abs_permalink=re.permalink;p||(ne.star_components=TS.templates.builders.buildStarComponents("file",re,null));$.extend(ne,TS.files.getFileTemplateArguments(re,360));ne.is_message=true;ne.lightbox=true;if(("file_share"===i.subtype||TS.boot_data.feature_file_threads)&&i.upload){"email"===re.mode&&(ne.is_added=true);ne.icon_class=TS.utility.getImageIconClass(re,"thumb_80")}else re.user!=i.user&&(ne.uploader=TS.utility.members.getEntityFromFile(re));!TS.interop.messages.shouldRenderFileThread(i)&&"file_share"===i.subtype&&i.upload&&re.initial_comment&&(ne.show_initial_comment=true);TS.files.isFileAuthorExternal(re)&&(ne.show_comment_action=false)}var fe=TS.templates.builders.msgs.buildFileShareMetaText(i);ne.file_share_html=new Handlebars.SafeString(fe)}else if("file_comment"===i.subtype){s&&!s.no_display&&s.file&&re&&re.id==s.file.id&&(k||(ne.is_file_convo_continuation=true));ne.show_comment_quote_icon=true;if(s&&!s.no_display&&s.file&&re&&re.id==s.file.id){(TS.boot_data.feature_file_threads&&!i.subtype||"file_share"===s.subtype)&&s.upload&&s.file.initial_comment&&(k||(ne.show_comment_quote_icon=false));"file_comment"===s.subtype&&(k||(ne.show_comment_quote_icon=false))}ne.file=re;ne.icon_class=TS.utility.getImageIconClass(re,"thumb_40");ne.comment=i.comment;ne.member=TS.utility.members.getEntityFromMessage(i);re&&re.user!=i.comment.user&&(ne.uploader=TS.utility.members.getEntityFromFile(re));p||(ne.star_components=TS.templates.builders.buildStarComponents("file_comment",i.comment,re))}ne.render_file_thread=TS.interop.messages.shouldRenderFileThread(i);var pe=e(i,ne);ne.msg_classes=pe.join(" ");v+=TS.templates.message(ne);v=TS.format.replaceHighlightMarkers(v);return v}catch(e){var he="";if(i){he="msg.ts:"+i.ts;delete n.model_ob;try{n.msg=_.cloneDeep(i);n.msg.text="REDACTED";n.msg.attachments&&(n.msg.attachments="REDACTED");n.prev_msg&&(n.prev_msg=n.prev_msg.ts);n.msg.channel&&n.msg.channel.id&&(n.msg.channel=n.msg.channel.id);he+=" "+JSON.stringify(n,null,"  ")}catch(e){}}e.message||(e.message="");e.message+=" "+he;TS.warn("Problem in TS.templates.builders.msgs.buildHTML with args: "+JSON.stringify(e.message));e.stack&&TS.info(e.stack);if(TS.boot_data.feature_tinyspeck)return TS.templates.message_failed({subtype:i&&i.subtype?i.subtype:"",msg_ts:i?i.ts:"",model_ob_id:a?a.id:""});return""}},buildFileShareMetaText:function e(r,i){if(!r)return"";var a=TS.utility.msgs.getFileOnMsg(r);if(!a)return"";var s=(TS.boot_data.feature_file_threads&&!r.subtype||"file_share"===r.subtype)&&r.upload;var o=a.user!=r.user&&!s;var l=!t(r);var u=TS.interop.files.getFileMetaTemplate(a);var d;if(o&&l)if(("file_share"===r.subtype||TS.boot_data.feature_file_threads&&!r.subtype)&&r.upload)if(a.initial_comment)d=n.test(a.mode)?u.addedCommentedPossessive:u.uploadedCommentedPossessive;else{if(!n.test(a.mode))return u.uploadedPossessive;d=u.addedPossessive}else d="file_mention"===r.subtype?u.mentionedPossessive:u.sharedPossessive;else d=("file_share"===r.subtype||TS.boot_data.feature_file_threads&&!r.subtype)&&r.upload?a.initial_comment?n.test(a.mode)?u.addedCommented:u.uploadedCommented:n.test(a.mode)?u.added:u.uploaded:"file_mention"===r.subtype?u.mentioned:u.shared;var c=TS.utility.members.getEntityFromFile(a);var _;if(i){var m=TS.interop.members.getPrefCompliantMemberName(c);_=TS.interop.i18n.fullPossessiveString(m)}else{var f=TS.templates.builders.makeMemberPreviewLink(c,false);var p=TS.interop.i18n.possessive(TS.interop.members.getPrefCompliantMemberName(c));var h="client"===TS.boot_data.app?'target="'+a.permalink+'" ':"";var g='<a href="'+a.permalink+'" '+h+'data-file-id="'+a.id+'">';var S=TS.interop.i18n.t("{uploader_name}{uploader_name_affix}","message")({uploader_name:f,uploader_name_affix:p});_="</a> "+S+g}return d({uploader_name_possessive_html:_,file_pretty_name:r&&a&&a.pretty_type?a.pretty_type:""})}});function e(e,t){var n=["message"];e.subtype&&("channel_join"===e.subtype||"group_join"===e.subtype||"app_conversation_join"===e.subtype?n.push("joined","automated"):"channel_leave"===e.subtype||"group_leave"===e.subtype||"app_conversation_leave"===e.subtype?n.push("left","automated"):"channel_topic"===e.subtype||"group_topic"===e.subtype?n.push("topic","automated"):"channel_name"===e.subtype||"group_name"===e.subtype?n.push("rename","automated"):"channel_purpose"===e.subtype||"group_purpose"===e.subtype?n.push("purpose","automated"):"channel_archive"===e.subtype||"group_archive"===e.subtype?n.push("archived","automated"):"channel_unarchive"===e.subtype||"group_unarchive"===e.subtype?n.push("unarchived","automated"):"bot_message"===e.subtype||"thread_broadcast"===e.subtype&&e.bot_id?n.push("bot_message"):"sh_room_shared"===e.subtype?n.push("sh_shared","automated"):"sh_room_created"===e.subtype?n.push("sh_created","automated"):"bot_add"===e.subtype||"bot_remove"===e.subtype||"bot_enable"===e.subtype||"bot_disable"===e.subtype?n.push("bot_change","automated"):"reminder_add"!==e.subtype&&"reminder_delete"!==e.subtype||n.push("reminder_change","automated"));e.alert_type&&"shared_channel_join"===e.alert_type&&n.push("highlight_yellow_bg");TS.boot_data.feature_fix_files&&n.push("feature_fix_files");e.no_display&&n.push("hidden");t.for_search_display&&n.push("for_search_display");t.for_top_results_search_display&&n.push("for_top_results_search_display");t.starred_items_list&&n.push("for_star_display");t.for_mention_display&&n.push("for_mention_display");t.for_mention_rxn_display&&n.push("for_mention_rxn_display");t.is_ephemeral&&n.push("ephemeral");t.unprocessed&&n.push("unprocessed");t.show_resend_controls&&n.push("resend");t.highlight&&n.push("highlight");t.highlight_as_new&&n.push("new");t.app_id&&n.push("is_app");t.is_pinned&&n.push("is_pinned");t.show_channel_highlight&&n.push("show_recap");t.is_highlighted_unfurl&&n.push("is_recap_unfurl");t.highlight_feedback_options&&n.push("has_feedback_options");t.highlight_is_leaving_feedback&&n.push("is_leaving_feedback");t.highlight_has_left_feedback&&n.push("has_left_feedback");t.standalone?n.push("standalone"):n.push("dirty_hover_container");if(t.show_user)n.push("first");else{t.file&&n.push("first");t.is_in_conversation&&n.push("first")}if(t.file){n.push("file_reference");t.is_mention?n.push("file_mention"):n.push("file_share")}t.comment&&(t.is_file_convo_continuation?n.push("comment_continuation"):n.push("first"));t.is_root_msg&&n.push("selected");t.is_new_reply&&n.push("new_reply");t.is_tombstone&&n.push("deleted");if(t.is_recap){n.push("is_recap");n.push("show_recap_highlight")}t.show_recap_debug&&n.push("show_recap_debug");t.is_broadcast&&n.push("thread_broadcast");_.get(t.member,"is_unknown")&&n.push("member_is_unknown");return n}function t(e){var t=TS.utility.msgs.getFileOnMsg(e);if(!t)return false;return t.name===TS.utility.welcome_post.WELCOME_POST_NAME&&"USLACKBOT"===e.user&&t.user===TS.model.user.id}var n=/(snippet)/})()},11240:function(e,t){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("templates.helpers",{onStart:function e(){TS.templates.helpers.register()},register:function a(){Handlebars.registerHelper("debugger",function(){});Handlebars.registerHelper("i18n_ns",function(e){if(!_.isObject(this)){TS.warn('Cannot set i18n namespace "'+e+'". Chances are you\u2019ve inadvertently changed the context in a Handlebars partial to something that\u2019s not an object.');return}this._i18n_ns&&(this._i18n_ns_history?this._i18n_ns_history.push(this._i18n_ns):this._i18n_ns_history=[this._i18n_ns]);this._i18n_ns=e});Handlebars.registerHelper("_i18n_ns_end",function(){this._i18n_ns_history&&this._i18n_ns_history.length&&(this._i18n_ns=this._i18n_ns_history.pop())});Handlebars.registerHelper("i18n_img",function(e){var t=e.fn(this);var n=e&&e.hash&&e.hash.locales?e.hash.locales:null;if(n){n=n.replace(/\s/g,"");n.split(",").indexOf(TS.interop.i18n.locale)>-1&&(t=t.replace(/(\..+$)/,"."+TS.interop.i18n.locale+"$1"))}return t});Handlebars.registerHelper("t",function(e){var t;if("string"===typeof e){t=e;e=arguments[1]}else t=e.fn();var n;n=void 0!==e.hash.ns?e.hash.ns:void 0!==this._i18n_ns?this._i18n_ns:e.data.root&&e.data.root._i18n_ns?e.data.root._i18n_ns:"";var r=this;_.isObject(r)||(r={this:r});var i={};var a;_.forOwn(e.hash,function(e,t){i[t]=r[t];r[t]=Handlebars.Utils.escapeExpression(e)});var s=t.match(/{[^\s}]+}/g);if(s&&s.length){var o=function e(t){var n=t.split(".");if(n.length>1){var i=0;var a=n.length;var s=r;for(i;i<a;i+=1){s=s[n[i]];if(void 0===s)return}return s}return r[t]};var l;var u=0;var d=s.length;for(u;u<d;u+=1){a=s[u].slice(1,-1);if(void 0===e.hash[a]){l=o(a);if(void 0!==l){i[a]=r[a];r[a]=Handlebars.Utils.escapeExpression(l)}}}}if(e.hash.debug){TS.info("debug handlerbars t helper");TS.info(this)}r.__handlebars=true;t=TS.interop.i18n.t(t,n)(r);_.forOwn(i,function(e,t){r[t]=e});return t});Handlebars.registerHelper("zdLocale",function(){return TS.interop.i18n.zdLocale()});Handlebars.registerHelper("hcTrackingToken",function(){return TS.utility.getHCAttributionQS()});Handlebars.registerHelper("exampleEmail",function(e){return TS.utility.exampleEmailAddress(e)});Handlebars.registerHelper("convertTimestampToMilliseconds",function(e){return 1e3*e});Handlebars.registerHelper("i18n_number",function(e){return TS.interop.i18n.number(e)});Handlebars.registerHelper("listify",function(e,t){t.hash.map&&(e=_.map(e,t.hash.map));var n=_.get(t.hash,"conjunction");var r=_.get(t.hash,"strong");var i=_.get(t.hash,"no_escape");var a=TS.interop.i18n.listify(e,{conj:n,strong:r,noEscape:i});return new Handlebars.SafeString(a.join(""))});Handlebars.registerHelper("ifInArray",function(e,t,n){if(t.indexOf(e)>-1)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getDisplayNames",function(e){var t=e.map(function(e){var t=_.isString(e)?e:e.id;return TS.interop.members.getPrefCompliantMemberNameById(t,true,false)});return t});Handlebars.registerHelper("isClient",function(e){if("client"===TS.boot_data.app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isChrome",function(e){if(TS.model.is_chrome_desktop||TS.model.is_chrome_mobile)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isFF",function(e){if(TS.model.is_FF)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isSafariDesktop",function(e){if(TS.model.is_safari_desktop)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isWeb",function(e){if("web"===TS.boot_data.app||"space"===TS.boot_data.app||"calls"===TS.boot_data.app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isMac",function(e){if(TS.model.is_mac)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isWin",function(e){if(TS.model.is_win)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isLin",function(e){if(TS.model.is_lin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isOurApp",function(e){if(TS.model.is_our_app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("needCrossWorkspaceLink",function(e,t){if(TS.model.is_our_app&&e&&(TS.enterprise.getChannelById(e.id)||TS.enterprise.getGroupById(e.id)))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isCrossWorkspace",function(e,t){if(e&&(TS.enterprise.getChannelById(e.id)||TS.enterprise.getGroupById(e.id)))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessOurApp",function(e){return Handlebars.helpers.isOurApp.call(this,{fn:e.inverse,inverse:e.fn,hash:e.hash})});Handlebars.registerHelper("isMacAppStorebuild",function(e){if(TSSSB.call("isAppStoreBuild")&&navigator.userAgent.match("MacAppStore"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("feature",function(e){var t=e.hash.flag;if(1==TS.qs_args[t]||1==TS.boot_data[t])return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("pageNeedsEnterprise",function(e){if(TS.boot_data.page_needs_enterprise)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("sharedChannelsEnabled",function(e){if(TS.permissions.members.canRequestSharedChannel())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("canDisconnectSharedChannels",function(e){if(TS.permissions.members.canDisconnectSharedChannels())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isChannelRequired",function(e,t){return TS.interop.rules.channels.isRequired(e)?t.fn(this):t.inverse(this)});Handlebars.registerHelper("canPostInModelOb",function(e,t){return TS.permissions.members.canPostInModelOb(TS.model.user,e)?t.fn(this):t.inverse(this)});Handlebars.registerHelper("experiment",function(e){var t=e.hash.name;var n=e.hash.group||"treatment";if(TS.experiment.getGroup(t)===n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("enterprisePOEmail",function(){if(TS.boot_data.page_needs_enterprise){var e=TS.redux.enterprise.getEnterprise().primary_owner.email;return e}return""});Handlebars.registerHelper("versioned_x_icon",function(){return cdn_url+"/52b9/img/enterprise/icon_times_in_circle.svg"});Handlebars.registerHelper("comments",function(e){return new Handlebars.SafeString(TS.templates.builders.buildComments(e))});Handlebars.registerHelper("comment_standalone",TS.templates.builders.buildCommentStandalone);Handlebars.registerHelper("star",function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildStar(e,t,n))});Handlebars.registerHelper("starWithTip",function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildStarWithTip(e,t,n))});Handlebars.registerHelper("inlineRoomPreviewToggler",TS.templates.builders.buildInlineRoomPreviewToggler);Handlebars.registerHelper("isInlineFilePreviewExpanded",function(e){var n=e.hash.container_id;var r=e.hash.file_id;var i=360;var a=false;var s=t(r,i);a=s?TS.inline_imgs.shouldExpand(n,TS.model.inline_imgs[s]):TS.inline_file_previews.shouldExpand(n,r);if(a)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("shouldTruncateInlineFilePreview",function(e,t){"string"===typeof e&&(e=TS.files.getFileById(e));if(e&&TS.inline_file_previews.shouldTruncate(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("shouldNotTruncateInlineFilePreview",function(e,t){return Handlebars.helpers.shouldTruncateInlineFilePreview.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("isInlineFilePreviewTruncated",function(e,t,n){"string"===typeof t&&(t=TS.files.getFileById(t));if(t&&TS.inline_file_previews.isTruncated(e,t))return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("isInlineFilePreviewNotTruncated",function(e,t,n){return Handlebars.helpers.isInlineFilePreviewTruncated.call(this,e,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})});Handlebars.registerHelper("formatActionLink",function(e,t,n){if(!e)return"";var r="<"+e.url+"|"+e.title+">";var i=TS.format.formatWithOptions(r,t,{no_highlights:true,no_specials:true,enable_slack_action_links:true===n});return new Handlebars.SafeString(i)});Handlebars.registerHelper("ellipsize",function(e,t){TS.info("len"+t);return TS.utility.ellipsize(e,t)});Handlebars.registerHelper("stripWhitespace",function(e){return e.replace(/\s+/g,"")});Handlebars.registerHelper("cash",function(e){var t=e.hash.all_digits||false;var n=e.hash.currency_code||"USD";var r=parseInt(e.hash.value,10);var i=TS.utility.money.formatMoney(r,n,{all_digits:t});return i});Handlebars.registerHelper("possessive",function(e){return TS.interop.i18n.possessive(e)});Handlebars.registerHelper("fullPossessiveString",function(e){return TS.interop.i18n.fullPossessiveString(e)});Handlebars.registerHelper("possessiveForMemberById",function(e){var t=TS.interop.members.getMemberById(e);if(!t)return"";return Handlebars.helpers.possessiveForMember(t)});Handlebars.registerHelper("possessiveForMember",function(e){var t=TS.interop.members.getPrefCompliantMemberName(e);return TS.interop.i18n.possessive(t)});Handlebars.registerHelper("concatStr",function(){return Array.prototype.slice.call(arguments,0,arguments.length-1).join("")});Handlebars.registerHelper("initialsSafe",function(e){var t=TS.interop.utility.getInitials(e,{numLetters:2});return new Handlebars.SafeString(t)});Handlebars.registerHelper("json",function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&null!==e&&"json"===e.name)return JSON.stringify(this);return JSON.stringify(e)});Handlebars.registerHelper("prettyJson",function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&null!==e&&"json"===e.name)return JSON.stringify(this,null,2);return JSON.stringify(e,null,2)});Handlebars.registerHelper("currentTeamName",function(){return _.escape(_.get(TS.model.team,"name",""))});Handlebars.registerHelper("currentTeamHostSafe",function(){return new Handlebars.SafeString(window.location.hostname)});Handlebars.registerHelper("canUserCreateGroups",function(e){return TS.permissions.members.canCreateGroups()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canCreateMpims",function(e){return TS.permissions.members.canCreateMpims()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canKickFromChannels",function(e){return TS.permissions.members.canKickFromChannels()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canKickFromGroups",function(e){return TS.permissions.members.canKickFromGroups()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("shouldShowMemberEmail",function(e){return e.is_self||TS.prefs.getTeamPref("display_email_addresses")});Handlebars.registerHelper("teamUsesCustomizedCustomStatusPresets",function(e){return TS.prefs.getTeamPref("uses_customized_custom_status_presets")?e.fn(this):e.inverse(this)});Handlebars.registerHelper("numberWithMax",function(e,t){if(e>=t)return t-1+"+";return e});Handlebars.registerHelper("convertFilesize",function(e){return TS.interop.utility.convertFilesize(e)});Handlebars.registerHelper("roundToThree",function(e){return TS.utility.roundToThree(e)});Handlebars.registerHelper("toDate",function(e){return TS.interop.datetime.toDate(e)});Handlebars.registerHelper("toCalendarDate",function(e){return TS.interop.datetime.toCalendarDate(e)});Handlebars.registerHelper("toCalendarDateShort",function(e){var t={shortenMonth:true};return TS.interop.datetime.toCalendarDate(e,t)});Handlebars.registerHelper("toCalendarDateOrNamedDay",function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e)});Handlebars.registerHelper("toCalendarDateIfYesterdayOrToday",function(e){return TS.interop.datetime.toCalendarDateIfYesterdayOrToday(e)});Handlebars.registerHelper("toCalendarDateOrNamedDayShort",function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e,{shortenMonth:true})});Handlebars.registerHelper("dayDividerPretty",function(e){return TS.interop.datetime.formatDate(e,"{day_divider_pretty}")});Handlebars.registerHelper("toTime",function(e,t,n){e&&!_.isObject(e)||(e=window.moment().unix());return TS.interop.datetime.toTime(e,{do24hrTime:TS.utility.date.do24hrTime(),includeMeridiem:false!==t,includeSeconds:true===n})});Handlebars.registerHelper("toTimeShort",function(e){if(TS.utility.date.do24hrTime())return TS.interop.datetime.toTime(e,{timeFormat:"HH:mm"});return TS.interop.datetime.toTime(e,{timeFormat:"h:mm"})});Handlebars.registerHelper("toTimeAgo",function(e){return TS.interop.datetime.toTimeAgo(e,{alwaysAgo:true})});Handlebars.registerHelper("toTimeAgoShort",function(e,t){t=!!_.isBoolean(t)&&t;var n=TS.interop.datetime.toTimeAgo(e,{compact:t,alwaysAgo:true});var r='<span class="relative_ts" data-ts="'+_.escape(e)+'" data-really-short="'+!!t+'">'+_.escape(n)+"</span>";return new Handlebars.SafeString(r)});Handlebars.registerHelper("toTimeDuration",function(e){return TS.interop.datetime.toTimeDuration(e)});Handlebars.registerHelper("msgTsTitle",function(e,t){var n;var r;var i=TS.model.unread_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInUnreadView(e.ts);var a=TS.model.threads_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInThreadsView(e.ts);var s=TS.client&&TS.ui.replies.activeConvoThreadTs()===e.thread_ts&&_.isString(t)&&TS.templates.makeMsgDomIdInConversation(e.ts)===t;i?r=TS.interop.i18n.t("Jump to conversation","templates_helpers")():a?r=e.ts===e.thread_ts?TS.interop.i18n.t("Open in channel","templates_helpers")():TS.interop.i18n.t("Open in sidebar","templates_helpers")():s&&e.ts===e.thread_ts&&(r=TS.interop.i18n.t("Open in channel","templates_helpers")());var o=TS.interop.i18n.t("{date} at {time}","templates_helpers")({date:TS.interop.datetime.toCalendarDateOrNamedDay(e.ts,{shortenMonth:true}),time:TS.interop.datetime.toTime(e.ts,{do24hrTime:TS.utility.date.do24hrTime(),includeSeconds:true})}).replace(/\s/g,"&nbsp;");n=r?r+'<br><span class="subtle_silver no_wrap">'+o+"</span>":o;return new Handlebars.SafeString(n)});Handlebars.registerHelper("toHour",function(e){return TS.interop.datetime.toHour(e)});Handlebars.registerHelper("memberLocalTime",function(e){var t=e&&e.tz?e.tz:"America/Los_Angeles";var n=TS&&TS.boot_data&&TS.boot_data.dst_offsets&&TS.boot_data.dst_offsets[e.tz]&&TS.boot_data.dst_offsets[e.tz].tz_offset?TS.boot_data.dst_offsets[e.tz].tz_offset:-25200;var r=TS.interop.datetime.memberLocalTime(Date.now(),{timeZone:t,timeZoneOffset:n,do24hrTime:TS.utility.date.do24hrTime()});var i=TS.interop.i18n.t('<span class="timezone_value">{local_time}</span> local time',"date_utilities")({local_time:r});return new Handlebars.SafeString(i)});Handlebars.registerHelper("memberUTCOffset",function(e){return TS.utility.date.memberUTCOffset(e)});Handlebars.registerHelper("isInDifferentTimeZone",function(e,t){if(e.tz_offset!==TS.model.user.tz_offset)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isToday",function(e,t){if(TS.interop.datetime.isToday(TS.interop.datetime.toDateObject(e)))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("toMonthYearFormat",function(e){return TS.interop.datetime.toCalendarDate(e,{excludeDay:true})});Handlebars.registerHelper("if_equal",function(t,n){n=e(n);if(t==n.hash.compare)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("if_not_equal",function(t,n){n=e(n);if(t!=n.hash.compare)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("if_gt",function(t,n){n=e(n);if(t>n.hash.compare)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("if_lt",function(t,n){n=e(n);if(t<n.hash.compare)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("or",function(t,n,r){r=e(r);if(t||n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("and",function(t,n,r){r=e(r);if(t&&n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("foreach",function(e,t){if(t.inverse&&!e.length)return t.inverse(this);return e.map(function(n,r){var i={index:r,value:n,length:e.length};i.first=0===r;i.last=r===e.length-1;return t.fn(i)}).join("")});Handlebars.registerHelper("repeat",function(e,t){var n="";for(var r=0;r<e;r+=1)n+=t.fn(r);return n});Handlebars.registerHelper("makeDayDividerDomId",function(e){return TS.templates.makeDayDividerDomId(e)});Handlebars.registerHelper("getFileShareMetaTextHtml",function(e){var t=TS.templates.builders.msgs.buildFileShareMetaText(e);return new Handlebars.SafeString(t)});Handlebars.registerHelper("formatFileTitle",function(e){return new Handlebars.SafeString(TS.templates.builders.formatFileTitle(e))});Handlebars.registerHelper("formatMessageByType",function(e,t,n,r,i){return new Handlebars.SafeString(TS.templates.builders.formatMessageByType(e,t,n,r,i))});Handlebars.registerHelper("formatAttachments",function(e,t,n,r){return new Handlebars.SafeString(TS.templates.builders.formatAttachments(e,t,n,r))});Handlebars.registerHelper("formatMessage",function(e,t){return new Handlebars.SafeString(TS.format.formatDefault(e,t))});Handlebars.registerHelper("formatNoHighlightsNoSpecials",function(e,t){return TS.format.formatNoHighlightsNoSpecials(e,t)});Handlebars.registerHelper("formatMessageAttachmentPartEscaped",TS.utility.attachments.formatMessageAttachmentPart);Handlebars.registerHelper("formatMessageAttachmentPart",function(e,t,n,r,i,a){return new Handlebars.SafeString(TS.utility.attachments.formatMessageAttachmentPart(e,t,n,r,i,a))});Handlebars.registerHelper("formatMessageAttachmentSlackFooter",function(e,t){var n;if(TS.boot_data.feature_grid_archive_link_fixes){if(!e.channel_name||!e.channel_id){n=TS.format.formatJustText(TS.format.cleanMsg(e.footer));return new Handlebars.SafeString(n)}n=TS.utility.attachments.getSlackMessageFooterText(e,t,true)}else n=TS.format.formatJustText(TS.format.cleanMsg(e.footer));return new Handlebars.SafeString(n)});Handlebars.registerHelper("formatTopicOrPurpose",function(e){return new Handlebars.SafeString(TS.utility.formatTopicOrPurpose(e))});Handlebars.registerHelper("unFormatMessage",function(e,t){return TS.format.unFormatMsg(e,t)});Handlebars.registerHelper("formatMessageResult",function(e){e=TS.format.formatJustText(e);e=TS.utility.msgs.handleSearchHighlights(e);return e});Handlebars.registerHelper("formatCurrentStatus",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,t))});Handlebars.registerHelper("formatCurrentStatusWithoutAnimations",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,_.assign({stop_animations:true},t)))});Handlebars.registerHelper("rxnPanel",function(e){var t=TS.templates.builders.rxnPanel(e);if(!t)return"";return new Handlebars.SafeString(t)});Handlebars.registerHelper("makeRefererSafeLink",function(e){if("string"!==typeof e.hash.url)return"";return new Handlebars.SafeString(TS.utility.makeRefererSafeLink(e.hash.url))});Handlebars.registerHelper("makeSafeForDomId",TS.utility.makeSafeForDomId);Handlebars.registerHelper("makeMsgAttachmentTextExpanderDomId",TS.templates.makeMsgAttachmentTextExpanderDomId);Handlebars.registerHelper("makeMsgDomId",TS.templates.makeMsgDomId);Handlebars.registerHelper("makeMsgLabelDomId",TS.templates.makeMsgLabelDomId);Handlebars.registerHelper("makeMSRDomId",TS.templates.makeMSRDomId);Handlebars.registerHelper("makeMSRDomIdWithModule",TS.templates.makeMSRDomIdWithModule);Handlebars.registerHelper("makeSHRoomClass",TS.templates.makeSHRoomClass);Handlebars.registerHelper("makeMemberColorClass",function(){return TS.templates.builders.makeMemberColorClass.apply(this,arguments)});Handlebars.registerHelper("buildMsgHTMLForSearch",function(){var e=TS.templates.builders.buildMsgHTMLForSearch.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("buildMsgHTMLForSearchTopResults",function(){var e=TS.templates.builders.buildMsgHTMLForSearchTopResults.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("ifExtracts",function(e,t){if(e.previous||e.previous_2||e.next||e.next_2)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("willForceExtracts",function(e,t){if(!e.previous&&!e.next||TS.search.view.resultHasExtracts(e))return t.inverse(this);var n=TS.search.query;var r=n.split(" ");var i;var a;var s=false;for(i=0;i<r.length;i+=1){a=_.trim(r[i]);if(a.length>0&&!TS.search.keyword_modifier_pair_regex.test(a)){s=true;break}}if(!s)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("formatAttachmentExtracts",function(e,t){var n=e.color||"e3e4e6";return TS.templates.search_attachment_extracts({attachment:e,message:t,bg_color:n})});Handlebars.registerHelper("getAttachmentAuthorMemberId",function(e){var t=TS.utility.attachments.getDecoratedAttachment(e);if(!t)return"";return t._slack_author_id||""});Handlebars.registerHelper("concatMsgExtracts",function(e){if(!e.extracts||0===e.extracts.length)return"";var t=TS.templates.builders.search_ellipsis;var n=e.extracts.map(function(n){n.text&&(n.text=n.text.replace(/&&gt;t;>&gt;/g,"&gt;&gt;&gt;"));var r=TS.format.replaceHighlightMarkers(n.text);if(TSF.jumbomoji_rx.match(r))return TS.format.formatDefault(r,e);var i=TS.format.formatWithOptions(n.text,e,{custom_linebreak:t});i=TS.utility.msgs.handleSearchHighlights(i);return i});var r=n.join(t);e.extracts[0].truncated_head&&(r=t+r);e.extracts[e.extracts.length-1].truncated_tail&&(r+=t);return r});Handlebars.registerHelper("concatAttachmentExtracts",function(e,t){var n=[];var r=e.extracts;var i;var a=TS.templates.builders.search_ellipsis;if(!r||0===r.length)return"";["title","text"].forEach(function(e){r[e]&&r[e].forEach(function(e){var r=TS.format.formatWithOptions(e.text,t,{custom_linebreak:a});r=TS.utility.msgs.handleSearchHighlights(r);0===n.length&&e.truncated_head&&(r=a+r);i=e;n.push(r)})});var s=n.join(a);s&&i&&i.truncated_tail&&(s+=a);s||!r.fields||r.fallback||r.fields.forEach(function(e){var t=_.escape(e.value.text);t=TS.utility.msgs.handleSearchHighlights(t);e.value.truncated_head&&(t=a+t);e.value.truncated_tail&&(t+=a);s+="<strong>"+_.escape(e.title)+"</strong> &bull; "+t+"<br>"});if(!s&&e.fallback){var o=e.fallback;r.fallback&&r.fallback.length>0&&(o=r.fallback[0].text);var l=TS.format.formatWithOptions(o,t,{custom_linebreak:a});l=TS.utility.msgs.handleSearchHighlights(l);return l}return s});Handlebars.registerHelper("newWindowName",TS.templates.builders.newWindowName);Handlebars.registerHelper("nl2br",function(e){if(!e)return e;e=_.escape(e);return e.replace(/\n/g,"<br />").replace(/&amp;#95;/g,"_")});Handlebars.registerHelper("smartnl2br",function(e){if(!e)return e;e=_.escape(e);e=e.replace(/\n\r\n\r/g,'<span class="para_break"><br /></span>');e=e.replace(/\n\r\n/g,'<span class="para_break"><br /></span>');e=e.replace(/\n\n/g,'<span class="para_break"><br /></span>');e=e.replace(/\n/g,"<br />");return new Handlebars.SafeString(e.replace(/&amp;#95;/g,"_"))});Handlebars.registerHelper("truncate",function(e,t){var n=truncate(e,t);return n.replace(/&#64;/g,"@")});Handlebars.registerHelper("truncateToNearestWordBoundary",TS.utility.truncateToNearestWordBoundary);Handlebars.registerHelper("proxyImgUrls",function(e){var t=$("<div>"+e+"</div>");TS.templates.builders.proxyImgUrlsForEmails(t);return t.html()});Handlebars.registerHelper("stripImageTags",function(e){var t=$("<div>"+e+"</div>");var n=t.find("img").remove().end().html();return new Handlebars.SafeString(n)});Handlebars.registerHelper("generalName",function(){var e=TS.interop.channels.getGeneralChannel();return e?e.name:""});Handlebars.registerHelper("makeChannelDomId",function(e){return TS.templates.makeChannelDomId(e)});Handlebars.registerHelper("makeLinksFromModelObs",function(e){return new Handlebars.SafeString(TS.templates.builders.makeLinksFromModelObs(e,{new_lines:true,overflow_ellipsis:true}))});Handlebars.registerHelper("makeChannelDragData",function(e){return TS.templates.makeChannelDragData(e)});Handlebars.registerHelper("makeFileDragData",function(e){return TS.templates.makeFileDragData(e)});Handlebars.registerHelper("ChannelNameMaxLength",function(){return TS.model.channel_name_max_length});Handlebars.registerHelper("ChannelPurposeMaxLength",function(){return TS.model.channel_purpose_max_length});Handlebars.registerHelper("ChannelTopicMaxLength",function(){return TS.model.channel_topic_max_length});Handlebars.registerHelper("makeUnreadMsgsDomId",function(e){return TS.templates.makeUnreadMsgsDomId(e)});Handlebars.registerHelper("getCorGNameWithPrefixById",function(e,t){var n=TS.redux.channels.getEntityById(e);if(!n){var r="getCorGNameWithPrefixById: Could not find model ob for ID "+e;TS.warn(r);if(t)return;return e}if(n.is_group)return TS.model.group_prefix+n.name;if(n.is_channel)return new Handlebars.SafeString(TS.templates.builders.makeChannelPrefix(n)+n.name);if(t)return;return e});Handlebars.registerHelper("makeChannelPrefix",function(e){return new Handlebars.SafeString(TS.templates.builders.makeChannelPrefix(e))});Handlebars.registerHelper("makeChannelLink",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.makeChannelLink(e,t))});Handlebars.registerHelper("makeModelObNameForDisplay",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(e,t))});Handlebars.registerHelper("makeChannelPath",TS.templates.builders.makeChannelPath);Handlebars.registerHelper("makeChannelLinkEnterpriseSearchResult",function(e){return new Handlebars.SafeString(TS.templates.builders.makeChannelLinkEnterpriseSearchResult(e))});Handlebars.registerHelper("makeChannelLinkById",function(e){var t=TS.interop.channels.getChannelById(e);if(t)return TS.templates.builders.makeChannelLink(t)});Handlebars.registerHelper("makeChannelLinkAriaLabelSafe",TS.templates.builders.makeChannelLinkAriaLabelSafe);Handlebars.registerHelper("makeUnreadHighlightDomId",function(e){return TS.templates.makeUnreadHighlightDomId(e)});Handlebars.registerHelper("makeChannelDomClass",function(e){var t="";TS.model.active_channel_id!=e.id||TS.client.activeChannelIsHidden()||(t+="active ");e.unread_cnt>0&&(t+="unread ");e.unread_highlight_cnt>0&&(t+="mention ");e.is_starred&&(t+="is_starred ");TS.notifs.isCorGMuted(e.id)&&(t+="muted_channel ");(e._show_in_list_even_though_no_unreads||_.trim(e.last_msg_input))&&(t+="show_in_list_even_though_no_unreads ");return t});Handlebars.registerHelper("makeChannelOrGroupLinkById",function(e,t){var n=TS.redux.channels.getEntityById(e);var r="";n.is_mpim?r=TS.templates.builders.makeMpimLink(n,false):n.is_group?r=TS.templates.builders.makeGroupLink(n,{omit_prefix:t}):n.is_channel&&(r=TS.templates.builders.makeChannelLink(n,{omit_prefix:t}));return new Handlebars.SafeString(r)});Handlebars.registerHelper("makeChannelOrGroupSSBLinkById",function(e){var t=TS.redux.channels.getEntityById(e);if(!t)return;var n;var r="slack://channel?team="+TS.model.team.id+"&id="+e;if(t.is_group||t.is_private){n=TS.model.group_prefix+t.name;return"<a href="+r+">"+n+"</a>"}if(t.is_channel){var i=TS.interop.channels.getChannelById(e);n="#"+i.name;return"<a href="+r+">"+n+"</a>"}});Handlebars.registerHelper("isEnterpriseTeam",function(e){return TS.boot_data.page_needs_enterprise?e.fn(this):e.inverse(this)});Handlebars.registerHelper("isLocalTeam",function(t,n){n=e(n);if(!TS.boot_data.page_needs_enterprise)return n.inverse(this);if(t==TS.model.team.id)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("currentEnterpriseName",function(){if(!TS.boot_data.page_needs_enterprise)return"";var e=TS.redux.enterprise.getEnterpriseOrgName();return e||""});Handlebars.registerHelper("getEnterpriseOrgURL",function(){if(!TS.boot_data.page_needs_enterprise)return"";return TS.interop.enterprise.getOrgURL()});Handlebars.registerHelper("isOnEnterpriseTeam",function(e){if(!TS.boot_data.page_needs_enterprise)return e.inverse(this);return TS.model.user.enterprise_user.teams.indexOf(e.hash.team_id)>-1?e.fn(this):e.inverse(this)});Handlebars.registerHelper("isModelObPendingExtShared",function(e,t){if(TS.interop.rules.channels.isPendingExternallySharedChannel(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isModelObExtShared",function(e,t){if(TS.interop.utility.isModelObjectExternal(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("shouldUseInitialsIcon",function(e,t,n){if(e&&e.icon&&(e.icon.image_default||t))return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("makeTeamlabel",function(e,t){var n=TS.templates.builders.makeTeamlabel(e,t);return new Handlebars.SafeString(n)});Handlebars.registerHelper("makeTeamNameList",function(e,t){t=t||{};t=t.hash||t;if(!e)return"";var n=TS.interop.i18n.listify(_.map(e,TS.teams.getTeamNameById),t).join("");if(n)return new Handlebars.SafeString(n)});Handlebars.registerHelper("makeGroupDomId",function(e){return TS.templates.makeGroupDomId(e)});Handlebars.registerHelper("groupPrefix",function(){return new Handlebars.SafeString(TS.model.group_prefix)});Handlebars.registerHelper("makeGroupLink",function(e,t){t=t||{};t=t.hash||t;var n=TS.templates.builders.makeGroupLink(e,t);return new Handlebars.SafeString(n)});Handlebars.registerHelper("makeGroupLinkById",function(e){var t=TS.interop.channels.getGroupById(e);if(t)return TS.templates.builders.makeGroupLink(t)});Handlebars.registerHelper("makeGroupLinkAriaLabelSafe",TS.templates.builders.makeGroupLinkAriaLabelSafe);Handlebars.registerHelper("makeGroupDomClass",function(e){var t="";TS.model.active_group_id!=e.id||TS.client.activeChannelIsHidden()||(t+="active ");e.unread_cnt>0&&(t+="unread ");e.unread_highlight_cnt>0&&(t+="mention ");e.is_starred&&(t+="is_starred ");TS.notifs.isCorGMuted(e.id)&&(t+="muted_channel ");(e._show_in_list_even_though_no_unreads||_.trim(e.last_msg_input))&&(t+="show_in_list_even_though_no_unreads ");return t});Handlebars.registerHelper("mpimMemberCount",function(e){return TS.mpims.getMemberCount(e)});Handlebars.registerHelper("mpimDisplayName",function(e,t,n,r,i){t=true===t;i=true===i;var a=TS.mpims.legacyGetDisplayName(e,t,true===n,r,i);if(t||i)return new Handlebars.SafeString(a);return a});Handlebars.registerHelper("makeMpimDomClass",function(e){var t="";if(!e)return t;e.id!==TS.model.active_mpim_id||TS.client.activeChannelIsHidden()||(t+="active ");(e.unread_cnt>0||e.unread_highlight_cnt>0)&&(t+="unread mention ");TS.notifs.isCorGMuted(e.id)&&(t+="muted_channel ");e.is_starred&&(t+="is_starred ");_.trim(e.last_msg_input)&&(t+="show_in_list_even_though_no_unreads ");return t});Handlebars.registerHelper("makeMpimDomId",function(e){return TS.templates.makeMpimDomId(e)});Handlebars.registerHelper("makeMpimLink",function(e,t){var n=TS.templates.builders.makeMpimLink(e,t);return new Handlebars.SafeString(n)});Handlebars.registerHelper("mpimArchivesPath",function(e){return"/archives/"+e.id});Handlebars.registerHelper("isCorGMuted",function(e,t){if(TS.notifs.isCorGMuted(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("currentUserId",function(){return TS.model.user.id});Handlebars.registerHelper("makeMemberDomId",function(e){return TS.templates.makeMemberDomId(e)});Handlebars.registerHelper("makeChannelListDomId",function(e){return TS.templates.makeChannelListDomId(e)});Handlebars.registerHelper("makeMemberPresenceDomClass",function(e){return TS.templates.makeMemberPresenceDomClass(e.id)});Handlebars.registerHelper("makeMemberPresenceIcon",function(e){TS.client||TS.warn("Presence icons should not be used outside of the client application, because they rely on a WS connection to keep presence up to date. Rendering anyway, but be careful out there!");return new Handlebars.SafeString(TS.templates.makeMemberPresenceIcon(e))});Handlebars.registerHelper("makeMemberTypeBadge",function(){var e=TS.templates.builders.makeMemberTypeBadge.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberTypeBadgeCompact",function(){var e=TS.templates.builders.makeMemberTypeBadgeCompact.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberStatusDomClass",function(e){return TS.templates.makeMemberStatusDomClass(e.id)});Handlebars.registerHelper("makeMemberDomClass",function(e){var t="";if(!e)return t;var n=TS.redux.presence.getPresenceByMemberId(e.id);e.is_self||"away"!==n||(t+="away ");if(TS.model.active_im_id){var r=TS.interop.channels.getImById(TS.model.active_im_id);r.user!=e.id||TS.client.activeChannelIsHidden()||(t+="active ")}var i=TS.redux.channels.getImByMemberId(e.id);if(i){(i.unread_cnt>0||i.unread_highlight_cnt>0)&&(t+="unread mention ");i.is_starred&&(t+="is_starred ");_.trim(i.last_msg_input)&&(t+="show_in_list_even_though_no_unreads ")}return t});Handlebars.registerHelper("showDraftIcon",function(e,t){if(TS.templates.builders.showDraftIcon(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeMemberListDomClass",function(e){var t="member ";var n=TS.redux.presence.getPresenceByMemberId(e.id);"away"===n&&(t+="away ");return t});Handlebars.registerHelper("makeMemberPreviewLink",function(){var e=TS.templates.builders.makeMemberPreviewLink.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberPreviewLinkById",function(e,t){true!==t&&(t=false);var n=TS.redux.members.getPotentiallyUnknownMemberById(e);n&&!n.is_non_existent||(n=TS.interop.bots.getBotById(e));if(!n)return new Handlebars.SafeString(_.escape(e));return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLink(n,t))});Handlebars.registerHelper("makeMemberPreviewLinkImage",function(){return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLinkImage.apply(this,arguments))});Handlebars.registerHelper("makeMemberPreviewCardLinkImage",function(){return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewCardLinkImage.apply(this,arguments))});Handlebars.registerHelper("makeProfileImage",TS.templates.builders.makeProfileImage);Handlebars.registerHelper("makePendingUserImage",function(){return new Handlebars.SafeString(TS.templates.builders.makePendingUserImage.apply(this,arguments))});Handlebars.registerHelper("emojiGraphicReplace",function(e,t){var n={};t&&"string"===typeof t?n.force_style=t:n.obey_emoji_mode_pref=true;return new Handlebars.SafeString(TS.emoji.graphicReplace(e,n))});Handlebars.registerHelper("emojiGraphicReplaceByName",function(e){return TS.emoji.graphicReplace(":"+e+":")});Handlebars.registerHelper("emojiModePref",function(){return TS.interop.rules.emoji.getEmojiMode()});Handlebars.registerHelper("makeUsernameImage",function(e,t){var n;var r;var a;var s;var o;var l=TS.redux.bots.getBotByMsg(e);e.icons?o=e.icons:l&&l.icons?o=l.icons:e.bot_profile&&e.bot_profile.icons&&(o=e.bot_profile.icons);o&&(o.image_36&&!TS.environment.is_retina?n=o.image_36:o.image_72&&TS.environment.is_retina?n=o.image_72:o.image_48?n=o.image_48:o.emoji&&":"===o.emoji.substr(0,1)&&":"===o.emoji.substr(o.emoji.length-1,1)&&(a=o.emoji));var u={};var d=TS.templates.builders.makeBotLink(l,u);var c=e&&e.is_ephemeral&&"slackbot"===e.username?TS.interop.members.getMemberById("USLACKBOT"):null;switch(t){case 24:r="thumb_24";s=cdn_url+"/66f9/img/avatars/ava_0002-24.png";c&&(s=c.profile.image_24);break;case 32:r="thumb_32";s=cdn_url+"/0180/img/avatars/ava_0002-32.png";c&&(s=c.profile.image_32);break;case 36:r="thumb_36";s=cdn_url+"/66f9/img/avatars/ava_0002-48.png";c&&(s=c.profile.image_48);break;case 72:r="thumb_72";s=cdn_url+"/66f9/img/avatars/ava_0002-72.png";c&&(s=c.profile.image_72);break;case 192:r="thumb_192";s=cdn_url+"/7fa9/img/avatars/ava_0002-192.png";c&&(s=c.profile.image_192);break;default:r="thumb_48";s=cdn_url+"/7fa9/img/avatars/ava_0002-192.png";c&&(s=c.profile.image_48);break}var m;if(n)if(e.bot_profile&&TS.interop.bots.isBotExternal(e.bot_profile)){u.classes="member_image "+r;u.style="background-image:url('"+n+"')";u.external_badge=TS.templates.member_type_external_badge({team:TS.teams.getTeamById(e.bot_profile.team_id),size:t,badge_size:i(16),with_tooltip:true});d=TS.templates.builders.makeBotLink(l,u);m=""+d.start_a+d.end_a}else m=d.start_a+'<img style="border: 0" src="'+n+'" class="member_image '+r+'" />'+d.end_a;else m=a?d.start_a+'<div style="border: 0" class="member_image '+r+'">'+TS.emoji.graphicReplace(_.escape(a))+"</div>"+d.end_a:c?d.start_a+'<img src="'+s+'" class="member_image '+r+'" />'+d.end_a:d.start_a+'<img src="'+s+'" class="member_image bot_icon_default '+r+'" />'+d.end_a;return new Handlebars.SafeString(m)});Handlebars.registerHelper("getMemberPreviewLinkImageArgs",function(e,t,n,i,a,s,o){var l;l="object"===("undefined"===typeof e?"undefined":r(e))?e:TS.interop.members.getMemberById(e);if(!l||!l.profile)return"";n=true===n;i=true===i;a=true===a;s=true===s;o="string"===typeof o&&o;"USLACKBOT"===e&&o&&(l=TS.utility.slackbot.getWithFeels(o));var u;var d;var c;d="background-image: ";c=[];switch(t){case 20:u=TS.environment.is_retina?l.profile.image_48:l.profile.image_24;break;case 24:u=TS.environment.is_retina?l.profile.image_48:l.profile.image_24;break;case 32:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_32;break;case 36:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;break;case 48:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;break;case 56:u=TS.environment.is_retina?l.profile.image_192:l.profile.image_72;break;case 72:u=TS.environment.is_retina?l.profile.image_192:l.profile.image_72;break;case 192:u=TS.environment.is_retina?l.profile.image_512||l.profile.image_192:l.profile.image_192;break;case 512:u=TS.environment.is_retina?l.profile.image_1024||l.profile.image_512||l.profile.image_192:l.profile.image_512||l.profile.image_192;break;default:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;break}c.push("url('"+u+"')");if(512===t){var _=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;c.push("url('"+_+"')")}d=n?c.length?c.join(", "):"":c.length?d+c.join(", "):"";var m={omit_link:i,omit_badge:a,lazy:n,member:l,size:t,include_restricted_overlay:!s||true,bg_img_style:d};return m});Handlebars.registerHelper("getGuestBadgeSize",function(e){var t;switch(e){case 24:t=10;break;case 32:case 36:case 48:t=16;break;case 72:t=24;break;case 192:t=48;break;case 512:t=96;break;default:t=16}return t});Handlebars.registerHelper("getTeamBadgeSize",i);Handlebars.registerHelper("getMemberNameById",function(e){var t=TS.interop.members.getMemberById(e);return t?t.name:e});Handlebars.registerHelper("getPrefCompliantMemberNameById",function(e){return TS.interop.members.getPrefCompliantMemberNameById(e)});Handlebars.registerHelper("getMemberNameNoModel",function(e,t){if(TS.boot_data.name_tagging_client)return e.display_name||e.real_name||t;return e.real_name||t});Handlebars.registerHelper("getMemberComponentPrimaryName",function(e,t){if(t){if("real_name"===t)return TS.interop.members.getMemberRealName(e);return TS.interop.members.getMemberMentionName(e)}return TS.interop.members.getPrefCompliantMemberName(e,false,false)});Handlebars.registerHelper("memberComponentHasSecondaryName",function(e,t,n){var r=false;e&&(r=t?"real_name"===t?!!TS.interop.members.getMemberProfileFieldDisplayName(e):!!TS.interop.members.getMemberRealName(e):!!TS.interop.members.getMemberSecondaryName(e));if(r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getMemberComponentSecondaryName",function(e,t){if(t){if("real_name"===t)return TS.interop.members.getMemberProfileFieldDisplayName(e);if("display_name"===t){if(TS.interop.members.getMemberProfileFieldDisplayName(e))return TS.interop.members.getMemberRealName(e);return""}}return TS.interop.members.getMemberSecondaryName(e)});Handlebars.registerHelper("getPrefCompliantMemberName",function(e,t,n){return TS.interop.members.getPrefCompliantMemberName(e,true===t,true===n)});Handlebars.registerHelper("getMemberAsContentsString",function(e){return TS.interop.texty.getMemberAsContentsString(e)});Handlebars.registerHelper("shouldShowMemberRestrictionBanner",function(t,n){n=e(n);_.isString(t)&&(t=TS.interop.members.getMemberById(t));if(!t)return n.inverse(this);var r=t.is_restricted||t.is_external;if(r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("shouldShowMemberActionBar",function(t,n){n=e(n);_.isString(t)&&(t=TS.interop.members.getMemberById(t));var r=t&&(!t.is_stranger||TS.redux.channels.getImByMemberId(t.id));if(r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getTeamNameByMember",function(e){return TS.teams.getTeamNameByMember(e)});Handlebars.registerHelper("getTeamById",function(e){return TS.teams.getTeamById(e)});Handlebars.registerHelper("getTeamNameById",function(e){return TS.teams.getTeamNameById(e)});Handlebars.registerHelper("getMemberPreviewLinkTarget",function(e){if(TS.utility.shouldLinksHaveTargets())return new Handlebars.SafeString('target="/team/'+e.id+'"');return""});Handlebars.registerHelper("getMemberProfileFieldDisplayName",function(e){return TS.interop.members.getMemberProfileFieldDisplayName(e)});Handlebars.registerHelper("getMemberSecondaryName",function(e){return TS.interop.members.getMemberSecondaryName(e)});Handlebars.registerHelper("memberHasSecondaryName",function(e,t){var n=false;e&&(n=!!TS.interop.members.getMemberSecondaryName(e));if(n)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessMemberHasSecondaryName",function(e,t){return Handlebars.helpers.memberHasSecondaryName.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("getMemberProfileFieldDisplayName",function(e){return TS.interop.members.getMemberProfileFieldDisplayName(e)});Handlebars.registerHelper("memberHasProfileFieldDisplayName",function(e,t){var n=false;e&&(n=!!TS.interop.members.getMemberProfileFieldDisplayName(e));if(n)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessMemberHasProfileFieldDisplayName",function(e,t){return Handlebars.helpers.memberHasProfileFieldDisplayName.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("memberHasDifferentDisplayAndFullName",function(e,t){var n=false;e&&(n=!!TS.interop.members.getMemberProfileFieldDisplayName(e)&&TS.interop.members.getMemberProfileFieldDisplayName(e)!==TS.interop.members.getMemberRealName(e));if(n)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("getMemberRealName",function(e){return TS.interop.members.getMemberRealName(e)});Handlebars.registerHelper("getMemberProfileFieldDisplayNameandRealNameInCorrectOrder",function(e){var t=_.escape(TS.interop.members.getPrefCompliantMemberName(e));var n;n=e.is_self?TS.interop.i18n.t("(you)","templates_helpers")():_.escape(TS.interop.members.getMemberSecondaryName(e));var r='<span class="member_real_name">'+t+"</span>";var i='<span class="member_preferred_name">'+n+"</span>";return new Handlebars.SafeString(r+i)});Handlebars.registerHelper("getMemberCurrentStatusEmoji",function(e,t){t=t||{};t=t.hash||t;return Handlebars.helpers.formatCurrentStatusWithoutAnimations(TS.interop.members.getMemberCurrentStatus(e).emoji,_.assign({transform_missing_emoji:true,show_icon_for_emoji_in_as_text_mode:true},t))});Handlebars.registerHelper("getMemberCurrentStatusText",function(e){var t=TS.interop.members.getMemberCurrentStatus(e,TS.team.getTeamCustomStatusPresets(),TS.boot_data.feature_i18n_custom_status).text;return Handlebars.helpers.formatCurrentStatusWithoutAnimations(t,{prevent_copy_paste:false})});Handlebars.registerHelper("getMemberCurrentStatusForDisplay",function(e){return new Handlebars.SafeString(TS.templates.builders.getMemberCurrentStatusForDisplay(e))});Handlebars.registerHelper("getMemberCurrentStatusForDisplayWithoutAnimations",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.getMemberCurrentStatusForDisplay(e,_.assign({stop_animations:true},t)))});Handlebars.registerHelper("getMemberCurrentStatusExpiration",function(e){if(!TS.boot_data.feature_custom_status_expiry||!e.is_self)return;var t=TS.interop.members.getMemberCurrentStatus(e);if(!(t&&t.expiration))return;var n=TS.interop.datetime.toTimeAgo(t.expiration,{left:true});return new Handlebars.SafeString('<p class="no_bottom_margin sk_dark_gray current_status_expiration">'+n+"</p>")});Handlebars.registerHelper("seesCurrentStatusInProfileView",function(t,n){n=e(n);if(t.profile.status_text||t.profile.status_emoji||"client"===TS.boot_data.app&&t.is_self)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getTeamCustomStatusPresets",function(){return TS.team.getTeamCustomStatusPresets()});Handlebars.registerHelper("getDisplayNameOfUserForIm",function(e){if(!e)return"MISSING_IM";return TS.ims.getDisplayNameOfUserForIm(e)});Handlebars.registerHelper("getIMIdByMemberId",function(e){var t=TS.redux.channels.getImByMemberId(e);return t?t.id:""});Handlebars.registerHelper("memberHasIm",function(e){var t=e.hash.member;var n=false;t&&TS.redux.channels.getImByMemberId(t.id)&&(n=true);if(n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberHasImUnreadCount",function(e){var t=e.hash.member;var n=false;if(t){var r=TS.redux.channels.getImByMemberId(t.id);r&&r.unread_cnt&&(n=true)}if(n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("getUnreadCountForIMByMemberId",function(e){var t=TS.redux.channels.getImByMemberId(e);if(t)return t.unread_cnt;return""});Handlebars.registerHelper("makeMemberLinksWithDisplayNames",function(e){if(!e)return"";return e.split(/\s*,\s*/).map(function(e){return TS.templates.builders.makeMemberPreviewLink(TS.interop.members.getMemberById(e))}).join(", ")});function s(e){var t=TS.interop.members.getMemberById(e.user);if(!t){TS.warn("Missing member in makeIMLink: "+e.user);return TS.templates.search_im_link({im_exists:false,im_member_id:e.user,im_name:e.user,im_id:e.id,member_color:"unknown"})}var n={im_exists:!TS.interop.channels.isImWithDeletedMember(e.id),im_member_id:t.id,im_name:TS.ims.getDisplayNameOfUserForIm(e),im_id:e.id,member_color:"color_"+(t?t.id+" color_"+t.color:"unknown")};if(TS.utility.shouldLinksHaveTargets()){var r="/messages/"+e.id;TS.interop.channels.isImWithDeletedMember(e.id)&&(r=TS.templates.builders.newWindowName());n.target=r}return TS.templates.search_im_link(n)}Handlebars.registerHelper("makeIMLink",function(e){return new Handlebars.SafeString(s(e))});Handlebars.registerHelper("makeIMLinkById",function(e){var t=TS.interop.channels.getImById(e);if(t)return new Handlebars.SafeString(s(t))});Handlebars.registerHelper("getBotName",TS.templates.builders.getBotName);Handlebars.registerHelper("getBotNameWithLink",TS.templates.builders.getBotNameWithLink);function o(e){if(!e)return"color_unknown";return"color_bot_"+TS.utility.makeSafeForDomClass(e)}Handlebars.registerHelper("getBotColorClassByUserName",o);function l(e){var t=TS.interop.members.getMemberById(e);if(!t)return"color_unknown";return"color_"+t.id+" color_"+t.color}Handlebars.registerHelper("getMemberColorClassById",l);Handlebars.registerHelper("getMemberColorClassByImId",function(e){var t=TS.interop.channels.getImById(e);if(!t)return"color_unknown";return l(t.user)});Handlebars.registerHelper("makeMemberLinkAriaLabelSafe",TS.templates.builders.makeMemberLinkAriaLabelSafe);Handlebars.registerHelper("msgIsFromSelf",function(e){var t=e.hash.msg;var n=t.user;!n&&"file_comment"===t.subtype&&t.comment&&(n=t.comment.user);var r=TS.interop.members.getMemberById(n);if(!r)return e.inverse(this);if(r.is_self)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberIsSelf",function(e){var t=TS.interop.members.getMemberById(e.hash.id);if(!t)return e.inverse(this);if(t.is_self)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberIsAdmin",function(e){var t=TS.interop.members.getMemberById(e.hash.id);if(!t)return e.inverse(this);if(t.is_admin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsAdmin",function(e){if(TS.model.user.is_admin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsOwner",function(e){if(TS.model.user.is_owner)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsRA",function(e){if(TS.model.user.is_restricted)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsURA",function(e){if(TS.model.user.is_ultra_restricted)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("tinyspeck",function(e){if(TS.boot_data.feature_tinyspeck)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("makeUnshareLinkById",function(e){var t=TS.files.getFileById(TS.web.file.file_id);var n=TS.redux.channels.getEntityById(e);if(n)return TS.templates.builders.makeUnshareLink(n,t)});Handlebars.registerHelper("makeUnshareLink",function(e){var t=TS.files.getFileById(TS.web.file.file_id);return TS.templates.builders.makeUnshareLink(e,t)});Handlebars.registerHelper("makeFileDomId",function(e){return TS.templates.makeFileDomId(e)});Handlebars.registerHelper("makeFileCommentsDomId",function(e){return TS.templates.makeFileCommentsDomId(e)});Handlebars.registerHelper("makeFileContentsDomId",function(e){return TS.templates.makeFileContentsDomId(e)});Handlebars.registerHelper("makeFileCommentHelpHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileCommentHelpHTML(e))});Handlebars.registerHelper("makeFileHeader",function(e,t){var n=TS.files.getFileActions(e);n.file=e;n.is_post="space"===e.mode||"post"===e.mode;n.download="hosted"===e.mode;n.member=t;return TS.templates.file_header(n)});Handlebars.registerHelper("makeFilePreviewHeader",function(e,t){var n=TS.files.getFileActions(e);n.file=e;n.member=t;n.download="hosted"===e.mode;n.edit_link="post"===e.mode?e.edit_link:e.permalink;n.is_post="space"===e.mode||"post"===e.mode;n.is_snippet="snippet"===e.mode;n.preview=true;return new Handlebars.SafeString(TS.templates.file_header(n))});Handlebars.registerHelper("makeFileSize",function(e){return TS.interop.utility.convertFilesize(e.size)+" "+e.pretty_type});Handlebars.registerHelper("formatSpaceHtml",function(e){var t=$("<div>").html(e);TS.templates.builders.replaceEmojiForPosts(t[0]);TS.utility&&TS.utility.attachments&&TS.utility.attachments.unfurlPlaceholders(t);return new Handlebars.SafeString(t.html())});Handlebars.registerHelper("fileIsImage",function(e){var t=TS.files.getFileById(e.hash.id);if(!t)return e.inverse(this);if(t.mimetype&&0===t.mimetype.indexOf("image/"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("mimeTypeIsImage",function(e){if(e.hash.type&&0===e.hash.type.indexOf("image/"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("fileDefaultIsNewWindow",function(t){t=e(t);var n=TS.files.getFileById(t.hash.id);if(!n)return t.inverse(this);var r=n.mimetype&&0===n.mimetype.indexOf("image/")&&-1===n.mimetype.indexOf("svg");var i="pdf"===n.filetype;if(r||i)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("fileOpensOnTeamSite",function(t){t=e(t);if(!TS.boot_data.feature_deprecate_files)return t.fn(this);var n=TS.files.getFileById(t.hash.id);if(!n)return t.inverse(this);var r=n.mode;if("space"===r||"email"===r||"snippet"===r)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("fileIconTypeDownload",function(){var t=Array.prototype.slice.call(arguments);var n=e(t.pop());var r=t[0];"string"===typeof r&&(r=TS.files.getFileById(r));if(!r)return n.inverse(this);var i="external"===r.mode;var a=r.mimetype&&0===r.mimetype.indexOf("image/")&&-1===r.mimetype.indexOf("svg");var s="pdf"===r.filetype;if(i||a||s)return n.inverse(this);return n.fn(this)});Handlebars.registerHelper("nonImageCanUseFSFV",function(e,t){if(TS.files.nonImageCanUseFSFV(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeFilePrivacyLabel",function(e){var t="";var n=e.is_public;var r=e.groups.length>0||e.ims.length>0;var i="email"===e.mode;var a="snippet"===e.mode;var s="post"!=e.mode&&"space"!=e.mode&&!i&&!a;"post"===e.mode||"space"===e.mode?t=n?TS.interop.i18n.t("Shared","templates_helpers")():r?TS.interop.i18n.t("Private","templates_helpers")():TS.interop.i18n.t("Draft","templates_helpers")():n&&i?t=TS.interop.i18n.t("Shared email","templates_helpers")():n&&a?t=TS.interop.i18n.t("Shared snippet","templates_helpers")():n&&s?t=TS.interop.i18n.t("Shared file","templates_helpers")():r&&i?t=TS.interop.i18n.t("Private email","templates_helpers")():r&&a?t=TS.interop.i18n.t("Private snippet","templates_helpers")():r&&s&&(t=TS.interop.i18n.t("Private file","templates_helpers")());return t});Handlebars.registerHelper("makeExternalFiletypeHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.makeExternalFiletypeHTML(e))});Handlebars.registerHelper("makeFileShareLabel",function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileShareLabel(e))});Handlebars.registerHelper("isFileAuthorExternal",function(e){return TS.files.isFileAuthorExternal(e)});Handlebars.registerHelper("nl2brAndHighlightSearchMatches",function(e){if(!e)return;e=_.escape(e);e=e.replace(/\n/g,"<br />");return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))});Handlebars.registerHelper("maybeGetIconForTeamProfileField",function(e){var t=["slack","apple","android","twitter","github","google","windows","youtube","skype","facebook","asana","linkedin","tumblr","instagram","soundcloud","flickr","pinterest","tripit","hangouts","viber","line"];e=e.toLowerCase();if(t.indexOf(e)>-1)return'<i class="ts_icon ts_icon_'+e+'"></i>'});Handlebars.registerHelper("getVisibleTeamProfileFieldsForMember",function(e,t){var n=TS.team.getVisibleTeamProfileFieldsForMember(e);return new Handlebars.SafeString(TS.templates.team_profile_fields({fields:n,lazy_load_profile_fields:t&&t.hash.lazy_load_profile_fields}))});Handlebars.registerHelper("isSkypeTeamProfileField",function(e,t){if("text"===e.type&&"skype"===e.label.toLocaleLowerCase())return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("getSafeSkypeURLComponent",function(e){var t=e.match(/^[a-zA-Z][a-zA-Z0-9.,\-_@]{5,31}/);return t?t[0]:""});Handlebars.registerHelper("highlightSearchMatches",function(e){if(!e)return;e=_.escape(e);return TS.utility.msgs.handleSearchHighlights(e)});Handlebars.registerHelper("highlightSearchMatchesInSpacesHtml",function(e){if(!e)return;var t=Handlebars.helpers.formatSpaceHtml(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(t))});Handlebars.registerHelper("highlightSearchMatchesInFileTitle",function(e){if(!e)return;e=_.unescape(e);e=_.escape(e);e=TS.emoji.graphicReplace(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))});Handlebars.registerHelper("searchFilter",function(){if(!TS.search.filter)return;return TS.search.filter});Handlebars.registerHelper("searchSort",function(){if(!TS.search.sort)return;return TS.search.sort});Handlebars.registerHelper("makeUnreadMessagesDomId",function(e){return TS.templates.makeUnreadMessagesDomId(e)});Handlebars.registerHelper("makeUnreadGroupMessagesDomId",function(e){return TS.templates.makeUnreadGroupMessagesDomId(e)});Handlebars.registerHelper("makeUnreadDmsDomId",function(e){return TS.templates.makeUnreadDmsDomId(e)});Handlebars.registerHelper("makeSentMessagesDomId",function(e){return TS.templates.makeSentMessagesDomId(e)});Handlebars.registerHelper("makeSentGroupMessagesDomId",function(e){return TS.templates.makeSentGroupMessagesDomId(e)});Handlebars.registerHelper("makeSentDmsDomId",function(e){return TS.templates.makeSentDmsDomId(e)});Handlebars.registerHelper("makeIssueListDomId",function(e){return TS.templates.makeIssueListDomId(e)});Handlebars.registerHelper("math",function(e,t,n){if(arguments.length<4){n=t;t="+"}e=parseFloat(e);n=parseFloat(n);return{"+":e+n,"-":e-n,"*":e*n,"/":e/n,"%":e%n}[t]});Handlebars.registerHelper("loadingHTML",function(){return new Handlebars.SafeString(TS.templates.builders.loadingHTML())});Handlebars.registerHelper("versioned_loading_animation",function(){return cdn_url+"/9c217/img/loading.gif"});Handlebars.registerHelper("versioned_loading_hash_animation",function(){return cdn_url+"/9c217/img/loading_hash_animation_@2x.gif"});Handlebars.registerHelper("versioned_mac_dock_badge",function(){return cdn_url+"/9135/img/prefs_mac_dock_badge@2x.png"});Handlebars.registerHelper("versioned_prefs_messages_clean",function(){return cdn_url+"/e5d8/img/prefs_messages_clean@2x.png"});Handlebars.registerHelper("versioned_prefs_messages_compact",function(){return cdn_url+"/e5d8/img/prefs_messages_compact@2x.png"});Handlebars.registerHelper("versioned_services_box_32",function(){return cdn_url+"/7f1a0/plugins/box/assets/service_32.png"});Handlebars.registerHelper("versioned_services_gdrive_16",function(){return cdn_url+"/66f9/img/services/gdrive_16.png"});Handlebars.registerHelper("versioned_services_onedrive_32",function(){return cdn_url+"/7f1a0/plugins/onedrive/assets/service_32.png"});Handlebars.registerHelper("versioned_slackbot_48",function(){return cdn_url+"/7f1a0/plugins/slackbot/assets/service_48.png"});Handlebars.registerHelper("versioned_slackbot_72",function(){return cdn_url+"/0180/img/slackbot_72.png"});Handlebars.registerHelper("versioned_twitter_64",function(){return cdn_url+"/66f9/img/services/twitter_64.png"});Handlebars.registerHelper("versioned_upload_file_icon",function(e){if("1x"===e)return cdn_url+"/a079/img/upload_file_icon.png";if("2x"===e)return cdn_url+"/a079/img/upload_file_icon@2x.png"});Handlebars.registerHelper("versioned_default_application_icon",function(){return cdn_url+"/bfaba/img/apps/default_new_app_icon.png"});Handlebars.registerHelper("versioned_join_shared_channel",function(e){if("1x"===e)return cdn_url+"/742c/img/join-channel/join_shared_channel.png";if("2x"===e)return cdn_url+"/742c/img/join-channel/join_shared_channel@2x.png"});Handlebars.registerHelper("versioned_tos_book_illustration",function(e){if("1x"===e)return cdn_url+"/ead48/img/signup/book_illustration.png";if("2x"===e)return cdn_url+"/ead48/img/signup/book_illustration@2x.png"});Handlebars.registerHelper("versioned_join_team_channel",function(e){if("1x"===e)return cdn_url+"/742c/img/join-channel/join_team_channel.png";if("2x"===e)return cdn_url+"/742c/img/join-channel/join_team_channel@2x.png"});Handlebars.registerHelper("versioned_signin_no_teams",function(e){if("1x"===e)return cdn_url+"/7c9e4/img/enterprise/signin-no-teams.png";if("2x"===e)return cdn_url+"/7c9e4/img/enterprise/signin-no-teams@2x.png"});Handlebars.registerHelper("versioned_basic_analytics_coming_soon",function(e){if("1x"===e)return cdn_url+"/436da/img/enterprise/ent_basic_analytics_coming_soon.png";if("2x"===e)return cdn_url+"/436da/img/enterprise/ent_basic_analytics_coming_soon@2x.png"});Handlebars.registerHelper("versioned_slack_logo_240",function(){return cdn_url+"/09f7/marketing/img/slack_logo@2x.png"});Handlebars.registerHelper("versioned_file_drop_blue",function(){return cdn_url+"/c3881/img/file-drop-blue@2x.png"});Handlebars.registerHelper("versioned_ill_team",function(e){if("1x"===e)return cdn_url+"/436da/img/quick_promo/ill_team.png";if("2x"===e)return cdn_url+"/436da/img/quick_promo/ill_team@2x.png"});Handlebars.registerHelper("versioned_basic_analytics_upsell_banner_image",function(){return cdn_url+"/436da/img/enterprise/ent_basic_analytics_upsell_banner_image.gif"});Handlebars.registerHelper("pinToLabel",function(e){var t="";e.is_channel&&(t+="#");e.is_im||e.is_mpim?t+=TS.interop.i18n.t("this conversation","pins")():t+=_.escape(e.name);return new Handlebars.SafeString(t)});Handlebars.registerHelper("preventWidow",function(e){var t=e.split(" ");if(t.length>1){t[t.length-2]+="&nbsp;"+t[t.length-1];t.pop();e=t.join(" ")}return new Handlebars.SafeString(e)});Handlebars.registerHelper("number",function(e){return TS.interop.i18n.number(e)||""});Handlebars.registerHelper("buildReplyBarHTML",function(e,t){return new Handlebars.SafeString(TS.templates.builders.buildReplyBarHTML(e,t))});Handlebars.registerHelper("makeSHRoomParticipantList",TS.templates.builders.makeSHRoomParticipantList);Handlebars.registerHelper("makeSHRoomSharedList",TS.templates.builders.makeSHRoomSharedList);Handlebars.registerHelper("atLabel",function(e){return TS.templates.builders.atLabel(e)});Handlebars.registerHelper("renderAttachmentActions",function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildAttachmentActions(e,t,n))});Handlebars.registerHelper("renderAttachmentActionSelectOption",function(e,t){var n=_.merge({},e,{is_group_item:t.hash.is_group_item});var r=TS.templates.attachment_actions_select_option(n);return new Handlebars.SafeString(r)});Handlebars.registerHelper("renderAttachmentMedia",function(e,t){var n;var r=TS.utility.attachments.getMediaType(e);var i;switch(r){case"other":e.other_html&&(n=TS.templates.builders.buildInlineOtherDiv(e.other_html,t,e.safe_other_html));break;case"video":if(e.video_html&&e.thumb_url){i=e.from_url||e.thumb_url;n=TS.templates.builders.buildInlineVideoDiv(i,t)}break;case"image":if(e.image_url){i=e.from_url||e.image_url;var a={};a.flush_with_attachment=true;a.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name;n=TS.templates.builders.buildInlineImgDiv(i,t,a)}break;case"audio":e.audio_html?n=TS.templates.builders.buildInlineAudioDiv(e.audio_html,t,e.safe_audio_html):e.audio_url&&(n=TS.templates.builders.formatSoundUrl(e));break;default:break}if(n)return new Handlebars.SafeString(n)});Handlebars.registerHelper("renderAttachmentFile",function(e){var t=TS.files.getFileTemplateArguments(e);var r="";if(TS.interop.files.fileIsImage(e))r=TS.templates.file_image(n({},t,{file:e}));else{var i=n({},e,{thumb_pdf:void 0,thumb_480:void 0,has_rich_preview:void 0,filetype:"space"===e.filetype?"post":e.filetype});r=TS.templates.file_generic(n({},t,{file:i,attachment_file:true,file_is_video:void 0,file_is_audio:void 0}))}return new Handlebars.SafeString('<div class="msg_inline_attachment_row">'+r+"</div>")});Handlebars.registerHelper("getMemberTypeClass",TS.templates.builders.getMemberTypeClass);Handlebars.registerHelper("inlineSaver",function(e){var t=TS.templates.inline_saver({hide_text:e.hash.hide_text,target:e.hash.target});return new Handlebars.SafeString(t)});Handlebars.registerHelper("dangerouslyRenderHTML",function(e){return new Handlebars.SafeString(e)});Handlebars.registerHelper("attachmentMediaCaret",function(e,t){var n="";var r=TS.utility.attachments.getMediaType(e);var i;switch(r){case"video":i=e.from_url||e.thumb_url;n=TS.templates.builders.buildInlineVideoToggler(i,t,true);break;case"audio":i=e.audio_html||e.audio_url;n=TS.templates.builders.buildInlineAudioToggler(i,t);break;case"other":n=TS.templates.builders.buildInlineOtherToggler(e.other_html,t);break;case"image":i=e.from_url||e.image_url;var a={};a.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name;n=TS.templates.builders.buildInlineImgToggler(i,t,false,a);break;default:n=TS.templates.builders.buildInlineAttachmentToggler(e.from_url,t);break}n&&(n='<span class="media_caret">'+n+"</span>");return new Handlebars.SafeString(n)});Handlebars.registerHelper("isMsgReply",function(e){var t=e.hash.msg;var n=TS.interop.messages.isReply(t);if(n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("buildMsgHTMLForThreadsView",function(e,t,n,r){var i=TS.templates.builders.buildThreadMsgHTML(e,t,n,r);return new Handlebars.SafeString(i)});Handlebars.registerHelper("buildThreadParticipantListHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.buildThreadParticipantListHTML(e))});Handlebars.registerHelper("getTeamIconOfSize",function(e,t){if(e&&e.icon)return e.icon["image_"+t];return null});Handlebars.registerHelper("listItemCount",function(e){if(_.isUndefined(e)){TS.error("The template helper listItemCount failed because it was passed undefined");return 0}e=TS.utility.parseJSONOrElse(e,e);if(_.isString(e)&&e.length)return e.split(",").length;return e.length});Handlebars.registerHelper("objectKeyCount",function(e){return _.isObject(e)?_.keys(e).length:0});Handlebars.registerHelper("getIconSizeToFit",function(e){return TS.interop.utility.getIconSizeToFit(e,[230,132,102,88,68,44,34])});Handlebars.registerHelper("prefsNotificationExampleAll",function(){var e=TS.model.team.name;TS.model.is_mac||(e=TS.interop.i18n.t("from {team_name}","prefs")({team_name:e}));var t=TS.templates.prefs_notification_example({name:e,text:TS.interop.i18n.t("Good morning everyone!","prefs")()});return new Handlebars.SafeString(t)});Handlebars.registerHelper("prefsNotificationExampleMentions",function(){var e=TS.model.team.name;TS.model.is_mac||(e=TS.interop.i18n.t("from {team_name}","prefs")({team_name:e}));var t=":wave:";var n=TS.emoji.getChosenSkinTone();n&&(t+=":"+n+":");var r=TS.emoji.graphicReplace(t);var i=TS.templates.prefs_notification_example({name:e,text:new Handlebars.SafeString(TS.interop.i18n.t("{wave_emoji} Hi <strong>@{username}</strong>","prefs")({wave_emoji:TS.interop.i18n.safeString(r),username:TS.interop.members.getPrefCompliantMemberName(TS.model.user,true)}))});return new Handlebars.SafeString(i)});Handlebars.registerHelper("prefsNotificationSettingReadable",function(e){if(!e.desktop&&!e.mobile)return"";var t="";var n=TS.boot_data.feature_turn_mpdm_notifs_on?"mentions_dms":"mentions";if(e.desktop===e.mobile)"everything"===e.desktop?t+=TS.interop.i18n.t("<strong>Desktop and Mobile:</strong> All new messages","prefs")():e.desktop===n?t+=TS.interop.i18n.t("<strong>Desktop and Mobile:</strong> Direct messages, mentions &amp; keywords","prefs")():t+=TS.interop.i18n.t("<strong>Desktop and Mobile:</strong> Nothing","prefs")();else{e.desktop&&("everything"===e.desktop?t+=TS.interop.i18n.t("<strong>Desktop:</strong> All new messages","prefs")():e.desktop===n?t+=TS.interop.i18n.t("<strong>Desktop:</strong> Direct messages, mentions &amp; keywords","prefs")():t+=TS.interop.i18n.t("<strong>Desktop:</strong> Nothing","prefs")());e.desktop&&e.mobile&&(t+="<br>");e.mobile&&("everything"===e.mobile?t+=TS.interop.i18n.t("<strong>Mobile:</strong> All new messages","prefs")():e.mobile===n?t+=TS.interop.i18n.t("<strong>Mobile:</strong> Direct messages, mentions &amp; keywords","prefs")():t+=TS.interop.i18n.t("<strong>Mobile:</strong> Nothing","prefs")())}return new Handlebars.SafeString(t)});Handlebars.registerHelper("teamRetentionDuration",function(){return TS.prefs.getTeamPref("retention_duration")});Handlebars.registerHelper("teamRetentionType",function(){return TS.prefs.getTeamPref("retention_type")});Handlebars.registerHelper("formatWorkspaceDiscoverability",function(e){return TS.utility.enterprise.getWorkspaceVisibilityLabel(e)});Handlebars.registerHelper("escape",function(e){return _.escape(e)});Handlebars.registerHelper("crossWorkspaceJumperLink",function(e){if(!e||!e.id||!e.team_id)return"";var t=TS.teams.getTeamById(e.team_id);return TS.utility.enterprise.buildTeamUrl(_.get(t,"domain"))+"messages/"+e.id});Handlebars.registerHelper("pinnedItemFileMessage",function(e){if(!TS.boot_data.feature_file_threads)return"";if(!e)return"";var t=_.first(e.files);if(!t)return"";var n=_.isString(t)?TS.files.getFileById(t):t;if(!n)return"";var r="";var i=TS.interop.i18n.safeString(TS.templates.builders.formatFileTitle(n));r=e.upload?TS.interop.i18n.t("Uploaded a file: {name}","pinned_item")({name:i}):TS.interop.i18n.t("Shared a file: {name}","pinned_item")({name:i});var a=["greigh"];e.text&&a.push("very_small_top_margin");return new Handlebars.SafeString('<div class="'+a.join(" ")+'">'+r+"</div>")})},test:function n(){return{_optionsFnInverseBooleanHelper:e,_inlineImgSrcForFile:t}}});var e=function e(t){"function"!==typeof t.fn&&(t.fn=function(){return true});"function"!==typeof t.inverse&&(t.inverse=function(){return false});return t};var t=function e(t,n){"string"===typeof t&&(t=TS.files.getFileById(t));if(!t)return false;if(!TS.files.fileIsImage(t))return false;n||(n=480);return TS.files.getThumbSrcForFile(t,{maxSize:n})};var i=function e(t){var n;switch(t){case 32:case 36:case 48:n=16;break;case 72:n=22;break;case 192:case 512:break;default:n=16}return n}})()},11241:function(e,t){(function(){TS.registerModule("utility.date",{fake_ts_unique_padder:"x",do24hrTime:function e(){return TS.model.user&&TS.prefs.prefs_loaded&&TS.prefs.getPref("time24")},memberUTCOffset:function t(n){var r=e(n);var i=r/60/60;if(i<0)return"(UTC"+i+")";if(i>0)return"(UTC+"+i+")";return"(UTC)"}});var e=function e(t){var n=-28800;(t&&t.tz_offset&&"undefined"!==typeof t.tz_offset||0===t.tz_offset)&&(n=t.tz_offset);return n}})()},11242:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("utility.msgs",{allowed_embed_attributes:["class","name","id","src","width","oldwidth","height","oldheight","frameborder","title","scrolling","allowtransparency","allowfullscreen","oallowfullscreen","msallowfullscreen","webkitallowfullscreen","mozallowfullscreen","controls","autoplay","loop","muted","poster","preload","webkit-playsinline","type"],ephemeral_msgs_map:{},messageIncludesMember:function e(t,n){if(!t){TS.warn("messageIncludesMember: WTF no member?");return}if(!n){TS.warn("messageIncludesMember: WTF no msg?");return}if(TS.utility.msgs.memberSentMessage(t,n))return true;var r=n.text;var i=TS.format.calculateOptions(n,{});var a=TSF.getTokensArray($.trim(r),i.tsf_mode,{jumbomoji:!i.no_jumbomoji,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});var s;for(var o=0,l=a.length;o<l;o+=1){s=a[o];if(0===s.indexOf("<")&&0===s.indexOf("<@")){var u=s.replace(/<|>/g,"");var d=TS.utility.msgs.getMemberIdFromMemberMarkup(u);if(d&&d==t.id)return true}}return false},memberSentMessage:function e(t,n){if(!t){TS.warn("messageIncludesMember: WTF no member?");return}if(!n){TS.warn("messageIncludesMember: WTF no msg?");return}return!!(n.user&&n.user==t.id)||!!(n.comment&&n.comment.user==t.id)},allUnknownUsersInMessage:function e(t){var n=[];var r=t.text;var i=TS.format.calculateOptions(t,{});var a=TSF.getTokensArray($.trim(r),i.tsf_mode,{jumbomoji:!i.no_jumbomoji,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});for(var s=0;s<a.length;s+=1){var o=a[s];if(0===o.indexOf("<")&&0===o.indexOf("<@")){var l=o.replace(/<|>/g,"");var u=TS.utility.msgs.getMemberIdFromMemberMarkup(l);var d=TS.redux.members.getPotentiallyUnknownMemberById(u);d||TS.boot_data.feature_deprecate_get_member_by_name||(d=TS.interop.members.getMemberByName(u));d||n.indexOf(u)<0&&n.push(u)}}return n},appendMsg:function e(t,n){t.unshift(TS.utility.msgs.makeSureMsgObIsValid(n))},setMsgs:function e(t,n){for(var r=0;r<n.length;r+=1)n[r]=TS.utility.msgs.makeSureMsgObIsValid(n[r]);TS.utility.msgs.sortMsgs(n);t.msgs=n;return t.msgs},spliceMsg:function e(t,n){var r=t.indexOf(n);r>-1&&t.splice(r,1)},getNonTempMsgFromUserMatchingText:function e(t,n,r){if(!t&&0!==t)return null;var i;for(var a=0;a<r.length;a+=1){i=r[a];if(i.user!=n)continue;if(TS.interop.rules.messages.isTempMsg(i))continue;if(i.text==t)return i}return null},getMsgByProp:function e(t,n,r){if(!n&&0!==n)return null;var i;for(var a=0;a<r.length;a+=1){i=r[a];if(i[t]==n)return i}return null},getEditableMsgByProp:function e(t,n,r){if(!n&&0!==n||!r)return null;var i;for(var a=0;a<r.length;a+=1){i=r[a];if(i.subtype&&"me_message"!==i.subtype&&"thread_broadcast"!==i.subtype)continue;if(i[t]==n)return i}return null},getEditableReplyByProp:function e(t,n,r,i){if(!n&&0!==n||!r||!i)return null;var a;if(TS.ui.replies.activeConvoModelId()===r.id&&TS.ui.replies.activeConvoThreadTs()===i)a=TS.ui.replies.getActiveMessages();else if(TS.model.threads_view_is_showing){var s=TS.client.threads.getThread(r,i);a=s&&s.replies?s.replies:[]}var o=_.findLast(a,function(e){var r=!(e.subtype&&"me_message"!==e.subtype);var i=e[t]===n;return r&&i});return o},sortMsgs:function e(t){function n(e,t){if(e.ts<t.ts)return 1;if(e.ts>t.ts)return-1;return 0}t.sort(n)},isMsgRolledUp:function e(t){if(!t._jl_rolled_up_in)return false;return t._jl_rolled_up_in!==t.ts},getPrevDisplayedMsg:function e(t,n){var r;var i=false;for(var a=0;a<n.length;a+=1){r=n[a];if(i){if(!TS.interop.rules.messages.isHidden(r)&&!TS.utility.msgs.isMsgRolledUp(r))return r}else r.ts==t&&(i=true)}return null},getDisplayedMsgs:function e(t){var n=[];var r;for(var i=0;i<t.length;i+=1){r=t[i];TS.interop.rules.messages.isHidden(r)||TS.utility.msgs.isMsgRolledUp(r)||n.push(r)}return n},getDisplayedMsgAfterTS:function e(t,n){var r;for(var i=n.length-1;i>-1;i-=1){r=n[i];if(r.ts>t&&!TS.interop.rules.messages.isHidden(r)&&!TS.utility.msgs.isMsgRolledUp(r))return r}return null},getDisplayedMsgBeforeTS:function e(t,n){var r;for(var i=0;i<n.length;i+=1){r=n[i];if(r.ts<t&&!TS.interop.rules.messages.isHidden(r)&&!TS.utility.msgs.isMsgRolledUp(r))return r}return null},getUnreadCountableMsgAfterTS:function e(t,n){var r;for(var i=n.length-1;i>-1;i-=1){r=n[i];if(r.ts>t&&TS.interop.messages.canCountAsUnreadForCurrentUser(r,TS.model.user.id))return r}return null},getMarkMsgTSForUnreadPoint:function e(t,n,r){var i;var a;if(r.oldest_msg_ts&&t==r.oldest_msg_ts)i="0000000000.000000";else{a=TS.utility.msgs.getPrevDisplayedMsg(t,n)||TS.utility.msgs.getMsg(t,n);a&&(i=a.ts)}if(!i)return null;while(i&&!TS.utility.msgs.getUnreadCountableMsgAfterTS(i,n)){a=TS.utility.msgs.getPrevDisplayedMsg(i,n);i=a?a.ts:null}if(!i)return null;return i},getMsg:function e(t,n){if(!n)return null;return TS.utility.msgs.getMsgByProp("ts",t,n)},getFileOnMsg:function e(t){if(!t)return;if(TS.interop.messages.shouldRenderFileThread(t)&&t.files&&t.files.length)return t.files[0];return t.file},getMsgActions:function e(t,n,r){if(!t)return;n=n||TS.shared.legacyGetActiveModelOb();var i={edit_msg:TS.interop.messages.canEditMessage(TS.model.user.id,t,n,TS.prefs.getTeamPref("msg_edit_window_mins")),delete_msg:true};var a=false;t.user==TS.model.user.id&&(a=true);var s=TS.utility.teams.isMsgFromOtherTeam(t);t.file&&"email"===t.file.mode&&(i.open_original=true);if(TS.prefs.getTeamPref("allow_message_deletion"))if("tombstone"===t.subtype)i.delete_msg=false;else if("retention"===t.subtype)i.delete_msg=false;else if(s)TS.boot_data.page_needs_enterprise&&(a||TS.model.user.enterprise_user.is_owner&&!n.is_im)?i.delete_msg=true:i.delete_msg=false;else if(TS.model.active_im_id)a||"USLACKBOT"===t.user||"bot_message"===t.subtype||(i.delete_msg=false);else if(a){if(TS.interop.rules.messages.isAutomatedSubtype(t.subtype)){var o=["pinned_item","sh_room_created","sh_room_shared","reply_broadcast"];TS.model.user.is_admin||_.includes(o,t.subtype)||(i.delete_msg=false)}}else TS.model.user.is_admin||(i.delete_msg=false);else s?TS.boot_data.page_needs_enterprise&&TS.model.user.enterprise_user.is_owner&&!n.is_im?i.delete_msg=true:i.delete_msg=false:TS.model.user.is_admin?TS.model.active_im_id&&(a||"USLACKBOT"===t.user||"bot_message"===t.subtype||(i.delete_msg=false)):i.delete_msg=false;if("thread_broadcast"===t.subtype){var l=r!==TS.interop.constants.MESSAGE_CONTAINERS.THREADS_FLEXPANE;l&&(i.remove_broadcast=i.delete_msg)}if(t.is_ephemeral)i.delete_msg=true;else{if(TS.client&&"pinned_item"!==t.subtype&&"unpinned_item"!==t.subtype&&"sh_room_created"!==t.subtype&&"sh_room_shared"!==t.subtype){TS.pins.canUserPinHere(n)&&(TS.pins.isMessagePinned(t,n)?i.unpin_msg=true:i.pin_msg=true);if("tombstone"===t.subtype){i.unpin_msg=false;i.pin_msg=false}var u=["channel_join","channel_leave","group_join","group_leave"];_.includes(u,t.subtype)&&(i.pin_msg=false)}"file_comment"===t.subtype?i.add_file_comment_rxn=true:TS.interop.rules.messages.isFile(t)?i.add_file_rxn=true:"tombstone"===t.subtype?i.add_rxn=false:i.add_rxn=true;if(TS.clipboard.canWriteText()){i.copy_link=true;"tombstone"===t.subtype&&(i.copy_link=false)}}TS.client&&(i.mark_unread=true);var d=!t.thread_ts||t.thread_ts==t.ts;i.jump_to_original=true;TS.replies.canReplyToMsg(n,t)&&(i.reply=true);i.jump_to_original=d;i.mark_unread&&!d&&(i.mark_unread=false);var c=["bot_message","file_share","file_mention","file_comment","me_message","reply_broadcast","thread_broadcast"];t.is_ephemeral||t.subtype&&-1===c.indexOf(t.subtype)||(i.remind_me=true);(i.jump_to_original||i.copy_link||i.mark_unread||i.remind_me)&&(i.has_private_actions=true);(i.copy_link||i.add_rxn||i.add_file_rxn||i.add_file_comment_rxn||i.pin_msg||i.unpin_msg)&&(i.has_public_actions=true);t.is_ephemeral||TS.interop.rules.messages.isTempMsg(t)||("file_share"===t.subtype||"file_mention"===t.subtype?i.share_file=true:"tombstone"===t.subtype?i.share_message=false:i.share_message=!TS.interop.channels.isImWithDeletedMember(_.get(n,"id"))&&(!n.is_archived||n.is_channel));return i},validateMsg:function e(t,n,r){if(!n.ts){TS.error("msg lacks a ts ("+t+")");TS.dir(0,n);return false}if(TS.utility.msgs.getMsg(n.ts,r)){TS.warn("msg "+n.ts+" already exists! ("+t+")");TS.dir(0,n);return false}return true},findMsg:function e(t,n){var r;if(TS.useReactMessages()){r=TS.redux.messages.getMessageByTimestamp(n,t);if(r)return r}var i=TS.redux.channels.getEntityById(n);if(i){r=i.msgs&&TS.utility.msgs.getMsg(t,i.msgs);if(r)return r;r=i._archive_msgs&&TS.utility.msgs.getMsg(t,i._archive_msgs);if(r)return r;if(TS.ui.replies){r=TS.ui.replies.getActiveMessage(i,t);if(r)return r}if(TS.client){r=TS.client.threads.getMessage(i,t);if(r)return r}if(!r&&TS.model.unread_view_is_showing&&TS.client){r=TS.client.unread.getMessage(i,t);if(r)return r}}var a=TS.mentions.getMentionByMsgId(t);if(a)return a.message;return null},legacyMsgChangedWorker:function e(t){var n=TS.redux.channels.getEntityById(t.channel);TS.mentions.replaceMsg(t.message);TS.pins&&TS.pins.replaceMsg(t.message,n);(t.message.imgs||TS.utility.msgs.hasImgs(t.message))&&(TS.model.show_inline_img_size_pref_reminder=true)},replaceMsg:function e(t,n,r,i,a){TS.redux.messages.replaceMessage(TS.utility.msgs.processImsg(n,t.id),a);TS.utility.msgs.legacyReplaceMsg(t,n,r,i)},removeEphemeralMsg:function e(t,n){var r=TS.interop.channels.getGroupById(t)||TS.interop.channels.getChannelById(t);if(!r)return;var i;i=TS.useReactMessages()?TS.utility.msgs.findMsg(n,r.id):TS.utility.msgs.getMsg(n,r.msgs);r.is_channel?TS.channels.legacyRemoveMsg(t,i):r.is_mpim?TS.mpims.legacyRemoveMsg(t,i):r.is_group&&TS.groups.legacyRemoveMsg(t,i)},getMemberFromMemberMarkup:function e(t){var n=TS.utility.msgs.getMemberIdFromMemberMarkup(t);var r=TS.redux.members.getPotentiallyUnknownMemberById(n);r||TS.boot_data.feature_deprecate_get_member_by_name||(r=TS.interop.members.getMemberByName(n));return r},getMemberIdFromMemberMarkup:function e(t){var n=t.substr(1);n&&(n=n.split("|")[0]);return n},makeSureMsgObIsValid:function e(t){return t},api_url_prefix:"api::",doApiUrl:function e(t){if(!TS.client){alert(TS.interop.i18n.t("This link will not work in the archives.","msgs")());return}t=t.replace(TS.utility.msgs.api_url_prefix,"");var n=t.split("?");var r=n[0];var i={};if(n.length>1){var a=n[1].split("&");for(var s=0;s<a.length;s+=1){var o=a[s].indexOf("=");if(-1!=o){var l=a[s].substring(0,o);var u=a[s].substring(o+1);i[l]=unescape(u)}}}TS.api.call(r,i)},new_api_url_prefix:"slack-action://",doNewApiUrl:function e(t){if(!TS.client){alert(TS.interop.i18n.t("This link will not work in the archives.","msgs")());return}var n=t.replace(TS.utility.msgs.new_api_url_prefix,"").split("/");var r=n.shift();var i=n.join("/");TS.api.call("chat.action",{bot:r,payload:decodeURIComponent(i)})},getHighlightWordsRegExp:function e(){TS.model.highlight_words_regex||TS.utility.msgs.makeHighlightWordsRegex();return TS.model.highlight_words_regex},makeHighlightWordsRegex:function e(){var t;var n=[];for(var r=0;r<TS.model.highlight_words.length;r+=1){t=TS.format.swapOutAts(TS.model.highlight_words[r]);t=TS.utility.regexpEscape(t);"don"===t&&(t+="(?!['\u2019]t)");n.push(t)}TS.model.highlight_words_regex=new XRegExp("((?!\\pL)|_|\\s|^)("+n.join("|")+")((?!\\pL)|_|\\s|$)","i")},getMsgMentionData:function e(t,n){var r={mentions:false,non_channel_mentions:false};var i=TS.utility.msgs.getHighlightWordsRegExp();var a="bot_message"===t.subtype;var s=TS.interop.messages.isReply(t);function o(e){if(l(e)){r.non_channel_mentions=true;r.mentions=true;return true}u(e)&&(r.mentions=true);return false}function l(e){if(!e)return false;if(TS.interop.members.getMemberMentionRegExp(TS.model.user.id).test(e))return true;if(a)return false;e=TS.format.swapOutAts(e);if(i.test(e)&&!n)return true;return false}function u(e){if(!e)return false;if(TS.model.everyone_regex.test(e)&&!s)return true;if(TS.model.channel_regex.test(e)&&!s)return true;if(TS.model.group_regex.test(e)&&!s)return true;return false}if(!t.ignore_if_attachments_supported&&o(t.text))return r;var d;var c;if(t.attachments)for(var _=0;_<t.attachments.length;_+=1){d=t.attachments[_];if(d.from_url)continue;if(o(d.title))return r;if(o(d.pretext))return r;if(o(d.text))return r;if(o(d.footer))return r;if(!d.fields||!d.fields.length)continue;for(var m=0;m<d.fields.length;m+=1){c=d.fields[m];if(o(c.value))return r}}return r},countAllUnreads:function t(){if(e)return;TS.model.all_unread_highlights_cnt=0;TS.model.all_unread_cnt=0;TS.model.all_unread_cnt_to_exclude=0;TS.model.all_unread_highlights_cnt_to_exclude=0;var n;var r;var i=TS.interop.redux.models.channels.getPublicChannels(TS.redux.getState());i.forEach(function(e){if(e.is_archived||TS.notifs.isCorGMuted(e.id)||!e.is_member)return;n=parseInt(e.unread_cnt,10)||0;r=parseInt(e.unread_highlight_cnt,10)||0;TS.model.all_unread_cnt+=n;TS.model.all_unread_highlights_cnt+=r;TS.utility.msgs.maybeExcludeUnreads(e,n,r)});TS.model.groups.forEach(function(e){if(e.is_archived||TS.notifs.isCorGMuted(e.id))return;n=parseInt(e.unread_cnt,10)||0;r=parseInt(e.unread_highlight_cnt,10)||0;TS.model.all_unread_cnt+=n;TS.model.all_unread_highlights_cnt+=r;TS.utility.msgs.maybeExcludeUnreads(e,n,r)});TS.model.ims.forEach(function(e){n=parseInt(e.unread_cnt,10)||0;r=parseInt(e.unread_cnt,10)||0;TS.model.all_unread_cnt+=n;TS.model.all_unread_highlights_cnt+=r;TS.utility.msgs.maybeExcludeUnreads(e,n,r)});TS.model.mpims.forEach(function(e){n=parseInt(e.unread_cnt,10)||0;if(TS.useReactMessages()){r=TS.notifs.isCorGMuted(e.id)?parseInt(e.unread_highlight_cnt,10):parseInt(e.unread_cnt,10);r=r||0}else r=parseInt(e.unread_cnt,10)||0;TS.model.all_unread_cnt+=n;TS.model.all_unread_highlights_cnt+=r;TS.utility.msgs.maybeExcludeUnreads(e,n,r)});_.each(TS.model.threads_mention_counts,function(e,t){r=parseInt(e,10)||0;TS.model.all_unread_highlights_cnt+=r;TS.utility.msgs.maybeExcludeUnreads(TS.redux.channels.getEntityById(t),0,r)});TS.model.threads_has_unreads&&(TS.model.all_unread_cnt+=1)},maybeExcludeUnreads:function e(t,n,r){if(!t)return;if(!n&&!r)return;if(!TS.interop.rules.channels.isOrgShared(t))return;if(TS.interop.rules.channels.isRelevantTeamForSharedChannel(t))TS.has_pri[o]&&TS.model.is_our_app&&TS.log(o,"Using unread of "+n+" and highlight of "+r+" for shared channel "+t.id+" because this IS the relevant team.");else{TS.model.is_our_app&&TS.has_pri[o]&&TS.log(o,"Excluding unread of "+n+" and highlight of "+r+" for shared channel "+t.id+" because this is NOT the relevant team.");TS.model.all_unread_cnt_to_exclude+=n;TS.model.all_unread_highlights_cnt_to_exclude+=r}},doesMsgHaveRxnFromUser:function e(t,n){return TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(t._rxn_key),n)},doesMsgHaveRxn:function e(t,n){return TS.rxns.doesRxnsHaveRxn(TS.rxns.getExistingRxnsByKey(t._rxn_key),n)},recordEmojiInHash:function e(t,n){if(!t)return false;if(!n)return false;var r=true;var i=TS.utility.findAllTeamEmojiInStr(t,r);if(!i.length)return false;var a=false;var s;for(var o=0;o<i.length;o+=1){s=TS.emoji.isValidName(i[o]);if(!s){TS.error(i[o]+" invalid");continue}parseInt(n[s],10)||(n[s]=0);n[s]+=1;a=true}return a},reCalcAndCountSomeUnreads:function e(t){if(!t||!t.length)return;var n;var r;var i;for(n=0;n<t.length;n+=1){i=TS.redux.channels.getEntityById(t[n]);if(!i){TS.warn("reCalcAndCountSomeUnreads: WTF no model_ob for id "+t[n]);continue}r=TS.shared.legacyGetControllerForModelOb(i);if(!r){TS.warn("reCalcAndCountSomeUnreads: WTF no controller for model_ob.id "+i.id);continue}if(!r.legacyCalcUnreadCnts){TS.warn("reCalcAndCountSomeUnreads: WTF no legacyCalcUnreadCnts on controller for model_ob.id "+i.id);continue}r.legacyCalcUnreadCnts(i)}},reCalcAndCountAllUnreads:function e(){var t=TS.interop.redux.models.channels.getPublicChannels(TS.redux.getState());var n=true;TS.utility.msgs.startBatchUnreadCalc();t.forEach(function(e){if(e.is_archived&&!e.was_archived_this_session)return;if(n&&TS.shared.legacyDidDeferMessageHistoryById(e.id))return;TS.channels.legacyCalcUnreadCnts(e)});TS.model.groups.forEach(function(e){if(e.is_archived&&!e.was_archived_this_session)return;if(n&&TS.shared.legacyDidDeferMessageHistoryById(e.id))return;TS.groups.legacyCalcUnreadCnts(e)});TS.model.ims.forEach(function(e){if(n&&TS.shared.legacyDidDeferMessageHistoryById(e.id))return;TS.ims.legacyCalcUnreadCnts(e)});TS.model.mpims.forEach(function(e){if(n&&TS.shared.legacyDidDeferMessageHistoryById(e.id))return;TS.mpims.legacyCalcUnreadCnts(e)});TS.utility.msgs.finishBatchUnreadCalc()},startBatchUnreadCalc:function t(){if("0"==TS.qs_args.unread_batch)return;e=true},finishBatchUnreadCalc:function t(){e=false;TS.utility.msgs.countAllUnreads()},maybeSetOldestMsgsTsAfterMsgAdded:function e(t){if(t.oldest_msg_ts)return;if(t.latest)return;TS.utility.msgs.setOldestMsgsTs(t)},setOldestMsgsTs:function e(t){var n=TS.utility.msgs.getOldestValidTs(t);if(n){TS.pri&&TS.log(58,"setOldestMsgsTs ("+t.id+'): setting oldest_msg_ts from "'+t.oldest_msg_ts+'" -> '+n);t.oldest_msg_ts=n;TS.storage.storeOldestTs(t.id,t.oldest_msg_ts);t._latest_via_users_counts&&(t._latest_via_users_counts=void 0)}},resetOldestMsgsTs:function e(t){TS.pri&&TS.log(58,"resetOldestMsgsTs ("+t.id+'): setting oldest_msg_ts from "'+t.oldest_msg_ts+'" -> null');t.oldest_msg_ts=null;TS.storage.storeOldestTs(t.id,null)},getOlderMsgsStatus:function e(t){var n=t.msgs;var r=t.oldest_msg_ts;var i=false;var a="ERROR";var s=false;var o=0;var l;t.msgs.length&&(l=TS.interop.rules.channels.getLatestMsgTs(t)||null);r&&TS.utility.msgs.getMsg(r,n)&&(i=true);if(l)if(i||t.is_limited){s=false;o=3;a="We have the oldest msg: "+r+". is_limited:"+t.is_limited}else{s=true;o=4;a=r?"There are older messages than these. oldest_msg_ts: "+r:"There are older messages than these. oldest_msg_ts: unknown"}else if(n.length){s=false;o=1;a="There are NOT older messages than these."}else{s=false;o=2;a="THIS IS A BRAND NEW CHANNEL SAY SOMETHING"}return{text:a,more:s,code:o,is_limited:t.is_limited}},getMostRecentValidTs:function e(t){if(!t)return null;var n;var r=t.msgs||[];for(var i=0;i<r.length;i+=1){n=r[i];if(!TS.interop.rules.messages.isTempMsg(n)){TS.pri&&i>0&&TS.log(58,"getMostRecentValidTs ("+t.id+"): "+n.ts+" at msgs["+i+"] of "+r.length);return n.ts}}var a=TS.interop.rules.channels.getLatestMsgTs(t)||null;TS.pri&&TS.log(58,"getMostRecentValidTs ("+t.id+"): did not find most recent valid ts. getLatestMsgTs() returned "+a);return a},getOldestValidTs:function e(t){var n;if(!t||!t.msgs)return null;var r=t.msgs.length-1;for(var i=r;i>-1;i-=1){n=t.msgs[i];if(!TS.interop.rules.messages.isTempMsg(n)){TS.pri&&i!==r&&TS.log(58,"getOldestValidTs("+t.id+"): "+n.ts+" at msgs["+i+"] of "+r);return n.ts}}TS.pri&&TS.warn("getOldestValidTs("+t.id+"): none found. msgs.length = "+r);return null},getHistoryFetchJobKey:function e(t,n){var r=t;n&&(r+="_"+n);return r},processImsg:function e(t,n){if(TS.boot_data.feature_modern_process_imsg)return TS.interop.messages.preprocessImsg(t,n);TS.utility.msgs._slurpExtraData(t,n);return TS.utility.msgs._makeInternalMsgObject(t,n)},processImsgFromHistory:function e(t,n){var r=TS.utility.msgs.processImsg(t,n);t.channel=n;"message_deleted"===t.subtype?TS.ms.msg_handlers.subtype__message_deleted(t):"message_changed"===t.subtype&&TS.ms.msg_handlers.subtype__message_changed(t);return r},_makeInternalMsgObject:function e(t,r){var i={type:"message",ts:t.ts};if(TS.useReactMessages()){i.channel=r;t._ephemeral_type&&(i._ephemeral_type=t._ephemeral_type)}t.source_team&&(i.source_team_id=t.source_team);"USLACKBOT"===t.user&&t.slackbot_feels&&(i.slackbot_feels=t.slackbot_feels);if(t.thread_ts){i.thread_ts=t.thread_ts;t.parent_ts&&(i.parent_ts=t.parent_ts);t.parent_user_id&&(i.parent_user_id=t.parent_user_id);t.hasOwnProperty("reply_count")&&(i.reply_count=parseInt(t.reply_count,10));t.thread_ts!==t.ts&&"thread_broadcast"!==t.subtype?i._hidden_reply=true:TS.useReactMessages()&&(i._hidden_reply=void 0);if("thread_broadcast"===t.subtype&&t.root){i.root=t.root;TS.useReactMessages()&&(i.root.channel=r);TS.boot_data.feature_file_threads&&(i.root=TS.utility.msgs.processImsg(t.root,r))}t.latest_reply&&(i.latest_reply=t.latest_reply);t.reply_users&&(i.reply_users=t.reply_users);t.reply_users_count&&(i.reply_users_count=t.reply_users_count)}else if(TS.useReactMessages()){i.thread_ts=void 0;i.reply_count=void 0}if("reply_broadcast"===t.subtype){t.broadcast_thread_ts&&(i.broadcast_thread_ts=t.broadcast_thread_ts);t.channel&&(i.channel_id=t.channel);t.new_broadcast&&(i.no_display=true)}t.replies?i.replies=t.replies:TS.useReactMessages()&&(i.replies=void 0);t.hasOwnProperty("subscribed")&&(i._subscribed=t.subscribed);t.hasOwnProperty("unread_count")&&(i._unread_count=t.unread_count);t.last_read&&(i._last_read=t.last_read);"tombstone"===t.subtype&&t.hidden&&t.reply_count>0&&delete t.hidden;"channel_topic"!==t.type&&"channel_purpose"!==t.type&&"channel_join"!==t.type&&"channel_leave"!==t.type||(t.subtype=t.type);TS.utility.msgs.shouldHideChannelJoinOrLeaveMsg(t,r)&&(i.no_display=true);if("group_join"===t.subtype||"group_purpose"===t.subtype||"group_topic"===t.subtype){var a=TS.redux.channels.getEntityById(r);a&&a.is_mpim&&(i.no_display=true)}t.inviter&&(i.inviter=t.inviter);t.hidden&&(i.hidden=t.hidden);t.no_notifications&&(i.no_notifications=t.no_notifications);t.ignore_if_attachments_supported&&(i.ignore_if_attachments_supported=t.ignore_if_attachments_supported);(t.hidden||t.no_display)&&(i.no_display=true);!t.ignore_if_attachments_supported||t.attachments&&t.attachments.length||(i.no_display=true);t.edited&&(i.edited=t.edited);t.user&&(i.user=t.user);t.attachments?i.attachments=t.attachments:TS.useReactMessages()&&(i.attachments=void 0);t.img_vids&&(i.img_vids=t.img_vids);t.bot_profile&&(i.bot_profile=t.bot_profile);var s;if(t.imgs){i.img_vids=i.img_vids||{};var o;for(s in t.imgs){if(i.img_vids[s])continue;o=t.imgs[s];o.img_vid_type="img";i.img_vids[s]=o}}if(t.videos){i.img_vids=i.img_vids||{};var l;for(s in t.videos){if(i.img_vids[s])continue;l=t.videos[s];l.img_vid_type="video";i.img_vids[s]=l}}t.icons&&(i.icons=t.icons);t.bot_id&&(i.bot_id=t.bot_id);t.is_ephemeral&&(i.is_ephemeral=t.is_ephemeral);t._alert_even_though_temp&&(i._alert_even_though_temp=t._alert_even_though_temp);t.is_starred&&(i.is_starred=t.is_starred);t.reactions&&delete t.reactions;t._rxn_key&&(i._rxn_key=t._rxn_key);t.pinned_to&&(i.pinned_to=t.pinned_to);TS.boot_data.feature_more_pins_info&&t.pinned_info&&(i.pinned_info=t.pinned_info);t.topic&&(i.topic=t.topic);t.name&&(i.name=t.name);t.old_name&&(i.old_name=t.old_name);t.purpose&&(i.purpose=t.purpose);t.text?_.isString(t.text)?i.text=t.text:TS.error("ERROR: invalid imsg.text type: "+n(t.text)+" "+TS.utility.stringifyJSONOrElse(t.text,null,2,"(and it is not JSON.stringifiable)")):TS.useReactMessages()&&(i.text=void 0);if(TS.interop.messages.shouldRenderFileThread(t)){t.upload&&(i.upload=true);if(_.isArray(t.files)){var u=t.files.map(function(e){if(!e.id)return null;var n=TS.files.getFileById(e.id);if(!n){TS.error("No file with id "+t.file.id+" for "+i.ts);return null}return n});i.files=_.compact(u);_.isEmpty(i.files)&&(i.no_display=true)}t.x_files&&(i.x_files=t.x_files)}t.sound&&(i.sound=t.sound);"mrkdwn"in t&&(i.mrkdwn=!!t.mrkdwn);"hex_swatches"in t&&(i.hex_swatches=!!t.hex_swatches);t.dnd_suppressed&&(i.dnd_suppressed=t.dnd_suppressed);t.recap&&(i.recap=t.recap);t.alert_type&&(i.alert_type=t.alert_type);if(t.subtype){i.subtype=t.subtype;("bot_message"===i.subtype||"thread_broadcast"===i.subtype&&t.bot_id)&&t.username&&(i.username=t.username);if("sh_room_created"===t.subtype||"sh_room_shared"===t.subtype)if(t._room_id)i._room_id=t._room_id;else if(t.room){var d=TS.rooms.getRoomById(t.room.id);if(d)i._room_id=d.id;else{TS.error("no room, no_display = true "+i.ts);i.no_display=true}}else i.no_display=true;if("file_share"===t.subtype||"file_mention"===t.subtype||"file_comment"===t.subtype){t.upload&&(i.upload=true);if(t.file){var c=TS.files.getFileById(t.file.id);if(c)i.file=c;else{TS.error("no file, no_display = true "+i.ts);i.no_display=true}}else i.no_display=true;"file_comment"===t.subtype&&(t.comment?i.file?i.comment=TS.files.addCommentToFile(t.comment,i.file):i.comment=t.comment:i.no_display=true)}if("pinned_item"===t.subtype){t.item_type&&(i.item_type=t.item_type);if("F"===t.item_type){if(t.item){var m=TS.files.getFileById(t.item.id);i.item=m}}else"Fc"!==t.item_type&&"C"!==t.item_type&&"G"!==t.item_type&&"D"!==t.item_type||(i.item=t.item);i.no_display=true}}else TS.useReactMessages()&&(i.subtype=void 0);return i},maybeFetchUserDataFromLS:function e(t){if(!t){TS.warn("maybeFetchUserDataFromLS: WTF no model_ob?");return}if(a[t.id])return;if(!t.last_msg_input){t.last_msg_input=TS.storage.fetchLastMsgInput(t.id);t.has_draft=!!t.last_msg_input;t.last_msg_input&&TS.has_pri[l]&&TS.log(l,'Got last_msg_input for "'+t.id+'": length = '+(t.last_msg_input.length||"unknown"))}a[t.id]=true},_handleLegacyAttachment:function e(t,n){if(!t){TS.warn("attachment is null!");return}if(t.slack_file_id&&!t._slack_file_is_deleted){var r=TS.files.getFileById(t.slack_file_id);r?t._slack_file=r:t._slack_file&&(t._slack_file=TS.files.upsertFile(t._slack_file).file)}if(t.mrkdwn_in&&_.isArray(t.mrkdwn_in)&&t.mrkdwn_in.length){t.mrkdwn_in_hash={};for(var i=0;i<t.mrkdwn_in.length;i+=1)t.mrkdwn_in_hash[t.mrkdwn_in[i]]=true}t.mrkdwn_in_hash||(t.mrkdwn_in_hash={});delete t.mrkdwn_in;t.hex_swatches=!!t.hex_swatches;(t.audio_html||t.audio_url)&&TS.inline_audios.makeInternalInlineAudio(t.audio_html||t.audio_url,t);if(t.other_html)TS.inline_others.makeInternalInlineOther(t);else if(t.video_html){var a=t.video_html_width&&parseInt(t.video_html_width,10)>parseInt(t.thumb_width,10)?t.video_html_width:t.thumb_width;var s=t.video_html_height&&parseInt(t.video_html_height,10)>parseInt(t.thumb_height,10)?t.video_html_height:t.thumb_height;TS.inline_videos.makeInternalInlineVideo(t.from_url||t.thumb_url,{title:t.title,html:TS.utility.msgs.filterHTMLForEmbeds(t.video_html),thumbnail:{url:t.thumb_url,width:a,height:s,link_url:t.from_url||t.title_url}})}else t.image_url&&TS.inline_imgs.makeInternalInlineImg(t.from_url||t.image_url,{src:t.image_url,width:t.image_width,height:t.image_height,link_url:t.from_url||t.title_url||t.image_url,bytes:t.image_bytes,rotation:t.rotation,content_type:t.content_type});TS.inline_attachments.massageAttachment(t,n)},processAttachments:function e(t){if(!t)return;var n;for(var r=0;r<t.length;r+=1){n=t[r];switch(n.type){case"canvas":TS.redux.canvases.addCanvas(n);delete n.content;break;default:TS.utility.msgs._handleLegacyAttachment(n,r)}}},_slurpExtraData:function e(t,n){TS.utility.msgs.processAttachments(t.attachments);t._rxn_key=TS.rxns.getRxnKey("message",t.ts,n);if(t.reactions){TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions}t.img_vids&&_.forOwn(t.img_vids,function(e,t){"img"===e.img_vid_type?TS.inline_imgs.makeInternalInlineImg(t,e):"video"===e.img_vid_type&&TS.inline_videos.makeInternalInlineVideo(t,e)});t.imgs&&_.forOwn(t.imgs,function(e,n){t.imgs[n].from_url=n;TS.inline_imgs.makeInternalInlineImg(n,e)});t.videos&&_.forOwn(t.videos,function(e,n){t.videos[n].from_url=n;TS.inline_videos.makeInternalInlineVideo(n,e)});if(TS.interop.messages.shouldRenderFileThread(t)&&t.files){_.forEach(t.files,function(e){TS.files.upsertAndSignal(e)});t.file&&TS.interop.console.warn("imsg has both a files array and file object on it. It should only have one or the other.")}if("file_share"===t.subtype||"file_mention"===t.subtype||"file_comment"===t.subtype)if(t.file&&!t.file.id)TS.error("WTF no file id on file in imsg.subtype:"+t.subtype+" "+t.ts);else if(t.file){TS.files.upsertAndSignal(t.file);"file_share"===t.subtype||"file_mention"===t.subtype;if("file_comment"===t.subtype)if(t.comment){var r=TS.files.getFileById(t.file.id);r?TS.files.addCommentToFile(t.comment,r):TS.warn("WTF no file? id:"+t.file.id)}else TS.error("WTF no comment in imsg.subtype:"+t.subtype+" "+t.ts)}"sh_room_created"!==t.subtype&&"sh_room_shared"!==t.subtype||(t.room&&!t.room.id?TS.error("WTF no room id on room in imsg.subtype:"+t.subtype+" "+t.ts):t.room?TS.rooms.upsertAndSignal(t.room):TS.error("WTF no room on imsg.subtype:"+t.subtype+" "+t.ts));"pinned_item"===t.subtype&&"F"===t.item_type&&t.item&&t.item.id&&!t.item.is_deleted&&TS.files.upsertAndSignal(t.item)},constructMsgPermalink:function e(t,n,r){if(!t)return"";var i;i=_.isString(t)?t:t.id;var a="/archives/"+i+"/p"+n.replace(".","");r&&r!==n&&(a+="?thread_ts="+r+"&cid="+i);return a},constructAbsoluteMsgPermalink:function e(t,n,r){var i=TS.boot_data.team_url.slice(0,-1)+TS.utility.msgs.constructMsgPermalink(t,n,r);return i},constructConversationPermalink:function e(t,n){var r;r=_.isString(t)?t:t.id;return"/conversation/"+r+"/p"+n.replace(".","")},shouldMarkUnreadsOnMessageFetch:function e(t){if("1"==TS.qs_args.no_unread_marking_on_msgs_fetch)return false;var n;if(t){n=TS.shared.legacyGetActiveModelOb();if(!n||n.id!==t.id)return false}TS.pri&&n&&TS.log(58,"shouldMarkUnreadsOnMessageFetch: returning TRUE for active model_ob of "+n.id);return true},removeFileSharesAndMentions:function e(t,n){if(!TS.client)return;var r=t.msgs;var i;for(var a=r.length-1;a>-1;a-=1){i=r[a];"file_share"!==i.subtype&&"file_mention"!==i.subtype||!i.file||i.file.id!=n.id||(t.is_mpim?TS.mpims.legacyRemoveMsg(t.id,i):t.is_group?TS.groups.legacyRemoveMsg(t.id,i):t.is_channel?TS.channels.legacyRemoveMsg(t.id,i):TS.ims.legacyRemoveMsg(t.id,i))}},removeFileComments:function e(t,n){if(!TS.client)return;var r=t.msgs;var i;for(var a=r.length-1;a>-1;a-=1){i=r[a];"file_comment"===i.subtype&&i.file&&i.file.id==n.id&&(t.is_mpim?TS.mpims.legacyRemoveMsg(t.id,i):t.is_group?TS.groups.legacyRemoveMsg(t.id,i):t.is_channel?TS.channels.legacyRemoveMsg(t.id,i):TS.ims.legacyRemoveMsg(t.id,i))}},removeFileReferences:function e(t,n){if(!TS.client)return;var r=t.msgs;var i;for(var a=r.length-1;a>-1;a-=1){i=r[a];if(i.attachments){var s=TS.inline_attachments.getAttachmentBySlackFileId(i.attachments,n);if(s&&!s._slack_file_is_deleted){s._slack_file_is_deleted=true;delete s._slack_file;t.id==TS.model.active_im_id?TS.ims.message_changed_sig.dispatch(t,i):t.id==TS.model.active_channel_id?TS.channels.message_changed_sig.dispatch(t,i):t.id==TS.model.active_group_id?TS.groups.message_changed_sig.dispatch(t,i):t.id==TS.model.active_mpim_id&&TS.mpims.message_changed_sig.dispatch(t,i)}}}},updateFileMsgs:function e(t,n){var r=t.msgs;var i=!(r&&r.length)||TS.model.archive_view_is_showing&&t.is_channel&&false===t.is_member;r=i?t._archive_msgs:r;if(!r||!r.length)return;var a;var s=function e(t){if(!t)return false;if(!t.attachments)return false;if(!t.attachments.length)return false;if(TS.inline_attachments.getAttachmentBySlackFileId(t.attachments,n.id))return true;return false};for(var o=r.length-1;o>-1;o-=1){a=r[o];if(n.is_deleted||"file_share"!==a.subtype&&"file_mention"!==a.subtype&&"file_comment"!==a.subtype||!a.file||a.file.id!=n.id){if(!s(a))continue}else;a.file=_.assign({},n);if(n.is_tombstoned)t.id==TS.model.active_im_id?TS.ims.message_changed_sig.dispatch(t,a):t.id==TS.model.active_channel_id?TS.channels.message_changed_sig.dispatch(t,a):t.id==TS.model.active_group_id?TS.groups.message_changed_sig.dispatch(t,a):t.id==TS.model.active_mpim_id&&TS.mpims.message_changed_sig.dispatch(t,a);else{if("hosted"===n.mode||"external"===n.mode||"snippet"===n.mode){if(!n.comments.length&&n.is_tombstoned)continue;t.id==TS.model.active_im_id?TS.ims.message_changed_sig.dispatch(t,a):t.id==TS.model.active_channel_id?TS.channels.message_changed_sig.dispatch(t,a):t.id==TS.model.active_group_id?TS.groups.message_changed_sig.dispatch(t,a):t.id==TS.model.active_mpim_id&&TS.mpims.message_changed_sig.dispatch(t,a)}TS.view.rebuildMsgFile(a,n,i)}}},updateCommentReferences:function e(t){if(!t)return;var n=TS.interop.redux.models.channels.getAllChannels(TS.redux.getState());_.forEach(n,function(e){_.forEach(e.msgs,function(e){if(!e.file||e.file.id!==t.id)return;if(!e.comment)return;var n=_.find(t.comments,{id:e.comment.id});n&&(e.comment=n)})})},tryToEditLastMsgFromShortcut:function e(t){var n=TS.shared.legacyGetActiveModelOb();if(!n)return;var r;r=TS.useReactMessages()?TS.redux.messages.getMessagesByChannelId(n.id):n.msgs;var i=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,r);if(!i){TS.sounds.play("beep");alert(TS.interop.i18n.t("Found no recent messages from you to edit :(","msgs")());return}var a=TS.format.unFormatMsg(i.text,i);var s=TS.utility.msgs.wordReplace(a,t);if(a==s){TS.sounds.play("beep");return}TS.useReactMessages()?TS.redux.dispatch(TS.interop.redux.actions.saveMessageEdit({channelId:n.id,ts:i.ts,text:TS.format.cleanMsg(s)})):TS.msg_edit.commitEdit(i,n,s)},getEditLastShortcutCmd:function e(t){var n=t.split("/");if(5!=n.length&&4!=n.length)return;if("s"!==n[1])return;var r=n[2];var i=n[3];var a=5==n.length&&("g"===n[4]||"gi"===n[4]||"ig"===n[4]);var s=5==n.length&&("i"===n[4]||"gi"===n[4]||"ig"===n[4]);if(!r)return;return{str:r,rpl:i,g:a,i:s}},wordReplace:function e(t,n){if(!n)return t;var r=(n.g?"g":"")+(n.i?"i":"");var i="[\\s\\n\\r\\t.,'\"+!?\\-_|]";var a=TS.utility.regexpEscape(n.str);var s=new RegExp("(^|"+i+"+)(?:"+a+")(?="+i+"+|$)",r);return t.replace(s,"$1"+n.rpl)},maybeTruncateMsgs:function e(t){if(!t)return;if(!t.msgs)return;if(!t.msgs.length)return;if(!TS.model.active_cid||!TS.shared.legacyGetActiveModelOb())return;var n=TS.model.initial_msgs_cnt+1;var r=Math.min(TS.model.hard_msg_limit,2*n);var i=1e3;var a=0;var s=2e4;var o=t.msgs;var l=TS.utility.msgs.getDisplayedMsgs(o);var u=Date.now();var d=t.has_fetched_history_after_scrollback?u-t.fetched_history_after_scrollback_time:u;if(l.length>r&&(t.id!=TS.shared.legacyGetActiveModelOb().id||t.scroll_top<i&&d>s))n=r;else{if(l.length-50<=n)return;if(t.last_made_active){var c=u-t.last_made_active;if(c<a)return}if(-1!=t.scroll_top)return}if(t.history_is_being_fetched)return;var _=[];while(TS.utility.msgs.getDisplayedMsgs(o).length>n)_.push(o.pop());if(t.is_limited){TS.info("Truncated "+t.id+" and reset is_limited");t.is_limited=false}t.id==TS.shared.legacyGetActiveModelOb().id&&TS.view.removeMsgsAfterTruncation(_)},checkForMsgsToTruncate:function e(){if(!TS.model)return;if(!TS.model.channels)return;var t=TS.model.channels;var n;var r;for(r=0;r<t.length;r+=1){n=t[r];if(n.id==TS.model.active_channel_id)continue;if(!n.is_member)continue;if(n.is_archived)continue;TS.utility.msgs.maybeTruncateMsgs(n)}var i=TS.model.ims;var a;for(r=0;r<i.length;r+=1){a=i[r];if(a.id==TS.model.active_im_id)continue;TS.utility.msgs.maybeTruncateMsgs(a)}var s=TS.model.groups;var o;for(r=0;r<s.length;r+=1){o=s[r];if(o.id==TS.model.active_group_id)continue;if(o.is_archived)continue;TS.utility.msgs.maybeTruncateMsgs(o)}var l=TS.model.mpims;var u;for(r=0;r<l.length;r+=1){u=l[r];if(u.id==TS.model.active_mpim_id)continue;TS.utility.msgs.maybeTruncateMsgs(u)}},getEphemeralMsgsByCidAndType:function e(t,n){var r;var i=[];var a=TS.redux.channels.getEntityById(t);if(!a)return i;TS.useReactMessages()&&(i=TS.redux.messages.getMessagesByProp(t,{_ephemeral_type:n}));_.forOwn(TS.utility.msgs.ephemeral_msgs_map,function(e,s){if(e.ephemeral_type==n&&e.c_id==t){r=TS.utility.msgs.getMsg(s,a.msgs);if(!r)return;i.push(r)}});return i},removeAllEphemeralMsgsByType:function e(t,n,r){if(TS.useReactMessages()&&!r){var i=TS.redux.messages.getMessagesByProp(n,{_ephemeral_type:t});_.forEach(i,function(e){var t=TS.redux.channels.getEntityById(e.channel);if(!t)return;var n=TS.shared.legacyGetControllerForModelOb(t);n.legacyRemoveMsg(t.id,e)});return}var a;var s;_.forOwn(TS.utility.msgs.ephemeral_msgs_map,function(e,i){if(e.ephemeral_type==t){if(n&&n!=e.c_id)return;if(r&&r!=e.thread_ts)return;a=TS.redux.channels.getEntityById(e.c_id);if(!a)return;s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;a.is_im?TS.ims.legacyRemoveMsg(a.id,s):a.is_mpim?TS.mpims.legacyRemoveMsg(a.id,s):a.is_channel?TS.channels.legacyRemoveMsg(a.id,s):a.is_group&&TS.groups.legacyRemoveMsg(a.id,s);delete TS.utility.msgs.ephemeral_msgs_map[i]}})},hasImgs:function e(t){if(!t)return false;if(t.img_vids)_.forOwn(t.img_vids,function(e){if("img"===e.img_vid_type)return true});else if(t.attachments)for(var n=0;n<t.attachments.length;n+=1)if(t.attachments[n].image_url)return true;return false},ingestMessagesFromBootData:function e(t){if(!TS.boot_data.msgs)return;var n=TS.boot_data.msgs[t.id];var r=[];if(n){var i;for(var a=0;a<n.length;a+=1){i=n[a];if(!i.ts)continue;r.push(TS.utility.msgs.processImsg(i,t.id))}}TS.utility.msgs.setMsgs(t,r)},handleSearchHighlights:function e(t){return TS.format.replaceHighlightMarkers(t,'<span class="match">',"</span>")},handleFailedMsgSend:function e(t,n,r){var i=TS.utility.msgs.getMsg(t,n.msgs);TS.useReactMessages()&&(i=TS.utility.msgs.findMsg(t,n.id));if(i){var a;var s;if(r&&i.thread_ts){a=TS.utility.msgs.findMsg(i.thread_ts,n.id);s=i._was_reply_broadcast}n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,i):n.is_channel?TS.channels.legacyRemoveMsg(n.id,i):n.is_group?TS.groups.legacyRemoveMsg(n.id,i):TS.ims.legacyRemoveMsg(n.id,i);r&&TS.shared.legacySendMsg(n.id,TS.format.unFormatMsg(i.text,i),a,s);delete TS.model.unsent_msgs[i.ts];delete TS.model.display_unsent_msgs[i.ts]}else TS.error("no msg?: "+t)},msgMightBeRolledUp:function e(t){return t.subtype&&-1!=TS.model.join_leave_subtypes.indexOf(t.subtype)},msgRollUpWorker:function e(t,n,r,i){delete n._jl_rollup_hash;delete n._jl_rolled_up_in;if(!TS.utility.msgs.msgMightBeRolledUp(n))return;i.push(n);if(0!==t&&TS.utility.msgs.msgMightBeRolledUp(r[t-1]))return"continue";i[0]._jl_rollup_hash={msg_ids:[],users:{}};var a=i[0]._jl_rollup_hash;var s;for(var o=0;o<i.length;o+=1){s=i[o];a.users[s.user]=a.users[s.user]||{};var l=a.users[s.user];a.msg_ids.push(s.ts);s._jl_rolled_up_in=i[0].ts;if("channel_join"===s.subtype||"group_join"===s.subtype){l.inviter=s.inviter;l.joined=true;l.is_in=true}else if("channel_leave"===s.subtype||"group_leave"===s.subtype){l.left=true;l.is_in=false}}return"swap"},shouldHaveBotLabel:function e(t,n){var r=t.subtype&&("bot_message"===t.subtype||"thread_broadcast"===t.subtype&&t.bot_id)&&"USLACKBOT"!==t.user;var i=n&&n.is_bot&&!n.is_slackbot;return r||i},checkConsistencyViaApi:function e(t){if(!TS.boot_data.feature_msg_consistency)return;if(!TS.redux.socket.isConnected())return;var n=TS.redux.channels.getEntityById(t);if(!n||!n.msgs||!n.msgs.length)return;if(n.is_archived)return;if(n.history_is_being_fetched)return;if(n._consistency_has_been_checked)return;if(n._consistency_is_being_checked)return;var r=TS.utility.msgs.getOldestValidTs(n);if(!r)return;var a=TS.utility.msgs.getMostRecentValidTs(n);var s="checkConsistencyViaApi for: "+t;n._consistency_is_being_checked=true;var o={channel:n.id,oldest:r,count:1e3,inclusive:true,ignore_replies:true,include_pin_count:true,no_user_profile:true};a&&(o.latest=a);TS.has_pri[u]&&TS.log(u,s+", range = "+o.oldest+" -> "+(o.latest||"now"));TS.api.call("conversations.history",o).then(function(e){var r=TS.utility.msgs.checkConsistency(t,e.data.messages);if(r){i+=1;TS.metrics.store("inconsistent_history_cnt",i,{is_count:true});TS.error(s+" NOT GOOD!")}else{n._consistency_has_been_checked=true;TS.has_pri[u]&&TS.log(u,s+" all good!")}}).catch(function(e){TS.error(s+" err:"+e)}).finally(function(){n._consistency_is_being_checked=false})},checkConsistency:function e(t,n){var r=TS.redux.channels.getEntityById(t);if(!r||!r.msgs||!r.msgs.length)return;var i=[];var a="checkConsistency for: "+t;TS.has_pri[u]&&TS.log(u,a+" from_msgs.length:"+n.length+" model_ob.msgs.length:"+r.msgs.length);n.forEach(function(e,n){if(!TS.utility.msgs.getMsg(e.ts,r.msgs)){e=TS.utility.msgs.processImsg(e,t);i.push(e);TS.error(a+" found and fixed an inconsistency at i:"+n+", ts="+e.ts)}});if(!i.length)return false;1==i.length?r.is_mpim?TS.mpims.legacyAddMsg(t,i[0]):r.is_group?TS.groups.legacyAddMsg(t,i[0]):r.is_im?TS.ims.legacyAddMsg(t,i[0]):r.is_channel&&TS.channels.legacyAddMsg(t,i[0]):TS.shared.legacyAddMsgs(r,i);return true},filterHTMLForEmbeds:function e(n){if(!n)return n;var i;var a=new DOMParser;var s=a.parseFromString(n,"text/html")||a.parseFromString(n,"text/xml");var o="";var l;s&&(l=$(s.body));if(!l)return n;if(l){i=l.find(r);i.length&&(o=TS.utility.sanitizeHTML(i.first()[0].outerHTML,t,TS.utility.msgs.allowed_embed_attributes))}a=null;s=null;l=null;i=null;return o},areMsgsSameDay:function e(t,n){var r=TS.interop.datetime.toDateObject(t.ts);var i=TS.interop.datetime.toDateObject(n.ts);return TS.interop.datetime.isSameDay(r,i)},maybeCalcUnreadCnts:function e(t){if(!TS.client||!TS.client._should_defer_initial_msg_history)return;if(!t){TS.warn("maybeCalcUnreadCnts: WTF no model_ob?");return}if(t._needs_unread_recalc&&1==t.unread_cnt){var n=TS.shared.legacyGetControllerForModelOb(t);if(!n){TS.warn("maybeCalcUnreadCnts: WTF no controller for id "+t.id+"?");return}var r=false;n.legacyCalcUnreadCnts(t,r);t._needs_unread_recalc=false}},maybeSetPrevLastRead:function e(t,n){if(!t)return;var r=TS.utility.msgs.getMostRecentValidTs(t);n!=r?TS.utility.msgs.setPrevLastRead(t,n):TS.utility.msgs.setPrevLastRead(t,t.last_read)},setPrevLastRead:function e(t,n){if(!t)return;if(t._prev_last_read||!t.unread_cnt||TS.notifs.isCorGMuted(t.id)){var r=TS.utility.msgs.getMostRecentValidTs(t);var i=TS.utility.msgs.getMsg(r,t.msgs);i&&"pinned_item"===i.subtype&&(t._prev_last_read=n)}else t._prev_last_read=n},maybeClearPrevLastRead:function e(t){t=t||TS.shared.legacyGetActiveModelOb();t&&t._prev_last_read&&(t._prev_last_read=void 0)},msgHasReplies:function e(t){if(!t)return false;return t.ts===t.thread_ts&&!!t.reply_count},startUpdatingRelativeTimestamps:function e(t){s.start(t)},stopUpdatingRelativeTimestamps:function e(t){s.stop(t)},shouldHideChannelJoinOrLeaveMsg:function e(t,n){if(!TS.boot_data.feature_hide_join_leave)return false;var r=TS.interop.members.getMemberById(t.user);var i=_.get(r,"is_bot",false);if("channel_join"===t.subtype||"member_joined_channel"===t.type){var a=_.isObject(n)?n:TS.interop.channels.getChannelById(n);if(!a)return false;var s=_.includes(TS.prefs.getTeamPref("default_channels"),a.id);var o=!!t.inviter;var l=a.num_members;if(_.isUndefined(a.num_members)){var u=TS.interop.memberCounts.getOrFetchMemberCounts(a.id);u.counts&&(l=_.get(u,"counts.member_count"))}var d=!_.isUndefined(l)&&l>20;if(!i&&!s&&!o&&d)return true}else if(("channel_leave"===t.subtype||"member_left_channel"===t.type)&&!i)return true;return false},extractMsgDisplayContext:function e(t){var n=t.closest("#unread_msgs_div, #sli_briefing");if(n.is("#unread_msgs_div"))return"all_unreads";if(n.is("#sli_briefing"))return"briefing";return null},extractLinkType:function e(t,n,r){if(n.data("member-id")||t.data("member-id"))return"user";if(n.data("channel-id")||t.data("channel-id"))return"channel";if(n.data("file-id")||t.data("file-id"))return"file";if(r&&r.match(/\.slack\.com\/archives\//))return"message";var i=r&&!TS.interop.url.getHostName(r).match(/\.slack\.com/);if(i)return"external";return"internal"},extractLinkItemId:function e(t,n,r){if("user"===r)return n.data("member-id")||t.data("member-id");if("channel"===r)return n.data("channel-id")||t.data("channel-id");if("file"===r)return n.data("file-id")||t.data("file-id");return null},extractLinkAction:function e(t,n){if(n.hasClass("file_preview_action")){if(n.hasClass("file_ssb_download_link"))return"file_ssb_download_link";if(n.hasClass("file_new_window_link"))return"file_new_window_link";if(n.hasClass("file_comment_link"))return"file_comment_link";return"file_preview_action"}if(t.hasClass("file_viewer_external_link"))return"file_viewer_external_link";if(t.hasClass("file_viewer_link"))return"file_viewer_link";if(n.hasClass("file_preview_link"))return"file_preview_link";if(n.hasClass("file_header"))return"file_header";if(n.parent()&&n.parent().hasClass("rest_text_expander"))return"rest_text_expander";return null},extractLinkAttachmentField:function e(t){var n=t.parent();if(t.hasClass("btn_attachment_link"))return"attachment_link_button";if(n.hasClass("attachment_source_icon"))return"attachment_source_icon";if(n.hasClass("attachment_source_name"))return"attachment_source_name";if(n.hasClass("attachment_author_name"))return"attachment_author_name";if(n.hasClass("attachment_title"))return"attachment_title";return null},isRawLink:function e(t,n){if(!t||!n)return false;if(!t.is("a"))return false;var r=n.replace(/(^\w+:|^)\/\//,"");return t.text()===n||t.text()===r},charsOverLimit:function e(t,n){_.isNumber(n)||(n=TS.interop.constants.MAX_MESSAGE_INPUT_BYTES);if(t.length<=n/4)return 0;var r=0;var i=[];var a=0;for(var s=0;s<t.length;s++){var o=t.charCodeAt(s);if(o<55296||o>57343){i.push(o);r+=TS.utility.bytesInUnicodeCodePoint(o)}if(o>=56320&&o<=57343){i.push(65533);r+=1}if(o>=55296&&o<=56319)if(s==t.length-1){i.push(65533);r+=1}else{var l=t.charCodeAt(s+1);if(l>=56320&&l<=57343){var u=1023&o;var d=1023&l;var c=66560+u+d;i.push(c);r+=TS.utility.bytesInUnicodeCodePoint(c);s+=1}else{i.push(65533);r+=1}}r<=n&&(a=i.length)}return i.length-a},getUnreadMsgTimestampsWithoutHighlights:function e(t){if(!t||!t.unread_cnt)return[];var n=parseFloat(t.last_read);return _.reduce(t.msgs,function(e,r){parseFloat(r.ts)>n&&!TS.client.highlights.msgIsHighlight(t.id,r.ts)&&!TS.client.highlights.isMsgBeingRequested(t.id,r.ts)&&(e[r.ts]=true);return e},{})},shouldSendSlashCommand:function e(t){if("/"===t.substr(0,1)&&"//"!==t.substr(0,2))return true;if("\uff0f"===t.substr(0,1))return true;return false},legacyReplaceMsg:function e(t,n,r,i){var a=TS.utility.msgs.getMsg(n.ts,t.msgs);!a&&t._archive_msgs&&(a=TS.utility.msgs.getMsg(n.ts,t._archive_msgs));!a&&TS.ui.replies&&(a=TS.ui.replies.getActiveMessage(t,n.ts));!a&&TS.client&&(a=TS.client.threads.getMessage(t,n.ts));!a&&TS.client&&(a=TS.client.unread.getMessage(t,n.ts));if(!a){r||TS.error("unknown msg:"+n.ts+" in "+t.id);return}n._rxn_key=a._rxn_key;n.pinned_to||(n.pinned_to=a.pinned_to);"is_starred"in n||(n.is_starred=a.is_starred);!n.recap&&a.recap&&(n.recap=a.recap);var s=null;if(n.comment&&n.file){var o=TS.files.getFileById(n.file.id);if(o){TS.files.editCommentOnFile(n.comment,o);s=TS.files.getFileCommentById(o,n.comment.id)}}n=TS.utility.msgs.processImsg(n,t.id);s&&(n.comment=s);var l=_.union(Object.keys(n),Object.keys(a)).filter(function(e){return n[e]!=a[e]});if(!l.length&&!i){TS.info("Not signalling message change because it doesn't look like anything has changed for "+n.ts+" in "+t.id);return}_.each(_.keys(a),function(e){delete a[e]});_.forOwn(n,function(e,t){a[t]=e});t.is_im?TS.ims.message_changed_sig.dispatch(t,a,l):t.is_group&&t.is_mpim?TS.mpims.message_changed_sig.dispatch(t,a,l):t.is_group&&!t.is_mpim?TS.groups.message_changed_sig.dispatch(t,a,l):t.is_channel&&TS.channels.message_changed_sig.dispatch(t,a,l);if(_.includes(l,"_hidden_reply")){var u=!TS.interop.rules.messages.isTempMsg(a);t.is_im?TS.ims.legacyCalcUnreadCnts(t,u):t.is_group&&t.is_mpim?TS.mpims.legacyCalcUnreadCnts(t,u):t.is_group&&!t.is_mpim?TS.groups.legacyCalcUnreadCnts(t,u):t.is_channel&&TS.channels.legacyCalcUnreadCnts(t,u)}TS.utility.msgs.msgHasReplies(a)&&!TS.useReactMessages()&&TS.replies.updateThreadBroadcastRoots(t,a)}});var e=false;var t=["video","iframe","source"];var r=t.join(",");var i=0;var a={};var s=function(){var e=null;var t=[];function n(n){if(_.includes(t,n))return;t.push(n);null===e&&(e=setInterval(i,6e4))}function r(n){_.pull(t,n);if(!t.length){clearInterval(e);e=null}}function i(){_.forEach(t,function(e){$(e).find(".relative_ts").each(function(){var e=$(this).attr("data-ts");var t=$(this).data("really-short");var n=TS.interop.datetime.toTimeAgo(e,{compact:t});n!==$(this).text()&&$(this).text(n)})})}return{start:n,stop:r}}();var o=67;var l=667;var u=773})()},11243:function(e,t){(function(){var e={};TS.registerModule("utility.members",{checkMemberMatch:function e(t,n,r){return!r&&t.profile&&t.profile.email&&t.profile.email.match(n)||t.profile&&t.profile.real_name_normalized&&t.profile.real_name_normalized.match(n)||t.profile&&t.profile.real_name&&t.profile.real_name.match(n)||t.profile&&t.profile.display_name_normalized&&t.profile.display_name_normalized.match(n)||t.profile&&t.profile.display_name&&t.profile.display_name.match(n)},filterMembersByQuery:function e(t,n){n=_.toString(n).trim().toLowerCase().replace(/^@/,"");if(!n)return t;var r=new RegExp(TS.utility.regexpEscape(n),"i");return t.filter(function(e){return TS.utility.members.checkMemberMatch(e,r)})},getBroadcastKeywordsForUser:function t(){var n=TS.shared.legacyGetActiveModelOb();if(!n)return[];var r=[];var i=[];var a=TS.boot_data.page_needs_enterprise&&TS.interop.rules.channels.isRequired(n)&&TS.interop.rules.channels.isOrgShared(n);n.is_general&&TS.permissions.members.canAtMentionEveryone(n.id)&&!a&&(r=_.filter(TS.model.BROADCAST_KEYWORDS,function(e){return"BKeveryone"===e.id||"BKall"===e.id}));!TS.permissions.members.canAtChannelOrGroup(n.id)||!n.is_channel&&!n.is_group||n.is_general&&!TS.permissions.members.canAtMentionEveryone(n.id)||a||(i=_.filter(TS.model.BROADCAST_KEYWORDS,function(e){return"BKchannel"===e.id||"BKgroup"===e.id||"BKhere"===e.id}));if(!i.length&&TS.model.user.is_admin&&(n.is_channel||n.is_group)&&!e[n.id]){e[n.id]=true;TS.logError({model_ob:n.id,is_channel:n.is_channel,is_group:n.is_group,is_general:n.is_general,is_enterprise_required_channel:a,who_can_at_channel:TS.prefs.getTeamPref("who_can_at_channel"),canAtChannelOrGroup:TS.permissions.members.canAtChannelOrGroup(n.id),canAtMentionEveryone:TS.permissions.members.canAtMentionEveryone(n.id),feature_stop_loud_channel_mentions:TS.boot_data.feature_stop_loud_channel_mentions},"getBroadcastKeywordsForUser no channel_keywords for admin","getBroadcastKeywordsForUser_empty_v2")}return r.concat(i)},isMemberRelevantToModel:function e(t,n){_.isObject(t)||(t=TS.interop.members.getMemberById(t));if(!t)return false;if(t.is_slackbot)return true;if(t.deleted)return false;_.isObject(n)||(n=TS.redux.channels.getEntityById(n)||TS.shared.legacyGetActiveModelOb());return true},isMemberElement:function e(t){if(t.hasAttribute("data-member-id"))return true;if(t.classList.contains("internal_member_link"))return true;return false},isMemberNonBotNonDeletedNonSelf:function e(t){var n=t&&!t.deleted&&!t.is_bot&&!t.is_slackbot;return n&&!t.is_self},getEntityFromMessage:function e(t){if(!t)return false;var n;n="USLACKBOT"===t.user&&t.file&&t.file.bot_id?TS.utility.members.getEntityFromFile(t.file):t.comment?TS.redux.members.getPotentiallyUnknownMemberById(t.comment.user):TS.redux.members.getPotentiallyUnknownMemberById(t.user);return n},getUsernamesMentionedInString:function e(t){var n=_.toLower(t).match(/\B@\w+/g);if(!n)return[];return _(n).map(function(e){return e.replace(/^@/,"")}).uniq().compact().value()},getEntityFromFile:function e(t){if(!t)return false;var n;if("USLACKBOT"===t.user&&t.bot_id){n=TS.interop.bots.getBotById(t.bot_id);n||(n={});n.is_bot=true;n.is_service=true}else n=TS.redux.members.getPotentiallyUnknownMemberById(t.user);return n}})})()},11244:function(e,t){(function(){TS.registerModule("format",{hex_rx:/(\W|^)(#[A-Fa-f0-9]{6})(\b)/g,onStart:function e(){r()},replaceUnicodeDoppelgangers:function e(t){if(!t)return"";t=t.replace(/\u00A0/g," ");t=t.replace(/\u000D/g,"\n");t=t.replace(/\u000A/g,"\n");return t},replaceHighlightMarkers:function e(t,n,r){if(!t)return"";n=n||"";r=r||"";return t.replace(/\ue000/g,n).replace(/\ue001/g,r)},hasOnlyValidMemberIds:function e(t){if(!_.isString(t))return true;return _.every(t.match(a),TS.interop.members.getMemberById)},cleanMsg:function e(t){return H(t,{do_specials:true})},cleanInternalMsg:function e(t){return H(t,{do_specials:false})},cleanForLanguageIdentifier:function e(t){var n="";var r=TS.interop.texty.convertContentsStringToContents(t,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());n=_.reduce(r.contents,function(e,t){if(t.attributes&&t.attributes.slackmention)return e;if(t.insert&&t.insert.slackemoji)return e;return e+t.insert},"");n=n.replace(TS.emoji.getColonsRx(),"");n=n.replace(s,"");var i=TSF.getTokensArray(n,"NORMAL");var a=false;n=_.reduce(i,function(e,t){if(-1!==["<I:START>","<B:START>","<STRIKE:START>","<I:END>","<B:END>","<STRIKE:END>","<QUOTE:PREFIX>","<QUOTE:START>","<QUOTE:END>","<LONGQUOTE:PREFIX>"].indexOf(t))return e;if("<HEX:BLOCK"===t.substr(0,10))return e;if("<SPACE:HARD>"===t)return e+" ";if("<LINE:BREAK>"===t)return e+"\n";if("<PARA:BREAK>"===t)return e+"\n\n";if(-1!==["<CODE:START>","<PRE:START>"].indexOf(t)||"<LINK:START"===t.substr(0,11)){a=true;return e}if(-1!==["<CODE:END>","<PRE:END>"].indexOf(t)||"<LINK:END"===t.substr(0,9)){a=false;return e}return a?e:e+t});return n},doEmoticonConversion:function e(t){f.length=0;t=t.replace(o,v);t=t.replace(l,v);t=t.replace(u,v);t=TS.emoji.replaceEmoticons(t);t=TS.format.deTokenizeStr(f,t);return t},tokenizeStr:function e(t,n,r){if(!n)return"";r=r||"";var i=0===n.indexOf("\n")?"\n":"";var a=w(i+h+(p+=1)+Date.now());a=r+a+r;t.push({str:n,token:a});return a},deTokenizeStr:function e(t,n){var r;var i=t.length-1;for(i;i>-1;i-=1){r=t[i];n=n.replace(r.token,r.str.replace(/\$/g,"$$$$"))}return n},unFormatMsg:function e(t,n){return TS.format.formatWithOptions(t,n,{for_edit:true})},formatJustText:function e(t){return TS.format.formatWithOptions(t)},formatDefault:function e(t,n){return TS.format.formatWithOptions(t,n)},formatNoHighlightsNoSpecials:function e(t,n){return TS.format.formatWithOptions(t,n,{no_highlights:true,no_specials:true})},formatNoHighlightsNoSpecialsNoInlineImgs:function e(t,n){return TS.format.formatWithOptions(t,n,{no_highlights:true,no_specials:true,do_inline_imgs:false})},formatNoHighlightsNoInlineImgs:function e(t,n){return TS.format.formatWithOptions(t,n,{do_inline_imgs:false,no_highlights:true})},formatNoSpecials:function e(t,n){return TS.format.formatWithOptions(t,n,{no_specials:true})},formatNotification:function e(t,n){return TS.format.formatWithOptions(t,n,{for_growl:true})},formatCurrentStatus:function e(t,n,r){r=r||{};return TS.format.formatWithOptions(t,n,_.assign({no_jumbomoji:true,no_linking:true,no_specials:true,no_highlights:true,no_emoji_text:true,prevent_copy_paste:true},r))},formatBroadcastExcerpt:function e(t,n){var r="&hellip;<br>";var i=r+'<span class="multiline_block">';var a="</span>";var s=TS.format.formatWithOptions(t,n,{no_highlights:true,no_hex_colors:true,do_inline_imgs:false,enable_slack_action_links:false,do_theme_install_buttons:false,no_jumbomoji:true,no_linking:true,custom_linebreak:r,token_overrides:{"<PRE:START>":i,"<PRE:END>":a,"<QUOTE:START>":i,"<QUOTE:END>":a,"<CODE:START>":"<span>","<CODE:END>":"</span>","<PARA:BREAK>":r}});_.startsWith(s,r)&&(s=s.substring(r.length));return s},extractIds:function e(t){var n=[];var r=[];var i=t.match(/<[#@]+(.*?)>/g);i&&i.forEach(function(e){var t;var i;if(0===e.indexOf("<@")){t=e.replace(/<|>/g,"");i=TS.utility.msgs.getMemberIdFromMemberMarkup(t);TS.interop.utility.looksLikeMemberId(i)&&TS.utility.ensureInArray(r,i)}else{t=e.replace(/<|>|#/g,"");i=t.split("|")[0];TS.interop.utility.looksLikeChannelId(i)&&TS.utility.ensureInArray(n,i)}});return{c_ids:n,m_ids:r}},calculateOptions:function e(t,n){return k(t,n)},formatWithOptions:function e(t,n,r){if(!$.trim(t))return"";var i=k(n,r);var a=x(t,n,i);return a},applyStringifyTransformsToChildren:function e(t,n,r){if(!t)return false;_.isObject(n)||(n={});if(!t.childElementCount)return false;var i=!r&&1===t.childNodes.length&&1===t.firstChild.nodeType&&t.firstChild.hasAttribute("data-stringify-requires-siblings");if(i)return;"PRE"!==t.tagName&&_.each(t.querySelectorAll("pre br"),function(e){e.parentElement.replaceChild(document.createTextNode("\n"),e)});var a=_.filter(t.querySelectorAll("*"),function(e){if(!j(e))return false;if(_.isFunction(n.excludeFn)&&n.excludeFn(e))return false;e.childElementCount&&TS.format.applyStringifyTransformsToChildren(e,n,true);var r;r=_.isFunction(n.customFn)&&n.customFn(e)?n.customFn(e):TS.format.stringifyNode(e);var i=r!==e.textContent;i&&("IMG"===e.tagName?t.replaceChild(document.createTextNode(r),e):e.textContent=r);return i});return a.length>0},formatSelection:function e(t,n){if(!t||!t.rangeCount)return;_.isObject(n)||(n={});var r=TS.selection.combineRanges(t);if(!r)return;var i;if(_.isElement(r.commonAncestorContainer)){if($(r.commonAncestorContainer).is(".ql-editor"))return t.toString();if(TS.model.is_safari_desktop){var a=r.commonAncestorContainer.querySelectorAll("ts-message");if(a.length>1)return}var s=r.commonAncestorContainer.cloneNode();s.appendChild(r.cloneContents());s.classList.add("offscreen","user_select_text");r.commonAncestorContainer.parentElement.appendChild(s);var o="\ufeff";s.innerHTML=s.innerHTML.replace(/&nbsp;/g,o);!s.lastChild||s.lastChild.textContent||j(s.lastChild)||s.removeChild(s.lastChild);var l=s.getElementsByClassName("para_break");if(l.length){_.eachRight(l,function(e){var t=document.createElement("br");e.parentElement.replaceChild(t,e);var n=document.createElement("br");t.parentElement.insertBefore(n,t.nextSibling)});s.innerHTML=s.innerHTML.replace(/<br>((<br>){2,})/g,"$1")}_.each(s.querySelectorAll([".ts_tip_tip",".c-message_list__unread_divider",".unread_divider",".c-message_list__day_divider__label",".c-reaction_bar",".c-message__reply_bar",".c-message__broadcast_repliers",".c-file__slide",".c-file__actions",".c-file_container__expand_container",".c-button",".c-message_attachment__row--actions",".c-message_attachment__border",".c-message_attachment__media_trigger",".c-message__label",".c-message--adjacent .c-message__gutter"].join(",")),function(e){e&&e.parentNode&&e.parentNode.removeChild(e)});TS.format.applyStringifyTransformsToChildren(s,n);var u=TS.selection.snapshot();t=TS.selection.selectNodeContents(s);i=t.toString();var d=new RegExp(o,"g");i=i.replace(/ {2}/g," ").replace(d," ");s.parentElement.removeChild(s);u()}else i=t.toString();i=TS.format.replaceUnicodeDoppelgangers(i);i=i.replace(/^\n+/,"");i=i.replace(/\n+$/,"");return i},formatSelectionAsHTML:function e(t,n){if(!t||!t.rangeCount)return"";1!==t.rangeCount&&TS.info("TS.format.formatSelection: found "+t.rangeCount+" ranges");var r=t.getRangeAt(0);var i=document.createElement("div");i.appendChild(r.cloneContents());if(n){i.querySelectorAll(".emoji").forEach(function(e){if("IMG"===e.tagName&&e.getAttribute("data-stringify-text")){var t=document.createElement("span");t.setAttribute("class","slack_inline_emoji");t.appendChild(document.createTextNode(e.getAttribute("data-stringify-text")));i.replaceChild(t,e)}});i.querySelectorAll("ts-mention").forEach(function(e){var t=e.textContent;var n=e.getAttribute("data-label");if(t.length>n.length){var r=Math.floor(t.length/n.length);var a="";for(var s=0;s<r;s++)a+=n;if(t===a){for(var o=0;o<r;o++){var l=e.cloneNode(true);l.textContent=n;i.insertBefore(l,e)}i.removeChild(e)}}})}return i.innerHTML.replace(/^<p><\/p>/,"<p><br></p>")},stringifyNode:function e(t){if(!t)return"";if(!j(t))return t.textContent;var n=t.textContent;_.each(d,function(e,r){t.hasAttribute(r)&&(n=e(t,n))});return n},shouldAllowIntraWordFormatting:function e(){return TS.boot_data.feature_allow_intra_word_formatting},swapInAts:function e(t){if(!t)return t;return t.replace(new RegExp(g,"g"),"@").replace(new RegExp(S,"g"),"-").replace(new RegExp(T,"g"),"_")},swapOutAts:function e(t){if(!t)return t;return t.replace(/@/g,g).replace(/-/g,S).replace(/_/g,T)},test:function e(){var t={encodeSpecialFormattingChars:y,encodeSpecialFormattingCharsAndColon:w,getTokenMap:c};Object.defineProperty(t,"_hasStringifyTransformations",{get:function e(){return j},set:function e(t){j=t}});return t}});var e=[];var t=[];var n={};var r=function r(){TS.model.BROADCAST_KEYWORDS.forEach(function(r){e.push(r.ms_name);n[r.ms_name]=r.name;t.push({regex:new RegExp("^@("+r.name+"|"+TS.interop.i18n.deburr(r.name)+")[.|\\-|_]*$"),cmd:r.cmd,name:"!"+r.name});r.ms_name!==r.name&&t.push({regex:new RegExp("^@"+r.ms_name+"[.|\\-|_]*$"),cmd:r.cmd,name:"!"+r.ms_name});if(r.alias){e.push(r.alias);t.push({regex:new RegExp("^@"+r.alias+"[.|\\-|_]*$"),cmd:"<!"+r.alias+">",name:"!"+r.alias})}})};var i=/((?:#[A-Fa-f0-9]{6} {0,}, {0,}){7})(#[A-Fa-f0-9]{6})(\b)/g;var a=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|\u201c|\u2018|')(@([^~`!@#$%^&*()+=[\]{}\\|;:'"\u201d\u2019,<>/?\s]+))/g;var s=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|\u201c|\u2018|')(#([^~`!@#$%^&*()+=[\]{}\\|;:'"\u201d\u2019,.<>/?\s]+))/g;var o=/(^|\s|[_*?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])```([\s\S]*?)?```(?=$|\s|[_*?.,\-!^;:})\]%$#+=\u2000-\u206F\u2E00-\u2E7F\u2026"])/g;var l=/(^|\s|[?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])`([^`]*?\S *)?`/g;var u=/(^|\n)&gt;(?![\W_](?:&lt;|&gt;|[|/\\[\]{}()Dpb](?=\s|$)))(([^\n]*)(\n&gt;[^\n]*)*)/g;var d={"data-stringify-text":function e(t){return t.getAttribute("data-stringify-text")},"data-stringify-prefix":function e(t,n){var r=t.getAttribute("data-stringify-prefix");return TS.interop.format.surroundTextWith({text:n,prefix:r})},"data-stringify-suffix":function e(t,n){var r=t.getAttribute("data-stringify-suffix");return TS.interop.format.surroundTextWith({text:n,suffix:r})}};var c=function e(){var t={"<QUOTE:START>":'<div class="special_formatting_quote"><div class="quote_bar"><div class="shim"></div></div><div class="content dynamic_content_max_width">',"<QUOTE:PREFIX>":'<span class="copyonly">&gt;</span>',"<LONGQUOTE:PREFIX>":'<span class="copyonly">&gt;&gt;&gt;</span>',"<QUOTE:END>":"</div></div>","<LINK:END>":"</a>","<LINE:BREAK>":"<br>","<PARA:BREAK>":'<span class="para_break"><i class="copy_only"><br></i></span>',"<SPACE:HARD>":"&nbsp;"};var n="ja-JP"===TS.interop.i18n.locale?"\uff0a":"*";var r="ja-JP"===TS.interop.i18n.locale?"\uff3f":"_";var i="ja-JP"===TS.interop.i18n.locale?"\uff40":"`";var a="ja-JP"===TS.interop.i18n.locale?"\uff40\uff40\uff40":"```";t["<B:START>"]='<b data-stringify-prefix="'+n+'" data-stringify-suffix="'+n+'" data-stringify-requires-siblings>';t["<B:END>"]="</b>";t["<STRIKE:START>"]='<strike data-stringify-prefix="~" data-stringify-suffix="~" data-stringify-requires-siblings>';t["<STRIKE:END>"]="</strike>";t["<CODE:START>"]='<code class="special_formatting" data-stringify-prefix="'+i+'" data-stringify-suffix="'+i+'" data-stringify-requires-siblings>';t["<CODE:END>"]="</code>";t["<I:START>"]='<i data-stringify-prefix="'+r+'" data-stringify-suffix="'+r+'" data-stringify-requires-siblings>';t["<I:END>"]="</i>";t["<PRE:START>"]='<pre class="special_formatting" data-stringify-prefix="'+a+'" data-stringify-suffix="'+a+'" data-stringify-requires-siblings>';t["<PRE:END>"]="</pre>";return t};var m=c();var f=[];var p=0;var h="^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}".split("").sort(function(){return.5-Math.random()}).join("");var g="thisreplacementtokenallowsustotreatatsymbolsasiftheywerewordcharactersinregex".split("").sort(function(){return.5-Math.random()}).join("");var S="thisreplacementtokenallowsustotreatdashesasiftheywerewordcharactersinregex".split("").sort(function(){return.5-Math.random()}).join("");var T="thisreplacementtokenallowsustotreatdashesasiftheywerewordcharactersinregex".split("").sort(function(){return.5-Math.random()}).join("");var v=function e(t,n){var r=t.slice(n.length);return n+TS.format.tokenizeStr(f,r)};var b=function e(t){var n=TS.interop.format.locateHighlightWords(t,TS.model.highlight_words,TS.boot_data.feature_cjk_highlight_words);_.forEachRight(n,function(e){var n=e.index;var r=n+e.length;var i=t.slice(n,r);var a=t.slice(0,n);var s='<span class="mention">'+i+"</span>";var o=t.slice(r);t=a+s+o});return t};var y=function e(t){if(!t)return"";return t.replace(/\*/g,"&ast;").replace(/_/g,"&#95;").replace(/`/g,"&#96;")};var w=function e(t){if(!t)return"";return y(t).replace(/:/g,"&#58;")};var k=function e(t,n){n=n||{};var r=!!n.do_inline_imgs||void 0;var i=!!n.for_growl||void 0;var a=!!n.for_edit||void 0;var s=!!n.no_highlights||void 0;var o=!!n.no_specials||void 0;var l=!!n.enable_slack_action_links||void 0;var u=!!n.no_jumbomoji||void 0;var d=!!n.no_preformatted||void 0;var c=n.custom_linebreak||void 0;var m=!!n.stop_animations||void 0;var f=!!n.no_emoji_text||void 0;var p=!!n.transform_missing_emoji||void 0;var h=!!n.show_icon_for_emoji_in_as_text_mode||void 0;var g=!!n.ignore_emoji_mode_pref||void 0;var S=!!n.prevent_copy_paste||void 0;var T=!!n.no_linking||void 0;var v=n.token_overrides||void 0;var b=n.emoji_mode;!_.isString(b)&&TS.prefs.prefs_loaded&&(b=TS.interop.rules.emoji.getEmojiMode());true!==u&&(u=!TS.prefs.getPref("jumbomoji"));s=t&&"no_highlights"in t?!!t.no_highlights:!!s;_.isBoolean(o)||(o=!!(t&&"mrkdwn"in t)&&false===t.mrkdwn);a&&(o=true);var y=t&&t.no_emoji;var w=!(r&&(!t||"bot_message"!==t.subtype));true!==w&&(w=!!TS.prefs.getPref("hide_hex_swatch"));var k=!w&&TS.client&&TS.model.team;var x="NORMAL";o&&(x="NOMRKDWN");i&&(x="GROWL");a&&(x="EDIT");return{tsf_mode:x,no_highlights:s,no_emoji:y,no_hex_colors:w,do_inline_imgs:r,enable_slack_action_links:l,do_theme_install_buttons:k,no_jumbomoji:u,no_preformatted:d,custom_linebreak:c,stop_animations:m,no_emoji_text:f,transform_missing_emoji:p,show_icon_for_emoji_in_as_text_mode:h,ignore_emoji_mode_pref:g,prevent_copy_paste:S,no_linking:T,token_overrides:v,emoji_mode:b}};var x=function e(t,n,r){var a=r.tsf_mode;var s=r.no_highlights;var o=r.no_emoji;var l=r.no_hex_colors;var u=r.do_inline_imgs;var d=r.enable_slack_action_links;var c=r.do_theme_install_buttons;var f=r.no_jumbomoji;var p=r.no_preformatted;var h=r.custom_linebreak;var g=r.stop_animations;var S=r.no_emoji_text;var T=r.transform_missing_emoji;var v=r.show_icon_for_emoji_in_as_text_mode;var y=r.ignore_emoji_mode_pref;var w=r.prevent_copy_paste;var k=r.no_linking;var x=r.token_overrides;var O=r.emoji_mode;var H=m;if(h||x){var B=x||{};h&&(B["<LINE:BREAK>"]=h);H=_.extend({},H,B)}var j=[];if(c){var L=(t.match(i)||[]).length;var N=[];var U=0;t=t.replace(i,function(e,t,n){U+=1;var r=L>1?P(e,U):P(e);N.push(r);var i=L>1?" ("+U+")\t":"";return t+TS.format.tokenizeStr(j,"<nobr>",",")+n+i+TS.format.tokenizeStr(j,"</nobr>")});t+=TS.format.tokenizeStr(j,F(N))}var q=TSF.getTokensArray($.trim(t),a,{jumbomoji:!f,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});p&&(q=q.map(D));k&&(q=_.reject(q,R));var G="";var W;var z;var K;var V;var Y;var J;var Q;var X;var Z;var ee;var te;var ne;var re;var ie;var ae;var se;var oe;var le;var ue;if("GROWL"===a||"EDIT"===a)for(V=0;V<q.length;V+=1){K=q[V];if(0===K.indexOf("<"))if(H[K])TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got something in the formatting map? '+K);else if(0===K.indexOf("<!"))G+=A(a,K);else if(0===K.indexOf("<@")){ue=I(a,K);G+=ue}else 0===K.indexOf("<#")?G+=C(a,K):TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got '+K);else if(-1==K.indexOf("<"))if("EDIT"===a){TS.interop.i18n.locale===TS.interop.i18n.DEFAULT_LOCALE||TS.utility.contenteditable.inlineEmojiIsEnabled()||(K=TS.emoji.maybeGetLocalizedEmojiString(K));G+=_.unescape(K)}else if(TS.utility.platformSupportsHtmlNotifications())TS.utility.platformSupportsImgEmojiInHtmlNotifications()&&(G+=TS.emoji.graphicReplace(K,{force_img:true,stop_animations:g}));else{var de=_.unescape(K);de=TS.emoji.maybeUnifiedReplace(de);TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&(K=TS.emoji.maybeGetLocalizedEmojiString(K));G+=de}else TS.error("token has a < in it but it is not the first character!\n"+K)}else{var ce="";var _e;var me;var fe;for(V=0;V<q.length;V+=1){K=q[V];if(0===K.indexOf("<"))if(H[K]){G+=H[K];if(K==TSF.LINK_END){G+=ce;ce=""}}else if(0===K.indexOf("<!"))G+=A(a,K,s,k);else if(0===K.indexOf("<@")){ue=I(a,K,s,k);G+=ue}else if(0===K.indexOf("<#"))G+=C(a,K,k);else if(0===K.indexOf(TSF.LINK_START.split(" ")[0])){var pe=function(e){var t=$.trim(e.replace(TSF.LINK_START.split(" ")[0],""));return t.substr(0,t.length-1)}(K);var he=TS.interop.utility.getBotIdFromUrl(pe);var ge;var Se="";var Te;var ve="";if(he){Te=TS.interop.bots.getBotById(he);if(!Te){TS.warn("No bot found for "+he);if(TS.interop.rules.channels.isExternallySharedChannel(TS.shared.legacyGetActiveModelOb())&&n.user){ge=_.get(TS.interop.members.getMemberById(n.user),"profile.team");Te={id:he,name:TS.interop.bots.getBotNameByBotLink(n.text)?TS.interop.bots.getBotNameByBotLink(n.text):"",source_team_id:ge}}}}if(!he||!Te||Te.is_unknown||Te.isUnknown||Te.isNonExistent)if(0===pe.indexOf(TS.utility.msgs.api_url_prefix+"chat.help"))if(d){_e=_.escape(JSON.stringify(""+pe));G+='<a onclick="TS.utility.msgs.doApiUrl('+_e+')" class="api_url">'}else G+='<a class="api_url muted">(Disabled) ';else if(0===pe.indexOf(TS.utility.msgs.new_api_url_prefix))if(d){_e=_.escape(JSON.stringify(""+pe));G+='<a onclick="TS.utility.msgs.doNewApiUrl('+_e+')" class="api_url">'}else G+='<a class="api_url muted">(Disabled) ';else if(0===pe.indexOf("javascript:"))G+='<a onclick="TS.client.msg_pane.maybeClick(this)" data-maybe-click="'+pe.replace("javascript:","")+'">';else if(TS.client&&TS.client.core_url&&0===pe.indexOf(TS.client.core_url))G+='<a target="_self" href="'+pe+'">';else{var be=TS.utility.getFileIDFromURL(pe);var ye=false;if(be&&TS.model&&TS.model.user&&TS.model.user.is_primary_owner){var we=!!TS.files&&TS.files.getFileById(be);we&&TS.utility.welcome_post&&we.name==TS.utility.welcome_post.WELCOME_POST_NAME&&(ye=true)}var ke=ye?"file_new_window_link welcome_post_slackbot_message":"file_preview_link";var xe=be?' class="no_jumbomoji '+ke+'"':"";var Ce=be?' data-file-id="'+be+'"':"";G+="<a "+TS.utility.makeRefererSafeLink(pe)+' target="_blank"'+xe+Ce+">";ce&&TS.error("WTF we should have no attach_html");ce="";var Me;if(n&&n.ts&&u){Me=TS.inline_attachments.getAttachmentByFromUrl(n.attachments,pe);Me&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(Me,n))&&(ce=TS.templates.builders.buildAttachmentHTML({attachment:Me,url:pe,msg:n,show_initial_caret:true}))}}else{fe=true;X=TS.utility.shouldLinksHaveTargets()?'target="'+pe+'" ':"";me=s?Te.name:b(Te.name);q[V+1]&&q[V+1]==pe&&(me=pe);me=me.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");Te.app_id&&(Se=Te.app_id);Te.source_team_id&&(ve="data-team-id="+Te.source_team_id+" ");G+='<a href="'+pe+'" '+X+'data-bot-id="'+he+'" data-app-id="'+Se+'" '+ve+'class="internal_bot_link app_preview_link">'+me}}else 0===K.indexOf(TSF.JUMBOMOJI_COLONS.split(" ")[0])?G+=M(K,{tsf_mode:a,no_emoji:o,do_jumbomoji:!f,stop_animations:g,no_emoji_text:S,transform_missing_emoji:T,show_icon_for_emoji_in_as_text_mode:v,ignore_emoji_mode_pref:y,emoji_mode:O}):0===K.indexOf(TSF.EMOJI_COLONS.split(" ")[0])?G+=M(K,{tsf_mode:a,no_emoji:o,do_jumbomoji:false,stop_animations:g,no_emoji_text:S,transform_missing_emoji:T,show_icon_for_emoji_in_as_text_mode:v,ignore_emoji_mode_pref:y,emoji_mode:O}):0===K.indexOf(TSF.HEX_BLOCK.split(" ")[0])?G+=E(a,K,l):TS.error("markup token not handled:"+K);else if(-1===K.indexOf("<"))if(fe)fe=false;else{s||(K=b(K));w&&(K=_.map($.parseHTML(K),function(e){if(e.nodeType===Node.TEXT_NODE)return'<span class="prevent_copy_paste" aria-label="'+_.escape(e.textContent)+'"></span>';return e.outerHTML}).join(""));G+=K}else TS.error("token has a < in it but it is not the first character!\n"+K)}}if(n&&("sh_room_created"===n.subtype||"sh_room_shared"===n.subtype)){var Ie=TS.ui.growls.extractFromNameFromCorGMessage(n);if(Ie){("GROWL"!==a||TS.utility.platformSupportsHtmlNotifications())&&(Ie=_.escape(Ie));Ie+=": "}G="sh_room_created"===n.subtype?TS.interop.i18n.t("{from_name} Started a call","string_format")({from_name:Ie}):TS.interop.i18n.t("{from_name} Shared a call","string_format")({from_name:Ie})}G=TS.format.deTokenizeStr(j,G);return G};var C=function e(t,n,r){var i=n.replace(/<|>|#/g,"");var a=i.split("|");var s=a[0];var o=a[1];var l=TS.interop.channels.getChannelById(s);var u;var d;if(TS.boot_data.feature_lazy_channels&&!l&&"EDIT"!==t&&"GROWL"!==t)return TS.templates.unknown_channel({id:s});if(l){u=l.name;d=l.is_private||l.is_group}var c=TS.interop.format.formatChannelName({fallbackName:o,channelName:u,isPrivate:d});if(!l||"GROWL"===t||"EDIT"===t||r)return c;var _=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+l.id+'"':"";return'<a href="/archives/'+l.id+'" '+_+' data-channel-name="'+l.name+'" data-channel-id="'+l.id+'" class="internal_channel_link">'+c+"</a>"};var M=function e(t,n){n=n||{};var r=t.split(" ")[1].replace(">","");if(n.no_emoji)return r;var i;var a=TS.emoji.isValidName(r)||TS.emoji.shouldRenderEmoji5(r);i=n.transform_missing_emoji&&!a?TS.emoji.MISSING_EMOJI_HTML:n.show_icon_for_emoji_in_as_text_mode&&"as_text"===n.emoji_mode?TS.emoji.graphicReplace(r,{show_icon_for_emoji_in_as_text_mode:true}):TS.emoji.graphicReplace(r,{obey_emoji_mode_pref:!n.ignore_emoji_mode_pref,include_title:true,include_text:!n.no_emoji_text,jumbomoji:n.do_jumbomoji,stop_animations:n.stop_animations});i&&-1!==i.indexOf(">>")&&TS.warn("TS.emoji.graphicReplace may be malformed: "+i);return i};var I=function e(t,n,r,i){var a=n.replace(/<|>/g,"");var s=TS.utility.msgs.getMemberIdFromMemberMarkup(a);if(!TS.interop.utility.looksLikeMemberId(s))return a;var o=TS.utility.msgs.getMemberFromMemberMarkup(a);if(o&&"EDIT"!==t&&"GROWL"!==t){if(o.is_unknown)return TS.templates.unknown_member({id:o.id});if(o.is_non_existent&&TS.interop.utility.looksLikeMemberId(o.id))return TS.templates.message_member_non_existent({id:o.id})}if(!o){if("GROWL"===t)return n;var l=a.split("|");if(l.length>1&&l[1])return"@"+l[1];return a}var u=["internal_member_link"];var d={"member-id":o.id,"stringify-text":"@"+o.id};if(o.is_bot&&o.profile){var c=_.get(o.profile,"bot_id");if(c){d["bot-id"]=c;var m=TS.interop.bots.getBotById(c);_.get(m,"app_id")&&(d["app-id"]=m.app_id)}u=_.pull(u,"internal_member_link");u.push("app_preview_link");u.push("app_preview_link_slug")}var f="";_.forEach(d,function(e,t){f+="data-"+t+'="'+e+'" '});var p=_.escape("@"+TS.interop.members.getMemberMentionName(o));u.push("ts_tip ts_tip_top ts_tip_lazy ts_tip_float ts_tip_member");f+='data-tip-member="'+o.id+'" ';if("EDIT"===t)return"<@"+o.id+"|"+p+">";if("GROWL"===t||!TS.permissions.members.canUserSeeMember(o))return"@"+TS.interop.members.getMemberMentionName(o);var h=TS.utility.shouldLinksHaveTargets()?'target="/team/'+o.id+'" ':"";o.id==TS.model.user.id&&u.push("mention");if(i)return p;f+='data-member-label="'+p+'" ';return'<a href="/team/'+o.id+'" '+h+f+'class="'+u.join(" ")+'">'+p+"</a>"};var A=function t(n,r,i,a){if(TS.boot_data.page_needs_enterprise&&TS.boot_data.feature_default_shared_channels){var s=TS.shared.legacyGetActiveModelOb()||{};if(TS.interop.rules.channels.isOrgShared(s)&&TS.interop.rules.channels.isOrgDefaultChannel(s)){i=true;a=true}}var o=r.replace(/<|>/g,"");var l=o.split("|");var u=l[0].substr(1);if(_.includes(e,u)){var d=TS.interop.format.formatBroadcastCommand({type:u});if("GROWL"===n||"EDIT"===n||a)return d;return'<b class="mention" data-broadcast-id="BK'+u+'" data-stringify-text="'+d+'">'+d+"</b>"}var c=l[1]?l[1]:u;if(-1===u.indexOf("^")){if("GROWL"===n||"EDIT"===n)return"<"+c+">";return"&lt;"+c+"&gt;"}var m=u.split("^");u=m.shift();if("date"===u&&m.length>=2){var f=m[0];var p=m[1];var h=TS.interop.datetime.formatDate(f,p,{fallbackString:c});var g=m.length>2?m[2]:"";if("GROWL"===n||"EDIT"===n||!g||a)return h;return"<a "+TS.utility.makeRefererSafeLink(g)+' target="_blank">'+h+"</a>"}if("team"===u&&1===m.length){var S=c;var T=TS.teams.getTeamById(m[0]);T&&(S=T.name);if("GROWL"===n||"EDIT"===n)return"*"+S+"*";return TS.templates.format_team({team:T,fallback:S})}if("subteam"!==u||1!==m.length){if("GROWL"===n||"EDIT"===n)return"<"+c+">";return"&lt;"+c+"&gt;"}var v=TS.interop.userGroups.getUserGroupById(m[0]);if(v&&v.handle){var y=TS.utility.shouldLinksHaveTargets()?'target="/usergroups/'+v.id+'" ':" ";var w=_.escape(v.handle);var k=i||"EDIT"===n?"@"+w:b("@"+w);var x=["internal_user_group_link"];if("GROWL"===n||"EDIT"===n){if("EDIT"===n)return"<@"+v.id+"|"+k+">";return"@"+v.handle}if(a)return k;k="@"+w;i||-1===TS.model.highlight_words.indexOf("@"+w+">")||x.push("mention");return'<a href="/usergroups/'+v.id+'" '+y+'data-user-group-id="'+v.id+'" class="'+x.join(" ")+'" data-stringify-text="@'+w+'">'+k+"</a>"}if("GROWL"!==n&&"EDIT"!==n)return c;return""};var E=function e(t,n,r){var i=n.split(" ")[1].replace(">","");if(!r)return' <div class="inline_color_block" style="background:'+i+';"></div>';return""};var P=function e(t,n){var r=TS.interop.i18n.t("Switch sidebar theme","string_format")();n&&(r+=" ("+n+")");return'<a data-theme="'+_.escape(t)+'" class="btn btn_small btn_outline very_small_top_margin very_small_bottom_margin tiny_right_margin theme_installer_btn">'+r+"</a>"};var F=function e(t){if(t&&t.length)return'<br/><span class="theme_install_btns">'+t.join(" ")+"</span>";return""};function O(e,t,n){var r=e.lastIndexOf(" ",n);var i=-1!==r?r+1:0;var a=e.substring(i,n+t.length);var s=TS.interop.url.findUrlsInString(a).length>0;return s}function D(e){switch(e){case TSF.PRE_START:return TSF.CODE_START;case TSF.PRE_END:return TSF.CODE_END;default:break}return e}function H(e,t){if(!e)return"";t||(t={});e=TS.format.replaceUnicodeDoppelgangers(e);var n=[];e=TSF.replaceFormatContents(n,e,{replace_pre:true,replace_code:true});var r=TS.interop.texty.replaceFormatMentions(e,t.do_specials);var i=r.mentions;e=r.text;t.do_specials&&(e=TSF.getTokensString(e,"CLEAN",{jumbomoji:TS.prefs.getPref("jumbomoji"),allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()}));i.forEach(function(t){e=e.replace(t.placeholder,t.mention)});e=e.replace(s,function(n,r,i,a,s){if("/"===r&&O(e,n,s))return n;var o=B(TS.interop.channels.getChannelById,i.substr(1),TS.redux.channels.getPublicChannelByName,i);if(o.model_ob){var l;l=t.human_readable?"#"+o.model_ob.name:"<#"+o.model_ob.id+"|"+o.model_ob.name+">";return r+l+o.extra}return r+i});TS.prefs.getPref("convert_emoticons")&&!TS.interop.rules.emoji.shouldRenderEmojiAsText()&&(e=TS.format.doEmoticonConversion(e));TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&(e=TS.emoji.maybeGetCanonicalEmojiString(e));n=n.map(function(e){var n=TS.interop.texty.convertContentsStringToContents(e.str,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());TS.utility.contenteditable.inlineEmojiIsEnabled()?e.str=TS.interop.texty.convertContentsToStringForDisplay(n):e.str=_.reduce(n.contents,function(e,t){return e+t.insert},"");t.do_specials&&(e.str=TSF.getTokensString(e.str,"CLEAN",{jumbomoji:TS.prefs.getPref("jumbomoji"),allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()}));return e});e=TSF.swapOutPlaceholders(n,e);return e}function B(e,t,n,r){var i;var a="";var s;if(_.isFunction(e)&&_.isString(t)){i=t.substring(0,TS.model.model_ob_id_length);s=e(i);s&&(a=t.substring(TS.model.model_ob_id_length))}s||(s=n(r));var o=[".","..","...","....","-","--","_","\u2026"];var l=0;while(!s&&l<o.length){var u=o[l];if(r&&r.substr(r.length-u.length,u.length)==u){i=r.substr(0,r.length-u.length);s=n(i);s&&(a=u)}l+=1}return{model_ob:s,extra:a}}var j=function e(t){if(!t||t instanceof Text)return false;return _.some(d,function(e,n){return t.hasAttribute(n)})};var R=function e(t){L||(L=TSF.LINK_START.split(" ")[0]);if(_.startsWith(t,L))return true;if(t===TSF.LINK_END)return true;return false};var L})()},11245:function(e,t){(function(){TS.registerModule("menu",{$menu:null,$submenu:null,$submenu_origin:null,$submenu_parent:null,$menu_header:null,$menu_items:null,$menu_list_container:null,$menu_list:null,$menu_footer:null,menu_lazy_load:null,user_group:null,end_tim:0,$target_element:null,$secondary_target_element:null,members_html_cache:null,large_list_trigger:1500,large_dom_trigger:500,watching_members_model:false,menu_items_hidden:true,has_submenu:false,menu_closed_sig:new signals.Signal,onStart:function e(){},buildIfNeeded:_.once(function(){TS.menu.$menu=$(TS.templates.menu());var e=TS.menu.$menu;if("mobile"!==TS.boot_data.app&&"0"!=TS.qs_args.new_scroll){TS.client?e.appendTo($("#client-ui")):e.appendTo($("body"));if(!TS.environment.supports_custom_scrollbar){var t="1"==TS.qs_args.debug_scroll;e.find("#menu_items_scroller").monkeyScroll({debug:t})}e.detach()}TS.menu.$menu_header=e.find("#menu_header");TS.menu.$menu_body=e.find(".menu_body");TS.menu.$menu_list_container=e.find("#menu_list_container");TS.menu.$menu_list=e.find("#menu_list");TS.menu.$menu_items=e.find("#menu_items");TS.menu.$menu_footer=e.find("#menu_footer")}),handleTopicKeydown:function e(t){var n=TS.utility.keymap;if(t.which==n.enter&&!t.shiftKey&&!t.altKey){var r=$(t.target);var i=TS.shared.legacyGetActiveModelOb();var a=$.trim(r.val());if(i.topic.value===a){TS.menu.end();return}TS.interop.channels.submitChannelTopic(i.id,a).catch(TS.channels.legacyAlertSetTopicError);TS.menu.end()}},startWithList:function e(t,n,r){if(!n||!n.length)return;if(TS.menu.isRedundantClick(t))return;r=r||{};TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(n.html());TS.menu.$menu.addClass(r.menu_class);(r.close_on_click||r.onClick)&&TS.menu.$menu_items.on("click.menu","li",function(e){"function"===typeof r.onClick&&r.onClick(e);r.close_on_click&&TS.menu.end()});TS.menu.start(t,void 0,r);if(r.attach_to_target_at_full_width)TS.menu.$menu.css({width:"100%",top:"calc(100% + 3px)",left:"0"});else{var i=s(r.align_right);TS.menu.positionAt(TS.menu.$target_element,i.left,i.top)}},startWithDatePicker:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_date_picker_items());TS.menu.$menu_items.on("click.menu","li",TS.menu.onDatePickerItemClick);TS.menu.$menu.attr("data-qa","date_picker_menu");var n=$("#date_picker_cal_container");TS.ui.date_picker.startJumpToDatePicker(n);TS.menu.$menu.addClass("date_picker")},onDatePickerItemClick:function e(t){var n=$(this).attr("id");var i=TS.shared.legacyGetActiveModelOb();if($(this).hasClass("disabled")){TS.menu.end();return}if("date_picker_back_item"===n){t.preventDefault();r=true;i.is_channel||i.is_mpim?TS.menu.channel.startWithChannel(t,i.id):i.is_im?TS.menu.member.startWithMember(t,i.user,false,false,true):i.is_group&&TS.menu.group.startWithGroup(t,i.id);TS.menu.$menu.removeClass("date_picker");return}TS.warn("not sure what to do with clicked element id:"+n)},startWithMessageActions:function e(t,n,r,i){if(TS.client&&!TS.redux.socket.isConnected()){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();i=i||TS.shared.legacyGetActiveModelOb();var a;a=TS.boot_data.feature_react_messages?TS.redux.messages.getMessageByTimestamp(i.id,n):TS.utility.msgs.getMsg(n,r);a||(a=TS.ui.replies.getActiveMessage(i,n));!a&&TS.model.threads_view_is_showing&&(a=TS.client.threads.getMessage(i,n));!a&&TS.model.unread_view_is_showing&&(a=TS.client.unread.getMessage(i,n));if(TS.boot_data.feature_app_actions_fe){TS.ui.react_message_menu.showMessageMenu(t,{channel:i,message:a});return}var s=TS.utility.msgs.getMsgActions(a,i);var o=TS.model.unread_view_is_showing;var l=s.mark_unread&&!a.is_briefing_message&&(TS.utility.msgs.getMarkMsgTSForUnreadPoint(n,r,i)||o)&&!TS.model.archive_view_is_showing&&!a.is_ephemeral;s.mark_unread=!!l;var u={msg:a,actions:s,model_ob:i,is_all_unreads_showing:TS.model.unread_view_is_showing,is_channel_or_group:i.is_channel&&!i.is_mpim||i.is_group&&!i.is_mpim};var d=$(t.target);u.abs_permalink=TS.utility.msgs.constructAbsoluteMsgPermalink(i,a.ts,a.thread_ts);"file_share"!==a.subtype&&"file_mention"!==a.subtype||a.file&&(u.abs_permalink=a.file.permalink);if(TS.replies.canReplyToMsg(i,a)){u.can_subscribe=true;u.subscription=TS.replies.getSubscriptionState(i.id,a.ts);u.context=TS.ui.thread.getContextForEl(d);u.subscription||TS.replies.promiseToGetSubscriptionState(i.id,a.ts).then(function(e){c(i.id,a.ts,e)});u.prefs_threads_everything=TS.prefs&&TS.prefs.getPref("threads_everything")}u.is_in_conversation=d.closest("ts-conversation").length>0;var m=d.closest("#threads_msgs").length>0;var f=u.is_in_conversation||m;var p=d.closest("#sli_briefing").length>0;s.mark_unread=s.mark_unread&&!f&&!p;f&&"tombstone"===a.subtype&&(s.has_private_actions=false);if("thread_broadcast"===a.subtype){!f&&s.delete_msg&&(s.delete_msg=false);(f&&s.remove_broadcast||i.is_channel&&!i.is_member)&&(s.remove_broadcast=false)}TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_message_action_items(u));TS.menu.$menu_items.on("click.menu","li",TS.menu.onMessageActionClick);TS.log("enabled reminders msg action menu");TS.menu.has_submenu=true;var h=TS.menu.$menu_items.find("#remind_me");h.on("highlighted",function(){h.submenu({items_html:TS.templates.remind_me_items(),onclick:_.partial(TS.menu.onMessageRemindClick,i,a,f)})}).on("unhighlighted",function(){TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active")&&h.submenu("destroy")});TS.menu.start(t);TS.menu.$target_element=d.closest("[data-action]");TS.menu.$target_element.addClass("active");TS.menu.$secondary_target_element=d.closest("ts-message");TS.menu.$secondary_target_element.addClass("active");var g=0;var S=d.width()+10;TS.client&&!TS.model.ui_state.flex_visible&&(S=-(TS.menu.$menu.width()+10));var T=TS.menu.$menu.find("#edit_link");0===T.length&&(T=TS.menu.$menu.find("#rxn_link"));if(T.length>0){var v=TS.menu.$menu.offset().top;var b=T.offset().top;g=-(b-v+T.height()/2-5)}TS.menu.positionAt(d,S,g);TS.menu.keepInBounds()},onMessageActionClick:function e(t){t.preventDefault();if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var n=$(this);var r=n.attr("id");var i=n.data("msg-ts");var a=n.data("model-ob-id");var s=n.data("rxn-key");var o=a?TS.redux.channels.getEntityById(a):TS.shared.legacyGetActiveModelOb();var l;if("edit_link"===r){var u=n.data("edit-state");TS.msg_edit.startEdit(i,o,u)}else if("delete_link"===r)TS.msg_edit.startDelete(i,o);else if("open_in_channel"===r){l=n.attr("data-thread-ts");TS.client.ui.tryToJump(o.id,l)}else if("open_thread_in_flexpane"===r){var d=TS.utility.msgs.findMsg(i,o.id);if(d&&TS.replies&&TS.replies.canReplyToMsg(o,d)){l=d.thread_ts||d.ts;TS.ui.replies.openConversation(o,l)}}else if("toggle-subscription-status"===r){var c=n.data("subscribed");var m;var f=TS.utility.msgs.findMsg(i,a);f&&f.latest_reply?m=f.latest_reply:f&&f.replies&&f.replies.length&&(m=_.last(f.replies).ts);n.addClass("disabled");TS.replies.setSubscriptionState(a,i,!c,m);var p=c?"THREADS_UNFOLLOW_CLICKED":"THREADS_FOLLOW_CLICKED";var h=n.data("context");var g=_.get(f,".reply_count",0)+1;TS.ui.thread.trackEvent(a,i,h,p,{num_msg_in_thread:g})}else if("pin_link"===r)TS.pins.startPinMessage(i,o);else if("unpin_link"===r)TS.pins.unPinMessage(i,o);else if("rxn_link"===r)TS.ui.react_emoji_menu.start({e:t,rxn_key:s});else if("mark_unread"===r)if(TS.model.unread_view_is_showing)TS.client.ui.unread.setUnreadPoint(i);else{TS.info("setting unread point on "+o.id+" due to message action click ("+i+")");TS.client.msg_pane.setUnreadPoint(i)}else if("copy_link"===r){TS.clipboard.writeText($(this).data("permalink"));var S=TS.menu.$secondary_target_element;var T={message_timestamp:i,channel_id:a,channel_type:a[0]||"",member_id:S.data("member-id"),app_id:S.data("app-id"),bot_id:S.data("bot-id")};TS.interop.clog.track("MSG_LINK_COPY",T)}else if("open_original_link"===r);else if("share_message_link"===r)TS.ui.share_message_dialog.start(i,o);else if("remove_broadcast_link"===r)TS.msg_edit.startRemoveBroadcast(i,o);else if("remind_me"===r)return;TS.menu.end()},onMessageRemindClick:function e(t,n,r,i){var a=$(i.target).data("msg-action");if("remind"===a){var s={time:$(i.target).data("remind-length"),message_channel:t.id,message_ts:n.ts};"thread_broadcast"!==n.subtype||r||(s.respond_in_channel=true);var o=function e(){};TS.api.call("reminders.addFromMessage",s).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})}TS.menu.end()},startWithCommentActions:function e(t,n,r){if(TS.client&&!TS.redux.socket.isConnected()){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.files.getFileById(n);if(!i)return;var a=TS.files.getFileCommentById(i,r);if(!a)return;var s=TS.shared.legacyGetActiveModelOb();var o=TS.files.getFileCommentActions(a,i);TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_comment_action_items({model_ob:s,file:i,comment:a,actions:o}));var l=$(t.target);TS.menu.$menu_items.on("click.menu","li",function(e){var t=l.closest(".comment_actions");TS.menu.onCommentActionClick(e,t)});TS.menu.start(t);var u=0;var d=-(TS.menu.$menu.width()+10);var c=TS.menu.$menu.find("#edit_file_comment");0===c.length&&(c=TS.menu.$menu.find("#rxn_file_comment"));if(c.length>0){var _=TS.menu.$menu.offset().top;var m=c.offset().top;u=-(m-_+c.height()/2-5)}TS.menu.positionAt(l,d,u);TS.menu.keepInBounds()},onCommentActionClick:function e(t,n){t.preventDefault();var r=$(t.target).closest("[id]");var i=r.attr("id");var a=r.data("rxn-key");var s=TS.shared.legacyGetActiveModelOb();if("edit_file_comment"===i)TS.ui.comments.startEdit(r.data("file-id"),r.data("comment-id"),n);else if("delete_file_comment"===i)TS.ui.comments.startDelete(r.data("file-id"),r.data("comment-id"));else if("rxn_file_comment"===i)TS.ui.react_emoji_menu.start({e:t,rxn_key:a});else if("pin_comment"===i&&s)TS.pins.startPinFileComment(r.data("comment-id"),r.data("file-id"),s);else{if("unpin_comment"!==i||!s){TS.warn("not sure what to do with clicked element id:"+i);return}TS.pins.unPinFileComment(r.data("comment-id"),r.data("file-id"),s)}TS.menu.end()},startWithSpaceWeb:function e(t,n,r){var i=5;if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var a=TS.files.getFileById(n);if(!a)return;var s=TS.files.getFileActions(a);var o=a.channels.concat(a.groups).concat(a.ims);var l=a.user==r&&o.length&&"uneditable"!==a.state;var u={file:a,actions:s,can_write_to_clipboard:TS.clipboard.canWriteText(),can_enable_collab_editing:l,collab_enabled:"locked"!==a.state&&"uneditable"!==a.state};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_space_action_items(u));TS.menu.$menu_items.on("click.menu","li",TS.menu.onSpaceClickWeb);TS.kb_nav.setSubmitItemHandler(TS.menu.onSpaceClickWeb);TS.menu.start(t);var d=$(".space_btn_more");$("#toggle_input").bind("change",function(){t.preventDefault();var e=$("#toggle_collab_editing");var n=$(this);e.addClass("disabled");n.prop("disabled",true);TS.web.space.lockEditingPrivilegesWithCallback(n.prop("checked"),function(t){var r=t&&t.data;var i=r?"locked"!==r.state:!n.prop("checked");e.removeClass("disabled");n.prop("disabled",false);n.prop("checked",i)})});var c=-TS.menu.$menu.outerWidth()+d.outerWidth();var _=d.outerHeight()+i;TS.menu.positionAt(d,c,_)},onSpaceClickWeb:function e(t){var n=$(this).attr("id");var r=TS.files.getFileById($(this).data("file-id"));if(!r)return;if("keyboard_shortcuts"===n){t.preventDefault();TS.ui.shortcuts_dialog.start(true)}else if("learn_more"===n);else if("feedback"===n){t.preventDefault();TS.web.space.provideFeedback()}else if("delete_space"===n){t.preventDefault();TS.web.file.deleteFile(r.id)}else if("copy_space_link"===n){t.preventDefault();TS.clipboard.canWriteText()?TS.clipboard.writeText(r.permalink):TS.warn("User clicked copy link, but we can't write to the clipboard right now")}else if("create_public_space_link"===n){t.preventDefault();TS.files.createPublicURL(r)}else if("view_public_space_link"===n){t.preventDefault();TS.web.space.showPublicUrlDialog()}else{if("print_space"!==n){if("toggle_collab_editing"===n)return;t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}window.print();t.preventDefault()}TS.menu.end()},startWithTeamAndUser:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.startWithTeamAndUserRebuild(t);if(TS.boot_data.page_needs_enterprise){TS.menu.listenForRebuildWorthiness(t);o(t)}},did_start_slack_menu_signal_listeners:false,listenForRebuildWorthiness:function e(t){TS.menu.did_start_slack_menu_signal_listeners=true;if(TS.client){u=TS.members.user_added_to_team_sig.add(function(){return l(t)});d=TS.members.user_removed_from_team_sig.add(function(){return l(t)})}},stopListeningForRebuildWorthiness:function e(){TS.menu.did_start_slack_menu_signal_listeners=false;if(TS.client){if(u){u.detach();u=null}if(d){d.detach();d=null}}},startWithTeamAndUserRebuild:function n(r){TS.menu.clean();TS.menu.submenu_template_args={};t=!!TS.prefs.getTeamPref("all_users_can_purchase");var i=TS.model&&TS.model.team&&TS.boot_data.feature_tinyspeck;var a=TS.environment.is_dev;var s=i||a;var o=TS.boot_data.qa_messages_count||TS.model.team.messages_count;var l=!!TS.redux.enterprise.getEnterpriseId();var u=!TS.model.team.plan&&!l&&o>=200;var d=TS.model.user.is_admin||!TS.prefs.getTeamPref("stats_only_admins")&&!TS.model.user.is_restricted;var c=TSSSB.call("isAppStoreBuild")&&navigator.userAgent.match("MacAppStore");var f=TS.model.user.is_owner||TS.prefs.getPref("purchaser");var p={user:TS.model.user,team:TS.model.team,team_name:TS.model.team.name,logout_url:TS.boot_data.logout_url,signin_url:TS.boot_data.signin_url,help_url:TS.boot_data.help_url,show_version_info:s,current_team_is_in_enterprise:false,current_team_gets_logout_url:true,show_apps_link:TS.interop.apps.isAppSpaceEnabled()&&TS.interop.members.isAppmin(),show_customize_link:TS.model.user.is_admin||!TS.prefs.getTeamPref("emoji_only_admins")||!TS.prefs.getTeamPref("slackbot_responses_only_admins")||!TS.prefs.getTeamPref("loading_only_admins"),show_statistics_link:d,show_billing_link:f,anyone_can_buy:t,is_app_store_build:c,is_our_app:TS.model.is_our_app,can_invite:TS.ui.admin_invites.canInvite(),can_view_shared_invites:TS.ui.admin_invites.userCanViewSharedInvitesModal(),show_limit_meters:u,messages_count:o,messages_count_str:TS.utility.number.formatNumberWithAbbreviation(o,{precision:2,decimal_places:1,lowercase:true}),hidden_messages_count_str:TS.utility.number.formatNumberWithAbbreviation(o-1e4,{decimal_places:1,lowercase:true})};var h=Object.keys(TS.boot_data.other_accounts).length;h&&(p.other_accounts=TS.boot_data.other_accounts);TS.model.team.enterprise_id&&(p.current_team_is_in_enterprise=true);var g=false;var S=_.merge({},TS.boot_data.other_accounts);var T={};TS.boot_data.page_needs_enterprise&&_.get(TS.model.user,"enterprise_user.teams.length")>1&&(S[TS.model.team.id]=TS.model.team);_.each(S,function(t){if(t.enterprise_id){if(!p.other_enterprise_accounts){g=true;p.other_enterprise_accounts=_(S).filter("enterprise_id").groupBy("enterprise_id").map(function(t){var n={};n.enterprise_id=t[0].enterprise_id;n.enterprise_name=t[0].enterprise_name;TS.model.user.enterprise_user&&n.enterprise_id===TS.model.user.enterprise_user.enterprise_id?n.enterprise_teams=_(_.get(TS.model.user,"enterprise_user.teams",[])).without(TS.model.team.id).map(TS.teams.getTeamById).compact().slice(0,e).map(function(e){return{team_id:e.id,team_url:TS.utility.enterprise.buildTeamUrl(e.domain),team_name:e.name}}).sortBy("team_name").value():n.enterprise_teams=t.slice(0,e);n.is_currently_logged_into=false;if(n.enterprise_id===TS.model.team.enterprise_id){n.is_enterprise_currently_logged_into=true;n.needs_enterprise_teams_dialog=_.get(TS.model.user,"enterprise_user.teams.length")>e;p.current_team_is_in_enterprise&&(p.current_team_gets_logout_url=false);p.enterprise_logout_url=TS.boot_data.enterprise_logout_url;p.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}else{n.needs_other_enterprise_logout=true;n.logout_url=TS.enterprise.workspaces.createLogoutURL(n.enterprise_id,TS.boot_data.logout_url)}return n}).value();TS.model.user.enterprise_user&&(p.other_enterprise_accounts=p.other_enterprise_accounts.sort(function(e,t){if(e.enterprise_id===TS.model.user.enterprise_user.enterprise_id)return-1;if(t.enterprise_id===TS.model.user.enterprise_user.enterprise_id)return 1;return 0}))}}else{t.logout_url=TS.enterprise.workspaces.createLogoutURL(t.team_id,TS.boot_data.logout_url);T[t.team_id]=t}});g&&(Object.keys(T).length?p.other_accounts=T:Object.keys(p.other_enterprise_accounts).length&&delete p.other_accounts);if(p.current_team_is_in_enterprise){p.current_team_gets_logout_url=false;p.enterprise_logout_url=TS.boot_data.enterprise_logout_url;p.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}if(TS.boot_data.page_needs_enterprise){(g||p.current_team_is_in_enterprise)&&(p.other_enterprise_accounts&&Object.keys(p.other_enterprise_accounts).length||p.other_accounts&&Object.keys(p.other_accounts).length)&&(p.show_switch_teams_submenu=true);p.can_show_leave_workspace=TS.permissions.enterprise.canUserLeaveTeam(TS.model.user,TS.model.team)}p.show_shared_channels=TS.boot_data.page_needs_enterprise&&!TS.model.user.is_restricted;p.show_shared_channels_open_beta_controls=TS.permissions.members.canManageParticipationInSharedChannelsOpenBeta();TS.boot_data.feature_tinyspeck&&"beta_link"===TS.experiment.getGroup("sli_trending_dashboard_beta_link")&&(p.show_sli_trending_dashboard_beta_link=true);TS.menu.$menu.addClass("team_menu slack_menu");TS.menu.$menu.attr("data-qa","team_menu");TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_body.html(TS.templates.menu_slack_menu(p));TS.menu.$menu_items.addClass("hidden");var v=TS.menu.$menu_body;v.off("click.menu mouseenter.section_header");v.on("click.menu","li",TS.menu.onTeamAndUserItemClick);v.on("click.menu",".member_preview_link",function(e){e.preventDefault();TS.client.ui.previewMember(TS.model.user.id)});v.on("mouseenter.section_header","> div.section_header",TS.kb_nav.clearHighlightedItem);TS.kb_nav.setSubmitItemHandler(TS.menu.onTeamAndUserItemClick);if(TS.boot_data.page_needs_enterprise){TS.menu.submenu_template_args.administration={};TS.menu.submenu_template_args.switch_teams=p}var b=55;TS.model.is_electron&&TS.model.is_mac&&TSSSB.call("isMainWindowFrameless")&&(b+=7);TS.menu.has_submenu=true;TS.menu.submenu_template_args.member_current_status_item={member:TS.model.user};TS.menu.start(r,void 0,{needs_to_remain_open:function e(){return TS.ui.react_emoji_menu.is_showing}});TS.menu.positionAt($("#team_menu"),10,b);TS.view.members.updateUserDisplayName();TS.view.members.updateUserCurrentStatus();v.on("highlighted","li:not(.divider)",TS.menu.onTeamAndUserItemMouseenter);d&&TS.interop.clog.track("UPGRADEXP_TEAM_ANALYTICS",{contexts:{ui_context:{action:"impression",step:"slack_menu"}}});c||(f||t)&&(TS.model.team.plan?TS.interop.clog.track("GROWTH_PRICING",{contexts:{ui_context:{action:"impression",step:"slack_menu",ui_element:"billing_link"}}}):TS.interop.clog.track("GROWTH_PRICING",{contexts:{ui_context:{action:"impression",step:"slack_menu",ui_element:"paid_plans_link"}}}));if(u){TS.interop.clog.track("UPGRDEXP_LIMIT_METER",{limit_meter_messages_count:o,contexts:{ui_context:{action:"impression",step:"slack_menu",ui_element:"limit_meter"}}});c?TS.interop.clog.track("UPGRADEXP_TEAM_ANALYTICS",{contexts:{ui_context:{action:"impression",step:"slack_menu",ui_element:"limit_meter"}}}):TS.interop.clog.track("GROWTH_PRICING",{contexts:{ui_context:{action:"impression",step:"slack_menu",ui_element:"limit_meter"}}});m(o)}},onTeamAndUserItemMouseenter:function e(t){if((!$(this).hasClass("has_submenu")||"member_current_status_item"===$(this).attr("id"))&&TS.menu._current_status_input&&TS.menu._current_status_input.isEdited())return;TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy");if($(t.currentTarget).hasClass("has_submenu")){var n=$(this).attr("id")||$(this).data("action");var r=TS.menu.$menu_body;var i={};TS.menu.submenu_template_args[n]&&(i=TS.menu.submenu_template_args[n]);switch(n){case"administration":if(TS.model.user.enterprise_user&&(TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner)){i.show_org_settings=true;i.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}else{var a=TSSSB.call("isAppStoreBuild")&&navigator.userAgent.match("MacAppStore");var s=(TS.model.user.is_owner||TS.prefs.getPref("purchaser"))&&!a;TS.interop.apps.isAppSpaceEnabled()&&TS.interop.members.isAppmin()?i.show_apps_link=true:s&&(i.show_billing_link=s);TS.prefs.getPref("seen_administration_menu")||TS.prefs.setPrefByAPI({name:"seen_administration_menu",value:true});i.can_create_shared_channel=TS.permissions.members.canCreateSharedChannel()}TS.menu.$submenu_parent=r.find("#administration");TS.menu.$submenu_parent.submenu({items_html:TS.templates.administration_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"switch_teams":TS.menu.$submenu_parent=r.find("#switch_teams");TS.menu.$submenu_parent.submenu({items_html:TS.templates.switch_teams_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"member_current_status_item":TS.menu.$submenu_parent=r.find("#member_current_status_item");TS.menu.$submenu_parent.submenu({items_html:TS.templates.current_status_submenu(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick,ondestroy:TS.menu._unregisterCurrentStatusInput});TS.menu._registerCurrentStatusInput();break;case"team_invitations":if(TS.ui.admin_invites.userCanViewSharedInvitesModal())return;t.preventDefault();TS.ui.admin_invites.start();TS.interop.clog.track(this.getAttribute("data-clog-event"),this.getAttribute("data-clog-params"));break;default:}}},onTeamAndUserItemSubmenuClick:function e(t){var n=$(t.target).closest("li");var r=n.attr("id")||n.data("action");switch(r){case"team_settings":case"manage_team":case"team_services":case"switch_team":case"logout":case"enterprise_logout":case"org_settings":break;case"enterprise_teams_dialog":t.preventDefault();TS.ui.enterprise_teams_dialog.show(TS.model.user);break;case"connected_workspaces":t.preventDefault();TS.interop.mountConnectedWorkspaces(TS.boot_data.team_id,{referringUiElement:"TEAM_MENU_ADMINISTRATION_MANAGE_SHARED_CHANNELS_BTN"});break;default:t&&t.target&&"_blank"===t.target.getAttribute("target")||t.preventDefault();return}TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy");TS.menu.end()},onTeamAndUserItemClick:function e(t){clearTimeout(TS.menu.end_time);var n=$(this);if(n.is("[disabled]")||n.hasClass("disabled")){t.preventDefault();return}var r=n.attr("id");!r&&n.hasClass("switch_team")&&(r="switch_team");switch(r){case"leave_workspace":t.preventDefault();TS.ui.leave_team_dialog.start(TS.model.team.id);break;case"workspaces":t.preventDefault();TS.ui.workspaces.start();break;case"shared_channels":t.preventDefault();TS.ui.enterprise_shared_channels_invites.start();break;case"shared_channels_open_beta":t.preventDefault();TS.ui.shared_channels_open_beta_modal.showModal();break;case"version_info":t.preventDefault();TS.ui.showVersionInfo();break;case"member_account_item":t.preventDefault();TS.client.ui.previewMember(TS.model.user.id);break;case"team_settings":case"manage_team":case"team_billing":case"team_pricing":case"team_services":case"team_customize":case"team_statistics":case"limit_meter":case"sli_trending_dashboard":break;case"team_apps":TS.metrics.count("team_menu_download_apps");t.preventDefault();TS.magic_login.execute({fallback_to_browser:true,browser_uri:"/downloads",app_uri:"/ssb/open"});break;case"team_invitations":if(TS.ui.admin_invites.userCanViewSharedInvitesModal())return;t.preventDefault();TS.ui.admin_invites.start();TS.interop.clog.track(this.getAttribute("data-clog-event"),this.getAttribute("data-clog-params"));break;case"member_prefs_item":t.preventDefault();TS.ui.prefs_dialog.start();break;case"team_help":t.preventDefault();i("team_menu");break;case"add_team":TSSSB.call("signInTeam")&&t.preventDefault();break;case"member_presence":t.preventDefault();TS.redux.presence.toggleUserPresence();TS.menu.end_time=setTimeout(TS.menu.end,1e3);return;case"logout":t.preventDefault();TS.client&&TS.client.windows.closeAll();TS.utility.loadUrlInWindowIfOnline(TS.boot_data.logout_url);break;case"enterprise_login":TSSSB.call("signInTeam")&&t.preventDefault();break;case"enterprise_logout":break;case"switch_team":var a=$(this).data("user-id");if(TSSSB.call("displayTeam",a))t.preventDefault();else{var s=$(this).find("a").attr("href");s&&-1==s.indexOf("?")&&$(this).find("a").attr("href",[s,TS.getQsArgsForUrl()].join("?"))}break;default:t.preventDefault();return}TS.menu.end()},startWithNotificationsMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var n=TS.dnd.memberDndStatus();var r=TS.shared.legacyGetActiveModelOb();var i;i=r.is_mpim?TS.mpims.legacyGetDisplayName(r,false,false):r.is_channel||r.is_group?"#"+r.name:r.name;var a={user:TS.model.user,model_ob:r,model_ob_name:i,in_dnd:n.in_dnd,is_snoozing:n.snoozed,readable_end_time:n.readable_end_time,cmd_key:TS.model.is_mac?"\u2318":"ctrl",meta_key:TS.model.is_mac?"opt":"alt",unread_view_is_showing:TS.model.unread_view_is_showing};TS.menu.has_submenu=true;TS.menu.$menu.addClass("notifications_menu");TS.menu.$menu_header.html(TS.templates.notifications_header(a));TS.menu.$menu_items.html(TS.templates.notifications_items(a));TS.menu.$menu_items.on("click.menu","li",TS.menu.onNotificationsMenuItemClick);var s=TS.menu.$menu_items.find("#adjust_snooze_time");s.on("highlighted",function(){s.submenu({items_html:TS.templates.snooze_items(),onclick:TS.menu.onNotificationsMenuItemClick})}).on("unhighlighted",function(){TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active")&&s.submenu("destroy")});TS.menu.start(t);TS.menu.positionAt($("#team_menu .notifications_menu_btn"),-10,24)},onNotificationsMenuItemClick:function e(t){var n=$(t.target).closest("[data-dnd-menu-action]");if(!n.length)return;var r=n.data("dnd-menu-action");var i=TS.dnd.memberDndStatus();if("turn_off"===r)i.snoozed?TS.dnd.endSnooze():i.in_dnd&&TS.dnd.endDnd();else if("snooze"===r){var a=parseInt(n.data("snooze-length"),10);a&&!isNaN(a)&&TS.dnd.setSnooze(a)}else if("dnd_schedule"===r)TS.ui.prefs_dialog.start("notifications","#prefs_dnd");else if("channel_settings"===r){var s=TS.shared.legacyGetActiveModelOb();TS.ui.channel_prefs_dialog.start(s.id)}else"notif_prefs"===r&&TS.ui.prefs_dialog.start("notifications");TS.menu.end()},startWithFlexMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();var n;n=TS.boot_data.page_needs_enterprise?TS.interop.i18n.t("Organization Directory","menu")():TS.interop.i18n.t("Workspace Directory","menu")();TS.menu.$menu_items.html(TS.templates.menu_flexpane_items({special_flex_panes:TS.boot_data.special_flex_panes,show_downloads:TS.model.supports_downloads,is_enterprise:TS.boot_data.page_needs_enterprise,show_user_groups:""!==TS.model.team.plan&&!TS.model.user.is_restricted,directory_title:n}));TS.menu.$menu_items.on("click.menu","li",TS.menu.onFlexMenuItemClick);TS.menu.start(t);TS.menu.$menu.addClass("flex_menu");TS.menu.$menu.attr("data-qa","flex_menu");var r=$("#flex_menu_toggle");var i=-(TS.menu.$menu.width()-r.width());var a=6+r.height();TS.menu.positionAt(r,i,a);TS.help.updateIcon();TS.client.whats_new.updateIcon();$("#flex_menu_toggle").addClass("menu_open");$("#flex_menu_callout").bind("click",function(){TS.menu.end()})},onFlexMenuItemClick:function e(t){var n=200;var r=$(this);var a=$(this).data("tab-id");if(a){var s=a;setTimeout(function(){if("files"===s){TS.client.ui.files.toggleFileList("all");TS.client.ui.files.filterFileList("all")}else if("team"===s)TS.client.ui.showTeamList();else if("groups"===s)TS.client.ui.showGroupsList();else{if("whats_new"===s){var e=!r.find("#whats_new_count").hasClass("hidden");e?TS.interop.clog.track("WHATSNEW_ACTION",{action:"open_pane_badged",trigger:"flex_menu",step:TS.client.whats_new.getNewestID()}):TS.interop.clog.track("WHATSNEW_ACTION",{action:"open_pane",trigger:"flex_menu",step:TS.client.whats_new.getNewestID()})}TS.client.ui.flex.openFlexTab(s)}},n)}else if($(this).data("filetype")){var o=$(this).data("filetype");var l=$("#file_list");l.length&&l.children().length||TS.view.files.last_files_html&&(TS.view.files.last_files_html="");setTimeout(function(){TS.client.ui.files.toggleFileList("all");TS.client.ui.files.filterFileList(o);TS.view.files.setButtonState(o)},n)}else{var u=$(this).attr("id");if("help"===u){t.preventDefault();setTimeout(function(){i("flex_menu")},n)}}TS.menu.end()},startWithUserGroupMenu:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.user_group=TS.interop.userGroups.getUserGroupById(n);TS.menu.$menu.addClass("no_min_width");var r=TS.permissions.members.canCreateAndDeleteUserGroups()&&!TS.menu.user_group.date_delete;var i=TS.permissions.members.canCreateAndDeleteUserGroups()&&TS.menu.user_group.date_delete;TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.user_group_items({show_user_groups_edit:TS.permissions.members.canEditUserGroups(),show_user_groups_disable:r,show_user_groups_enable:i}));TS.menu.$menu_items.on("click.menu","li",TS.menu.onUserGroupMenuItemClick);TS.menu.start(t);TS.menu.positionAt($("#user_group_menu_toggle"),-(TS.menu.$menu.width()-$("#user_group_menu_toggle").width()),37)},onUserGroupMenuItemClick:function e(){var t=$(this).data("action");"edit_info"===t?TS.ui.admin_user_groups.editInfo(TS.menu.user_group):"edit_members"===t?TS.ui.admin_user_groups.editMembers(TS.menu.user_group):"disable"===t?TS.ui.admin_user_groups.disable(TS.menu.user_group):"enable"===t?TS.ui.admin_user_groups.enable(TS.menu.user_group):"delete"===t&&TS.ui.admin_user_groups.remove(TS.menu.user_group);TS.menu.end()},startWithSearchFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var n={search_exclude_bots:TS.prefs.getPref("search_exclude_bots"),search_only_my_channels:TS.prefs.getPref("search_only_my_channels"),search_only_current_team:TS.prefs.getPref("search_only_current_team"),result_type:"files"===TS.search.filter?"files":"messages",is_enterprise:TS.boot_data.page_needs_enterprise};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu.addClass("search_filter_menu");TS.menu.$menu_items.html(TS.templates.menu_search_filter_items(n));TS.menu.start(t);a();var r=$("#search_filter_menu_label");TS.menu.positionAt(r,-8,r.height()+10);$("#search_only_my_channels_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_only_my_channels",value:!$(this).prop("checked")})});$("#search_exclude_bots_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_exclude_bots",value:!$(this).prop("checked")})});$("#search_only_current_team_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_only_current_team",value:!$(this).prop("checked")})});TS.menu.search_filter_is_showing=true;$("#search_filter_menu_label").addClass("active")},startWithMentionsFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var n={exclude_at_channels:TS.prefs.getPref("mentions_exclude_at_channels"),exclude_at_user_groups:TS.prefs.getPref("mentions_exclude_at_user_groups"),show_user_group_filter:true};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu.addClass("search_filter_menu");TS.menu.$menu_items.html(TS.templates.menu_mentions_filter_items(n));TS.menu.start(t);a();var r=$("#mentions_filter_menu_label");TS.menu.positionAt(r,-8,r.height()+10);$("#exclude_at_channels_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"mentions_exclude_at_channels",value:!$(this).prop("checked")})});$("#exclude_at_user_groups_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"mentions_exclude_at_user_groups",value:!$(this).prop("checked")})});$("#mentions_filter_menu_label").addClass("active")},startWithEditTeamProfileListActions:function e(t,n,r){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var i=$(t.target);var a=TS.team.getTeamProfileFieldById(i.data("id"));var s={id:a.id,hidden:!!(a&&a.is_hidden),is_scim:r.is_scim};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.admin_menu_edit_team_profile_list_action_items(s));TS.menu.$menu_items.on("click.menu","li",n);TS.menu.start(t);TS.menu.positionAt(i.find('[data-action="edit_team_profile_list_menu"]'),-(TS.menu.$menu.width()+6),0);TS.menu.keepInBounds()},startWithAllUnreadsSortOrderMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var n={sort_order:TS.client.unread.getSortOrder(),is_paid_team:""!==TS.model.team.plan};TS.menu.has_submenu=true;TS.menu.$menu.addClass("all_unreads_sort_order_menu selectable");TS.menu.$menu_items.html(TS.templates.unread_sort_order_menu(n));TS.menu.$menu_items.on("click.menu","li",TS.menu.onAllUnreadsSortOrderMenuItemClick);TS.menu.addSubmenu(".priority",TS.templates.menu_help_submenu({icon:"ts_icon_emoji_objects",title:TS.interop.i18n.t("Sorted by science","all_unreads")(),message:TS.interop.i18n.t("This sorts your unreads based on how you use Slack.","all_unreads")()}),_.noop,true);TS.menu.start(t);TS.menu.positionAt($(".channel_header_info_count"),105,20)},onAllUnreadsSortOrderMenuItemClick:function e(t){var n=$(t.target).closest("[data-sort-order]");if(!n.length)return;var r=n.data("sortOrder");if(r===TS.client.unread.getSortOrder()){TS.menu.end();return}TS.prefs.setPrefLocal("all_unreads_sort_order",r);TS.prefs.setPrefByAPI({name:"all_unreads_sort_order",value:r});TS.prefs.all_unreads_sort_order_changed_sig.dispatch(r);TS.client.ui.unread.updateChannelHeader();TS.client.unread.reload();TS.menu.end()},startWithSearchableMemberListFilter:function e(t,n,r){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i={everyone_count:0,admins_count:0,guests_count:0,enterprise_filter_options:TS.boot_data.page_needs_enterprise,bots_count:0};TS.boot_data.page_needs_enterprise&&_.merge(i,{is_enterprise:true,org_name:TS.model.team.enterprise_name,team_name:TS.model.team.name,everyone_count:0,org_members_count:0,org_admins_count:0,org_guests_count:0,org_bots_count:0});_.each(n,function(e,t){i[t+"_count"]=e});var a=[];_.each(n.external_teams,function(e,t){a.push({id:t,name:TS.teams.getTeamNameById(t)})});a.length>0&&_.merge(i,{ext_teams:a.sort(TS.interop.i18n.mappedSorter("name"))});TS.menu.$menu.width($(t.target).outerWidth());TS.menu.$menu.addClass("searchable_member_list_filter_menu");TS.menu.$menu_items.html(TS.templates.searchable_member_list_filter_items(i));TS.menu.$menu_items.on("click.menu","li",function(e){TS.menu.end();r(e)});TS.menu.start(t);TS.menu.positionAt($(".searchable_member_list_filter"),16,56)},startWithSoundsMenu:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();var r=TS.boot_data.notification_sounds;r=_.reject(r,{value:"none"});var i={notification_sounds:r};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_sound_items(i));TS.menu.start(t);TS.menu.$menu_items.on("click.menu",'[data-action="set_sound"]',function(e){var t=$(this).data("sound");if(!t)return;e.preventDefault();n(t);TS.menu.end()}).on("click.menu",'[data-action="play_sound"]',function(e){var t=$(this).data("sound");if(!t)return;e.preventDefault();TS.sounds.play(t,{ignore_mute:true})});TS.menu.keepInBounds()},legacyStartWithChannelsMenu:function e(t,n){if(!n)return;var r=TS.interop.channels.getEntityById(n);if(!r)return;t.persist&&t.persist();if(r.is_im&&r.user)return TS.menu.member.startWithMember(t,r.user,false,false,true);r.is_channel||r.is_mpim?TS.menu.channel.startWithChannel(t,n):r.is_group&&TS.menu.group.startWithGroup(t,n)},startWithGeneric:function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();var a="";_.each(n,function(e){a+=TS.templates.menu_generic_item({label:e.label,value:e.value})});TS.menu.clean();TS.menu.$menu_header.empty();i.header_text?TS.menu.$menu_header.html(TS.templates.menu_generic_header({header_text:i.header_text})):TS.menu.$menu_header.addClass("hidden");TS.menu.$menu_items.html(a);var s={};s.menu_class=i.menu_class;TS.menu.start(t,void 0,s);TS.menu.$menu_items.on("click.menu","a[data-value]",function(){t.preventDefault();r($(this).data("value"));TS.menu.end()});TS.menu.keepInBounds()},positionAt:function e(t,n,r){n=n||0;r=r||0;var i=t.offset();var a=i.left+n;var s=i.top+r;TS.menu.$menu.css({top:s,left:a})},isRedundantClick:function e(t){if(TS.isPartiallyBooted()){t.preventDefault();TS.incremental_boot.userDidInteractWithUI();return true}if(t&&TS.menu.last_e&&(t.target==TS.menu.last_e.target||t.currentTarget==TS.menu.last_e.currentTarget))return true;return false},isLarge:function e(){return TS.menu&&TS.menu.$menu&&TS.menu.$menu.find("li").length>TS.menu.large_dom_trigger},start:function e(t,i,a){a=a||{};TS.menu.last_e=t;if(!r){var s=$(t.target).offset();var o=s.left+$(t.target).width()+10;var l=s.top;if(i){o=t.pageX+10;l=t.pageY+10}}_.isFunction(a.needs_to_remain_open)&&(TS.menu.needs_to_remain_open=a.needs_to_remain_open);$(".tooltip").hide();TS.tips.hideAll();$(t.currentTarget).addClass("active");TS.menu.$target_element=$(t.currentTarget);TS.model.menu_is_showing=true;var u=TS.menu.$menu;a.onClose&&u.one("closed",a.onClose);a.menu_class&&u.addClass(a.menu_class);var d=TS.menu.isLarge();r||u.css({top:l,left:o});var c=u.find("#menu_items_scroller");c.scrollTop(0);a.attach_to_target_at_full_width?TS.menu.$target_element.after(u):TS.client?u.appendTo($("#client-ui")):u.appendTo($("body"));a.keep_menu_open_if_target_clicked_again&&TS.menu.$menu.addClass("keep_menu_open_if_target_clicked_again");if(d||r)u.css("opacity",1);else{u.css("opacity",0);u.stop().transition({opacity:1},200)}u.find(".menu_close").on("click",TS.menu.end);a.ignore_bounds||TS.menu.keepInBounds();TS.ui.utility.updateClosestMonkeyScroller(c,true);TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents&&TS.menu.menu_lazy_load.detachEvents();TS.menu.menu_lazy_load=TS.menu.$menu_items.find(".lazy").lazyload({container:$("#menu_items_scroller"),all_images_same_size:true,throttle:250});a.ignore_bounds||$(window).bind("resize",TS.menu.keepInBounds);$(window.document).bind("keydown",TS.menu.onKeyDown);$("html").bind("mousedown touchstart",TS.menu.onMouseDown);var m=u.find(".menu_list");var f=m.length?m:u.find("#menu_items");TS.menu.has_submenu?TS.kb_nav.start(f,"li:not(.divider)",u,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists}):TS.kb_nav.start(f,"li:not(.divider)");var p=m.length?m.first().find("a, button").first():null;TS.ui&&TS.ui.a11y&&TS.ui.a11y.focusAndAddTabindex(p);r=false;n=a.on_esc},clean:function e(){TS.menu.$menu_footer.empty();TS.menu.$menu_header.removeClass("hidden");TS.menu.$menu.removeClass("no_min_width no_max_width profile_preview flex_menu search_filter_menu popover_menu no_icons team_menu file_menu notifications_menu all_unreads_sort_order_menu searchable_member_list_filter_menu selectable member_file_filter_menu app_card keep_menu_open_if_target_clicked_again member_file_filter_menu").css("max-height","");TS.menu.$menu.removeAttr("data-qa");TS.menu.$menu.find("#menu_items_scroller").css("max-height","");TS.menu.$menu.find(".arrow, .arrow_shadow").remove();TS.menu.$menu_items.off("mouseenter.section_header");TS.menu.$menu.removeClass("narrow_menu");TS.menu.$menu_body.off("mouseenter.section_header");TS.menu.needs_to_remain_open=void 0;TS.menu.$menu.removeClass("date_picker");if(TS.boot_data.page_needs_enterprise){TS.menu.$menu_list_container.html('<div id="menu_list" role="menu"></div>').removeClass("populated");TS.menu.$menu_list=TS.menu.$menu.find("#menu_list");TS.menu.$menu.off("keydown","#file_member_filter .member_filter")}TS.menu.$menu.removeAttr("data-model-ob-id");TS.menu.$menu.removeAttr("data-thread-ts");if(TS.SearchableMemberList&&TS.SearchableMemberList.get("member_file_filter_menu")){TS.menu.$menu.find(".searchable_member_list").remove();TS.SearchableMemberList.get("member_file_filter_menu").destroy()}if(TS.menu.$menu.find(".member_item")){TS.menu.$menu.find(".member_item").remove();TS.menu.$menu.find(".list_items").css("height",0)}n=null},end:function e(){if(_.isFunction(TS.menu.needs_to_remain_open)&&TS.menu.needs_to_remain_open())return;TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy");TS.menu.$menu.width("");TS.model.menu_is_showing=false;TS.menu.menu_items_hidden=true;TS.menu.has_submenu=false;TS.menu.$submenu_parent=null;TS.menu.submenu_template_args={};TS.menu.did_start_slack_menu_signal_listeners&&TS.menu.stopListeningForRebuildWorthiness();var t=TS.menu.$menu;var n=function e(){if(TS.model.menu_is_showing)return;setTimeout(function(){TS.model.menu_is_showing||(TS.menu.last_e=null)},50);t.detach();TS.menu.$menu_header.empty();TS.menu.$menu_footer.empty();TS.menu.$menu_items.empty();TS.menu.$menu_items.removeClass("hidden");TS.menu.$menu_body.empty();TS.menu.clean()};TS.menu.isLarge()||r?n():t.stop().transition({opacity:0},200,n);t.trigger("closed");if(TS.menu.$target_element){TS.menu.$target_element.removeClass("active");TS.menu.$target_element=null}if(TS.menu.$secondary_target_element){TS.menu.$secondary_target_element.removeClass("active");TS.menu.$secondary_target_element=null}TS.menu.user_group=null;TS.menu.$menu_header.unbind("click.menu");TS.menu.$menu_items.off("click.menu");TS.menu.$menu_body.off("click.menu");$(window).unbind("resize",TS.menu.keepInBounds);$(window.document).unbind("keydown",TS.menu.onKeyDown);$("html").unbind("mousedown touchstart",TS.menu.onMouseDown);TS.members.view.team_filter_changed_sig.remove(TS.kb_nav.clearHighlightedItem);$(".file_list_item.active").removeClass("active");TS.tips.unhideAll();TS.menu.search_filter_is_showing=false;$("#search_filter_menu_label").removeClass("active");$("#mentions_filter_menu_label").removeClass("active");$("#flex_menu_toggle").removeClass("menu_open");$("#channel_actions_toggle").removeClass("active");$("#menu_member_dm_input").length&&TS.utility.contenteditable.unload($("#menu_member_dm_input"));t.removeClass("narrow_menu");setTimeout(function(){TS.menu.file.file_list_menu_up=false;$(".inline_file_preview_container.file_menu_open, .file_container.file_menu_open").removeClass("file_menu_open")},100);if(TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents){TS.menu.menu_lazy_load.detachEvents();TS.menu.menu_lazy_load=null}TS.kb_nav.end();TS.client&&"team"!==TS.model.ui.active_tab_id&&"details"!==TS.model.ui.active_tab_id&&TS.client.flex_pane.stopLocalTimeInterval();TS.menu.menu_closed_sig.dispatch()},onKeyDown:function e(t){var r=TS.utility.keymap;var i=t.which;var a=t.metaKey||t.ctrlKey||t.altKey;if(i==r.esc){if(TS.utility.contenteditable.hasFocus($("#menu_member_dm_input")))return;t.stopPropagation();t.preventDefault();TS.menu.end();n&&n()}else if(!a&&!TS.utility.isArrowKey(i)&&i!=r.tab&&i!=r.enter&&i!=r.shift){TS.kb_nav.clearHighlightedItem();TS.utility.contenteditable.focus($("#menu_member_dm_input"))}},onLeftKeyDownIfSubmenuExists:function e(){var t=false;if(TS.menu.$submenu&&TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active");TS.kb_nav.end();TS.kb_nav.highlightItemWithKey(TS.menu.$submenu_origin);var n=TS.menu.$menu.find(".menu_list");var r=n.length?n:TS.menu.$menu.find("#menu_items");TS.kb_nav.start(r,"li:not(.divider)",TS.menu.$menu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists});-1===["member_current_status_item","switch_teams"].indexOf(TS.menu.$submenu_origin.attr("id"))&&TS.menu.$submenu_origin.submenu("destroy");t=true}return t},onRightKeyDownIfSubmenuExists:function e(){var t=false;TS.kb_nav.getHighlightedItem()&&TS.kb_nav.getHighlightedItem().data("has-submenu")&&(TS.menu.$submenu||TS.kb_nav.getHighlightedItem().submenu({items_html:TS.templates.snooze_items(),onclick:TS.menu.onNotificationsMenuItemClick}));if(TS.menu.$submenu){if(TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active");TS.menu.end()}else{TS.menu.$submenu.addClass("kb_active");TS.kb_nav.end();TS.kb_nav.highlightItemWithKey(TS.menu.$submenu.find("li:not(.divider)").first());TS.kb_nav.start(TS.menu.$submenu.find("ul"),"li:not(.divider)",TS.menu.$submenu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists})}t=true}return t},onMouseDown:function e(t){var n=$(t.target);if(TS.menu.$menu&&TS.menu.$menu.hasClass("keep_menu_open_if_target_clicked_again")&&n.is(TS.menu.$target_element))return;(0===n.closest("#menu, .submenu, .trap_menu_clicks").length||n.hasClass("popover_mask"))&&TS.menu.end()},keepInBounds:function e(){window.requestAnimationFrame?TS.utility.rAF(TS.menu.keepInBoundsThrottled):TS.menu.keepInBoundsThrottled()},keepInBoundsThrottled:function e(){var t=TS.menu.$menu;var n=10;var r=t.dimensions_rect();var i={top:0+n,right:$(window).width()-n,bottom:$(window).height()-(n+14),left:0+n};if(TS.utility.doesRectContainRect(i,r))return;r.left<i.left?t.css("left",i.left):r.right>i.right&&t.css("left",Math.max(i.left,i.right-r.width));r.top<i.top?t.css("top",i.top):r.bottom>i.bottom&&t.css("top",Math.max(i.top,i.bottom-r.height+$(window).scrollTop()))},addSubmenu:function e(t,n,r,i){var a=TS.menu.$menu_items.find(t);a.on("highlighted",function(){a.submenu({items_html:n,onclick:r,help:i})}).on("unhighlighted",function(){TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active")&&a.submenu("destroy")})},_registerCurrentStatusInput:function e(){TS.menu._unregisterCurrentStatusInput();if(TS.boot_data.feature_m11n_custom_status_input){TS.interop.mountCustomStatusInput(TS.boot_data.team_id,document.getElementById("slack_menu_current_status_submenu"),{inputType:"team_menu",onSubmit:TS.menu.end});return}TS.menu._current_status_input=new TS.ui.CurrentStatusInput({$parent:$("#slack_menu_current_status_submenu"),onEscape:TS.menu.end,onSave:TS.menu.end});TS.menu.$menu_body.find("#member_current_status_item").on("click.current_status_item",function(){TS.menu._current_status_input&&TS.menu._current_status_input.focus()})},_unregisterCurrentStatusInput:function e(){if(TS.boot_data.feature_m11n_custom_status_input){TS.interop.unmountCustomStatusInput(document.getElementById("slack_menu_current_status_submenu"));return}if(TS.menu._current_status_input){TS.menu._current_status_input.destroy();TS.menu._current_status_input=null}TS.menu.$menu_body.find("#member_current_status_item").off(".current_status_item")}});var e=3;var t;var r=false;var i=function e(t){TS.help_modal.start();TS.interop.clog.track("HELP_MODAL_ACTION",{action:"open_modal",trigger:t})};var a=function e(){var t=TS.menu.$menu;t.addClass("popover_menu");t.prepend('<span class="arrow"></span><span class="arrow_shadow"></span>')};var s=function e(t){var n=3;var r=TS.menu.$target_element.outerHeight()+n;var i=0;t&&(i=TS.menu.$target_element.outerWidth()-TS.menu.$menu.outerWidth());return{left:i,top:r}};var o=function t(n){var r=_.without(_.get(TS.model.user,"enterprise_user.teams",[]),TS.model.team.id);if(!r.length)return;var i=_.partition(r,TS.teams.getTeamById);var a=i[0];var s=i[1];var o=s.slice(0,Math.max(0,e-a.length));if(!o.length)return;var u="TS.menu._maybeEnsureTeamsAndRebuild";TS.teams.ensureTeamsArePresent(o,u).then(function(){if(!TS.model.menu_is_showing||!TS.menu.did_start_slack_menu_signal_listeners)return;l(n)})};var l=function e(t){var n=$(".menu.submenu").data("origin-id");r=true;TS.menu.startWithTeamAndUserRebuild(t);r=false;n&&$("#"+n).trigger("highlighted")};var u;var d;var c=function e(t,n,r){if(!TS.model.menu_is_showing)return;var i=$("#toggle-subscription-status");if(i.attr("data-model-ob-id")!==t||i.attr("data-msg-ts")!==n)return;i.attr("data-subscribed",r.subscribed);i.removeClass("disabled");TS.menu.keepInBounds()};var m=function e(t){var n=1e4;var r=$("#limit_meter");var i=$("#limit_meter_circle_progress");var a;var s="rgba(0, 0, 0, .1)";var o;var l={r:69,g:186,b:133};var u={r:255,g:197,b:101};var d={r:243,g:61,b:95};if(t<=n){a=t/n;s="rgba(0, 0, 0, .1)";var c=_.mergeWith(l,u,function(e,t){return Math.floor(e*(1-a)+t*a)});o="rgb("+c.r+", "+c.g+", "+c.b+")"}else{a=Math.atan((t-n)/2500-3)/Math.PI+.5;s="rgb("+u.r+", "+u.g+" , "+u.b+")";o="rgb("+d.r+", "+d.g+", "+d.b+")"}i.circleProgress({value:a,size:50,animation:{duration:20},thickness:4,fill:{color:o},emptyFill:s,startAngle:.425*-Math.PI});r.on("click",function(){TS.interop.clog.track("UPGRDEXP_LIMIT_METER",{limit_meter_messages_count:t,contexts:{ui_context:{action:"click",step:"slack_menu"}}})})};$.widget("TS.submenu",{_create:function e(){this.element.data("has-submenu",true);var t=TS.interop.i18n.t("submenu","menu_source")();var n='<div class="menu submenu'+(this.options.help?" submenu_help":"")+'" data-origin-id="'+this.element.attr("id")+'" data-model-ob-id="'+this.element.data("modelObId")+'"><ul aria-hidden="true" aria-label="'+t+'">'+this.options.items_html+"</ul></div>";var r=7;var i=11;var a=TS.menu.$menu.offset().left+TS.menu.$menu.width()+r;var s=this.element.offset().top-i;this.$submenu=$(n);this.$submenu.appendTo("body");TS.menu.$submenu=this.$submenu;TS.menu.$submenu_origin=this.element;if(a+this.$submenu.width()>window.innerWidth){var o=TS.menu.$menu.offset().left-r;var l=window.innerWidth-a;o>l&&(a=TS.menu.$menu.offset().left-this.$submenu.width()-r)}if(s+this.$submenu.height()>window.innerHeight){var u=s;var d=Math.abs(window.innerHeight-(s+this.$submenu.height()));s=u>d?window.innerHeight-this.$submenu.height()-i:i}this.$submenu.css({position:"absolute",left:a+"px",top:s+"px"});var c=this.options.onclick;c&&this.$submenu.on("click",function(e){c.call(this,e)})},_destroy:function e(){TS.menu.$submenu=null;TS.menu.$submenu_origin=null;this.options.ondestroy&&this.options.ondestroy();this.$submenu.remove()}})})();var n},11246:function(e,t){(function(){TS.registerModule("menu.app",{onStart:function e(){},active_app:null,active_app_bot_id:null,app_item_click_sig:new signals.Signal,startWithApp:function t(n,r,i,a,s,o){if(TS.menu.isRedundantClick(n))return;if(TS.client.ui.checkForEditing(n))return;if(!s){TS.menu.buildIfNeeded();TS.menu.clean()}i||(i=TS.model.user.team_id);if(TS.boot_data.feature_better_web_app_model&&!o){var l=n&&n.target;return TS.interop.apps.openAppProfileCard(r,i,l)}TS.menu.app.active_app_bot_id=r;TS.menu.app.active_app_team_id=i;TS.menu.app.active_app_member_id=_.get(n,"target.dataset.memberId",null);function u(e){var t=_.get(e,"bot_user.id");var n=TS.shared.legacyGetActiveModelOb();if(t&&(TS.model.active_channel_id||TS.model.active_group_id))return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(n.id,[t]).then(function(){return e});return e}function d(t){TS.menu.app.active_app=t;s?TS.menu.app_team_id?TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id):TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id):e(n,a,o)}return TS.apps.promiseToGetFullAppProfile(r,i,null,true).then(u).then(d)},onAppItemClick:function e(t){var n=$(this);var r=n.data("action");var i=TS.menu.app.active_app.is_xoxa_app?_.get(TS.menu.app.active_app,"app_user_id"):_.get(TS.menu.app.active_app,"bot_user.id");if("view_details"===r)TS.interop.apps.isAppSpaceEnabled()&&i?TS.ims.legacyStartImByMemberId(i).then(function(){TS.client.ui.app_space.toggleView("about")}):TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);else if("files"===r){t.preventDefault();TS.view.files.clearFilter();TS.client.ui.files.filterFileList(i)}else if("invite_to_channel"===r){t.preventDefault();TS.ui.invite.showInviteMemberToChannelDialog(i)}else if("app_support"===r)TS.help_modal.start();else if(TS.menu.app.active_app.is_xoxa_app&&"settings"===r){t.preventDefault();TS.redux.dispatch(TS.interop.openAppManagementModal({appProfile:TS.menu.app.active_app,serviceId:TS.menu.app.active_app_bot_id}))}TS.interop.clog.track("USER_CARD_CLICK",{app_id:TS.menu.app.active_app.id,bot_id:TS.menu.app.active_app_bot_id});TS.menu.app.end()},end:function e(){TS.menu.app.active_app=null;TS.menu.end()}});var e=function e(t,n,r){var i;if(r){i={app_id:TS.menu.app.active_app.id,bot_id:TS.menu.app.active_app_bot_id,support_url:TS.menu.app.active_app.support_url,is_xoxa_app:TS.menu.app.active_app.is_xoxa_app,homepage_url:TS.menu.app.active_app.url,is_distributed:TS.menu.app.active_app.is_distributed,is_slack_integration:TS.menu.app.active_app.is_slack_integration,is_custom_integration:_.get(TS.menu.app.active_app,"config.is_custom_integration"),hide_im_menu_items:!TS.menu.app.active_app.is_installed||TS.menu.app.active_app.is_external||TS.model.user.is_restricted,is_uninstalled:!TS.menu.app.active_app.is_installed};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_app_items(i));TS.menu.$menu_footer.addClass("hidden").empty();TS.menu.start(t,n);var a=$("#channel_actions_toggle");TS.menu.positionAt(a,6,a.height())}else{i=TS.apps.constructTemplateArgsForCardAndProfile(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_member_id,TS.menu.app.active_app_team_id);var s=TS.menu.app.active_app.is_xoxa_app?_.get(TS.menu.app.active_app,"app_user_id"):_.get(TS.menu.app.active_app,"bot_user.id");if(!s){var o=TS.interop.members.getMemberById(TS.menu.app.active_app_member_id);o&&o.is_bot&&(s=o.id)}TS.menu.$menu_header.html(TS.templates.menu_app_card_header(i));TS.menu.$menu_items.html(TS.templates.menu_app_card_items(i));TS.menu.$menu_footer.html(TS.templates.menu_app_card_footer(i));TS.menu.$menu_header.find(".emoji_replace_on_load").each(function(){var e=$(this).html();e=TS.emoji.graphicReplace(e);$(this).html(e)});TS.menu.start(t,n,{menu_class:"app_card"});if(s){var l=false;var u=$("[data-js=app_card_dm]");var d=TS.interop.i18n.t("Message {name}","menu")({name:i.name});TS.utility.contenteditable.create(u,{modules:{tabcomplete:{searchOptions:{complete_member_specials:false},completers:["channels","emoji","members"],positionMenu:function e(t){t.style.width=u.outerWidth()+"px";t.style.minWidth="0";TS.tabcomplete.positionUIRelativeToInput(t,u)}}},singleLineInput:true,onEnter:function e(t){var n=_.trim(TS.utility.contenteditable.value(u));if(!_.keys(t).length&&!l&&n.length){TS.ims.legacyStartImByMemberId(s,false,n);TS.menu.member.end();l=true;TS.interop.clog.track("USER_CARD_DM",{})}return false},onEscape:function e(){TS.menu.end()},placeholder:d,ariaLabel:d.replace(/&#39;/g,"'")});TS.utility.contenteditable.enable(u)}i.hide_link_to_app_profile?TS.menu.$menu_header.off():TS.menu.$menu_header.on("click",function(){var e=TS.menu.app.active_app.is_xoxa_app?_.get(TS.menu.app.active_app,"app_user_id"):_.get(TS.menu.app.active_app,"bot_user.id");TS.interop.apps.isAppSpaceEnabled()&&e?TS.ims.legacyStartImByMemberId(e).then(function(){TS.client.ui.app_space.toggleView("about")}):TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);TS.menu.$menu_header.off();TS.interop.clog.track("USER_CARD_CLICK",{app_id:TS.menu.app.active_app?TS.menu.app.active_app.id:"",bot_id:TS.menu.app.active_app_bot_id});TS.menu.app.end()});TS.menu.$menu_items.on("click.menu","[data-member-profile-link]",function(e){e.preventDefault();TS.client.ui.previewMember($(this).data("member-profile-link"))});TS.menu.keepInBounds()}TS.menu.$menu_items.on("click.menu","li",TS.menu.app.onAppItemClick)}})()},11247:function(e,t){var n=function(){function e(e,t){var n=[];var r=true;var i=false;var a=void 0;try{for(var s=e[Symbol.iterator](),o;!(r=(o=s.next()).done);r=true){n.push(o.value);if(t&&n.length===t)break}}catch(e){i=true;a=e}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();(function(){TS.registerModule("menu.channel",{onStart:function e(){},channel:null,startWithChannel:function t(n,r){if(TS.menu.isRedundantClick(n))return;if(TS.client.ui.checkForEditing(n))return;TS.model.menu_is_showing||(e=void 0);TS.menu.buildIfNeeded();TS.menu.clean();var i=false;TS.menu.channel.channel=TS.interop.channels.getChannelById(r,i)||TS.interop.channels.getMpimById(r,i);var a=TS.menu.channel.channel;var s=TS.prefs.getTeamPref("allow_email_ingestion");TS.menu.$menu_header.addClass("hidden").empty();var o={channel:a,user:TS.model.user,show_email_item:s};TS.notifs.isCorGMuted(a.id)&&(o.channel_is_muted=true);TS.permissions.channels.canSeeDataRetentionChannelOption(a)&&(o.show_message_retention=true);if(a.is_mpim){o.show_mpim_create=TS.permissions.members.canCreateMpims();o.show_mpim_convert=TS.permissions.members.canCreateGroups()&&!TS.interop.rules.channels.isExternallySharedChannel(a);o.show_export_history=TS.permissions.members.canExportMessageHistory(TS.menu.channel.channel)}else{o.can_delete_channel=TS.model.user.is_admin&&TS.interop.rules.channels.isPublicChannel(a)&&!TS.interop.rules.channels.isRequired(a);TS.interop.rules.channels.isRequired(a)&&!TS.permissions.members.canPostInChannel(a)||0===a.purpose.last_set&&!TS.model.user.is_ultra_restricted&&a.is_member&&(o.show_purpose_item=true);!a.is_member||TS.interop.rules.channels.isRequired(a)&&!TS.permissions.members.canPostInChannel(a)||(o.show_advanced_item=true);if(TS.boot_data.page_needs_enterprise){var l=TS.permissions.members.canCreateConvertOrgSharedChannels();o.show_advanced_item&&!l&&TS.interop.rules.channels.isOrgShared(a)&&(o.show_advanced_item=false);TS.interop.rules.channels.isOrgShared(a)&&(o.is_not_allowed_integrations=true)}o.is_moved=a.is_moved}TS.apps.permissions.areXoxaAppsInstalled()&&(o.show_add_apps=true);TS.menu.$menu_items.html(TS.templates.menu_channel_items(o));TS.menu.$menu_header.bind("click.menu",TS.menu.channel.onChannelHeaderClick);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelItemClick);TS.kb_nav.setSubmitItemHandler(TS.menu.channel.onChannelItemClick);TS.menu.start(n);TS.menu.$menu.attr("data-qa","channel_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs();var u="#channel_name";var d="#channel_actions_toggle";e||(e=$(n.target).closest(u).length);var c=e?$(u):$(d);var _=c.height();var m=e?_+6:_;var f=18;var p=e?f:6;TS.menu.positionAt(c,p,m)},onChannelHeaderClick:function e(t){t.preventDefault()},onChannelItemClick:function e(t){var n=$(this).attr("id");var r=TS.menu.channel.channel;if($(this).hasClass("disabled")){TS.menu.channel.end();return}if("channel_join_item"===n){t.preventDefault();TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==TS.menu.channel.channel.id?TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:TS.menu.channel.channel.id})).catch(_.noop):TS.channels.legacyDisplayChannel({id:TS.menu.channel.channel.id})}else if("channel_details_item"===n){t.preventDefault();TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name?$("#details_tab").highlight(null,"channel_page_details_highlighter"):TS.client.ui.flex.openFlexTab("details")}else if("channel_display_item"===n){t.preventDefault();TS.channels.legacyDisplayChannel({id:TS.menu.channel.channel.id})}else if("channel_close_archived_item"===n){t.preventDefault();TS.shared.legacyCloseArchivedChannel(TS.menu.channel.channel.id)}else if("channel_leave_item"===n){t.preventDefault();TS.channels.leave(TS.menu.channel.channel.id)}else if("channel_email_item"===n);else if("channel_retention_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"retention")}else if("channel_advanced_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id)}else if("channel_convert_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"manage_teams")}else if("channel_delete_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"delete")}else if("channel_unarchive_item"===n){t.preventDefault();var i=function e(t,n){if(t)return;var r;r="restricted_action"===n.error?TS.interop.i18n.t("<p>You don\u2019t have permission to un-archive channels.</p><p>Talk to your Workspace Owner.</p>","channel_menu")():TS.interop.i18n.t("Un-archiving failed with error","channel_menu")+' "'+n.error+'"';setTimeout(TS.generic_dialog.alert,100,r)};TS.api.call("conversations.unarchive",{channel:TS.menu.channel.channel.id}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}},function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})}else if("channel_archives_item"===n);else{if("channel_jump_item"===n){t.preventDefault();TS.menu.startWithDatePicker(t);return}if("channel_mute_item"===n){t.preventDefault();TS.notifs.muteOrUnmuteCorG(r.id)}else if("channel_invite_item"===n){t.preventDefault();TS.ui.channel_invite_modal.startInviteToChannelModal(TS.menu.channel.channel.id)}else if("channel_notification_prefs"===n){t.preventDefault();TS.ui.channel_prefs_dialog.start(r.id)}else if("channel_add_service_item"===n);else if("channel_mpim_message_retention"===n){t.preventDefault();TS.ui.channel_options_dialog.start(r.id,"retention")}else if("channel_mpim_export_history"===n){t.preventDefault();TS.ui.channel_options_dialog.start(r.id,"export")}else if("channel_create_mpim_item"===n){t.preventDefault();setTimeout(function(){TS.ui.im_browser.startWithMpim(r)},1)}else if("convert_to_private_channel"===n){t.preventDefault();var a=TS.shared.legacyGetActiveModelOb();TS.ui.mpim_conversion_modal.startMpimConversionModal(a)}else{if("channel_add_apps_item"!==n){TS.warn("not sure what to do with clicked element id:"+n);return}t.preventDefault();TS.ui.apps_browser.startAddApps()}}TS.menu.channel.end()},startWithChannelPickerForChange:function e(t,n){if(TS.menu.isRedundantClick(t))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.interop.members.getMemberById(n);var s=_.partition(TS.interop.redux.models.channels.getUnarchivedPublicAndPrivateChannels(TS.redux.getState()).filter(function(e){return!i.channels.hasOwnProperty(e.id)&&!i.groups.hasOwnProperty(e.id)}),TS.interop.rules.channels.isPublicChannel);var o={user_id:n,channels:s[0],groups:s[1]};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(o));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(o)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickChangeChannel);TS.menu.start(t);var l=$(t.target).closest(".pill");"mobile"===TS.boot_data.app?TS.menu.positionAt(l,16-l.offset().left,0):TS.menu.positionAt(l,-TS.menu.$menu.width()+l.outerWidth(),l.height()+4);TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25});TS.boot_data.feature_lazy_channels?r(n):a();TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},onChannelPickerItemClickChangeChannel:function e(){var t=$(this).data("user-id");var n=$(this).data("channel-id");var r=$(this).data("group-id");n?TS.api.call("users.admin.changeURAChannel",{user:t,channel:n}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,n,r);return{data:t,args:n,request_id:r}},function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,n,r);return{data:t,args:n,request_id:r}}):r&&TS.api.call("users.admin.changeURAChannel",{user:t,channel:r}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,n,r);return{data:t,args:n,request_id:r}},function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,n,r);return{data:t,args:n,request_id:r}});TS.menu.channel.end()},startWithChannelPickerForInvite:function e(t,n){if(TS.menu.isRedundantClick(t))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.interop.members.getMemberById(n);var s=_.partition(TS.interop.redux.models.channels.getUnarchivedPublicAndPrivateChannels(TS.redux.getState()).filter(function(e){return!i.channels.hasOwnProperty(e.id)&&!i.groups.hasOwnProperty(e.id)}),TS.interop.rules.channels.isPublicChannel);var o={user_id:n,channels:s[0],groups:s[1]};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(o));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(o)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickInviteChannel);TS.menu.start(t);var l=$(t.target).closest(".pill");"mobile"===TS.boot_data.app?TS.menu.positionAt(l,16-l.offset().left,0):TS.menu.positionAt(l,10-l.width(),l.height()+4);TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25});TS.boot_data.feature_lazy_channels?r(n):a();TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},onChannelPickerItemClickInviteChannel:function e(){var t=$(this).data("user-id");var n=$(this).data("channel-id");var r=$(this).data("group-id");var i=n||r;i&&TS.api.call("conversations.invite",{users:t,channel:i}).then(function(e){var t=e.data,i=e.args,a=e.request_id;var s=true;n&&TS.web.admin.onMemberInviteChannel?TS.web.admin.onMemberInviteChannel(s,t,i,a):r&&TS.web.admin.onMemberInviteGroup&&TS.web.admin.onMemberInviteGroup(s,t,i,a);return{data:t,args:i,request_id:a}},function(e){var t=e.data,i=e.args,a=e.request_id;var s=false;n&&TS.web.admin.onMemberInviteChannel?TS.web.admin.onMemberInviteChannel(s,t,i,a):r&&TS.web.admin.onMemberInviteGroup&&TS.web.admin.onMemberInviteGroup(s,t,i,a);return{data:t,args:i,request_id:a}});TS.menu.channel.end()},startWithChannelPicker:function e(t,n,r){if(TS.menu.isRedundantClick(t))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=[];var s=[];var o=[];n.forEach(function(e){e.is_mpim?o.push(e):e.is_group||e.is_private?s.push(e):e.is_channel&&i.push(e)});var l={user_id:TS.model.user.id,channels:i,groups:s,mpims:o};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(l));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(l)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",r);TS.menu.start(t);a();TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},end:function e(){TS.menu.channel.channel=null;TS.menu.end()}});var e;var t;var r=function e(n){var r=TS.menu.$menu.find(".no_matches");var a=TS.menu.$menu.find(".icon_close");var s=TS.menu.$menu.find(".menu_filter");a.click(function(){s.val("").trigger("input");s.focus()});s.on("input",function(){var e=$(this).val();t&&t.cancel();t=i(n,e).then(function(t){var i=t.channels,s=t.groups;var o=!!(i.length||s.length);a.removeClass("hidden");var l={user_id:n,channels:i,groups:s};TS.menu.$menu_items.html(TS.templates.menu_channel_picker(l));if(o)r.addClass("hidden");else{r.find(".query").text(e);r.removeClass("hidden")}TS.ui.utility.updateClosestMonkeyScroller(TS.menu.$menu.find("#menu_items_scroller"),true)});TS.kb_nav.clearHighlightedItem();a.toggleClass("hidden",!e)});s.focus()};var i=function e(t,r){var i=TS.interop.members.getMemberById(t);var a={prefer_exact_match:false,frecency:false,allow_empty_query:true,prefer_channels_user_belongs_to:false};var s={channels:{include_archived:false},groups:{include_archived:false},sort:false};return TS.searcher.search(r,s).then(function(e){var t=_(TS.sorter.search(r,e,a)).filter(function(e){return!(i&&i.channels&&(i.channels[e.id]||i.groups[e.id]))}).partition(TS.interop.rules.channels.isPublicChannel).value(),s=n(t,2),o=s[0],l=s[1];return{groups:l,channels:o}})};var a=function e(){var t=TS.menu.$menu.find(".no_matches");var n=TS.menu.$menu.find(".icon_close");var r=TS.menu.$menu.find(".menu_filter");var i="";n.click(function(){r.val("").trigger("change");r.focus()});TS.menu.$menu_items.children("li").each(function(){var e=$(this).data("channel-id")||$(this).data("group-id")||$(this).data("mpim-id");if(e){var t=TS.interop.channels.getEntityById(e);TS.interop.rules.channels.isMpim(t)?$(this).data("mpim",t):TS.interop.rules.channels.isPrivateChannel(t)?$(this).data("name",t.name):t&&$(this).data("name","#"+t.name)}});r.on("keyup change paste",TS.utility.debounce(function(){var e=$(this).val();if(e){if(i!==e){var r=false;var a=new RegExp(TS.utility.regexpEscape(e),"i");var s=[];var o=e.split(/[,| ]/).filter(function(e){return!!e});for(var l=0;l<o.length;l+=1)s.push(new RegExp("^"+TS.utility.regexpEscape(o[l]),"i"));n.removeClass("hidden");TS.menu.$menu_items.children("li").removeClass("hidden").each(function(){var e=$(this).data("name");var t=$(this).data("mpim");if(e){var n=e.match(a);if(n){r=true;return}}else if(t&&TS.mpims.checkMpimMatch(t,s)){r=true;return}$(this).addClass("hidden")});if(r)t.addClass("hidden");else{t.removeClass("hidden");t.find(".query").text(e)}TS.kb_nav.clearHighlightedItem()}}else{TS.menu.$menu_items.children("li.hidden").removeClass("hidden");t.addClass("hidden");n.addClass("hidden");i!==e&&TS.kb_nav.clearHighlightedItem()}i=e;TS.ui.utility.updateClosestMonkeyScroller(TS.menu.$menu.find("#menu_items_scroller"),true)},250));r.focus()}})()},11248:function(e,t){(function(){TS.registerModule("menu.file",{onStart:function e(){},reported_no_file_reader:false,startWithNewFileOptions:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();TS.menu.$menu.addClass("file_menu");TS.menu.$menu_header.addClass("hidden").empty();var r=window.File&&"disable_all"!==TS.prefs.getTeamPref("disable_file_uploads");var i;var a;if(r)if("disable_all_except_images"===TS.prefs.getTeamPref("disable_file_uploads")){i=TS.interop.i18n.t("Add an image from\u2026","menu_file")();a=TS.interop.i18n.t("an image","menu_file")()}else{i=TS.interop.i18n.t("Add a file from\u2026","menu_file")();a=TS.interop.i18n.t("a file","menu_file")()}else{if(!TS.menu.file.reported_no_file_reader){TS.menu.file.reported_no_file_reader=true;TS.info("TS.menu: No File support?  navigator.userAgent: "+navigator.userAgent)}i=TS.interop.i18n.t("Add from\u2026","menu_file")();a=""}var s=TS.boot_data.feature_email_ingestion&&TS.prefs.getTeamPref("allow_email_ingestion");var o=TS.utility.box.isBrowserSupported()&&TS.prefs.getPref("box_enabled");var l=TS.boot_data.feature_arugula;var u=window.Dropbox&&Dropbox.isBrowserSupported()&&TS.prefs.getPref("dropbox_enabled");var d=TS.prefs.getTeamPref("gdrive_enabled_team");var c=TS.boot_data.feature_onedrive_picker&&TS.prefs.getTeamPref("onedrive_enabled_team");var _=0;o&&(_+=1);u&&(_+=1);d&&(_+=1);c&&(_+=1);var m=_>1;var f=TS.templates.menu_file_new_file_items({should_show_upload_file:r,should_show_email:s,should_show_box:o,should_show_dropbox:u,should_show_gdrive:d,should_show_onedrive:c,should_show_arugula:l,add_from:i,file_type:a,use_cloud_submenu:m});TS.menu.$menu_items.html(f);if(d){TS.menu.addSubmenu("#gdrive_create_submenu",TS.templates.menu_file_gdrive_doc_type_items(),TS.menu.file.onGDriveDocumentTypeItemClick);TS.menu.has_submenu=true}if(c){TS.menu.addSubmenu("#onedrive_create_submenu",TS.templates.menu_file_onedrive_doc_type_items(),TS.menu.file.onOneDriveDocumentTypeItemClick);TS.menu.has_submenu=true}if(m){var p=TS.templates.menu_file_cloud_service_items({should_show_box:o,should_show_dropbox:u,should_show_gdrive:d,should_show_onedrive:c});TS.menu.addSubmenu("#cloud_submenu",p,TS.menu.file.onNewFileOptionsItemClick);TS.menu.has_submenu=true}TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onNewFileOptionsItemClick);TS.kb_nav.setSubmitItemHandler(TS.menu.file.onNewFileOptionsItemClick);var h=n&&"primary_file_button"===n.attr("id");var g;if(TS.client&&h){g=function e(){TS.utility.contenteditable.focus(TS.client.msg_input.$input)};TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_button"}}})}TS.menu.start(t,false,{on_esc:g});TS.menu.$menu.attr("data-qa","file_menu");h?TS.menu.positionAt(n,1,-(TS.menu.$menu.height()+6)):TS.menu.positionAt(n,n.width()-TS.menu.$menu.width(),n.outerHeight()+10)},onGDriveDocumentTypeItemClick:function n(r){var i=$(r.target);var a=i.data("doc-type");var s=i.data("doc-display-type");if(!a)return;var o=TS.templates.loading_indicator();t.remove();e.append(o);TS.files.gdrive.createAndShare(a,s);TS.menu.file.end();e.toggleClass("active",true);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_gdrive_"+a.toLowerCase()}}})},onOneDriveDocumentTypeItemClick:function e(t){TS.log(9999,"boop");TS.log(9999,t)},onGDriveCreateComplete:function n(r,i){r&&i&&$("#allow_popups_banner").is(":visible")&&TS.client.ui.addEphemeralBotMsg({text:TS.interop.i18n.t("It looks like your browser is blocking popups so here\u2019s a link to your <{url}|document>","menu_file")({url:i.data.url}),ephemeral_type:"created_google_drive_document"});e.find(".ts_icon").remove();e.toggleClass("active",false).append(t)},onNewFileOptionsItemClick:function e(t){var n=$(this).closest("[data-which]");n.length||(n=$(t.target).closest("[data-which]"));var r=n.data("which");var i;if("choose"===r){t.preventDefault();TS.client.ui.files.$upload.trigger("click");TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_upload"}}})}else if("email"===r);else if("snippet"===r){t.preventDefault();TS.client.msg_input.startSnippet();TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_snippet"}}})}else if("post"===r)TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_post"}}});else if("box"===r){t.preventDefault();TS.files.openBoxChooser();TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_box"}}})}else if("dropbox"===r){t.preventDefault();TS.files.openDropboxChooser();TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_dropbox"}}})}else if("gdrive_import"===r){t.preventDefault();TS.files.gdrive.openPickerWindow();TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_gdrive"}}})}else if("gdrive_create_submenu"===r)t.preventDefault();else if("onedrive_import"===r){t.preventDefault();TS.files.onedrive.openPickerWindow();TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_onedrive"}}})}else if("cloud_submenu"===r)t.preventDefault();else if("space"===r){t.preventDefault();i=TS.utility.cmdKey(t);TS.files.createAndOpenNewSpace(null,i);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_space"}}})}else if("docs"===r){t.preventDefault();i=TS.utility.cmdKey(t);TS.files.createAndOpenNewArugula(null,i);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_docs"}}})}else{t.preventDefault();TS.warn("not sure what to do with clicked element:"+r)}TS.menu.file.end()},startWithFileFilter:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var r="all";TS.model.file_list_types&&(r=TS.model.file_list_types[0]);var i=TS.boot_data.feature_email_ingestion&&TS.prefs.getTeamPref("allow_email_ingestion")||TS.model.team.plan;TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_file_filter_items({active_type:r,show_email_item:i}));n?TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onSearchFileFilterItemClick):TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileFilterItemClick);TS.menu.start(t);n?TS.menu.positionAt($("#search_file_list_heading"),0,20):TS.menu.positionAt($("#file_list_container"),8,44)},onFileFilterItemClick:function e(t){t.preventDefault();TS.client.ui.files.filterFileList($(this).data("filetype"));TS.view.files.setButtonState($(this).data("filetype"));TS.menu.file.end()},onSearchFileFilterItemClick:function e(t){t.preventDefault();TS.search.setFiletypeFilter($(this).data("filetype"));TS.view.files.setButtonState($(this).data("filetype"));TS.menu.file.end()},startWithFileMemberPromiseFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();TS.menu.$menu.append(TS.templates.menu_file_member_filter());TS.menu.$menu.addClass("member_file_filter_menu");TS.menu.start(t);TS.menu.positionAt($("#file_list_toggle_user"),0,35);var n=new TS.SearchableMemberList({$container:$(".member_file_filter_menu .searchable_member_list"),id:"member_file_filter_menu",show_filter_bar:false,compact_results:true,prevent_member_click_handler:true,suppress_presence:true});n.showInitial();n.member_clicked_sig.add(function(e,t){TS.client.ui.files.toggleFileList(t.id);TS.menu.file.end()})},onFileMemberFilterItemClick:function e(t){t.preventDefault();var n=$(t.currentTarget).data("member-id");TS.client.ui.files.toggleFileList(n);TS.menu.file.end()},onSearchFileMemberFilterItemClick:function e(t){t.preventDefault();var n=$(t.currentTarget).data("member-id");TS.search.setMember(n);TS.menu.file.end()},file_list_menu_up:false,startWithFileActions:function e(t,n){if(TS.client&&!TS.redux.socket.isConnected()){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var r=TS.files.getFileById(n);if(!r)return;var i=TS.files.getFileActions(r);if(TS.boot_data.feature_file_threads){i.comment=false;i.rxn_file=false;i.pin_file=false;i.unpin_file=false}var a=$(t.target);var s=a.closest(".file_actions");i.comment&&s.data("exclude-comment")&&(i.comment=false);i.download&&s.data("exclude-download")&&(i.download=false);i.open_original&&s.data("exclude-original")&&(i.open_original=false);i.rxn_file&&s.data("exclude-rxn")&&(i.rxn_file=false);i.pin_file&&(s.data("exclude-pin")||s.data("exclude-pin-file"))&&(i.pin_file=false);i.unpin_file&&(s.data("exclude-pin")||s.data("exclude-unpin-file"))&&(i.unpin_file=false);i.edit&&s.data("exclude-edit")&&(i.edit=false);i.edit_title&&s.data("exclude-edit-title")&&(i.edit_title=false);i.print&&s.data("exclude-print")&&(i.print=false);i.create_public_link&&s.data("exclude-create-public-link")&&(i.create_public_link=false);i.revoke_public_link&&s.data("exclude-revoke-public-link")&&(i.revoke_public_link=false);i.star=true;i.open_in_flexpane=true;s.data("include-open-file-page")&&(i.open_file_page=true);s.data("include-view-public-link")&&(i.view_public_link=true);var o=a.closest(".file_list_item").length>0;if(o){"details"!==TS.model.ui_state.flex_name&&(i.share=false);TS.menu.file.file_list_menu_up=true}var l=a.closest(".inline_file_preview_container, .file_container");if(l.length>0){l.addClass("file_menu_open");i.new_window=false}TS.menu.$menu_header.addClass("hidden").empty();var u=false;(i.edit||TS.client&&i.edit_title||i.create_public_link||i.revoke_public_link||i.print||i.save_to_dropbox||i.refresh)&&(u=true);var d={file:r,actions:i,is_refreshing:TS.files.waiting_for_refresh[r.id],model_ob:TS.shared.legacyGetActiveModelOb(),show_workflow_divider:u,external_file_author:TS.files.isFileAuthorExternal(r)};if(TS.model.unread_view_is_showing){d.source_model_ob_id=a.closest(".unread_group").data("modelId");d.source_model_ob_id&&(d.model_ob=TS.redux.channels.getEntityById(d.source_model_ob_id))}TS.client&&(d.info_pane_visible="details"===TS.model.ui_state.flex_name);TS.menu.$menu_items.html(TS.templates.menu_file_action_items(d));TS.boot_data.feature_fix_files&&TS.menu.$menu.addClass("no_icons");TS.web?TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileActionClickWeb):TS.client&&TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileActionClickClient);TS.menu.start(t);a.closest(".file_list_item").addClass("active");TS.menu.positionAt(a,-(TS.menu.$menu.width()+6),0);TS.menu.keepInBounds()},onFileActionClickClient:function e(t){var n=$(this).attr("id");var r=$(this).data("rxn-key");var i=TS.files.getFileById($(this).data("file-id"));var a=TS.shared.legacyGetActiveModelOb();var s=$(this).data("sourceModelId");TS.model.unread_view_is_showing&&s&&(a=TS.redux.channels.getEntityById(s));if(!i){TS.error("no file id:"+$(this).data("file-id"));return}if("share_file"===n){t.preventDefault();TS.view.files.shareInCurrentChannelOrIM(i.id,s)}else if("edit_file_snippet"===n){if(!i.is_truncated){t.preventDefault();TS.ui.snippet_dialog.startEdit(i.id)}}else if("edit_file_post"===n);else if("edit_file_space"===n||"open_new_window"===n)TS.client.windows.openFileWindow(i.id)&&t.preventDefault();else if("edit_file_arugula"===n);else if("edit_file_title"===n){t.preventDefault();if(TS.boot_data.feature_file_threads)TS.redux.dispatch(TS.interop.redux.actions.openRenameFileDialog({file:i}));else{TS.client.ui.files.previewFile(i.id,"file_list");TS.files.editFileTitle(i.id)}}else if("delete_file"===n){t.preventDefault();TS.view.files.delete(i.id)}else if("create_public_link"===n){t.preventDefault();if(TS.prefs.getTeamPref("disallow_public_file_urls")){var o;o=TS.boot_data.feature_external_files?TS.interop.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this file.","menu_file")():TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(o);return}TS.files.createPublicURL(i,function(e,t){if(e){TS.model.previewed_file_id&&$("#file_preview_scroller").find(".file_actions_link").scrollintoview({duration:500,offset:"top",px_offset:-50});$(".file_public_link_"+i.id).highlightText();TS.ui.file_share.fileShowPublicUrlDialog(t.file)}})}else if("revoke_public_link"===n){t.preventDefault();TS.ui.file_share.fileRevokePublicLink(i.id)}else if("view_public_link"===n){t.preventDefault();TS.ui.file_share.fileShowPublicUrlDialog(i)}else{if("refresh_file"===n){t.preventDefault();TS.files.refreshFile(i.id);TS.menu.$menu.find("#refresh_file .item_label").text(TS.interop.i18n.t("Refreshing...","menu_file")()).end();return}if("download_file"===n){var l=!(TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing);TS.client&&TS.client.downloads.startDownload(i,l)&&t.preventDefault()}else if("open_original_file"===n);else if("comment_file"===n){t.preventDefault();TS.model.previewed_file_id!=i.id?TS.client.ui.files.previewFile(i.id,"file_list",false,true):TS.utility.contenteditable.focus($("#file_comment"))}else{if("save_to_dropbox"===n){var u=function e(t,n){t&&Dropbox.save(n.url,i.name)};return TS.api.callImmediately("files.getTempURL",{file:i.id}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;u(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;u(i,t,n,r);return{data:t,args:n,request_id:r}})}if("rxn_file"===n){t.preventDefault();TS.ui.react_emoji_menu.start({e:t,rxn_key:r})}else if("share_private_file"===n){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("pin_file"===n&&a){t.preventDefault();TS.pins.startPinFile(i.id,a)}else if("unpin_file"===n&&a){t.preventDefault();TS.pins.unPinFile(i.id,a)}else if("open_in_flexpane"===n){t.preventDefault();TS.client.ui.files.previewFile(i.id)}else if("copy_file_link"===n){t.preventDefault();TS.clipboard.writeText(i.permalink);var d=TS.interop.members.getMemberById(i.user);var c={};if(d&&d.is_bot){var _=d.profile.bot_id;var m=TS.interop.bots.getBotById(_);c.app_id=m?m.app_id:"";c.bot_id=_}TS.interop.clog.track("MSG_LINK_COPY",c)}else{if("star_file"!==n){t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}t.preventDefault();TS.stars.checkForStarClick(t)}}}TS.menu.file.end()},onFileActionClickWeb:function e(t){var n=$(this).attr("id");var r=$(this).data("rxn-key");var i=TS.files.getFileById($(this).data("file-id"));var a=TS.shared.legacyGetActiveModelOb();if(!i){TS.error("no file id:"+$(this).data("file-id"));return}if("share_file"===n){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("share_private_file"===n){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("edit_file_snippet"===n);else if("edit_file_post"===n);else if("edit_file_space"===n||"open_new_window"===n);else if("edit_file_title"===n);else if("delete_file"===n){t.preventDefault();TS.web.file.deleteFile(i.id)}else if("create_public_link"===n){t.preventDefault();if(!TS.prefs.getTeamPref("disallow_public_file_urls")){var s=function e(t,n){if(t){var r=$(".file_public_link_shared");r.slideToggle(100);TS.files.upsertAndSignal({id:i.id,public_url_shared:true});0===r.length&&TS.ui.file_share.fileShowPublicUrlDialog(i)}else if(n.error&&"not_allowed"===n.error){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",true);var a;a=TS.boot_data.feature_external_files?TS.interop.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this file.","menu_file")():TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(a)}};TS.api.callImmediately("files.sharedPublicURL",{file:i.id}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})}}else if("revoke_public_link"===n){t.preventDefault();TS.web.file?TS.web.file.revokePublicURL(i):TS.ui.file_share.fileRevokePublicLink(i.id)}else if("view_public_link"===n){t.preventDefault();TS.ui.file_share.fileShowPublicUrlDialog(i)}else{if("refresh_file"===n){t.preventDefault();TS.files.refreshFile(i.id);TS.menu.$menu.find("#refresh_file .item_label").text("Refreshing...").end();return}if("download_file"===n);else if("print_file"===n){window.print();t.preventDefault()}else if("open_original_file"===n);else if("comment_file"===n){t.preventDefault();TS.utility.contenteditable.focus($("#file_comment"))}else{if("save_to_dropbox"===n){var o=function e(t,n){t&&Dropbox.save(n.url,i.name)};return TS.api.callImmediately("files.getTempURL",{file:i.id}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})}if("rxn_file"===n){t.preventDefault();TS.ui.react_emoji_menu.start({e:t,rxn_key:r})}else if("pin_file"===n&&a){t.preventDefault();TS.pins.startPinFile(i.id,a)}else if("unpin_file"===n&&a){t.preventDefault();TS.pins.unPinFile(i.id,a)}else if("copy_file_link"===n){t.preventDefault();TS.clipboard.writeText(i.permalink)}else if("open_file_page"!==n){t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}}}TS.menu.file.end()},clean:function e(){TS.menu.clean()},end:function e(){TS.menu.end()}});var e=$('[data-js="primary_file_button"]');var t=e.find(".ts_icon_plus_thick")})()},11249:function(e,t){(function(){TS.registerModule("menu.group",{onStart:function e(){},group:null,startWithGroup:function t(n,r){if(TS.menu.isRedundantClick(n))return;if(TS.client.ui.checkForEditing(n))return;TS.model.menu_is_showing||(e=void 0);TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.group.group=TS.interop.channels.getGroupById(r);var i=TS.menu.group.group;var a=TS.prefs.getTeamPref("allow_email_ingestion");TS.menu.$menu_header.addClass("hidden").empty();var s={group:i,user:TS.model.user,show_email_item:a,leave_action:TS.interop.rules.channels.getLeaveAction(TS.redux.getState(),i),show_export_history:TS.permissions.members.canExportMessageHistory(i)};0!==i.purpose.last_set||TS.model.user.is_ultra_restricted||(s.show_purpose_item=true);TS.notifs.isCorGMuted(i.id)&&(s.group_is_muted=true);s.show_advanced_item=true;if(TS.boot_data.page_needs_enterprise){var o=TS.permissions.members.canCreateConvertOrgSharedChannels();o?s.show_advanced_item=true:i.creator!==TS.model.user.id&&i.is_org_shared&&(s.show_advanced_item=false)}TS.permissions.channels.canSeeDataRetentionChannelOption(i)&&(s.show_message_retention=true);TS.apps.permissions.areXoxaAppsInstalled()&&(s.show_add_apps=true);TS.menu.$menu_items.html(TS.templates.menu_group_items(s));TS.menu.$menu_header.bind("click.menu",TS.menu.group.onGroupHeaderClick);TS.menu.$menu_items.on("click.menu","li",TS.menu.group.onGroupItemClick);TS.menu.start(n);TS.menu.$menu.attr("data-qa","group_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs();$("#menu_group_topic_input").bind("keydown",TS.menu.handleTopicKeydown);var l="#channel_name";var u="#channel_actions_toggle";e||(e=$(n.target).closest(l).length);var d=e?$(l):$(u);var c=d.height();var _=e?c+6:c;var m=18;var f=e?m:6;TS.menu.positionAt(d,f,_)},onGroupHeaderClick:function e(t){t.preventDefault()},onGroupItemClick:function e(t){var n=$(this).attr("id");if($(this).hasClass("disabled")){TS.menu.end();return}if("group_display_item"===n){t.preventDefault();TS.groups.legacyDisplayGroup({id:TS.menu.group.group.id})}else if("group_details_item"===n){t.preventDefault();TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name?$("#details_tab").highlight(null,"channel_page_details_highlighter"):TS.client.ui.flex.openFlexTab("details")}else if("group_star_item"===n){t.preventDefault();TS.stars.checkForStarClick(t)}else if("group_mute_item"===n){t.preventDefault();TS.notifs.muteOrUnmuteCorG(TS.menu.group.group.id)}else if("group_email_item"===n);else if("group_files_item"===n){TS.client.ui.flex.openFlexTab("search");TS.search.setFilter("files");TS.view.resizeManually("TS.key_triggers");var r="in:"+TS.shared.legacyGetActiveModelOb().name+" ";TS.search.setInputVal(r)}else if("group_leave_item"===n){t.preventDefault();TS.channels.leave(TS.menu.group.group.id)}else if("group_unarchive_item"===n){t.preventDefault();TS.api.call("conversations.unarchive",{channel:TS.menu.group.group.id})}else if("group_archives_item"===n);else{if("group_jump_item"===n){t.preventDefault();TS.menu.startWithDatePicker(t);return}if("group_advanced_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id)}else if("group_convert_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"manage_teams")}else if("group_invite_item"===n){t.preventDefault();TS.ui.channel_invite_modal.startInviteToChannelModal(TS.menu.group.group.id)}else if("group_prefs"===n){t.preventDefault();TS.ui.channel_prefs_dialog.start(TS.menu.group.group.id)}else if("group_message_retention"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"retention")}else if("group_export_history"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"export")}else if("group_add_service_item"===n);else{if("group_add_apps_item"!==n){TS.warn("not sure what to do with clicked element id:"+n);return}t.preventDefault();TS.ui.apps_browser.startAddApps()}}TS.menu.end()}});var e})()},11250:function(e,t){(function(){TS.registerModule("menu.member",{member:null,member_item_click_sig:new signals.Signal,onStart:function n(){e=new TS.PresenceList;t=TS.interop.mountToast},startWithMember:function t(s,l,u,d,c){if(TS.menu.isRedundantClick(s))return;if(TS.client.ui.checkForEditing(s))return;TS.model.menu_is_showing||(n=void 0);TS.menu.buildIfNeeded();TS.menu.member.member=TS.interop.members.getMemberById(l);var m=TS.menu.member.member;if(!m)return;if(!TS.permissions.members.canUserSeeMember(m))return;if(m.is_bot&&_.get(m.profile,"bot_id"))return TS.menu.app.startWithApp(s,_.get(m.profile,"bot_id"),_.get(m,"team_id",null),false,false,c);TS.menu.clean();e.add(l);TS.menu.menu_closed_sig.addOnce(function(){e.clear()});var f=r(m,{is_header_menu:d,is_im_menu:c});TS.boot_data.feature_tinyspeck&&(f.user_mc_url=o(m));if(f.channel_kick_name&&f.channel_kick_hidden){var p=TS.shared.legacyGetActiveModelOb();TS.interop.membership.ensureChannelMembershipIsKnownForUsers(p.id,[m.id]).then(function(){if(!TS.model.menu_is_showing)return;if(TS.menu.last_e!==s)return;var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(p.id,m.id);e.is_member&&TS.menu.$menu_items.find("#member_kick_channel_item").removeClass("hidden")})}if(c)TS.menu.$menu_header.addClass("hidden").empty();else{TS.menu.$menu_header.html(TS.templates.menu_member_header(f));TS.client.flex_pane.startLocalTimeInterval()}m.is_stranger&&!TS.redux.channels.getImByMemberId(m.id)||TS.menu.$menu_items.html(TS.templates.menu_member_items(f));c||m.deleted||TS.interop.clog.track("USER_CARD_DISPLAY",{});if(l==TS.model.user.id){var h="";c||(h+=TS.templates.menu_member_footer({member:m}));TS.menu.$menu_footer.html(h)}else c||TS.menu.$menu_footer.html(TS.templates.menu_member_footer({member:m}));TS.menu.start(s,u);var g=false;var S=$("#menu_member_dm_input");var T=TS.interop.members.getPrefCompliantMemberName(m,true);var v=TS.interop.i18n.t("Message {name}","menu")({name:T});TS.utility.contenteditable.create(S,{modules:{tabcomplete:{searchOptions:{complete_member_specials:false},completers:["channels","emoji","members"],positionMenu:function e(t){t.style.width=S.outerWidth()+"px";t.style.minWidth="0";TS.tabcomplete.positionUIRelativeToInput(t,S)}}},singleLineInput:true,onEnter:function e(t){var n=_.trim(TS.utility.contenteditable.value(S));if(!_.keys(t).length&&!g&&n.length){TS.ims.legacyStartImByMemberId(m.id,false,n);TS.menu.member.end();g=true;TS.interop.clog.track("USER_CARD_DM",{})}return false},onEscape:function e(){TS.menu.end()},placeholder:v,ariaLabel:v.replace(/&#39;/g,"'")});TS.utility.contenteditable.enable(S);m.is_self&&TS.menu.$menu_header.find(".member_timezone_value a").on("click.timezone",function(e){e.preventDefault();TS.menu.member.end()});TS.menu.$menu_header.bind("click.menu",i);TS.menu.$menu_items.on("click.menu","li",a);TS.kb_nav.setSubmitItemHandler(a);if(c){var b="#channel_name";var y="#channel_actions_toggle";n||(n=$(s.target).closest(b).length);var w=n?$(b):$(y);var k=w.height();var x=n?k+6:k;var C=18;var M=n?C:6;TS.menu.positionAt(w,M,x);TS.menu.$menu.attr("data-qa","member_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs()}c||TS.menu.keepInBounds()},startWithMemberPreview:function e(t,n,r,i){if(TS.menu.isRedundantClick(t))return;if(TS.client&&TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var s=$(t.target).closest(".member_preview_menu_target");n||(n=s.closest("[data-member-id]").data("member-id"));TS.menu.member.member=TS.interop.members.getMemberById(n);var l=TS.menu.member.member;var u=TS.redux.channels.getImByMemberId(n);var d={member:l,is_team_directory:true,im_id:u&&u.id,hide_view_profile:i,show_user_id:true,can_write_to_clipboard:TS.clipboard.canWriteText(),member_is_self:l.is_self};TS.boot_data.feature_tinyspeck&&(d.user_mc_url=o(l));TS.menu.$menu_header.addClass("hidden").empty();if(!l.deleted&&!l.is_slackbot&&n!=TS.model.user.id&&!TS.interop.members.isExternal(l)){TS.model.user.is_ultra_restricted||l.is_ultra_restricted||(d.show_channel_invite=true);if(TS.boot_data.page_needs_enterprise){var c=TS.model.team;c&&c.id!==l.team_id&&(d.show_call_action=false)}}if(r)TS.menu.$menu_items.html(TS.templates.menu_member_items_short(d));else{TS.menu.$menu_items.html(TS.templates.menu_member_items(d));TS.menu.$menu_items.on("click.menu","li",{is_member_preview:i},a)}TS.menu.start(t);TS.kb_nav.setSubmitItemHandler(a);var _=s.outerWidth()-TS.menu.$menu.width()-1;TS.menu.positionAt(s,_,s.outerHeight()+5);TS.menu.keepInBounds()},startWithEditMemberProfilePhotoActions:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var r=true===TS.model.user.profile.is_custom_image;var i=$(t.target);var a=i.is(".btn");var s={show_delete:r&&!a,is_iOS:TS.model.is_iOS};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_edit_member_profile_photo_action_items(s));TS.menu.$menu_items.on("click.menu","li",n);TS.menu.start(t);a?TS.menu.positionAt(i,0,i.outerHeight()+5):TS.menu.positionAt(i.closest('[data-action="edit_member_profile_photo_menu"]'),36,156);TS.menu.keepInBounds()},startWithEnterpriseMemberHeader:function e(t){var n=15;if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var r={enterprise_name:$("[data-enterprise-name]").val(),signout_url:TS.boot_data.signout_url};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_enterprise_member_header(r));TS.menu.$menu_items.on("click.menu","li",s);TS.kb_nav.setSubmitItemHandler(s);TS.menu.start(t);var i=$("[data-header-menu-toggle]");var a=-TS.menu.$menu.outerWidth()+i.outerWidth();var o=i.outerHeight()+n;TS.menu.positionAt(i,a,o);t.preventDefault()},end:function e(){TS.menu.member.member=null;TS.menu.end()},test:function e(){var e={};Object.defineProperty(e,"_getTemplateArguments",{get:function e(){return r},set:function e(t){r=t}});return e}});var e;var t;var n;var r=function e(t,n){n=n||{};var r={member:t,show_dm_item:!n.is_im_menu,show_email_item:TS.prefs.getTeamPref("allow_email_ingestion"),is_im_menu:n.is_im_menu,show_admin_info:t.is_admin&&t.team_id===TS.model.user.team_id,can_write_to_clipboard:TS.clipboard.canWriteText(),member_is_self:t.is_self};if(n.is_im_menu){var i=TS.redux.channels.getImByMemberId(t.id);r.im=i;!TS.apps.permissions.areXoxaAppsInstalled()||TS.interop.rules.channels.isSlackbot(i)||t.deleted||(r.show_add_apps=true)}if(n.is_header_menu&&t.id===TS.model.user.id){r.other_accounts=TS.boot_data.other_accounts;r.logout_url=TS.boot_data.logout_url;r.signin_url=TS.boot_data.signin_url}t.deleted||t.is_slackbot||t.id===TS.model.user.id||TS.interop.members.isExternal(t)||TS.model.user.is_ultra_restricted||t.is_ultra_restricted||(r.show_channel_invite=true);var a=TS.shared.legacyGetActiveModelOb();if(TS.permissions.channels.canMemberBeRemovedFromChannel(a,t)){var s=TS.interop.membership.getCachedChannelMembershipInfoForUser(a.id,t.id);var o={show_tooltip:false,inherit_font_size:true};if(s.is_known)s.is_member&&(r.channel_kick_name=new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(a,o)));else{r.channel_kick_name=new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(a,o));r.channel_kick_hidden=true}}if("USLACKBOT"===t.id){var l=false;TS.model.user.is_admin?l=true:TS.prefs.getTeamPref("slackbot_responses_disabled")||TS.prefs.getTeamPref("slackbot_responses_only_admins")||(l=true);r.show_slackbot_responses_item=l}if(TS.utility.calls.isEnabled()&&!t.is_bot&&"USLACKBOT"!==t.id){r.show_call_action=true;t._is_local||(r.show_call_action=false)}TS.permissions.channels.canSeeDataRetentionChannelOption(a)&&(r.show_dm_retention=true);r.show_export_history=TS.permissions.members.canExportMessageHistory(a);return r};var i=function e(t){t.preventDefault();TS.client.ui.previewMember(TS.menu.member.member.id,"menu_member_header");TS.interop.clog.track("USER_CARD_CLICK");TS.menu.member.end()};var a=function e(t){var n=$(this).attr("id");clearTimeout(TS.menu.end_time);if("member_photo_item"===n);else if("member_details_item"===n){t.preventDefault();TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name?$("#details_tab").highlight(null,"channel_page_details_highlighter"):TS.client.ui.flex.openFlexTab("details")}else if("member_dm_retention"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.shared.legacyGetActiveModelOb().id,"retention")}else if("member_export_history"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.shared.legacyGetActiveModelOb().id,"export")}else if("member_archives_item"===n);else{if("member_jump_item"===n){t.preventDefault();TS.menu.startWithDatePicker(t);TS.menu.member.member_item_click_sig.dispatch(n);return}if("member_star_item"===n){t.preventDefault();TS.stars.checkForStarClick(t)}else if("member_email_item"===n);else if("member_skype_item"===n);else if("member_account_item"===n);else if("member_prefs_item"===n){t.preventDefault();TS.generic_dialog.is_showing&&TS.generic_dialog.cancel();TS.ui.prefs_dialog.start()}else if("member_files_item"===n){t.preventDefault();TS.view.files.clearFilter();TS.client.ui.files.filterFileList(TS.menu.member.member.id)}else if("member_im_files_item"===n){TS.client.ui.flex.openFlexTab("search");TS.search.setFilter("files");TS.view.resizeManually("TS.key_triggers");var r="in:"+TS.shared.legacyGetActiveModelOb().name+" ";TS.search.setInputVal(r)}else if("member_dm_item"===n){t.preventDefault();TS.ims.legacyStartImByMemberId(TS.menu.member.member.id)}else if("member_invite_channel_item"===n){t.preventDefault();if(TS.client.channel_page.members_dialog.isShowing()){var i=TS.generic_dialog.current_setting;TS.generic_dialog.cancel()}TS.ui.invite.showInviteMemberToChannelDialog(TS.menu.member.member.id);i&&TS.generic_dialog.start(i)}else if("member_create_group_item"===n){t.preventDefault();TS.ui.new_channel_modal.start("",false,[TS.menu.member.member.id])}else if("member_profile_item"===n){t.preventDefault();if(TS.menu.member.member.is_self){TS.generic_dialog.is_showing&&TS.generic_dialog.cancel();TS.ui.edit_member_profile.start()}else TS.client.ui.previewMember(TS.menu.member.member.id)}else{if("member_presence"===n){t.preventDefault();TS.redux.presence.toggleUserPresence();TS.menu.end_time=setTimeout(function(){TS.menu.member.end();TS.menu.member.member_item_click_sig.dispatch(n)},1e3);return}if("logout"===n){t.preventDefault();TS.client&&TS.client.windows.closeAll();TS.utility.loadUrlInWindowIfOnline(TS.boot_data.logout_url)}else if($(this).hasClass("switch_team")){t.preventDefault();var a=$(this).data("team-id");if(TSSSB.call("displayTeam",a))t.preventDefault();else{var s=$(this).find("a").attr("href");s&&-1==s.indexOf("?")&&$(this).find("a").attr("href",s+="?"+TS.getQsArgsForUrl())}}else if("member_kick_channel_item"===n){t.preventDefault();TS.model.active_channel_id?TS.channels.legacyKickMember(TS.model.active_channel_id,TS.menu.member.member.id):TS.model.active_group_id&&TS.groups.kickMember(TS.model.active_group_id,TS.menu.member.member.id)}else if("member_slackbot_responses"===n);else if("member_call_item"===n)TS.utility.calls.startCallInModelOb(TS.menu.member.member);else if("member_add_apps_item"===n){t.preventDefault();TS.ui.apps_browser.startAddApps()}else if("member_copy_id"===n)TS.clipboard.canWriteText()&&TS.clipboard.writeText(TS.menu.member.member.id);else if("member_copy_profile_url"===n){var o=TS.interop.enterprise.getOrgURL()+"user/@"+TS.menu.member.member.id;TS.clipboard.canWriteText()&&TS.clipboard.writeText(o);l()}else if("member_mc_link"!==n){t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}}}t.data&&t.data.is_member_preview?TS.interop.clog.track("USER_PROFILE_CLICK"):TS.interop.clog.track("USER_CARD_CLICK");TS.menu.member.end();TS.menu.member.member_item_click_sig.dispatch(n)};var s=function e(t){var n=$(this).attr("id");if("sign_out"===n)return;if("view_account"===n)return;t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n)};var o=function e(t){return"https://"+window.location.host+"/god/user.php?id="+t.id+"&team_id="+t.team_id};var l=function e(){var n;n=TS.boot_data.feature_enterprise_dm_deeplink?TS.interop.i18n.t("Copied to clipboard!","menu")():"Copied to clipboard!";t({children:n,icon:"check_circle_o",iconClassName:"sk_seafoam_green"})}})()},11251:function(e,t){var n=function(){function e(e,t){var n=[];var r=true;var i=false;var a=void 0;try{for(var s=e[Symbol.iterator](),o;!(r=(o=s.next()).done);r=true){n.push(o.value);if(t&&n.length===t)break}}catch(e){i=true;a=e}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();(function(){TS.registerModule("cmd_handlers",{server_cmds:null,onStart:function t(){var n=true;l=TS.utility.throttleFunc(l,3e3,n);TS.prefs.team_allow_calls_changed_sig.add(u);if(!_.get(window,"desktop.app.toggleDevTools")){delete TS.cmd_handlers["/slackdevtools"];delete TS.cmd_handlers["/slackgpuinfo"];delete TS.cmd_handlers["/slackmediainfo"];delete TS.cmd_handlers["/slackaccessibility"]}_.get(window,"desktop.stats.downloadCookies")||delete TS.cmd_handlers["/slackcookies"];_.get(window,"desktop.app.openTaskManager")||delete TS.cmd_handlers["/slacktaskmanager"];_.get(window,"desktop.stats.restartWithNetlog")||delete TS.cmd_handlers["/slacknetlog"];TS.client&&TS.client.traces.canTrace()||delete TS.cmd_handlers["/slacktrace"];TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&e.push("/"+TS.interop.i18n.t("active","cmd_handlers")());var r=TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts);r||delete TS.cmd_handlers["/redox"]},test:function e(){return{_maybeInviteUserToModelOb:g,_maybeInviteUserGroupToModelOb:S,_getUserIdentifier:T,_maybeUpdateAppsModel:d}},groupCmdsByType:function e(t){var n=[c(t),m(t),h(t)];var r=Array.prototype.concat.apply([],n);var i=r.filter(function(e){return e.cmds.length>0});return i},getAvailableUserCmds:function e(t){var n={};var r=TS.shared.legacyGetActiveModelOb();t=t||{};_.forOwn(TS.cmd_handlers,function(e,i){if(0!==i.indexOf("/"))return;if("function"===typeof e.autocomplete&&!e.autocomplete()||false===e.autocomplete||e.alias_of)return;if(t.in_thread&&!TS.cmd_handlers.isCmdSupportedInThreads(i))return;switch(i){case"/archive":case"/unarchive":if(TS.boot_data.page_needs_enterprise&&!_.get(TS.model.user,"enterprise_user.is_admin",false)&&TS.interop.rules.channels.isOrgDefaultChannel(r))return;if(TS.interop.rules.channels.isRequired(r))return;if(r.is_im)return;if(r.is_mpim)return;if((r.is_group||r.is_private)&&TS.model.user.is_restricted)return;if(r.is_channel&&!TS.permissions.members.canArchiveChannels())return;if(TS.interop.rules.channels.isExternallySharedChannel(r))return;break;case"/kick":case"/remove":if(r.is_archived)return;if(r.is_im)return;if(r.is_mpim)return;if(r.is_group&&!TS.permissions.members.canKickFromGroups())return;if(r.is_channel&&!TS.permissions.members.canKickFromChannels())return;break;case"/join":if(TS.model.user.is_restricted)return;break;case"/feed":if(TS.model.user.is_restricted)return;break;case"/invite":if(TS.model.user.is_ultra_restricted)return;break;case"/invite_people":if(!TS.ui.admin_invites.canInvite())return;break;case"/topic":case"/purpose":if(r.is_im)return;if(r.is_mpim)return;if(TS.model.user.is_restricted)return;if(TS.interop.rules.channels.isRequired(r)&&!TS.permissions.members.canPostInChannel(r))return;break;case"/leave":if(r.is_group||r.is_private)return;break;default:break}if(("custom"===e.type||"service"===e.type)&&TS.prefs.commands_only_regular&&TS.model.user.is_restricted)return;n[i]=e});return n},parseArgs:function e(t){var n=t;t=TS.interop.texty.convertContentsStringForSlashCommands(t,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());var r={cmd:"",rest:"",words:[]};if(!_.isString(t))return r;var i=t.trim();if(!i)return r;r.words=i.split(/\s+/);r.cmd=r.words[0].toLowerCase().replace(/\u2019/g,"'");r.disp=r.words[0];r.rest=i.substring(r.cmd.length).trim();r.original_txt=n;return r},setUpCmds:function e(){if(!TS.boot_data.page_needs_custom_cmds){u();return Promise.resolve()}a();if(o()){var t=TS.storage.fetchCmds();TS.model.did_we_load_with_cmd_cache=true;TS.cmd_handlers.mergeInServerCmds(t.data);u();TS.apps.permissions.areXoxaAppsInstalled()&&p(t.data);return Promise.resolve()}var n=true;return TS.api.call("commands.list",{},null,n).then(function(e){if(!e.data.commands)return;s(e.data.commands,e.data.cache_ts)}).catch(_.noop)},removeCommand:function e(t,n){delete TS.cmd_handlers.server_cmds[t];s(TS.cmd_handlers.server_cmds,n)},updateCommand:function e(t,n){TS.cmd_handlers.server_cmds[t.name]=t;s(TS.cmd_handlers.server_cmds,n)},resetUpCmds:function e(){TS.storage.storeCmds("");l()},getCmdAppUserIds:function e(){return i},sortNames:function e(t){var n=t.sort(TS.interop.i18n.sorter);function r(e,t){return e.filter(function(e){return-1!==t.indexOf(TS.cmd_handlers[e].type)})}var i=r(n,["client","core"]);var a=r(n,["custom"]);var s=r(n,["app","service"]);var o=s.filter(function(e){var t=TS.cmd_handlers[e];return!!(t.app||t.service_name)});o.sort(function(e,t){var n=TS.cmd_handlers[e];var r=TS.cmd_handlers[t];var i=n.service_name||TS.model.apps[n.app].name;var a=r.service_name||TS.model.apps[r.app].name;return TS.interop.i18n.sorter(i,a)});var l=s.filter(function(e){var t=TS.cmd_handlers[e];return!(t.app||t.service_name)});l.sort();var u=[].concat(i,a,o,l);return u},getAppNameForCmdName:function e(t){var n=TS.cmd_handlers[t];if(!n)return"";var r;n.app&&TS.model.apps[n.app]?r=TS.model.apps[n.app].name:n.service_name&&(r=n.service_name);return r},mergeInServerCmds:function e(t){TS.cmd_handlers.server_cmds=t;var n;for(var r in TS.cmd_handlers){if(0!==r.indexOf("/"))continue;"client"===TS.cmd_handlers[r].type?delete TS.cmd_handlers[r].override:delete TS.cmd_handlers[r]}for(n in t){if(0!==n.indexOf("/"))continue;if(TS.cmd_handlers[n]&&!TS.cmd_handlers[n].can_be_overridden_by_server_cmd){TS.cmd_handlers[n].override=true;continue}TS.cmd_handlers[n]=TS.cmd_handlers.makeInternalCmdObject(t[n])}for(n in t){if(0!==n.indexOf("/"))continue;if(!TS.cmd_handlers[n].alias_of)continue;var i=TS.cmd_handlers[TS.cmd_handlers[n].alias_of];if(!i)continue;if("client"===i.type)continue;i.aliases||(i.aliases=[]);i.aliases.push(n)}},makeInternalCmdObject:function e(t){return{autocomplete:true,alias_of:t.alias_of?t.alias_of:null,aliases:null,usage:t.usage||"",desc:t.desc||"",help_text:t.help_text||"",type:t.type||"",app:t.app||"",service_name:t.service_name||"",normalized:TS.interop.i18n.deburr(t.name),canonical_name:t.canonical_name||null}},addEphemeralFeedback:function e(t,n){n=_.defaults(n,{temporary:true});var r={text:t};n.input_txt&&(n.c_id&&n.thread_ts?TS.utility.populateThreadInputs(n.input_txt,n.c_id,n.thread_ts):TS.utility.contenteditable.value(TS.client.ui.$msg_input,n.input_txt));n.temporary||(n.c_id&&n.thread_ts?TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",n.c_id):TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid));n.temporary&&(r.ephemeral_type="temp_slash_cmd_feedback");n.slackbot_feels&&(r.slackbot_feels=n.slackbot_feels);if(n.c_id&&n.thread_ts){r.channel=n.c_id;r.thread_ts=n.thread_ts;n.temporary&&(r.ephemeral_type="threads_temp_slash_cmd_feedback")}n.temporary?TS.client.ui.addOrFlashEphemeralBotMsg(r):TS.client.ui.addEphemeralBotMsg(r)},runCommand:function e(t,n,r){if(!TS.cmd_handlers[t.cmd])return;if(n&&!TS.cmd_handlers.isCmdSupportedInThreads(t.cmd)){TS.cmd_handlers.sendCmdNotSupportedInThreadsMsg(t.cmd,t.original_txt,n,r);return}TS.model.last_active_cid&&TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.last_active_cid);var i=t.cmd;TS.cmd_handlers[t.cmd].canonical_name&&(i=TS.cmd_handlers[t.cmd].canonical_name);"client"===TS.cmd_handlers[t.cmd].type&&TS.interop.clog.track("BUILTIN_CHAT_COMMAND_CALLED",{locale:TS.interop.i18n.locale,slash_command_canonical_name:i,slash_command_name:t.cmd});TS.cmd_handlers[t.cmd].func(t.cmd,t.rest,t.words,t.original_txt,n,r)},isCmdSupportedInThreads:function t(n){return n&&_.includes(e,n)},sendCmdNotSupportedInThreadsMsg:function e(t,n,r,i){var a;a=TS.cmd_handlers[t]?TS.interop.i18n.t("*{cmd}* is not supported in threads. Sorry!","threads")({cmd:t}):TS.interop.i18n.t("*{cmd}* is not a valid command.","threads")({cmd:t});TS.cmd_handlers.addEphemeralFeedback(a,{input_txt:n,slackbot_feels:"sad_surprise",c_id:i.id,thread_ts:r.ts})},"/slacknetlog":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;if(!window.desktop.stats||!window.desktop.stats.restartWithNetlog)return;window.desktop.stats.restartWithNetlog()}},"/slackaccessibility":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;TS.utility.window.open({url:"chrome://accessibility/",try_window_open_in_ssb:true})}},"/slackcookies":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!_.get(window,"desktop.stats.downloadCookies"))return;desktop.stats.downloadCookies({showItemInFolder:true})}},"/slackgpuinfo":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;TS.utility.window.open({url:"chrome://gpu/",try_window_open_in_ssb:true})}},"/slackmediainfo":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;TS.utility.window.open({url:"chrome://media-internals/",try_window_open_in_ssb:true})}},"/slackdevtools":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!_.get(window,"desktop.app.toggleDevTools"))return;var t=false;desktop.app.toggleDevTools(t)}},"/slacktaskmanager":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!TS.model.is_our_app)return;if(!window.desktop.app||!window.desktop.app.openTaskManager)return;desktop.app.openTaskManager()}},"/slackdebuglag":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(t,r,i){if(3!==i.length){TS.cmd_handlers.addEphemeralFeedback("usage: /slackdebuglag [api response delay in milliseconds] [flannel delay in milliseconds]");return}var a=i.slice(1),s=n(a,2),o=s[0],l=s[1];TS.api.debugSetResponseDelay(o);TS.interop.Flannel.debugSetResponseDelay(l);TS.cmd_handlers.addEphemeralFeedback("OK, every API call will be delayed by "+o+" ms, and every Flannel call by "+l+" ms.")}},"/slackdebugunreads":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){var t=TS.interop.redux.models.channels.getAllChannels(TS.redux.getState());if(!t||!Object.keys(t).length){var n="/slackdebugunreads: Could not get list of model objects for user. :(";TS.warn(n);TS.cmd_handlers.addEphemeralFeedback(n);return}var r=[];var i=0;var a=0;_.each(t,function(e){if(!e.unread_cnt)return;var t;t=e.is_group?"group":e.is_mpim?"mpim":e.is_im?"im":e.is_channel?"channel":"unknown";if((e.unread_cnt||e.unread_highlight_cnt)&&t){i+=1;r.push([">","`"+e.id+"`","group"===t||"mpim"===t?" ("+t+"):":":",e.unread_cnt?" unread"+(e.is_im||e.is_mpim?" (highlight)":"")+" = "+e.unread_cnt:"",e.unread_highlight_cnt?", highlight = "+e.unread_highlight_cnt:"",TS.notifs.isCorGMuted(e.id)?" (muted)":""].join(""));a+=e.unread_cnt}else{var s="/slackdebugunreads: bad type for channel id "+e.id+"? ("+t+")";TS.warn(s);TS.cmd_handlers.addEphemeralFeedback(n)}});a||r.push("No unreads found across "+t.length+" channels??");var s=TS.model.all_unread_highlights_cnt;var o=TS.model.all_unread_cnt;r=["\ud83d\udd75\ufe0f \ud83d\udcd6 *Unreads Report for user @"+TS.model.user.name+" (`"+TS.model.user.id+'`) in workspace "'+_.escape(TS.model.team.name)+'" (`'+TS.model.team.id+"`)*","> "+a+" unreads across "+i+(1===i?" channel":" channels"),"> TS.model.threads_has_unreads: "+TS.model.threads_has_unreads+" (TS.model.all_unread_cnt++ when true), TS.model.threads_mention_count: "+TS.model.threads_mention_count].concat(r);if(TS.model.is_our_app){if(TS.boot_data.page_needs_enterprise&&TS.model.team&&TS.model.team.enterprise_id&&TS.boot_data.other_accounts){if(TS.model.all_unread_highlights_cnt_to_exclude){r.push("> TS.model.all_unread_highlights_cnt_to_exclude = "+TS.model.all_unread_highlights_cnt_to_exclude);s=Math.max(0,s-TS.model.all_unread_highlights_cnt_to_exclude)}if(TS.model.all_unread_cnt_to_exclude){r.push("> TS.model.all_unread_cnt_to_exclude = "+TS.model.all_unread_cnt_to_exclude);o=Math.max(0,o-TS.model.all_unread_cnt_to_exclude)}}r.push("> SSB setBadgeCount details: all_unread_highlights_cnt = "+s+", all_unread_cnt = "+o+", bullet = "+(!window.winssb||!TS.prefs.getPref("mac_ssb_bullet")?"false":"true"))}r=r.join("\n");TS.cmd_handlers.addEphemeralFeedback(r);TS.info(r)}},"/slackdebugwidget":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!TS.debug_widget)return;TS.debug_widget.toggle()}},"/slacktrace":{type:"client",autocomplete:function e(){return TS.client&&TS.client.traces.canTrace()&&TS.boot_data.feature_tinyspeck},alias_of:null,aliases:null,desc:TS.interop.i18n.t("Submit a performance profile to Slack","cmd_handlers")(),func:function e(t,n,r){if(!TS.client||!TS.client.traces.canTrace())return;if(r.length>1&&"ui"===r[1]){if(!_.get(window,"desktop.stats.openTraceDialog"))return;desktop.stats.openTraceDialog();return}TS.client.traces.startTrace(parseInt(n,10),{reason:"slashcommand"});TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Thank you for submitting a performance profile to Slack!","cmd_handlers")())}},"/away":{localized:"/"+TS.interop.i18n.t("away","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t('Toggle your "away" status',"cmd_handlers")(),func:function e(t,n,r,i,a,s){TS.redux.presence.toggleUserPresence().then(function(e){var t=e.args.presence||TS.redux.presence.getPresenceByMemberId(TS.model.user.id);var n;n="away"===t?":white_check_mark: "+TS.interop.i18n.t("You are now marked as *away*.","cmd_handlers")():":white_check_mark: "+TS.interop.i18n.t("You are now marked as *active*.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(n,{temporary:false,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(n,{temporary:false})}).catch(_.noop);n&&TS.members.setUserStatus(n)}},"/prefs":{localized:"/"+TS.interop.i18n.t("prefs","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Open the preferences dialog","cmd_handlers")(),func:function e(){TS.ui.prefs_dialog.start()}},"/shortcuts":{localized:"/"+TS.interop.i18n.t("shortcuts","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/keys"],localized_aliases:["/"+TS.interop.i18n.t("keys","cmd_handlers")()],desc:TS.interop.i18n.t("Open the keyboard shortcuts dialog","cmd_handlers")(),func:function e(){TS.boot_data.feature_shortcuts_flexpane?TS.ui.react_keyboard_shortcuts.toggleShortcutsFlexpane():TS.ui.shortcuts_dialog.start()}},"/keys":{localized:"/"+TS.interop.i18n.t("keys","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/shortcuts",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/shortcuts"].func()}},"/open":{localized:"/"+TS.interop.i18n.t("open","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/join"],localized_aliases:["/"+TS.interop.i18n.t("join","cmd_handlers")()],desc:TS.interop.i18n.t("Open a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("channel","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){if(1==r.length)TS.ui.channel_browser.start();else{var o=_.trim(i.substr(t.length));var l=TS.interop.texty.convertContentsStringToDisplayString(o);l=TS.utility.cleanChannelName(l);var u=TS.redux.channels.getPublicOrPrivateChannelByName(l);if(u&&u.is_channel){if(u.is_member)TS.channels.legacyDisplayChannel({id:u.id});else if(!TS.model.user.is_restricted){var d=function e(t,n){if(!t){var r=TS.interop.i18n.t("There was a problem joining \u201c{channel_name}\u201d, sorry!","cmd_handlers")({channel_name:l});"is_archived"==n.error&&(r=TS.interop.i18n.t("\u201c{channel_name}\u201d has been archived, so can\u2019t be opened.","cmd_handlers")({channel_name:l}));s&&a?TS.cmd_handlers.addEphemeralFeedback(r,{temporary:false,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(r,{temporary:false,slackbot_feels:"sad_surprise"})}};TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:u.id})).then(function(e){d(e.data.ok,e.data)}).catch(function(e){d(false,e.data)})}}else if(u&&u.is_group)u.is_archived&&!u.was_archived_this_session||TS.groups.legacyDisplayGroup({id:u.id});else if(TS.permissions.members.canCreateChannels())TS.ui.new_channel_modal.start(l);else{var c=TS.interop.i18n.t("I couldn\u2019t find a channel named \u201c{channel_name}\u201d, sorry!","cmd_handlers")({channel_name:l});s&&a?TS.cmd_handlers.addEphemeralFeedback(c,{temporary:false,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(c,{temporary:false,slackbot_feels:"sad_surprise"})}}}},"/join":{localized:"/"+TS.interop.i18n.t("join","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/open",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/open"].func(t,n,r,i,a,s)}},"/msg":{localized:"/"+TS.interop.i18n.t("msg","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/dm"],localized_aliases:["/"+TS.interop.i18n.t("dm","cmd_handlers")()],desc:TS.interop.i18n.t("Send a DM message to another user","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:false},{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){var o=r.length>1?r[1]:"";var l;var u;var d=v(o);if(!d)if(o){var c=o.replace("#","");l=TS.redux.channels.getPublicOrPrivateChannelByName(c);if(!l){u=TS.interop.i18n.t("A valid member name is required.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}}else $("#direct_messages_header").trigger("click.open_dialog").scrollintoview({duration:500});var m=n.replace(o,"");m=d?_.trim(i.substr(i.indexOf(">")+1)):_.trim(i.substr(i.indexOf(o)+o.length));if(d){if(d.deleted){u=TS.interop.i18n.t("That user has been deactivated","cmd_handlers")()+" :disappointed:";s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}TS.ims.legacyStartImByMemberId(d.id,false,m)}else if(l){if(l.is_archived){u=TS.interop.i18n.t("That {channel} has been archived","cmd_handlers")({channel:l.is_channel?TS.interop.i18n.t("channel","cmd_handlers")():TS.interop.i18n.t("private channel","cmd_handlers")()});s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}l.is_channel?TS.channels.legacyDisplayChannel({id:l.id,and_send_txt:m}):TS.groups.legacyDisplayGroup({id:l.id,and_send_txt:m})}}},"/invite":{localized:"/"+TS.interop.i18n.t("invite","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Invite another member to a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:false},{name:TS.interop.i18n.t("channel","cmd_handlers")(),optional:true}],func:function e(t,n,r,i){var a=r.length>1?r[1]:"";var s=v(a);var o;a&&(o=TS.interop.userGroups.getUserGroupById(a.substr(1)));if(!s&&!o&&a){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid member name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s&&s.deleted){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("That user has been deactivated.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}var l=r.length>2?r[2]:"";var u=l?TS.redux.channels.getPublicOrPrivateChannelByName(l):TS.shared.legacyGetActiveModelOb();var d=function e(){if(s&&s.is_app_user){var t=TS.shared.legacyGetActiveModelOb();TS.apps.permissions.addAppToResource(s,t,i);return}u&&!u.is_im&&(s||o||u.is_mpim)?s?g(s,u,i):o&&!u.is_mpim?S(o,u,i):TS.ui.im_browser.startWithMpim(u):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"})};!(s&&s.is_restricted)||u&&(u.is_im||u.is_mpim)?d():TS.interop.members.fetchMemberProfileExtras(s.id,["channels"]).then(function(e){return e&&_.isArray(e.channels)&&e.channels||[]}).then(function(e){if(!s.is_ultra_restricted&&TS.model.user.is_admin||u&&e.indexOf(u.id)>-1)d();else{if(s.is_ultra_restricted&&e.length){TS.model.user.is_admin?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest and can\u2019t be added to a second channel. To invite {user} to this channel, you\u2019ll need to <{team_url}admin#restricted|upgrade their membership> to a Multi-Channel Guest. \u200bNote: This will add a billable seat to your workspace.","cmd_handlers")({user:T(s),team_url:TS.boot_data.team_url}),{input_txt:i,slackbot_feels:"sad_surprise"}):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest and can\u2019t be added to a second channel. Your Workspace Admin can upgrade their membership to a Multi-Channel Guest.","cmd_handlers")({user:T(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}if(!TS.model.user.is_admin){if(s.is_ultra_restricted){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:T(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}if(u&&!u.is_private&&!u.is_group){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Multi-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:T(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}}}d()})}},"/invite_people":{localized:"/"+TS.interop.i18n.t("invite_people","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Invite people to your workspace","cmd_handlers")(),args:[{name:TS.utility.exampleEmailAddress()+", ...",optional:true}],func:function e(t,n){if(TS.ui.admin_invites.canInvite()){n=n&&n.trim();n&&TS.ui.admin_invites.populateInvites(n.split(/\s*,\s*|\s+/).map(function(e){return{email:e}}));TS.ui.admin_invites.start()}else TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to invite people.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}},"/dm":{localized:"/"+TS.interop.i18n.t("dm","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/msg",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/msg"].func(t,n,r,i,a,s)}},"/archive":{localized:"/"+TS.interop.i18n.t("archive","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Archive the current channel","cmd_handlers")(),func:function e(){var t=TS.shared.legacyGetActiveModelOb();if(t.is_archived||TS.interop.rules.channels.isRequired(t))return;if(TS.interop.rules.channels.isExternallySharedChannel(t))return;if(t.is_channel&&!t.is_mpim){if(!TS.permissions.members.canArchiveChannels())return;if(TS.boot_data.page_needs_enterprise&&!_.get(TS.model.user,"enterprise_user.is_admin",false)&&TS.interop.rules.channels.isOrgDefaultChannel(t))return;TS.channels.ui.showArchiveChannelDialog(t)}else if(t.is_group&&!t.is_mpim){if(TS.model.user.is_restricted)return;TS.channels.ui.showArchiveGroupDialog(t)}}},"/leave":{localized:"/"+TS.interop.i18n.t("leave","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/close","/part"],localized_aliases:["/"+TS.interop.i18n.t("close","cmd_handlers")(),"/"+TS.interop.i18n.t("part","cmd_handlers")()],desc:TS.interop.i18n.t("Leave a channel","cmd_handlers")(),func:function e(t,n,r){if(1==r.length){var i=TS.shared.legacyGetActiveModelOb();i.is_channel?i.is_mpim?TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id})):i.is_archived?TS.shared.legacyCloseArchivedChannel(i.id):TS.channels.leave(i.id):i.is_mpim||i.is_im?TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id})):i.is_group?i.is_archived?TS.shared.legacyCloseArchivedChannel(i.id):TS.channels.leave(i.id):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel or member name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}else{var a=TS.redux.channels.getPublicOrPrivateChannelByName(n);a?TS.channels.leave(a.id):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}}},"/star":{localized:"/"+TS.interop.i18n.t("star","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,desc:TS.interop.i18n.t("Stars the current channel or conversation","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o;s&&a?TS.stars.toggleStarOnMsg(a.ts,s,function(){o=a.is_starred?TS.interop.i18n.t("Ok, I starred this thread","cmd_handlers")():TS.interop.i18n.t("Ok, I unstarred this thread","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(o,{c_id:s.id,thread_ts:a.ts})}):TS.stars.toggleStarForActiveModel(function(e){o=e?TS.interop.i18n.t("Ok, I starred {channel}","cmd_handlers")({channel:s.name}):TS.interop.i18n.t("Ok, {channel} is unstarred","cmd_handlers")({channel:s.name});TS.cmd_handlers.addEphemeralFeedback(o)})}},"/close":{localized:"/"+TS.interop.i18n.t("close","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/leave",aliases:null,desc:"",func:function e(t,n,r){TS.cmd_handlers["/leave"].func(t,n,r)}},"/part":{localized:"/"+TS.interop.i18n.t("part","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/leave",aliases:null,desc:"",func:function e(t,n,r){TS.cmd_handlers["/leave"].func(t,n,r)}},"/topic":{localized:"/"+TS.interop.i18n.t("topic","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Set the channel topic","cmd_handlers")(),args:[{name:TS.interop.i18n.t("new topic","cmd_handlers")(),optional:true}],func:function e(t,n,r,i){var a=TS.shared.legacyGetActiveModelOb();if(TS.model.user.is_restricted||TS.interop.rules.channels.isRequired(a)&&!TS.permissions.members.canPostInChannel(a)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Setting the topic is a restricted action.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(n.length>TS.model.channel_topic_max_length){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Topics cannot exceed {max_characters} characters.","cmd_handlers")({max_characters:TS.model.channel_topic_max_length}),{input_txt:i,slackbot_feels:"sad_surprise"});return}var s=_.trim(i.substr(t.length));a.is_mpim||a.is_im?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Regrettably, direct messages do not have topics","cmd_handlers")(),{slackbot_feels:"sad_surprise"}):s?TS.interop.channels.submitChannelTopic(a.id,s).catch(TS.channels.legacyAlertSetTopicError):$("#channel_topic_text").click().focus().select()}},"/togglethemes":{localized:"/"+TS.interop.i18n.t("togglethemes","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.prefs.setPrefByAPI({name:"messages_theme",value:"light_with_avatars"===TS.prefs.getPref("messages_theme")?"dense":"light_with_avatars"})}},"/search":{localized:"/"+TS.interop.i18n.t("search","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/s"],localized_aliases:["/"+TS.interop.i18n.t("s","cmd_handlers")()],desc:TS.interop.i18n.t("Perform a search","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your text","cmd_handlers")(),optional:true}],func:function e(t,n){TS.client.ui.flex.openFlexTab("search");TS.view.resizeManually("TS.search.view.showResults");TS.search.autocomplete.search(n,true);TS.interop.clog.track("SEARCH_OPEN",{open_method:"command",search_session_id:TS.search.getSearchSessionId()})}},"/s":{localized:"/"+TS.interop.i18n.t("s","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/search",aliases:null,desc:"",func:function e(t,n){TS.cmd_handlers["/search"].func(t,n)}},"/rename":{localized:"/"+TS.interop.i18n.t("rename","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Rename a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("new name","cmd_handlers")(),optional:true}],func:function e(t,n){if(TS.model.user.is_restricted){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to rename.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}var r=TS.shared.legacyGetActiveModelOb();if(r.is_mpim||r.is_im){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Direct messages don\u2019t even have a name! Ergo, regrettably, you can\u2019t change it.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if((r.is_channel||r.is_group)&&!TS.model.user.is_admin&&r.creator!=TS.model.user.id){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Only Workspace Admins (or the channel creator) are allowed to rename channels.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}var i=_.escape(n)||r.name;TS.ui.channel_options_dialog.start(r.id,"rename",{name:i})}},"/beep":{localized:"/"+TS.interop.i18n.t("beep","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.sounds.play("new_message")}},"/upload":{localized:"/"+TS.interop.i18n.t("upload","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(t,n){var r=TS.utility.base64StrtoBlob(n);TS.client.ui.file_pasted_sig.dispatch(r)}},"/colors":{localized:"/"+TS.interop.i18n.t("colors","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/colours"],localized_aliases:["/"+TS.interop.i18n.t("colours","cmd_handlers")()],desc:TS.interop.i18n.t("View any custom colors you have set for other members","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o=TS.members.getMembersForUser();var l;var u="";for(var d=0;d<o.length;d+=1){l=o[d];l.member_color!=l.color&&(u+=l.name+": "+l.member_color+"\n")}var c=u?TS.interop.i18n.t("You have overridden colors as follows:","cmd_handlers")()+"\n"+u:TS.interop.i18n.t("No user color overrides have been set.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(c,{temporary:false,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(c,{temporary:false})}},"/colours":{localized:"/"+TS.interop.i18n.t("colours","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/colors",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/colors"].func(t,n,r,i,a,s)}},"/color":{localized:"/"+TS.interop.i18n.t("color","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/colour"],localized_aliases:["/"+TS.interop.i18n.t("colour","cmd_handlers")()],desc:TS.interop.i18n.t("Set a custom color for another member","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o=r.length>1?r[1]:"";var l=r.length>2?r[2].replace(/#/g,""):"";var u;var d=v(o);if(!d){u=TS.interop.i18n.t("A valid member name is required.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}var c;d&&(c=TS.interop.members.getPrefCompliantMemberName(d,true,true));if(l&&(6!=l.length||!("#"+l).match(TS.format.hex_rx))){u=TS.interop.i18n.t("A valid 6 character hex code is required, like `FF0000`.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i});return}TS.members.setMemberUserColor(d,l);TS.prefs.setPrefLocal("user_colors",JSON.stringify(TS.model.user_colors));TS.prefs.setPrefByAPI({name:"user_colors",value:TS.prefs.getPref("user_colors")});u=l?TS.interop.i18n.t("You\u2019ve set your custom color for {user} to {color}","cmd_handlers")({user:c,color:"#"+l}):TS.interop.i18n.t("You\u2019ve removed your custom color for {user}.","cmd_handlers")({user:c});s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i})}},"/colour":{localized:"/"+TS.interop.i18n.t("colour","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/color",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/color"].func(t,n,r,i,a,s)}},"/colortest":{localized:"/"+TS.interop.i18n.t("colortest","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(t,n){var r=null;if(n)try{r=JSON.parse(n)}catch(e){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Not a good value for colors: ","cmd_handlers")()+n,{slackbot_feels:"sad_surprise"});return}r&&r.length||(r=["#DDCFFA","#2EF645","#F38303","#E702AE","#3C986D","#9D6158","#F43368","#97C10A","#7491F9","#9E63A3","#FACE41","#35A5CC","#39A93E","#4FECA8","#CA5B34","#E2A974","#2BCFCB","#F89BA7","#89868A","#6A7841","#ADC498","#B1DBDD","#B849C3","#9CDB81","#E72F36","#A16A28","#F68CCF","#317C84","#58851C","#FC4A97","#5774BB","#97B7FE","#C64D97","#CB4A5C","#F68B6B","#81EE4F","#B7ED6D","#756D8E","#3AED69","#81E7FB","#91ECB7","#ED8947","#57AF19","#28BC89","#4A9788","#D645DF","#B498FE","#71C8F9","#C07B1D","#16BD60","#EFCAE3","#A4E0BB","#478AAF","#59953E","#886CA7","#F0C3F1","#29AF70","#80A5F8","#636BB8"]);var i;for(i=0;i<r.length;i+=1)r[i]=r[i].replace("#","");var a=TS.members.getMembersForUser();for(i=0;i<a.length;i+=1)TS.members.setMemberUserColor(a[i],r[_.random(0,r.length-1)])}},"/discon":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.disconnect()}},"/sleepsleep":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.sleep()}},"/sleepsleep2":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.sleep()}},"/wakewake":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.wake()}},"/discon4":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.disconnect()}},"/emo":{localized:"/"+TS.interop.i18n.t("emo","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/emote","/emoji"],localized_aliases:["/"+TS.interop.i18n.t("emote","cmd_handlers")(),"/"+TS.interop.i18n.t("emoji","cmd_handlers")()],desc:"",func:function e(){var t={target:TS.client.ui.$msg_input};TS.ui.react_emoji_menu.start({e:t})}},"/emoji":{localized:"/"+TS.interop.i18n.t("emoji","cmd_handlers")(),type:"client",autocomplete:false,alias_of:"/emo",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/emo"].func()}},"/emote":{localized:"/"+TS.interop.i18n.t("emote","cmd_handlers")(),type:"client",autocomplete:false,alias_of:"/emo",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/emo"].func()}},"/editlast":{localized:"/"+TS.interop.i18n.t("editlast","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Edit the last message you posted","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o=s||TS.shared.legacyGetActiveModelOb();var l;if(!o)return;n=$.trim(n);if(!n){l=TS.interop.i18n.t("You must enter some text!","cmd_handlers")();o&&a?TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,c_id:o.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i});return}var u;if(o&&a)u=TS.utility.msgs.getEditableReplyByProp("user",TS.model.user.id,o,a.ts);else{var d;d=TS.useReactMessages()?TS.redux.messages.getMessagesByChannelId(o.id):o.msgs;d=_.reject(d,TS.interop.messages.isReply);u=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,d)}if(!u){l=TS.interop.i18n.t("Found no recent messages from you to edit.","cmd_handlers")();o&&a?TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,slackbot_feels:"sad_surprise",c_id:o.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,slackbot_feels:"sad_surprise"});return}TS.useReactMessages()?TS.redux.dispatch(TS.interop.redux.actions.saveMessageEdit({channelId:o.id,ts:u.ts,text:n})):TS.msg_edit.commitEdit(u,o,n)}},"/deletelast":{localized:"/"+TS.interop.i18n.t("deletelast","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Delete the last message you posted","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o=s||TS.shared.legacyGetActiveModelOb();if(!o)return;var l;if(o&&a)l=TS.utility.msgs.getEditableReplyByProp("user",TS.model.user.id,o,a.ts);else{var u;u=TS.useReactMessages()?TS.redux.messages.getMessagesByChannelId(o.id):o.msgs;u=_.reject(u,TS.interop.messages.isReply);l=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,u)}if(!l){var d=TS.interop.i18n.t("Found no recent messages from you to delete.","cmd_handlers")();o&&a?TS.cmd_handlers.addEphemeralFeedback(d,{slackbot_feels:"sad_surprise",c_id:o.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(d,{slackbot_feels:"sad_surprise"});return}TS.msg_edit.startDelete(l.ts,o)}},"/collapse":{localized:"/"+TS.interop.i18n.t("collapse","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Collapse all files in the current channel (opposite of /expand)","cmd_handlers")(),func:function e(){if(TS.useReactMessages()){var t=TS.shared.legacyGetActiveModelOb().id;var n=TS.redux.messages.getExpandablesInChannel(t);var r=_.zipObject(n,_.map(n,function(){return false}));TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(r))}else{TS.inline_imgs.collapseAllInCurrent();TS.inline_videos.collapseAllInCurrent();TS.inline_attachments.collapseAllInCurrent();TS.inline_audios.collapseAllInCurrent();TS.inline_others.collapseAllInCurrent();TS.inline_file_previews.collapseAllInCurrent()}TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("I\u2019ve collapsed all files in this channel for you.","cmd_handlers")(),{temporary:false})}},"/expand":{localized:"/"+TS.interop.i18n.t("expand","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Expand all files in the current channel (opposite of /collapse)","cmd_handlers")(),func:function e(){if(TS.useReactMessages()){var t=TS.shared.legacyGetActiveModelOb().id;var n=TS.redux.messages.getExpandablesInChannel(t);var r=_.zipObject(n,_.map(n,function(){return true}));TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(r))}else{TS.inline_imgs.expandAllInCurrent();TS.inline_videos.expandAllInCurrent();TS.inline_attachments.expandAllInCurrent();TS.inline_audios.expandAllInCurrent();TS.inline_others.expandAllInCurrent();TS.inline_file_previews.expandAllInCurrent()}TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("I\u2019ve expanded all files in this channel for you.","cmd_handlers")(),{temporary:false})}},"/attach_align":{localized:"/"+TS.interop.i18n.t("attach_align","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){$("body").toggleClass("attachments_flush_with_avatar")}},"/attach_thumb_align":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){window.attach_thumb_align_title=!window.attach_thumb_align_title;TS.client.msg_pane.rebuildMsgsWithReason("/attach_thumb_align command")}},"/remove":{localized:"/"+TS.interop.i18n.t("remove","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/kick"],localized_aliases:["/"+TS.interop.i18n.t("kick","cmd_handlers")()],desc:TS.interop.i18n.t("Remove a person from the current channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:false}],func:function e(t,n,r,i){var a=TS.shared.legacyGetActiveModelOb();n=$.trim(n);var s=v(n);if((a.is_im||a.is_mpim)&&!s.is_app_user){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove someone from a direct message.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(a.is_channel&&!s.is_app_user&&!TS.permissions.members.canKickFromChannels()){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Removing someone from a channel is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(a.is_group&&!s.is_app_user&&!TS.permissions.members.canKickFromGroups()){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Removing someone from a private channel is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(a.is_archived){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove anyone from *{channel}* while it is archived.","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+a.name}),{slackbot_feels:"sad_surprise"});return}if(!n){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Please specify someone to remove!","cmd_handlers")(),{input_txt:i});return}if(!s){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{input}* is not a recognized member name.","cmd_handlers")({input:TS.interop.i18n.safeString(_.escape(TS.interop.texty.convertContentsStringToDisplayString(_.trim(i.substr(t.length))),TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText()))}),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s.is_app_user){TS.apps.permissions.removeAppFromResource(s,a,i);return}if(TS.interop.rules.channels.isRequired(a)&&!s.is_restricted&&!s.is_bot){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove this member from *{channel}*!","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+a.name}));return}TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,[s.id]).then(function(){var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(a.id,s.id);if(!e.is_member){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is not a member of this {channel}.","cmd_handlers")({user:TS.interop.i18n.safeString(_.escape(TS.interop.texty.convertContentsStringToDisplayString(_.trim(i.substr(t.length))),TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText())),channel:a.is_channel?TS.interop.i18n.t("channel","cmd_handlers")():TS.interop.i18n.t("private channel","cmd_handlers")()}),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s.is_self){TS.client.ui.onSubmit("/leave");return}if(TS.interop.members.isExternal(s)){var n;n=TS.boot_data.page_needs_enterprise?TS.interop.i18n.t("You can\u2019t remove {member_name} from this channel, because they\u2019re from a workspace outside your organization.","cmd_handlers")({member_name:T(s)}):TS.interop.i18n.t("You can\u2019t remove {member_name} from this channel, because they\u2019re from another workspace.","cmd_handlers")({member_name:T(s)});TS.cmd_handlers.addEphemeralFeedback(n,{input_txt:i,slackbot_feels:"sad_surprise"});return}a.is_channel?TS.channels.legacyKickMember(a.id,s.id):a.is_group&&TS.groups.kickMember(a.id,s.id)})}},"/kick":{localized:"/"+TS.interop.i18n.t("kick","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/remove",aliases:null,desc:"",func:function e(t,n,r,i){TS.cmd_handlers["/remove"].func(t,n,r,i)}},"/feedback":{localized:"/"+TS.interop.i18n.t("feedback","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Send feedback to Slack","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){if(!n){TS.utility.openInNewTab("/help/requests/new","_blank");return}var o=_.trim(i.substr(t.length));o=TS.interop.texty.convertContentsStringToDisplayString(o,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());TS.generic_dialog.start({title:TS.interop.i18n.t("Send feedback","cmd_handlers")(),body:'<p class="bold">'+TS.interop.i18n.t("Looks like you are trying to send us some feedback! Yes?","cmd_handlers")()+"</p>",show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, send it","cmd_handlers")(),onGo:function e(){var n={command:t,text:o,channel:TS.model.active_cid,client_token:TS.interop.client_action_token.generateAndEnqueue()};if(s&&a){n.channel=s.id;n.thread_ts=a.ts}var r=i;var l=function e(t,n,i){TS.client.ui.onAPICommand(t,n,i,r)};TS.api.call("chat.command",n).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;l(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;l(i,t,n,r);return{data:t,args:n,request_id:r}})},onCancel:function e(){s&&a?TS.utility.populateThreadInputs(i,s.id,a.ts):TS.utility.populateInput(TS.client.ui.$msg_input,i)}})}},"/redox":{type:"client",autocomplete:true,alias_of:null,aliases:null,desc:"Display redux documentation (redox), only works in dev",func:function e(){window&&window.slackDebug&&window.slackDebug.redox&&window.slackDebug.redox()}},"/shrug":{localized:"/"+TS.interop.i18n.t("shrug","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Appends \xaf\\_(\u30c4)_/\xaf to your message","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){var o=_.trim(i.substr(t.length));o&&" "!==o.substr(o.length-1)&&(o+=" ");o+="\xaf\\_(\u30c4)_/\xaf ";s||(s=TS.shared.legacyGetActiveModelOb());TS.client.ui.sendMessage(s,o,a)}},"/showfallbacks":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.model.show_attachment_fallback=!TS.model.show_attachment_fallback;TS.client.msg_pane.rebuildMsgsWithReason("/showfallbacks command")}},"/toggle_debugging_prefs":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.ui.prefs_dialog.start("advanced","#prefs_debug")}},"/weighscale":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"Output size and counts of local model to console.",func:function e(){TS.interop.console.info("Weigh Scale","Calculating local model size ...");TS.metrics.reportModelSize()}}});var e=["/shrug","/prefs","/shortcuts","/keys","/toggle_debugging_prefs","/away","/search","/togglethemes","/feedback","/slack_diagnostic_report","/msg","/dm","/s","/editlast","/deletelast","/star","/beep","/colors","/colours","/color","/colour","/active"];var t;var r={localized:null,type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Start a call","cmd_handlers")(),args:[{name:TS.interop.i18n.t("help","cmd_handlers")(),optional:true}],can_be_overridden_by_server_cmd:true,func:function e(t,n){var r=TS.shared.legacyGetActiveModelOb();var i=TS.interop.members.getMemberById(r.user);if(TS.boot_data.page_needs_enterprise){var a=TS.model.team;if(TS.interop.rules.channels.isExternallySharedChannel(r)||i&&a&&i.team_id!==a.id||TS.boot_data.feature_default_shared_channels&&TS.interop.rules.channels.isOrgDefaultChannel(r)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You are not allowed to use this command here.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}}if("help"===n.trim()){var s;s=TS.utility.calls.isCurrentContextMultiParty()&&!TS.utility.calls.isMultiPartyEnabled()?TS.interop.i18n.t("To call someone, use `/call` in a direct message to them.","cmd_handlers")():r.is_mpim?TS.interop.i18n.t("To call {group_name}, use `/call` in this group conversation.","cmd_handlers")({group_name:TS.interop.rules.channels.getDisplayNameForChannel(r)}):r.is_im?TS.interop.i18n.t("To call {user}, use `/call` in this Direct Message conversation.","cmd_handlers")({user:TS.interop.rules.channels.getDisplayNameForChannel(r)}):TS.interop.i18n.t("To start a call in {channel}, use `/call` here.","cmd_handlers")({channel:TS.interop.rules.channels.getDisplayNameForChannel(r)});s+="\n";s+=TS.interop.i18n.t("To run a series of tests, use `/call --test` here.","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(s);return}if(n.trim().match(/--server=/)){var o=n.trim().replace(/--server=/g,"");var l=TS.storage.fetchCallsState();l.call_server_override=o;TS.storage.storeCallsState(l)}if(n.trim().match(/--test/)){var u="https://"+window.location.host+"/help/test/calls";TS.model.is_our_app?TS.client.windows.openWindow({url:u,no_spinner:true}):window.open(u,"calls_test");return}if(TS.utility.calls.isCurrentContextMultiParty()&&!TS.utility.calls.isMultiPartyEnabled()){if("Slack"!==TS.prefs.getTeamPref("calling_app_name")){TS.utility.calls.startCallInModelOb(r,true);return}TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Group calls aren\u2019t available on the free plan. Try using `/call` in a Direct Message conversation!","cmd_handlers")());return}if(TS.interop.rules.channels.isSlackbot(r)){var d=[TS.interop.i18n.t("I\u2019m on the other line. Sorry!","cmd_handlers")(),TS.interop.i18n.t("Thanks for calling me! I\u2019m afraid I only accept calls from my mother, Sundays at 2pm.","cmd_handlers")(),TS.interop.i18n.t("I\u2019m washing my hair right now\u2026can\u2019t come to the phone!","cmd_handlers")(),TS.interop.i18n.t("It\u2019s awfully nice of you to try calling me. But \u2014 shh! \u2014 I\u2019m quite afraid of the phone!","cmd_handlers")()+" :grimacing:",TS.interop.i18n.t("Thank you so much for calling, but I can\u2019t talk right now, I\u2019m watching my stories.","cmd_handlers")()];var c=_.shuffle(d)[0];TS.cmd_handlers.addEphemeralFeedback(c);return}if(i&&(i.is_bot||i.id==TS.model.user.id)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Unfortunately, {user} is busy right now, and can\u2019t answer your call.","cmd_handlers")({user:TS.interop.members.getPrefCompliantMemberName(i,false,true)}),{slackbot_feels:"sad_surprise"});return}TS.utility.calls.startCallInModelOb(r,true)}};var i=[];var a=function n(){if(t||TS.interop.i18n.locale===TS.interop.i18n.DEFAULT_LOCALE)return;t=true;var r;var i;_.forOwn(TS.cmd_handlers,function(t,n){if(0!==n.indexOf("/"))return;r=TS.cmd_handlers[n].localized?TS.cmd_handlers[n].localized.toLowerCase():null;if(r&&r!==n&&!TS.cmd_handlers[r]){TS.cmd_handlers[r]=_.clone(TS.cmd_handlers[n]);TS.cmd_handlers[r].localized=null;TS.cmd_handlers[r].canonical_name=n;TS.cmd_handlers[n].autocomplete=false;i=TS.interop.i18n.deburr(r);if(r!==i){TS.cmd_handlers[r].normalized=i;TS.cmd_handlers[i]||(TS.cmd_handlers[i]=_.clone(TS.cmd_handlers[n]))}_.includes(e,n)&&e.push(r)}})};var s=function e(t,n){TS.model.commands_cache_ts=n;var r={data:t,cache_ts:TS.model.commands_cache_ts,locale:TS.interop.i18n.locale};TS.storage.storeCmds(r);d(t);TS.cmd_handlers.mergeInServerCmds(t);u();TS.apps.permissions.areXoxaAppsInstalled()&&p(t)};var o=function e(){var t=TS.storage.fetchCmds();if(!t)return false;if(TS.model.commands_cache_ts!==t.cache_ts)return false;if(TS.interop.i18n.locale!==t.locale)return false;return true};var l=function e(){TS.cmd_handlers.setUpCmds()};var u=function e(){var t="/"+TS.interop.i18n.t("call","cmd_handlers")();var n=TS.interop.i18n.deburr(t);if(TS.utility.calls.isEnabled()){if(!TS.cmd_handlers["/call"])if("/call"===t)TS.cmd_handlers["/call"]=r;else{TS.cmd_handlers[t]=_.clone(r);var i=_.clone(r);i.autocomplete=false;i.localized=null;TS.cmd_handlers["/call"]=i;if(t!==n){TS.cmd_handlers[t].normalized=n;TS.cmd_handlers[n]||(TS.cmd_handlers[n]=i)}}}else{TS.cmd_handlers["/call"]&&"client"===TS.cmd_handlers["/call"].type&&_.unset(TS.cmd_handlers,"/call");TS.cmd_handlers[t]&&"client"===TS.cmd_handlers[t].type&&_.unset(TS.cmd_handlers,t);t!==n&&TS.cmd_handlers[n]&&"client"===TS.cmd_handlers[n].type&&_.unset(TS.cmd_handlers,t)}};var d=function e(t){var n=_.filter(t,"app");if(!n.length)return false;var r=[];n.forEach(function(e){TS.model.apps[e.app]||-1!==r.indexOf(e.app)||r.push(e.app)});r&&Promise.map(r,function(e){return TS.api.call("apps.profile.get",{app:e}).then(function(e){var t=e.data.app_profile;TS.apps.ingestApp(t)}).catch(function(t){TS.warn("Could not add app "+e+" to model");TS.error(t)})})};var c=function e(t){var n=false;var r=TS.shared.legacyGetActiveModelOb();TS.interop.rules.channels.isOrgShared(r)&&(n=true);return{cmds:t.filter(function(e){return("core"===e.type||"client"===e.type)&&!(n&&"/call"===e.name)}),id:"core",name:"Slack"}};var m=function e(t){return{cmds:t.filter(function(e){return"custom"===e.type}),id:"custom",name:TS.model.team.name}};var f=function e(t){var n=TS.apps.getAppById(t);if(!n)return false;if(!n.is_xoxa_app)return false;var r=TS.interop.membership.getCachedChannelMembershipInfoForUser(TS.model.active_cid,n.app_user_id);if(true===r.is_known&&false===r.is_member)return true;return false};var p=function e(t){var n=[];_.each(t,function(e){var t=e.app;if(t){var r=_.get(TS.model.apps,t+".app_user_id");r&&n.push(r)}});i=n};var h=function e(t){var n=t.filter(function(e){return"app"===e.type||"service"===e.type});var r=n.filter(function(e){return!!(e.service_name||e.app)});var i=n.filter(function(e){return!(e.service_name||e.app)});var a={};r.forEach(function(e){var t=TS.cmd_handlers.getAppNameForCmdName(e.name);a[t]||(a[t]=[]);a[t].push(e)});var s=Object.keys(a).slice().sort(TS.interop.i18n.sorter);var o=s.map(function(e){var t={cmds:a[e],id:"app",name:e};TS.apps.permissions.areXoxaAppsInstalled()&&(t.xoxa_app_not_in_channel=f(a[e][0].app));return t});o.push({cmds:i,id:"app",name:"Other"});return o};var g=function e(t,n,r){if(!_.isObject(t))throw new Error("Expected user to be an object");if(!_.isObject(n))throw new Error("Expected model_ob to be an object");if(!_.isString(r))throw new Error("Expected input_txt to be a string");return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(n.id,[t.id]).then(function(){var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(n.id,t.id);if(e.is_member){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("{user} is already in this channel.","cmd_handlers")({user:T(t)}),{input_txt:r});return}if(!n.is_mpim&&!TS.permissions.channels.canMemberBeInvitedToChannel(n,t)){var i;if(TS.boot_data.page_needs_enterprise){i=TS.interop.members.isExternal(t)?TS.interop.rules.channels.isExternallySharedChannel(n)||!TS.teams.getTeamNameByMember(t)?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization.","cmd_handlers")({member_name:T(t)}):1===TS.prefs.getTeamPref("enable_shared_channels")?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization. If you\u2019d like, you can share this channel with {team_name}.","cmd_handlers")({member_name:T(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))}):TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization. If you\u2019d like, you can share this channel with {team_name}. <https://get.slack.help/hc/articles/115004151183|Learn about shared channels>","cmd_handlers")({member_name:T(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))}):TS.interop.i18n.t("{user} is not a member of {team_name}.","cmd_handlers")({user:T(t),team_name:TS.interop.i18n.safeString(_.escape(TS.model.team.name))});TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:r,slackbot_feels:"sad_surprise"});return}if(TS.interop.members.isExternal(t)){i=TS.interop.rules.channels.isExternallySharedChannel(n)||!TS.teams.getTeamNameByMember(t)?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace.","cmd_handlers")({member_name:T(t)}):1===TS.prefs.getTeamPref("enable_shared_channels")?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace. If you\u2019d like, you can share this channel with {team_name}.","cmd_handlers")({member_name:T(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))}):TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace. If you\u2019d like, you can share this channel with {team_name}. <https://get.slack.help/hc/articles/115004151183|Learn about shared channels>","cmd_handlers")({member_name:T(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))});TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:r,slackbot_feels:"sad_surprise"});return}}if(n.is_mpim)TS.ui.im_browser.startWithMpim(n,[t.id]);else{if(!n.is_group)return TS.api.call("conversations.invite",{channel:n.id,users:t.id});TS.ui.invite.showInviteMembersPreSelected(n.id,[t.id])}})};var S=function e(t,n,r){if(!_.isObject(t))throw new Error("Expected ug to be an object");if(!_.isObject(n))throw new Error("Expected model_ob to be an object");if(!_.isString(r))throw new Error("Expected input_txt to be a string");TS.user_groups.promiseToGetUserGroupMembers(t.id).then(function(e){TS.interop.membership.ensureChannelMembershipIsKnownForUsers(n.id,e.users).then(function(){var t=e.users.filter(function(e){if(TS.boot_data.page_needs_enterprise){var t=TS.interop.members.getMemberById(e);if(!TS.permissions.channels.canMemberBeInvitedToChannel(n,t))return false}var r=TS.interop.membership.getCachedChannelMembershipInfoForUser(n.id,e);return!r.is_member});if(!t.length){var i=TS.interop.i18n.t("All of the users in that user group are already in this channel.","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:r});return}!n.is_private&&!n.is_group||TS.interop.rules.channels.isExternallySharedChannel(n)?TS.api.call("conversations.invite",{channel:n.id,users:t,force:true}):TS.ui.invite.showInviteMembersPreSelected(n.id,t)})})};var T=function e(t){if(!_.isObject(t))throw new Error("Expected user to be an object");return TS.interop.members.getPrefCompliantMemberName(t,false,true)};var v=function e(t){return TS.interop.members.getMemberById(t)}})()},11252:function(e,t){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};(function(){TS.registerModule("stars",{member_stars_fetched_sig:new signals.Signal,member_stars_being_fetched_sig:new signals.Signal,channel_starred_sig:new signals.Signal,channel_unstarred_sig:new signals.Signal,has_more:false,fetched_once:false,onStart:function e(){TS.files.team_file_changed_sig.add(u);TS.files.team_file_deleted_sig.add(TS.stars.maybeUpdateUserStarredList);TS.files.team_file_comment_deleted_sig.add(TS.stars.maybeUpdateUserStarredList);TS.channels.message_changed_sig.add(o);TS.ims.message_changed_sig.add(o);TS.mpims.message_changed_sig.add(o);TS.groups.message_changed_sig.add(o);TS.client&&TS.experiment.loadUserAssignments().then(function(){TS.stars.badge_star_menu=TS.experiment.getGroup("badge_star_menu");"treatment"==TS.stars.badge_star_menu&&TS.stars.fetchUserStarredItems()});r=$("#member_stars_more_btn")},getAllStars:function e(){return s},maybeUpdateUserStarredList:function e(t){if(!TS.client)return;if(!TS.model.team)return;if(i||!TS.stars.fetched_once){a=true;return}l(t)},maybeRemoveStarredListItem:function e(t){if(!TS.client)return;var n=_.findIndex(s,function(e){if(e.type!==t.type)return false;switch(e.type){case"message":return e.message.ts===t.message.ts;case"file":return e.file.id===t.file_id;case"file_comment":return e.comment.id===t.comment.id;default:break}return false});-1!==n&&s.splice(n,1);c();if("stars"!==TS.model.ui_state.flex_name)return;var r;var i;if("file"===t.type){i=".star_item #file_"+t.file_id;r=$(i).parent(".star_item")}else if("message"===t.type){i='.star_item .message[data-ts="'+t.message.ts+'"]';r=$(i).parent(".star_item")}else{if("file_comment"!==t.type)return;i='.star_item .star_comment[data-comment-id="'+t.comment.id+'"]';r=$(i).parents(".star_item")}r.remove()},fetchUserStarredItems:function e(){var t=m();TS.stars.fetched_once||(TS.stars.fetched_once=true);return TS.api.call("stars.list",t).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;d&&d(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;d&&d(i,t,n,r);return{data:t,args:n,request_id:r}})},userStarStatusHasChanged:function e(t,n,r){f(t,n,r);var i=false;if("message"===n.type){p(n.message.ts,n.channel,t,false);TS.useReactMessages()&&TS.redux.messages.replaceMessage(TS.utility.msgs.processImsg(n.message,n.channel))}else if("file"===n.type)n.file.is_starred!=t&&g(n.file.id,t);else if("file_comment"===n.type)n.comment.is_starred!=t&&h(n.comment.id,n.file.id,t);else if("channel"===n.type){var a=TS.interop.channels.getChannelById(n.channel,i);a?a.is_starred!=t&&S(n.channel,t):TS.warn("userStarStatusHasChanged channel_id:"+n.channel+" not found")}else if("group"===n.type){var s=TS.interop.channels.getGroupById(n.channel,i);s||(s=TS.interop.channels.getMpimById(n.channel,i));s?s.is_starred!=t&&(s.is_mpim?b(n.channel,t):T(n.channel,t)):TS.warn("userStarStatusHasChanged group_id:"+n.channel+" not found")}else if("im"===n.type){var o=TS.interop.channels.getImById(n.channel,i);o?o.is_starred!=t&&v(n.channel,t):TS.warn("userStarStatusHasChanged im_id:"+n.channel+" not found")}else TS.error("userStarStatusHasChanged needs to handle star item type:"+n.type)},checkForStarClick:function e(t,n){if(!t.target)return false;var r=$(t.target);_.isFunction(n)||(n=_.noop);var i;i=r.closest(".star").length?r.closest(".star"):r.closest(".star_link");var a=false;if(!i||!i.length)if(r.is("button.file_star"))i=r.children(".star");else if(r.closest(".starred_icon").length){a=true;i=r.closest(".starred_icon")}if(!i||!i.length)return false;if(i.hasClass("not-clickable"))return false;var s=i.hasClass("starred");var o={};var l;if(a){var u=TS.redux.channels.getEntityById(i.data("c-id"));if(u){o.channel=u.id;s=u.is_starred;l=function e(t){u.is_channel?S(o.channel,t):u.is_im?v(o.channel,t):u.is_mpim?b(o.channel,t):u.is_group&&T(o.channel,t)}}}else if(i.hasClass("star_message")){o.channel=i.data("c-id");o.timestamp=i.data("msg-id");l=function e(t){p(o.timestamp,o.channel,t,true)}}else if(i.hasClass("star_file")){o.file=i.data("file-id");l=function e(t){g(o.file,t)}}else if(i.hasClass("star_file_comment")){o.file_comment=i.data("comment-id");l=function e(t){h(o.file_comment,i.data("file-id"),t)}}else if(i.hasClass("star_channel")){o.channel=i.data("channel-id");l=function e(t){S(o.channel,t)}}else if(i.hasClass("star_group")){o.channel=i.data("group-id");l=function e(t){T(o.channel,t)}}else if(i.hasClass("star_im")||i.hasClass("star_app")){o.channel=i.data("im-id");var d=false;TS.interop.apps.isAppSpaceEnabled()&&i.hasClass("star_app")&&(d=true);l=function e(t){v(o.channel,t,d)}}else{if(!i.hasClass("star_mpim")){TS.error("checkForStarClick doesn't know what to do with a click on "+i[0].outerHTML);return false}o.channel=i.data("mpim-id");l=function e(t){b(o.channel,t)}}t.preventDefault();l(!s);n(!s);if(s){var c=function e(t,r){if(t)return;if("not_starred"===r.error){l(false);n(false)}else{l(true);n(true)}};TS.api.call("stars.remove",o).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;c(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;c(i,t,n,r);return{data:t,args:n,request_id:r}})}else{var m=function e(t,r){if(t)return;if("already_starred"===r.error){l(true);n(true)}else{l(false);n(false)}};TS.api.call("stars.add",o).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;m(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;m(i,t,n,r);return{data:t,args:n,request_id:r}})}return true},updateMsgStar:function e(t,n,r,i){p(t,n,r,i)},updateFileStar:function e(t,n){g(t,n)},updateFileCommentStar:function e(t,n,r){h(t,n,r)},toggleStarOnMsg:function e(t,n,r){if(!t||!n)return;var i=TS.utility.msgs.findMsg(t,n.id);if(!i)return;var a={channel:n.id,timestamp:t};var s=i.is_starred?"stars.remove":"stars.add";var o=function e(t,i){t?r&&r(n):i.error&&TS.error(i.error)};TS.api.call(s,a).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})},toggleStar:function e(t,n){var r=n?TS.redux.channels.getEntityById(n):TS.shared.legacyGetActiveModelOb();if(!r||TS.client.activeChannelIsHidden())return;var i=r.is_starred;var a={};a.channel=r.id;if(i){var s=function e(n,i){n?t&&t(r):i.error&&TS.error(i.error)};TS.api.call("stars.remove",a).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})}else{var o=function e(n,i){n?t&&t(r):i.error&&TS.error(i.error)};TS.api.call("stars.add",a).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})}},toggleStarForActiveModel:function e(t){if(TS.client.activeChannelIsHidden())return;var n={preventDefault:_.noop,target:$("#star_container button.star").get(0)};try{TS.stars.checkForStarClick(n,t)}catch(e){TS.stars.toggleStar(function(e){t(e.is_starred)})}}});var e=1;var t=20;var r;var i=false;var a=false;var s=[];var o=function e(t,n){true===n.is_starred&&TS.stars.maybeUpdateUserStarredList()};var l=function e(n){i=true;a=false;TS.stars.member_stars_being_fetched_sig.dispatch(TS.model.user,true);var r=true;var o=m();o.page=1;o._update=true;o.count=Math.max(s.length,t);n&&n.delta&&(o.count+=n.delta);TS.api.call("stars.list",o,null,r).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;d&&d(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;d&&d(i,t,n,r);return{data:t,args:n,request_id:r}})};var u=function e(t){if(t.hasOwnProperty("is_starred")){var n=$(".star_item");var r=TS.files.containerHasFileListItem(t,n);var i=TS.interop.files.fileNeedsUpdate(t.id);if(i&&r){TS.interop.files.fileIsUpdating(t.id)||TS.files.fetchFileInfo(t.id,null,"TS.starts._teamFileChanged needs updated files.info");return}g(t.id,t.is_starred,t.id);r&&TS.files.updateFileListItem(t,n)}};var d=function t(n,o,l){i=false;TS.stars.member_stars_being_fetched_sig.dispatch(TS.model.user,false);if(a){TS.stars.maybeUpdateUserStarredList();return}if(!n){TS.stars.member_stars_fetched_sig.dispatch({error:"api_not_ok"});return}for(var u=0;u<o.items.length;u+=1){var d=o.items[u];TS.stars.userStarStatusHasChanged(true,d,"stars.list")}if(1==l.page)s=o.items;else{s=s.concat(o.items);s=_.uniqWith(s,_.isEqual)}r.data("ladda")&&r.data("ladda").stop();c();TS.stars.has_more=o.paging.pages>o.paging.page;l._update||(e+=1);TS.stars.member_stars_fetched_sig.dispatch(null,TS.model.user)};var c=function e(){if("treatment"!=TS.stars.badge_star_menu)return;var t=Date.now()/1e3-259200;var n=_.countBy(s,function(e){return e.date_create>t});var r=_.get(n,true,0);0===r?$("#star_badge").hide():$("#star_badge").show().text(r>=20?"20+":r)};var m=function n(){var r={user:TS.model.user.id,exclude:"Ch,Gh,Dh",page:e,count:t};return r};var f=function e(t,r,i){if("message"===r.type){r.message._rxn_key=TS.rxns.getRxnKey("message",r.message.ts,r.channel);"channel_topic"!==r.message.type&&"channel_purpose"!==r.message.type&&"channel_join"!==r.message.type&&"channel_leave"!==r.message.type||(r.message.subtype=r.message.type);r.message.type="message"}else if("file"===r.type||"file_comment"===r.type){if(!r.file){TS.error("WTF no file in type "+r.type+" in "+i);return false}if(r.file_id&&TS.boot_data.feature_no_files_info){var a=TS.files.getFileById(r.file_id);if(!a)return false;TS.files.upsertAndSignal(n({},a,{is_starred:t}))}else TS.files.upsertAndSignal(r.file);var s=r.file&&r.file.id;TS.boot_data.feature_no_files_info?Object.defineProperty(r,"file",{enumerable:true,configurable:true,get:function e(){return TS.files.getFileById(s)},set:function e(){return false}}):r.file=TS.files.getFileById(s);if("file_comment"===r.type){if(!r.comment){TS.error("WTF no comment in type "+r.type+" in "+i);return false}r.comment=TS.files.addCommentToFile(r.comment,r.file)}}else if("channel"===r.type);else if("group"===r.type);else if("im"!==r.type){TS.error("need to handle star item type:"+r.type+" in "+i);return false}return true};var p=function e(t,n,r,i){var a=TS.redux.channels.getEntityById(n);var s;a&&(s=TS.utility.msgs.findMsg(t,n));var o='.star_message[data-msg-id="'+t+'"][data-c-id="'+n+'"]';var l=$(o);if(i){var u={};var d=r?"STAR_ADD_CLICKED":"STAR_REMOVE_CLICKED";if(TS.model.unread_view_is_showing){_.merge(u,TS.client.ui.unread.getTrackingData(t));TS.client.ui.unread.incrementTrackingSeqId()}_.merge(u,TS.ui.thread.getTrackingPayloadForEl(l));"threads_view"===TS.ui.thread.getContextForEl(l)&&TS.client.ui.threads.incrementTrackingSeqId();TS.interop.clog.track(d,u)}y(l,r,s,o)};var h=function e(t,n,r){var i=TS.files.getFileById(n);var a;i?a=TS.files.getFileCommentById(i,t):TS.warn("updateFileCommentStar file_id:"+n+" not found");var s='.star_comment[data-comment-id="'+t+'"]';y($(s),r,a,s)};var g=function e(t,n){var r=TS.files.getFileById(t);r||TS.warn("updateFileStar file_id:"+t+" not found");var i='.star_file[data-file-id="'+t+'"]';y($(i),n,r,i)};var S=function e(t,n){var r=TS.interop.channels.getChannelById(t);r||TS.warn("updateChannelStar channel_id:"+t+" not found");r.is_starred=n;var i='.star_channel[data-channel-id="'+t+'"]';y($(i),n,r,i);if(TS.client){var a=TS.redux.channels.getEntityById(t);if(!a)return;n?TS.stars.channel_starred_sig.dispatch(a):TS.stars.channel_unstarred_sig.dispatch(a)}};var T=function e(t,n){var r=TS.interop.channels.getGroupById(t);r||TS.warn("updateGroupStar group_id:"+t+" not found");r.is_starred=n;var i='.star_group[data-group-id="'+t+'"]';y($(i),n,r,i)};var v=function e(t,n,r){var i=TS.interop.channels.getImById(t);i||TS.warn("updateImStar im_id:"+t+" not found");i.is_starred=n;var a="";a=r?'.star_app[data-im-id="'+t+'"]':'.star_im[data-im-id="'+t+'"]';y($(a),n,i,a)};var b=function e(t,n){var r=TS.interop.channels.getMpimById(t);r||TS.warn("updateMpimStar mpim_id:"+t+" not found");r.is_starred=n;var i='.star_mpim[data-mpim-id="'+t+'"]';y($(i),n,r,i)};var y=function e(t,n,r){n?t.hasClass("starred")||t.addClass("starred ts_icon_star").removeClass("ts_icon_star_o"):t.removeClass("starred ts_icon_star").addClass("ts_icon_star_o");r&&(r.is_starred=n)}})()},11253:function(e,t){(function(){TS.registerModule("inline_attachments",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,shouldExpand:function e(t,n){if(TS.model.expandable_state["attach_"+t+n.from_url])return true;if(false===TS.model.expandable_state["attach_"+t+n.from_url])return false;return true},legacyShouldShow:function e(t,n){if(t.is_share)return true;if(n&&"reply_broadcast"===n.subtype)return true;if("twitter"===t.service_name&&"bot_message"===n.subtype)return true;if(!t.from_url)return true;if(n.standalone_attachment)return true;if(n&&n.text&&-1==n.text.indexOf(t.from_url)){if(!TS.model.ampersands_are_inconsistent_in_from_urls)return true;if(-1==n.text.indexOf(t.from_url.replace(/&/g,"&amp;")))return true}if(TS.prefs.getPref("expand_inline_imgs")){if(t.audio_html)return true;if(t.other_html)return true;if(t.video_html)return true;if(t.image_url)return true;if(t.service_name&&"twitter"===t.service_name.toString().toLowerCase())return true}return!!TS.prefs.getPref("expand_non_media_attachments")},expandAllInCurrent:function e(){TS.inline_attachments.no_scrolling=true;$(".msg_inline_attachment_expander").trigger("click");TS.inline_attachments.no_scrolling=false;TS.client&&TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_attachment_collapser").trigger("click")},expand:function e(t,n){TS.model.expandable_state["attach_"+t+n]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var s=function e(){return $(this).data("real-src")==n};var o=i.find(".inline_attachment").filter(s);o.removeClass("hidden");i.find(".msg_inline_attachment_expander").filter(s).addClass("hidden");i.find(".msg_inline_attachment_collapser").filter(s).removeClass("hidden");o.css("opacity",0).stop().animate({opacity:1},300);if(!TS.inline_attachments.no_scrolling)if(TS.client&&a){TS.client.ui.instaScrollMsgsToBottom(false);i.children().first().scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}else o.scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_attachments.expand_sig.dispatch(t)},collapse:function e(t,n){TS.model.expandable_state["attach_"+t+n]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=function e(){return $(this).data("real-src")==n};var s=i.find(".inline_attachment").filter(a);s.length||(s=i.find(".msg_inline_attachment_holder").filter(a));s.css("visibility","hidden");i.find(".msg_inline_attachment_expander").filter(a).removeClass("hidden");i.find(".msg_inline_attachment_collapser").filter(a).addClass("hidden");TS.inline_attachments.collapse_sig.dispatch(t);setTimeout(function(){s.addClass("hidden");s.css("visibility","visible")},200)},checkForInlineAttachmentClick:function e(t){if(!t.target)return;var n=$(t.target);var r;var i;var a=n.closest(".message");i=a.data("ts");r=a.attr("id");var s=n.closest(".msg_inline_attachment_expander");if(s.length){t.preventDefault();if(!r)return;TS.inline_attachments.expand(r,s.data("real-src"))}var o=n.closest(".msg_inline_attachment_collapser");if(o.length){t.preventDefault();if(!r)return;TS.inline_attachments.collapse(r,o.data("real-src"))}var l=n.closest(".rest_text_expander");if(l.length){t.preventDefault();var u=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var d=l.parent().find(".short_text");var c;var _=l.parent().find(".more_text");if(l.data("show-text")){if(_.length){_.addClass("hidden");c=l.find("a span");l.data("hide-text",c.text());c.text(l.data("show-text"));l.data("show-text","");l.find("a .ts_icon").removeClass("ts_icon_caret_down").addClass("ts_icon_caret_right")}}else{var m=d.attr("data-all-text");if(m){d.html(m);d.data("all-text","")}_.length&&_.removeClass("hidden");if(_.length&&l.data("hide-text")){c=l.find("a span");l.data("show-text",c.text());c.text(l.data("hide-text"));l.data("hide-text","");l.find("a .ts_icon").removeClass("ts_icon_caret_right").addClass("ts_icon_caret_down")}else l.css("display","none")}d.css("opacity",0).transition({opacity:1},300);TS.inline_attachments.rest_texts_expanded[l.attr("id")]=true;TS.client&&TS.ui.utility.updateClosestMonkeyScroller(d);if(TS.client&&u){TS.client.ui.instaScrollMsgsToBottom(false);d.scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}}var f=n.closest(".delete_attachment_link");if(f.length){t.preventDefault();var p=f.data("attachment-id").toString();var h=a.attr("data-model-ob-id");TS.inline_attachments.promptForDeletingAttachment(h,i,p)}},promptForDeletingAttachment:function e(t,n,r){var i=TS.redux.channels.getEntityById(t);if(!i){TS.warn("missing model_ob");return}if(!r){TS.warn("missing attachment-id");return}var a=i.id;var s=TS.utility.msgs.findMsg(n,t);if(!s){TS.error("Attachment removing failed: msg not found anywhere!");var o=TS.interop.i18n.t("Attachment removing failed!","inline_attachments")();TS.generic_dialog.alert(o);return}var l="";if(TS.model.user.is_admin){var u=_.find(s.attachments,{id:r});if(u&&u.from_url){var d=TS.inline_attachments.makeBlackListSelect(u.from_url);var c=TS.interop.i18n.t("Disable future attachments from this website?","inline_attachments")();l='<p class="large_left_margin '+(d&&"no_bottom_margin")+'">';l+='<label class="checkbox normal" style="font-size: 16px;">';l+='<input id="attachment_blacklist_cb" type="checkbox" class="small_right_margin" />';l+=c;l+="</label>";d&&(l+=d);l+="</p>"}}var m=TS.interop.i18n.t("Are you sure you wish to remove this attachment from the message?","inline_attachments")();var f='<p class="'+(l?"small_bottom_margin":"")+'">'+m+"</p>"+l;TS.generic_dialog.start({title:TS.interop.i18n.t("Remove attachment","inline_attachments")(),body:f,go_button_text:TS.interop.i18n.t("Yes, remove","inline_attachments")(),onShow:function e(){$("#attachment_blacklist_cb").bind("change",function(){var e=!!$("#attachment_blacklist_cb").prop("checked");e?$("#attachment_blacklist_select").prop("disabled",false):$("#attachment_blacklist_select").prop("disabled",true)})},onGo:function e(){if(s.is_ephemeral){s.attachments=TS.inline_attachments.removeAttachmentById(s.attachments,r);TS.utility.msgs.replaceMsg(i,s,false,true)}else{var t=!!$("#attachment_blacklist_cb").prop("checked");var o=t?$("#attachment_blacklist_select").val():"none";var l=t?$("#attachment_blacklist_select").find(":selected").data("url"):"";var u={channel:a,ts:n,attachment:r,blacklist_type:o,blacklist_url:l};TS.dir(0,u);var d=function e(t){if(t){if(TS.web){s.attachments=TS.inline_attachments.removeAttachmentById(s.attachments,r);TS.utility.msgs.replaceMsg(i,s)}}else{var n=TS.interop.i18n.t("Attachment removing failed!","inline_attachments")();TS.generic_dialog.alert(n)}};TS.api.call("chat.deleteAttachment",u).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;d(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;d(i,t,n,r);return{data:t,args:n,request_id:r}})}}})},makeBlackListSelect:function e(t){if(!t)return"";t=_.escape(t).replace("https://","").replace("http://","");var n="";var r=t.split("/");var i=r[0];var a=r[r.length-1];var s=TS.interop.i18n.t("All links from {host}","inline_attachments")({host:i});var o=TS.interop.i18n.t("Just the link {url}","inline_attachments")({url:t});n+='<label class="select small full_width">\r';n+='<select id="attachment_blacklist_select" disabled="disabled" class="small" style="margin-bottom: 4px;">\r';n+='<option value="all" data-url="'+i+'">'+s+"</option>\r";n+='<option value="just" data-url="'+t+'">'+o+"</option>\r";if(a!=i){TS.info(a);var l=r.concat();l.length-=1;var u=l.join("/");if(u!=i){u+="/";var d=TS.interop.i18n.t("All links under {host_path}","inline_attachments")({host_path:u});n+='<option value="under" data-url="'+u+'">'+d+"</option>\r"}}n+="</select>\r";n+="</label>\r";return n},rest_texts_expanded:{},shouldExpandText:function e(t){return!!TS.inline_attachments.rest_texts_expanded[t]},renderStandaloneAttachment:function e(t){TS.inline_attachments.massageAttachment(t,0);if(t.image_url&&!TS.model.inline_imgs[t.from_url]){t.from_url||(t.from_url=t.image_url);TS.inline_imgs.makeInternalInlineImg(t.from_url,{link_url:t.from_url,bytes:t.image_bytes,src:t.image_url,width:isNaN(t.image_width)?null:t.image_width,height:isNaN(t.image_height)?null:t.image_height,should_expand:true})}t.video_html&&!TS.model.inline_videos[t.from_url]&&TS.inline_videos.makeInternalInlineVideo(t.from_url,{src:t.thumb_url,html:t.video_html,proxied_src:t.proxied_thumb_url,title:t.title,display_h:t.video_html_height,display_w:t.video_html_width,thumbnail:{link_url:t.from_url,url:t.thumb_url,height:t.thumb_height,width:t.thumb_width}});var n=TS.interop.datetime.makeTsStamp();var r=TS.templates.builders.buildAttachmentHTML({attachment:t,msg:{enable_slack_action_links:false,text:t.from_url,ts:n,url:t.from_url,standalone_attachment:t.standalone_attachment||false},can_delete:false,maybe_show_file_viewer:false,has_content:TS.utility.attachments.hasContent(t),from_post:true,model_ob:TS.redux.channels.getEntityById(t.channel_id)});var i=TS.templates.makeMsgDomId(n);return'<div class="message standalone-attachment" id="'+i+'" data-ts="'+n+'">'+r+"</div>"},massageAttachment:function e(t,n){t._index=n;"id"in t&&(t.id=t.id.toString());t.text&&(t._short_text=TS.inline_attachments.legacyTruncateAttachmentText(t.text));t._floated_thumb_display_height=75;t._floated_thumb_display_width=75;t.thumb_height&&t.thumb_width&&(t.thumb_height>t.thumb_width?t._floated_thumb_display_width=parseInt(t.thumb_width*(t._floated_thumb_display_height/t.thumb_height),10):t._floated_thumb_display_height=parseInt(t.thumb_height*(t._floated_thumb_display_width/t.thumb_width),10));var r=TS.utility.getImgProxyURL(t.thumb_url,t._floated_thumb_display_width,t._floated_thumb_display_height);r!=t.thumb_url?t.proxied_thumb_url=r:delete t.proxied_thumb_url},legacyTruncateAttachmentText:function e(t){var n=500;var r=3;var i="";var a=0;var s="";var o="";var l="";var u;var d=0;var c=false;for(var _=0;_<t.length;_+=1){u=t.charAt(_);if(o||"<"===u){o+=u;(l||"|"===u)&&(l+=u);if(">"===u){i+=o;a+=l.length-2;a>n&&(c=true);o="";l=""}}else{"\n"===u&&(d+=1);if(d>r+1){s=t.replace(i,"");break}i+=u;a+=1;a>n&&(c=true);if(c&&" "===u){s=t.replace(i,"");break}}}var m=i.trim()==t.trim()?"":i;var f=i.match(/```/g);var p=s.match(/```/g);f&&p&&(m+="```");return m},getAttachmentByFromUrl:function e(t,n){if(!t)return null;for(var r=0;r<t.length;r+=1){if(!t[r]){TS.info(n);TS.dir(0,t);continue}if(!t[r].from_url)continue;if(t[r].from_url==n)return t[r];if(TS.model.ampersands_are_inconsistent_in_from_urls&&t[r].from_url.replace(/&/g,"&amp;")==n)return t[r]}return null},getAttachmentBySlackFileId:function e(t,n){if(!t)return null;if(!n)return null;for(var r=0;r<t.length;r+=1){if(!t[r])continue;if(t[r].slack_file_id==n)return t[r]}return null},removeAttachmentById:function e(t,n){if(!t)return null;var r=[];for(var i=0;i<t.length;i+=1)t[i].id!=n&&r.push(t[i]);return r}})})()},11254:function(e,t){(function(){TS.registerModule("inline_others",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){},shouldExpand:function e(t,n){if(TS.model.expandable_state["vid_"+t+n.src])return true;if(false===TS.model.expandable_state["vid_"+t+n.src])return false;if(n.internal_file_id)return TS.prefs.getPref("expand_internal_inline_imgs");return TS.prefs.getPref("expand_inline_imgs")},expandAllInCurrent:function e(){var t=$(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)");if(!t.length)return;TS.inline_others.no_scrolling=true;t.trigger("click");TS.inline_others.no_scrolling=false;TS.client&&TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_media_toggler[data-media-type=other].expanded").trigger("click")},expand:function e(t,n){TS.model.expandable_state["vid_"+t+n]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var s=function e(){return $(this).data("real-src")==n};var o=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(s):null;o&&o.length||(o=i.find(".msg_inline_other_holder").filter(s));o.removeClass("hidden");i.find(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)").filter(s).addClass("expanded");TS.client&&TS.client.ui.checkInlineImgsAndIframesEverywhere();o.css("opacity",0).stop().animate({opacity:1},300);if(!TS.inline_others.no_scrolling)if(TS.client&&a){TS.client.ui.instaScrollMsgsToBottom(false);i.children().first().scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}else i.find(".msg_inline_other").last().scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_others.expand_sig.dispatch(t);TS.client&&TS.client.ui.checkInlineImgsAndIframesEverywhere()},collapse:function e(t,n){TS.model.expandable_state["vid_"+t+n]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=function e(){return $(this).data("real-src")==n};var s=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(a):null;s&&s.length||(s=i.find(".msg_inline_other_holder").filter(a));s.css("visibility","hidden");i.find(".msg_inline_media_toggler[data-media-type=other].expanded").filter(a).removeClass("expanded");s.find(".msg_inline_other_iframe_div").html("");TS.inline_others.collapse_sig.dispatch(t);setTimeout(function(){s.addClass("hidden");s.css("visibility","visible")},200)},checkForInlineOtherClick:function e(t){if(!t.target)return;var n=$(t.target);var r;var i=n.closest(".message");r=i.attr("id");if(!r)return;var a=n.closest(".msg_inline_media_toggler[data-media-type=other]");if(a.length){t.preventDefault();var s=a.data("real-src");a.hasClass("expanded")?TS.inline_others.collapse(r,s):TS.inline_others.expand(r,s)}},makeInternalInlineOther:function t(n){var r=400;var i=500;if(n.other_html_width>r){n.other_html_height=parseInt(n.other_html_height*(r/n.other_html_width),10);n.other_html_width=r}if(n.other_html_height>i){n.other_html_width=parseInt(n.other_html_width*(i/n.other_html_height),10);n.other_html_height=i}var a;n.google_map_config&&(a=TS.utility.parseJSONOrElse(n.google_map_config,void 0));if(a&&a.center&&"string"!==typeof a.center.lat){a.scrollwheel=false;var s="googmap_"+(e+=1);n.other_html='<div class="google-maps" id="'+s+'" style="width:100%; min-width:'+_.escape(n.other_html_width)+"px; height:"+_.escape(n.other_html_height)+'px;"></div>\t\t\t<script>TS.inline_others.runGoogleMapCode("'+s+"\", '"+JSON.stringify(a)+"')<\/script>";n.safe_other_html=n.other_html}else{if(-1==n.other_html.indexOf("oldwidth")){n.other_html=n.other_html.replace(" width=",' width="'+n.other_html_width+'" oldwidth=');n.other_html=n.other_html.replace(" height=",' height="'+n.other_html_height+'" oldheight=')}n.safe_other_html=n.other_html;n.safe_other_html=TS.utility.swapInRedirUrlForIframe(n.safe_other_html);n.safe_audio_html=TS.utility.setCssFromHeightAndWidthAttrs(n.safe_audio_html)}TS.model.inline_others[n.other_html]={src:_.escape(n.other_html),attachment:n}},runGoogleMapCode:function e(t,n){if(!window.google)return;if(!n)return;var r=JSON.parse(n);var i=new google.maps.Map(document.getElementById(t),r);if(!r.query)return;var a=new google.maps.Geocoder;var s="number"===typeof r.max_results?r.max_results:10;s<0&&(s=Number.MAX_VALUE);var o=function e(){google.maps.event.clearListeners(i,"bounds_changed");var t=i.getBounds();var n=0;var o=function e(t){new google.maps.Marker({map:i,position:t.geometry.location});n+=1};var l=function e(a,l){var u=false;l==google.maps.GeocoderStatus.OK?a.slice(0,s).forEach(function(e){o(e);u=u||!e.partial_match}):TS.warn("Geocoder failed due to: "+l);if(!u&&n<s){var d=new google.maps.places.PlacesService(i);var c=function e(t,r){r==google.maps.places.PlacesServiceStatus.OK?t.slice(0,s-n).map(o):TS.warn("PlacesService failed due to: "+r)};d.nearbySearch({bounds:t,name:r.query},c)}};a.geocode({address:r.query,bounds:t},l)};google.maps.event.addListener(i,"bounds_changed",o)}});var e=0})()},11255:function(e,t){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};(function(){TS.registerModule("msg_edit",{editing:false,editing_in_msg_pane:false,editing_in_convo_pane:false,deleting_from_editing:false,current_msg:null,current_model_ob:null,mousedown_active:false,edit_interv:0,onStart:function e(){},onCountDownInterval:function e(){if(!TS.msg_edit.current_msg)return;if(-1==TS.prefs.getTeamPref("msg_edit_window_mins")||TS.interop.rules.channels.isYou(TS.msg_edit.current_model_ob)){$("#edit_countdown").empty();return}var t=TS.interop.datetime.toDateObject(TS.msg_edit.current_msg.ts).getTime()+60*TS.prefs.getTeamPref("msg_edit_window_mins")*1e3;var n=Math.floor((t-Date.now())/1e3);n<1?$("#edit_countdown").html(TS.interop.i18n.t("(your time to edit ran out)","msg_edit")()+"&nbsp&nbsp&nbsp&nbsp"):n<61?$("#edit_countdown").html(TS.interop.i18n.t("(you have <strong>{seconds_count, number}</strong> seconds)","msg_edit")({seconds_count:n})+"&nbsp&nbsp&nbsp&nbsp"):$("#edit_countdown").empty()},cancelEditingINothingHasChanged:function e(){if(!TS.msg_edit.editing)return true;var t=TS.format.unFormatMsg(TS.msg_edit.current_msg.text);var n=TS.utility.contenteditable.value($("#message_edit_form").find("#msg_text"));if(n===t){TS.msg_edit.onCancelEdit();return true}return false},editExpiration:function e(n){if(n>0){var r=t(n);if(TS.model.user.is_admin)return'<p class="no_bottom_margin">'+TS.interop.i18n.t('In this workspace, you can\u2019t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")({msg_edit_duration_text:r})+"</p>";return'<p class="no_bottom_margin">'+TS.interop.i18n.t("In this workspace, you can\u2019t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")({msg_edit_duration_text:r})+"</p>"}if(TS.model.user.is_admin)return'<p class="no_bottom_margin">'+TS.interop.i18n.t('In this workspace, you can\u2019t edit messages after the fact. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")()+"</p>";return'<p class="no_bottom_margin">'+TS.interop.i18n.t("In this workspace, you can\u2019t edit messages after the fact. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")()+"</p>"},startEdit:function t(n,r,i,a){if($("#message_edit_form").length&&!TS.msg_edit.cancelEditingINothingHasChanged()){TS.msg_edit.promptEdit();return}if(!n){TS.error("no msg_ts?");return null}if(!r){TS.error("no model_ob?");return null}if(!TS.useReactMessages()&&!r.msgs){TS.error("no model_ob.msgs?");return null}a||(a=TS.utility.msgs.getMsg(n,e(r)));a||(a=TS.ui.replies.getActiveMessage(r,n));TS.model.threads_view_is_showing&&!a&&(a=TS.client.threads.getMessage(r,n));if(!a){TS.error("no msg in msgs?");return null}if(TS.useReactMessages()&&"convo"!==i&&!TS.client.activeChannelIsHidden()){TS.redux.dispatch(TS.interop.redux.features.messageEdit.maybeStartEditingMessage({channelId:a.channel,ts:n,scroll:true}));return}var s=TS.format.unFormatMsg(a.text);var o=i&&i.force_reopen;if(!o){var l=Date.now();var u=TS.interop.datetime.toDateObject(a.ts);var d=l-u;var c=d/6e4;if(TS.prefs.getTeamPref("msg_edit_window_mins")>=0&&c>TS.prefs.getTeamPref("msg_edit_window_mins")&&!TS.interop.rules.channels.isYou(r)){TS.warn("Editing unavailable on channel "+r.id+", msg with ts = "+a.ts+". now = "+l+", elapsed (minutes) = "+c+", msg_edit_window_mins = "+TS.prefs.getTeamPref("msg_edit_window_mins"));var m=TS.prefs.getTeamPref("msg_edit_window_mins")>0?TS.interop.i18n.t("This message can\u2019t be edited","msg_edit")():TS.interop.i18n.t("Messages can\u2019t be edited","msg_edit")();TS.generic_dialog.alert(TS.msg_edit.editExpiration(TS.prefs.getTeamPref("msg_edit_window_mins")),m,TS.interop.i18n.t("Got It","msg_edit")());return}}var f=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var p;if("convo"===i){TS.msg_edit.editing_in_msg_pane=false;TS.msg_edit.editing_in_convo_pane=true;p=TS.msg_edit.getDivForMsgInConvoPane(a.ts)}else{TS.msg_edit.editing_in_msg_pane=true;TS.msg_edit.editing_in_convo_pane=false;p=TS.msg_edit.getDivForMsgInMsgPane(a.ts)}if(!p.length){TS.error("no msg div for edit");return null}TS.msg_edit.current_msg=a;TS.msg_edit.current_model_ob=r;p.addClass("hidden");var h=s;i&&i.text&&(h=i.text);var g=TS.templates.message_edit_form({msg:a,edit_text:h,permalink:TS.utility.msgs.constructMsgPermalink(r,a.ts,a.thread_ts),include_emo:!!TS.client,relative_ts:TS.interop.messages.isReply(a)});p.after(g);var S=$("#message_edit_form");var T=S;var v=S.find("#msg_text");var b={complete_member_specials:!("convo"===i)};TS.utility.contenteditable.create(v,{ariaLabel:TS.interop.i18n.t("Edit message","msg_edit")(),modules:{tabcomplete:{searchOptions:b,positionMenu:function e(t){t.style.width=v.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,v)},completers:["channels","emoji","members"]}},onEnter:function e(){TS.msg_edit.checkAndSubmit(v,S);return false},onEscape:function e(){TS.model.menu_is_showing||TS.model.dialog_is_showing||setTimeout(TS.msg_edit.onCancelEdit,0)},onTextChange:function e(){TS.msg_edit.checkLengthAndUpdateMessage(v)}});TS.utility.contenteditable.enable(v);v.on("keyup",function(){var e=TS.utility.contenteditable.cursorPosition(v);if(!e.length){var t=TS.client&&TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);(!TS.client||S.outerHeight()<t.height)&&T.find(".edit_controls").scrollintoview({px_offset:-50})}});TS.utility.contenteditable.value(v,h);TS.msg_edit.checkLengthAndUpdateMessage(v);TS.info("message_edit_form added");TS.msg_edit.editing=true;S.bind("destroyed",function(){TS.utility.contenteditable.unload($("#message_edit_form #msg_text"));TS.info("message_edit_form removed");TS.msg_edit.editing=false;TS.msg_edit.editing_in_msg_pane=false;TS.msg_edit.editing_in_convo_pane=false;S=null;v=null;TS.msg_edit.resetEditUI()});S.bind("submit",function(e){e.preventDefault();var t=TS.utility.contenteditable.value(v);t=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(t,b);if(t===s){TS.msg_edit.onCancelEdit();return}if(!t){var i=TS.utility.msgs.getMsgActions(a,r);var o=p.attr("id")===TS.templates.makeMsgDomIdInConversation(n)||p.attr("id")===TS.templates.makeMsgDomIdInThreadsView(n);i.remove_broadcast&&!o?TS.msg_edit.startRemoveBroadcast(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,true):i.delete_msg?TS.msg_edit.startDelete(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelEdit,true):TS.msg_edit.onConfirmEdit("~"+a.text.replace(/~/g,"")+"~");return}var l=TS.ui.needToBlockAtChannelKeyword(t,null,TS.msg_edit.current_model_ob.id);if(l){TS.generic_dialog.alert("<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{blocked_keyword}</strong> messages.","msg_edit")({blocked_keyword:TS.interop.i18n.safeString(_.escape(l))})+"</p>");return}if(!$.trim(t))return;TS.msg_edit.onConfirmEdit(t)});S.find("#commit_edit").bind("click",function(){TS.msg_edit.checkAndSubmit(v,S)});S.find("#cancel_edit").bind("click",function(){TS.msg_edit.onCancelEdit()});S.bind("mousedown",function(){TS.msg_edit.mousedown_active=true});S.bind("mouseup",function(){TS.msg_edit.mousedown_active=false});var y=S.find(".emo_menu");y.removeClass("hidden");y.bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:"#msg_text"})});TS.client&&f&&TS.client.ui.instaScrollMsgsToBottom(false);var w=TS.client&&TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);if(!TS.client||S.outerHeight()<w.height)T.find(".edit_controls").scrollintoview({duration:500,px_offset:-50,complete:function e(){TS.msg_edit.focusAndSetCursorPosition(v,i)}});else{TS.msg_edit.focusAndSetCursorPosition(v,i);T.find(".edit_controls").scrollintoview({duration:500,px_offset:-50})}TS.msg_edit.onCountDownInterval();TS.msg_edit.edit_interv=setInterval(TS.msg_edit.onCountDownInterval,1e3)},isMessageTooLong:function e(t){var n=TS.format.cleanMsg(TS.utility.contenteditable.value(t));if(TS.boot_data.feature_message_input_byte_limit)return TS.utility.msgs.charsOverLimit(n);return n.length>TS.interop.constants.MAX_MESSAGE_INPUT_LENGTH},updateTooLongWarning:function e(t,n){var r=$(t).parent().find(".edit_warning");if(n){r.removeClass("hidden");TS.boot_data.feature_message_input_byte_limit&&r.text(TS.interop.i18n.t("Your message is {diff_count, plural, =1{# character}other{# characters}} too long.","msg_input")({diff_count:n}))}else $(t).parent().find(".edit_warning").addClass("hidden")},checkLengthAndUpdateMessage:function e(t){var n=TS.msg_edit.isMessageTooLong(t);TS.msg_edit.updateTooLongWarning(t,n);return!n},checkAndSubmit:function e(t,n){TS.msg_edit.checkLengthAndUpdateMessage(t)&&n.submit()},onConfirmEdit:function e(t){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}if(!t){TS.error("no edited_text?");return null}var n=TS.msg_edit.editing_in_convo_pane;TS.msg_edit.commitEditInternal(t);TS.msg_edit.resetEditUI();if(TS.client)if(n){var r=true;TS.ui.replies.focusReplyInput(r)}else TS.view.focusMessageInput()},onCancelEdit:function e(){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}var t=TS.msg_edit.editing_in_convo_pane;TS.msg_edit.resetEditUI();if(TS.client)if(t){var n=true;TS.ui.replies.focusReplyInput(n)}else TS.view.focusMessageInput()},resetEditUI:function e(){clearInterval(TS.msg_edit.edit_interv);if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}TS.msg_edit.getDivBeingEdited().removeClass("hidden");$("#message_edit_container").remove()},getDivBeingEdited:function e(){if(TS.msg_edit.editing_in_msg_pane)return TS.msg_edit.getDivForMsgInMsgPane(TS.msg_edit.current_msg.ts);if(TS.msg_edit.editing_in_convo_pane)return TS.msg_edit.getDivForMsgInConvoPane(TS.msg_edit.current_msg.ts);return $()},getDivForMsgInMsgPane:function e(t){var n=TS.model.unread_view_is_showing;var r=TS.model.threads_view_is_showing;if(n)return $("#"+TS.templates.makeMsgDomIdInUnreadView(t));if(r)return $("#"+TS.templates.makeMsgDomIdInThreadsView(t));return $("#"+TS.templates.makeMsgDomId(t))},getDivForMsgInConvoPane:function e(t){return $("#"+TS.templates.makeMsgDomIdInConversation(t))},getAllDivsForMsg:function e(t){var n=TS.msg_edit.getDivForMsgInMsgPane(t);return n.add(TS.msg_edit.getDivForMsgInConvoPane(t))},commitEditInternal:function e(t){TS.msg_edit.commitEdit(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,t)},commitEdit:function e(n,r,i,a,s){if(!n){TS.error("no msg?");return null}if(!r){TS.error("no model_ob?");return null}a||(a=0);s||(s=100);var o=function e(a,s,o){if(a){if(TS.web||r.is_channel&&!r.is_member){var l=_.extend({},n,{text:s.text,edited:{ts:TS.interop.datetime.makeTsStamp(null,{padder:"0"})}});TS.utility.msgs.replaceMsg(r,l)}}else{if(s&&s.error)if("message_not_found"===s.error){if(o._attempts<10){o._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitEdit(n,r,i,o._attempts,o._delay_ms)},o._delay_ms);return}r.is_channel?TS.channels.legacyRemoveMsg(r.id,n):r.is_im?TS.ims.legacyRemoveMsg(r.id,n):r.is_mpim?TS.mpims.legacyRemoveMsg(r.id,n):r.is_group&&TS.groups.legacyRemoveMsg(r.id,n);TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")())}else if("edit_window_closed"===s.error){var u="<p>"+TS.interop.i18n.t("Sorry, but messages can only be edited for <strong>{msg_edit_duration_text}</strong> after posting.","msg_edit")({msg_edit_duration_text:t(TS.prefs.getTeamPref("msg_edit_window_mins"))})+"</p>";TS.model.user.is_admin&&(u+="<p>"+TS.interop.i18n.t('(To adjust the message editing window, visit <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.)',"msg_edit")()+"</p>");TS.generic_dialog.alert(u,TS.interop.i18n.t("Message editing failed","msg_edit")())}else"msg_too_long"===s.error?TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, your message is too long. Please shorten it and try again.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")()):TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")());else TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")());TS.msg_edit.startEdit(n.ts,r,{text:i,force_reopen:true})}};TS.api.call("chat.update",{channel:r.id,ts:n.ts,text:TS.format.cleanMsg(i),_attempts:a,_delay_ms:s}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;o(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;o(i,t,n,r);return{data:t,args:n,request_id:r}})},promptEdit:function e(){if("none"!==$("#message_editing_info").css("display")){$("#message_edit_container").scrollintoview({duration:300,px_offset:0});return}$("#message_editing_info").css("display","");$("#message_editing_info").css("opacity",0);$("#message_edit_container").scrollintoview({duration:300,px_offset:0,complete:function e(){$("#message_editing_info").transition({opacity:1},250)}})},startDelete:function t(r,i,a,s,o){o=o||_.noop;if(!r){TS.error("no msg_ts?");o();return null}_.isString(i)&&(i=TS.redux.channels.getEntityById(i));if(!i){TS.error("no model_ob?");o();return null}if(!TS.useReactMessages()&&!i.msgs){TS.error("no model_ob.msgs?");o();return null}var l;if(TS.useReactMessages()){l=TS.redux.messages.getMessageByTimestamp(i.id,r);l&&l.file&&(l=n({},l,{file:TS.redux.files.getFileById(l.file)}))}l||(l=TS.utility.msgs.getMsg(r,e(i)));l||(l=TS.ui.replies.getActiveMessage(i,r));TS.model.threads_view_is_showing&&!l&&(l=TS.client.threads.getMessage(i,r));if(!l){TS.error("no msg in msgs?");o();return null}TS.msg_edit.deleting_from_editing=!!s;TS.msg_edit.current_msg=l;TS.msg_edit.current_model_ob=i;var u=TS.msg_edit.getAllDivsForMsg(l.ts);var d='<p class="bottom_margin">'+TS.interop.i18n.t("Are you sure you want to delete this message? This cannot be undone.","msg_edit")()+"</p>";if(l.subtype){var c;if(l.file){c="file";"snippet"===l.file.mode?c="snippet":"post"===l.file.mode&&(c="post")}var m="";"file_upload"===l.subtype?"file"===c?m=TS.interop.i18n.t("Note that deleting this message will not delete the file that was uploaded.","msg_edit")():"snippet"===c?m=TS.interop.i18n.t("Note that deleting this message will not delete the snippet that was uploaded.","msg_edit")():"post"===c&&(m=TS.interop.i18n.t("Note that deleting this message will not delete the post that was uploaded.","msg_edit")()):"file_share"===l.subtype?"file"===c?m=TS.interop.i18n.t("Note that deleting this message will not unshare the file.","msg_edit")():"snippet"===c?m=TS.interop.i18n.t("Note that deleting this message will not unshare the snippet.","msg_edit")():"post"===c&&(m=TS.interop.i18n.t("Note that deleting this message will not unshare the post.","msg_edit")()):"file_comment"===l.subtype&&(m=TS.interop.i18n.t("Note that deleting this message will not delete the comment.","msg_edit")());m&&(d+="<p>"+m+"</p>")}u.addClass("delete_mode");TS.generic_dialog.start({title:TS.interop.i18n.t("Delete message","msg_edit")(),body:d+TS.templates.builders.msgs.buildHTML({msg:l,model_ob:i,standalone:true}),go_button_text:TS.interop.i18n.t("Delete","msg_edit")(),go_button_class:"btn_danger",onGo:function e(){TS.msg_edit.deleting_from_editing&&(TS.useReactMessages()?TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessage({channelId:i.id,ts:r})):TS.msg_edit.onCancelEdit());TS.msg_edit.commitDeleteInternal(a)},onCancel:function e(){TS.msg_edit.onCancelDelete()},onEnd:o});TS.generic_dialog.div.find("img.msg_inline_img.hidden").each(function(e,t){var n=$(t);n.prop("src",n.data("real-src"));n.removeClass("hidden")})},onCancelDelete:function e(){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}var t=TS.msg_edit.getAllDivsForMsg(TS.msg_edit.current_msg.ts);t.removeClass("delete_mode");TS.msg_edit.deleting_from_editing&&TS.utility.contenteditable.focus($("#msg_text"))},commitDeleteInternal:function e(t){TS.msg_edit.commitDelete(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelDelete,t)},commitDelete:function t(n,r,i,a,s,o,l){if(!n){TS.error("no msg?");return null}if(!r){TS.error("no model_ob?");return null}var u=r.id;o||(o=0);l||(l=100);if(n.is_ephemeral||TS.interop.rules.messages.isTempMsg(n))r.is_channel?TS.channels.legacyRemoveMsg(r.id,n):r.is_im?TS.ims.legacyRemoveMsg(r.id,n):r.is_mpim?TS.mpims.legacyRemoveMsg(r.id,n):r.is_group&&TS.groups.legacyRemoveMsg(r.id,n);else{if(n._jl_rollup_hash&&n._jl_rollup_hash.msg_ids){var d=n._jl_rollup_hash.msg_ids;d.forEach(function(t){if(t==n.ts)return;var d=function t(o,l,u){if(o||"message_not_found"===l.error){if("message_not_found"===l.error&&u._attempts<10){u._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitDelete(n,r,i,a,s,u._attempts,u._delay_ms)},u._delay_ms);return}(TS.web||r.is_channel&&!r.is_member)&&(r.is_channel?TS.channels.legacyRemoveMsg(r.id,TS.utility.msgs.getMsg(u.ts,e(r))):r.is_im?TS.ims.legacyRemoveMsg(r.id,TS.utility.msgs.getMsg(u.ts,e(r))):r.is_mpim?TS.mpims.legacyRemoveMsg(r.id,TS.utility.msgs.getMsg(u.ts,e(r))):r.is_group&&TS.groups.legacyRemoveMsg(r.id,TS.utility.msgs.getMsg(u.ts,e(r))))}};TS.api.call("chat.delete",{channel:u,ts:t,_attempts:o,_delay_ms:l}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;d(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;d(i,t,n,r);return{data:t,args:n,request_id:r}})})}var c=function e(t,o,l){if(t||"message_not_found"===o.error){if("message_not_found"===o.error&&l._attempts<10){l._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitDelete(n,r,i,a,s,l._attempts,l._delay_ms)},l._delay_ms);return}(TS.web||r.is_channel&&!r.is_member)&&(r.is_channel?TS.channels.legacyRemoveMsg(r.id,n):r.is_im?TS.ims.legacyRemoveMsg(r.id,n):r.is_mpim?TS.mpims.legacyRemoveMsg(r.id,n):r.is_group&&TS.groups.legacyRemoveMsg(r.id,n));a&&a()}else{i&&i();if(!s){var u;u=o&&o.error?TS.interop.i18n.t("The message was not deleted. The error was: {error}","msg_edit")({error:o.error}):TS.interop.i18n.t("The message was not deleted. The error was: unknown","msg_edit")();TS.generic_dialog.start({title:TS.interop.i18n.t("Delete Message Failed","msg_edit")(),body:u,show_cancel_button:false,esc_for_ok:true})}}if(TS.web){var d=!TS.utility.msgs.getDisplayedMsgs(r.msgs).length;if(d){var c=$(".pager .previous a");c.attr("href")?window.location=c.attr("href"):TS.reload(false,"TS.msg_edit.commitEdit")}}};TS.api.call("chat.delete",{channel:u,ts:n.ts,_attempts:o,_delay_ms:l}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;c(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;c(i,t,n,r);return{data:t,args:n,request_id:r}})}},$last_clicked_cb:null,startBatchDelete:function e(){$("#msgs_div").addClass("selecting_messages");$("#channel_actions_div").addClass("hidden");$("#batch_delete_div").removeClass("hidden");TS.msg_edit.batchDeleteSelectionChanged()},cancelBatchDelete:function e(){TS.msg_edit.selectNoneBatchDelete();$("#msgs_div").removeClass("selecting_messages");$("#channel_actions_div").removeClass("hidden");$("#batch_delete_div").addClass("hidden")},doBatchDelete:function t(){var n=$("#msgs_div").find(".msg_select_cb:checked");var r=TS.shared.legacyGetActiveModelOb();if(n.length){var i=n.length;if(1==i){TS.msg_edit.startDelete(n.eq(0).closest(".message").data("ts"),r,TS.msg_edit.cancelBatchDelete);return}var a='<p class="small_bottom_margin">'+TS.interop.i18n.t("Are you sure you want to delete {count, plural, =1 {this message} other {these messages}}? This cannot be undone! Note that deleting these messages will not delete any files or file comments.","msg_edit")({count:i})+"</p>";var s;var o;for(var l=0;l<i;l+=1){o&&!o.no_display&&(s=o);var u=n.eq(l).closest(".message").data("ts");o=TS.utility.msgs.getMsg(u,e(r));if(!o)continue;a+=TS.templates.builders.msgs.buildHTML({msg:o,prev_msg:s,model_ob:r,standalone:true})}var d=function e(t){function n(e){TS.msg_edit.commitDelete(e,r,i,i,true)}function i(){if(t.length)setTimeout(function(){n(t.pop())},100);else{TS.generic_dialog.cancel();TS.generic_dialog.start({title:"",body:TS.interop.i18n.t("Messages deleted.","msg_edit")(),show_cancel_button:false,esc_for_ok:true})}}TS.generic_dialog.start({title:"",body:"<p>"+TS.interop.i18n.t("Deleting messages...","msg_edit")()+"</p>",show_cancel_button:false,show_go_button:false});i()};TS.generic_dialog.start({title:TS.interop.i18n.t("Delete Messages","msg_edit")(),body:a,go_button_text:TS.interop.i18n.t("Yes, delete these messages","msg_edit")(),go_button_class:"btn_danger",onGo:function t(){var a=[];for(var s=0;s<i;s+=1){var o=n.eq(s).closest(".message").data("ts");if(!o){alert("no msg_ts");return}var l=TS.utility.msgs.getMsg(o,e(r));if(!l){alert("no msg");return}a.push(l)}TS.msg_edit.cancelBatchDelete();d(a)}})}},batchDeleteSelectionChanged:function e(t,n){var r=TS.msg_edit.$last_clicked_cb;if(r&&t&&n){var i=$("#msgs_div").find(".msg_select_cb:visible");var a=i.index(r);var s=i.index(t);if(a>s){s=a;a=i.index(t)}var o="checked"===r.prop("checked");for(var l=a;l<=s;l+=1)i.eq(l).prop("checked",o)}r=t;TS.msg_edit.$last_clicked_cb=r;var u=TS.interop.i18n.t("0 messages","msg_edit")();var d=$("#msgs_div").find(".msg_select_cb:checked");$("#msgs_div").find(".multi_delete_mode").removeClass("multi_delete_mode");if(d.length){u=TS.interop.i18n.t("{count, plural, =1 {# message} other {# messages}}","msg_edit")({count:d.length});$("#batch_delete_button").removeClass("disabled");d.each(function(){$(this).closest(".message").addClass("multi_delete_mode")})}else $("#batch_delete_button").addClass("disabled");$("#batch_delete_count_span").html(u)},selectAllBatchDelete:function e(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",true);TS.msg_edit.batchDeleteSelectionChanged()},selectNoneBatchDelete:function e(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",false);TS.msg_edit.batchDeleteSelectionChanged()},startRemoveBroadcast:function e(t,n,r,i){i=i||_.noop;_.isString(n)&&(n=TS.redux.channels.getEntityById(n));var a=TS.utility.msgs.findMsg(t,n.id);if(!a){TS.error("Cannot find "+t+" for startRemoveBroadcast");i();return}TS.msg_edit.deleting_from_editing=!!r;TS.msg_edit.current_msg=a;TS.msg_edit.current_model_ob=n;var s=TS.msg_edit.getDivForMsgInMsgPane(t);var o=n.is_channel||n.is_group&&!n.is_mpim;var l=TS.templates.builders.msgs.buildHTML({msg:a,model_ob:n,standalone:true});var u=TS.templates.thread_confirm_remove_broadcast({is_channel_or_group:o,msg_html:new Handlebars.SafeString(l)});s.addClass("delete_mode");var d;d=o?TS.interop.i18n.t("Remove from channel","msg_edit")():TS.interop.i18n.t("Remove from conversation","msg_edit")();TS.generic_dialog.start({title:d,body:u,go_button_text:TS.interop.i18n.t("Remove message","msg_edit")(),onGo:function e(){TS.msg_edit.deleting_from_editing&&TS.msg_edit.onCancelEdit();TS.api.call("chat.delete",{channel:n.id,ts:a.ts,broadcast_delete:true}).then(function(){TS.useReactMessages()&&TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessage({channelId:n.id,ts:a.ts}));TS.web&&(n.is_channel?TS.channels.legacyRemoveMsg(n.id,a):n.is_im?TS.ims.legacyRemoveMsg(n.id,a):n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,a):n.is_group&&TS.groups.legacyRemoveMsg(n.id,a))}).catch(function(e){TS.error("Failed to remove broadcast "+a.ts);TS.error(e);TS.msg_edit.current_msg===a&&TS.msg_edit.onCancelDelete()})},onCancel:function e(){TS.msg_edit.onCancelDelete()},onEnd:i})},pauseEditing:function e(){if(!TS.msg_edit.editing)return;var t=$("#msg_text");var n=TS.utility.contenteditable.value(t);var r=TS.utility.contenteditable.cursorPosition(t);var i={msg_ts:TS.msg_edit.current_msg.ts,model_ob:TS.msg_edit.current_model_ob,text:n,cursor_start:r.start,cursor_length:r.length};TS.msg_edit.resetEditUI();return i},resumeEditing:function e(t){if(TS.msg_edit.editing)return;if(!t)return;if(TS.model.active_cid!==t.model_ob.id)return;TS.msg_edit.startEdit(t.msg_ts,t.model_ob,t)},focusAndSetCursorPosition:function e(t,n){TS.utility.contenteditable.focus(t);TS.utility.rAF(function(){n&&_.isFinite(n.cursor_start)&&_.isFinite(n.cursor_length)?TS.utility.contenteditable.cursorPosition(t,n.cursor_start,n.cursor_length):TS.utility.contenteditable.cursorPosition(t,1e8,0)})}});var e=function e(t){return TS.model.archive_view_is_showing&&t._archive_msgs?t._archive_msgs:t.msgs};var t=function e(t){return TS.interop.datetime.toTimeDuration(t,{units:"minutes"})}})()},11256:function(e,t){(function(){TS.registerModule("ui.fs_modal",{is_showing:false,transition_duration:250,start:function s(l){if(TS.ui.fs_modal.is_showing){w(l);return}m=_.defaults({},l,f);TS.ui.fs_modal.is_showing=true;TS.tips.hideAll();p();m.modal_class&&e.addClass(m.modal_class);m.modal_bg_class&&t.addClass(m.modal_bg_class);m.modal_contents_container_class&&e.find(".contents_container").addClass(m.modal_contents_container_class);r=e.find(".contents");i=e.find("#fs_modal_sidebar");a=e.find("#fs_modal_header");o=e.find("#fs_modal_footer_content");var u;if(m.body_template_html){u=m.body_template_html;m.body&&TS.warn("Both body and body_template_html were passed in settings to TS.ui.fs_modal.start(). Using body_template.")}else u=TS.templates.fs_modal_generic_contents({settings:m,fs_modal_header:_.includes(m.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(m.modal_class,"fs_modal_footer")});r.html(u);m.header_html&&a.replaceWith(m.header_html);m.footer_html&&o.html(m.footer_html);m.sidebar_html&&i.html(m.sidebar_html);m.modal_gallery&&x();l.title&&e.attr("aria-label",l.title);!l.title&&a&&e.attr("aria-labelledby","fs_modal_header");TS.boot_data.feature_accessible_fs_dialogs&&$("#client-ui").attr("aria-hidden",true);e.on("click",".dialog_go",h);e.on("click",".dialog_secondary_go",g);e.on("click",".dialog_cancel",v);$(window.document).off(".fs_modal");$(window.document).on("keydown.fs_modal",S);$(window.document).on("focusin.fs_modal",T);n.on("click",function(){m.esc_for_ok?h():v()});$("html").addClass("fs_modal_active");setTimeout(function(){t&&t.addClass("active");e&&e.addClass("active")},0);e.find("input").length?e.find("input").first().focus():document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur();m.onShow&&m.onShow();if(m.onShowComplete||TS.model.is_our_app&&TSSSB.nodrag.getIsRequired()){var d=false;var c=k();var b=setTimeout(function(){d=true;C();m.onShowComplete&&m.onShowComplete();e.off(c+".fs_modal_show_complete")},600);e.one(c+".fs_modal_show_complete",function(){if(!d){C();clearTimeout(b);m.onShowComplete&&m.onShowComplete()}})}},close:function e(t){v(t)},bindBackButton:function e(t){$("#fs_modal_back_btn").off("click.fs_modal").on("click.fs_modal",t)},unbindBackButton:function e(){$("#fs_modal_back_btn").off("click.fs_modal")},showBackButton:function e(){$("#fs_modal_back_btn").removeClass("hidden")},hideBackButton:function e(){$("#fs_modal_back_btn").addClass("hidden")},activate:function n(){e.addClass("active");t.addClass("active")},deactivate:function n(){e.removeClass("active");t.removeClass("active")},setHeaderTitle:function t(n){if(!a.length)return;var r=TS.templates.fs_modal_header({title:n});a.replaceWith(r);a=e.find("#fs_modal_header")},showFooter:function t(){if(!s.length)return;e.addClass("fs_modal_footer");s.removeClass("hidden")},hideFooter:function t(){if(!s.length)return;e.removeClass("fs_modal_footer");s.addClass("hidden")},isShowing:function e(){return TS.ui.fs_modal.is_showing}});var e;var t;var n;var r;var i;var a;var s;var o;var l=0;var u=false;var d;var c=".modal,[role=dialog]:not(.modal),[role=alertdialog]:not(.modal)";var m=null;var f={title:"",body:"",body_template_html:null,show_go_button:true,show_secondary_go_button:false,show_cancel_button:true,go_button_text:TS.interop.i18n.t("OK","fs_modal")(),go_button_class:"",secondary_go_button_text:TS.interop.i18n.t("OK 2","fs_modal")(),secondary_go_button_class:"",cancel_button_text:TS.interop.i18n.t("Cancel","fs_modal")(),disable_default_controls:false,disable_esc:false,onGo:null,onSecondaryGo:null,onCancel:null,onEnd:null,esc_for_ok:false,onShow:null,enter_always_gos:false,fullscreen:false,modal_class:null,modal_bg_class:null,modal_contents_container_class:null,modal_gallery:null,sidebar_html:null,header_html:null,footer_html:null};var p=function l(){t=null;e=null;a=null;s=null;o=null;n=null;r=null;i=null;var u={settings:m,fs_modal_header:_.includes(m.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(m.modal_class,"fs_modal_footer"),fs_modal_sidebar:_.includes(m.modal_class,"fs_modal_sidebar"),disable_default_controls:m.disable_default_controls};var d=TS.templates.fs_modal(u);$("body").append(d);t=$("#fs_modal_bg");e=$("#fs_modal");a=$("#fs_modal_header");s=$("#fs_modal_footer");n=$("#fs_modal_close_btn")};var h=function e(){if(!TS.ui.fs_modal.is_showing){TS.error("not showing?");return}m.onGo?false!==m.onGo()&&v():v()};var g=function e(){if(!TS.ui.fs_modal.is_showing){TS.error("not showing?");return}m.onSecondaryGo?false!==m.onSecondaryGo()&&v():v()};var S=function e(t){if(t.which!=TS.utility.keymap.enter||"BODY"!==TS.utility.getActiveElementProp("NODENAME")&&!m.enter_always_gos){if(t.which==TS.utility.keymap.esc){if(m.disable_esc)return;if(m.esc_for_ok)h();else{v();m.clog_name&&TS.interop.clog.track(m.clog_name+"_ACTION",{action:"close_modal",trigger:"esc_key"})}}}else if(m.show_go_button){h();t.preventDefault()}};var T=function t(n){if(!TS.boot_data.feature_accessible_fs_dialogs)return;if(!TS.boot_data.feature_trap_kb_within_fs_modals)return;var r=$(c).filter(function(){return"none"!==$(this).css("display")}).toArray();var i=_.sortBy(r,function(e){return parseInt($(e).css("z-index"),10)}).pop();if(!e.is(i))return;var a=n.target;e.is(a)||e.has(a).length||e.focus()};var v=function n(r){if(A(r)){e&&e.removeClass("active");t&&t.removeClass("active");setTimeout(function(){$("html").removeClass("fs_modal_active")},TS.ui.fs_modal.transition_duration);m.onCancel&&m.onCancel();y()}};var b=function n(){e.removeAttr("aria-label");e.removeAttr("aria-labelledby");e.remove();t.remove();TS.ui.fs_modal.is_showing=false;M()};var y=function e(){setTimeout(function(){b();TS.boot_data.feature_accessible_fs_dialogs&&$("#client-ui").removeAttr("aria-hidden")},TS.ui.fs_modal.transition_duration);$(window.document).off("keydown.fs_modal");$(window.document).off("focusin.fs_modal");m.onEnd&&m.onEnd();TS.tips.unhideAll()};var w=function n(r){e.removeClass("active");m.onCancel&&m.onCancel();var i=t.attr("id",null).addClass("fs_modal_bg");setTimeout(function(){e.remove();TS.ui.fs_modal.is_showing=false;TS.ui.fs_modal.start(r);setTimeout(i.remove.bind(i),TS.ui.fs_modal.transition_duration)},TS.ui.fs_modal.transition_duration)};var k=function t(){var n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",transition:"transitionend"};for(var r in n)if(void 0!==e[0].style[r])return n[r]};var x=function t(){var n=e.find("[data-modal-items]");l=m.modal_gallery.index;TS.ui.fs_modal.hideFooter();l?e.find('[data-modal-gallery-index="'+l+'"]').removeClass("hidden"):e.find("[data-modal-gallery-index]").first().removeClass("hidden");e.on("click","[data-modal-gallery-direction]",function(){var e=$(this).data("modal-gallery-direction");l+=e;n.find("[data-modal-gallery-index]").addClass("hidden");n.find('[data-modal-gallery-index="'+l+'"]').removeClass("hidden");I()});I()};var C=function e(){if(!TS.model.is_our_app||!TSSSB.nodrag.getIsRequired())return;if(_.get(window,"desktop.app.updateDragRegion")){window.desktop.app.updateDragRegion([]);return}TSSSB.nodrag.regions.set([]);var t=$("#fs_modal").find("header").find("button, a").toArray();if(!u){TSSSB.nodrag.updateElements(t);u=true}d=_.debounce(function(){window.requestIdleCallback(function(){return TSSSB.nodrag.updateElements(t)},{timeout:200})},400);$(window).off("resize.setupNoDragFSM").on("resize.setupNoDragFSM",d)};var M=function e(){if(!TS.model.is_our_app||!TSSSB.nodrag.getIsRequired())return;u=false;$(window).off("resize.setupNoDragFSM");TSSSB.nodrag.regions.set([]);TS.client.channel_header.calculateNoDragRegions();TS.search.autocomplete.calculateNoDragRegions()};var I=function t(){var n=e.find('[data-modal-gallery-direction="-1"]');var r=e.find('[data-modal-gallery-direction="1"]');var i=e.find("[data-modal-slideshow-count]");var a=e.find("[data-modal-slideshow-total]");var s=m.modal_gallery.total_items;0===l?n.prop("disabled",true):n.prop("disabled",false);l===s?r.prop("disabled",true):r.prop("disabled",false);i.html(l+1);a.html(s+1)};var A=function e(t){if(t)return true;if(TS.ui.lazy_filter_select.is_list_open)return false;if(TS.ui.react_emoji_menu.is_showing)return false;if(TS.model.menu_is_showing)return false;if(TS.model.dialog_is_showing)return false;if(TS.utility.isTabCompleteShowing())return false;return true}})()},11257:function(e,t){(function(){TS.registerModule("ui.admin_edit_team_profile",{onStart:function e(){$("body").on("click",'[data-action="edit_team_profile_modal"]',TS.ui.admin_edit_team_profile.start)},start:function e(){C()&&a()}});var e;var t;var n;var r=[];var i=50;var a=function e(){var t={body_template_html:TS.templates.admin_edit_team_profile_modal(),onShow:s,onCancel:o};TS.ui.fs_modal.start(t)};var s=function n(){e=$("#edit_team_profile_container");t=$("body");e.on("click",'[data-action="edit_team_profile_to_custom"]',v);e.on("click",'[data-action="edit_team_profile_to_add"]',T);e.on("click",'[data-action="edit_team_profile_to_edit"]',b);e.on("click",'[data-action="edit_team_profile_to_hide"]',y);e.on("click",'[data-action="edit_team_profile_to_delete"]',w);e.on("click",'[data-action="edit_team_profile_cancel"]',S);e.on("click",'[data-action="edit_team_profile_confirm_edit"]',h);e.on("click",'[data-action="edit_team_profile_confirm_hide"]',m);e.on("click",'[data-action="edit_team_profile_confirm_delete"]',c);e.on("click",'[data-action="edit_team_profile_remove_option"]',E);e.on("click",'[data-action="edit_team_profile_add_option"]',P);e.on("focusin",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',D);e.on("focusout",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',H);e.on("input",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',O);e.on("click",'[data-action="edit_team_profile_list_menu"]',L);e.on("input","input",V);t.on("keydown.admin_submit",l);u().then(S).catch(TS.error)};var o=function i(){M(true);e=null;r=[];n=null;t.off("keydown.admin_submit");t=null;TS.web&&TS.web.account_profile&&TS.web.account_profile.render()};var l=function e(t){if(t.which==TS.utility.keymap.enter){$(n).find('button[type="submit"]').trigger("click");return false}};var u=function e(){return TS.team.ensureTeamProfileFields()};var d=function e(t,n){if(!t)return;return TS.api.call(t,n).then(function(e){"team.profile.delete"===t?TS.team.upsertTeam(_.assign({id:TS.boot_data.team_id},{profile:JSON.parse(n.profile)})):TS.team.upsertTeam(_.assign({id:TS.boot_data.team_id},e.data));return Promise.resolve(e)},function(e){return Promise.reject(e)})};var c=function e(t){var n=$(t.target);var r=n.data("id");r||(n=n.closest("[data-id]"));r=n.data("id");if(!r)return;var i=TS.team.getTeamProfileFieldById(r);if(!i)return;g("team.profile.delete",[r]).then(S,_.noop)};var m=function e(t){p(t,true)};var f=function e(t){p(t,false)};var p=function e(t,n){var r=$(t.target);var i=r.data("id");i||(r=r.closest("[data-id]"));i=r.data("id");if(!i)return;var a=TS.team.getTeamProfileFieldById(i);if(!a)return;a=$.extend({},a);a.is_hidden=n;n&&(a.ordering=a.ordering||R());function s(){S();K(i)}g("team.profile.set",[a]).then(s,_.noop)};var h=function t(n){var r=e.find("#edit_team_profile_edit");if(!TS.ui.validation.validate(r,{quiet:true,fast:true})){TS.ui.validation.validate(r);Ladda.stopAll();$("#edit_team_profile_confirm_edit_btn").addClass("disabled");return}var i=$(n.target);var a=i.data("id");a||(i=i.closest("[data-id], [data-type]"));a=i.data("id");var s=e.find('input[name="label"]');var o=e.find('input[name="hint"]');var l=TS.team.getTeamProfileFieldById(a)||{};var u=JSON.stringify(l);l=$.extend({},l);l.type=l.type||i.data("type")||"text";l.label=s.val().trim();l.hint=o.val().trim();l.ordering=l.ordering||R();"options_list"===l.type&&(l.possible_values=e.find('input[name^="option_"]').map(function(){return $(this).val().trim()}).toArray());function d(){S();K(a)}if(JSON.stringify(l)==u){d();Ladda.stopAll()}else g("team.profile.set",[l]).then(d,_.noop)};var g=function e(t,n){n=n&&n.length?n:TS.model.team.profile.fields;var r={profile:JSON.stringify({fields:n})};return d(t,r).catch(function(e){if("no_perms"!==e.data.error&&"missing_scope"!==e.data.error){if("field_bad_order"===e.data.error){TS.error("Failed to create profile field: "+e.data.error);return TS.generic_dialog.alert(TS.interop.i18n.t("Apologies, but the maximum number of profile fields you can add is {max_no_of_fields, number}. Please remove some existing fields if you\u2019d like to add different ones.","team_profile")({max_no_of_fields:i}))}TS.error("Failed to customize profile: "+e.data.error);return TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","team_profile")())}TS.generic_dialog.start({body:TS.interop.i18n.t("Sorry! An owner in your workspace has restricted who can customize your members\u2019 profile.","team_profile")(),show_cancel_button:false,esc_for_ok:true,fullscreen:false,onEnd:TS.ui.fs_modal.close})}).finally(Ladda.stopAll)};var S=function t(){r.length=0;r.push({back:t});var n={};n.team_profile_fields=q();n.hidden_team_profile_fields=G();n.default_team_profile_fields=z();var i=TS.templates.admin_edit_team_profile_list(n);e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Customize profile","team_profile")()).removeClass("hidden center_and_narrow");var a;a=TS.model.team.profile&&TS.model.team.profile.fields.length>=50?'<div class="alert alert_info"><i class="ts_icon ts_icon_info_circle"></i>'+TS.interop.i18n.t("You have reached the maximum number of fields that can be added to profiles.","team_profile")()+"</div>":TS.interop.i18n.t("Expand your members\u2019 profiles by adding additional fields below","team_profile")();e.find("#edit_team_profile_value_note").html(a).removeClass("hidden center_and_narrow");e.find("#edit_team_profile_list").html(i);U("#edit_team_profile_list");j();x();M(true)};var T=function t(){r.push({back:t});var n={};n.default_team_profile_fields=z();var i=TS.templates.admin_edit_team_profile_add(n);e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Select a field type","team_profile")()).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").addClass("hidden");e.find("#edit_team_profile_add").html(i);U("#edit_team_profile_add");x();M()};var v=function t(){r.push({back:t});var n=TS.templates.admin_edit_team_profile_custom();e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Create a new field","team_profile")()).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").text(TS.interop.i18n.t("Which type of field would you like to create?","team_profile")()).removeClass("hidden center_and_narrow");e.find("#edit_team_profile_custom").html(n);U("#edit_team_profile_custom");x();M();B()};var b=function t(n){var i=$(n.target);if(i.hasClass("ts_icon_grabby_patty"))return false;var a=i.data("id");a||(i=i.closest("[data-id], [data-type]"));a=i.data("id");var s={};var o;if(a){s=TS.team.getTeamProfileFieldById(a);if(!s)return;o=TS.interop.i18n.t("Edit profile field","team_profile")()}else{s.type=i.data("type");s.label=i.data("label");o=TS.interop.i18n.t("Customize profile field","team_profile")()}n.stopPropagation();r.push({back:t,event:n});var l=TS.templates.admin_edit_team_profile_edit(s);e.find("#edit_team_profile_header").text(o).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").addClass("hidden");e.find("#edit_team_profile_edit").html(l);U("#edit_team_profile_edit");I();A();B();Ladda.bind("#edit_team_profile_confirm_edit_btn");x();M();V()};var y=function t(n){var i=$(n.target);var a=i.data("id");a||(i=i.closest("[data-id]"));a=i.data("id");if(!a)return;var s=TS.team.getTeamProfileFieldById(a);if(!s)return;n.stopPropagation();r.push({back:t,event:n});var o=TS.templates.admin_edit_team_profile_hide({id:s.id,can_delete:!_.get(s,"options.is_scim",false)});var l=TS.interop.i18n.t('Hide "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var u=TS.interop.i18n.t("All data entered for this field will no longer be visible on your members\u2019 profiles. You can un-hide it later.","team_profile")();e.find("#edit_team_profile_value_note").text(u).addClass("center_and_narrow").removeClass("hidden");e.find("#edit_team_profile_hide").html(o);U("#edit_team_profile_hide");Ladda.bind("#edit_team_profile_confirm_hide_btn");k();M()};var w=function t(n){var i=$(n.target);var a=i.data("id");a||(i=i.closest("[data-id]"));a=i.data("id");if(!a)return;var s=TS.team.getTeamProfileFieldById(a);if(!s)return;n.stopPropagation();r.push({back:t,event:n});var o=TS.templates.admin_edit_team_profile_delete(s);var l=TS.interop.i18n.t('Delete "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var u=TS.interop.i18n.t("<strong>Are you sure?</strong> All data associated with this field will be permanently deleted. This <strong>cannot be undone</strong>.","team_profile")();e.find("#edit_team_profile_value_note").html(u).addClass("center_and_narrow").removeClass("hidden");e.find("#edit_team_profile_delete").html(o);U("#edit_team_profile_delete");Ladda.bind("#edit_team_profile_confirm_delete_btn");k();M()};var k=function t(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh");e.css({margin:"auto 0",height:"auto","padding-top":0})};var x=function t(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height","");e.css({margin:"",height:"","padding-top":""})};var C=function e(){if(!(TS.model.team&&TS.model.team.plan))return false;var t=TS.model.user;if(!t)return false;if("admin"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_admin;if("owner"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_owner;return true};var M=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(function(){r.pop();var e=r.pop();e.back(e.event)});TS.ui.fs_modal.showBackButton()}};var I=function t(){var n=e.find(".option_row");n.length>=3?n.addClass("show_remove_action"):n.removeClass("show_remove_action")};var A=function t(){O({target:e.find('.option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]')})};var E=function e(t){$(t.target).closest(".row.option_row").remove();V();I();A();F()};var P=function t(){var n=TS.templates.admin_edit_team_profile_option_row({index:e.find(".row.option_row").length});e.find("#option_rows").append(n).find(".row.option_row").last().find("input").focus();V();I();F()};var F=function t(){50===e.find(".row.option_row").length?e.find('[data-action="edit_team_profile_add_option"]').addClass("hidden").next().removeClass("hidden"):e.find('[data-action="edit_team_profile_add_option"]').removeClass("hidden").next().addClass("hidden")};var O=function t(n){var r=$(n.target);var i=r.val();i&&(i=i.trim());void 0===i||i.length||(i=r.data("default"));e.find('.profile_field_preview [data-id="'+r.data("target")+'"]').text(i)};var D=function t(n){var r=e.find('.profile_field_preview [data-id="'+$(n.target).data("target")+'"]');var i=r.closest("select");i.length&&(r=i);r.addClass("highlight_yellow_bg")};var H=function t(n){var r=e.find('.profile_field_preview [data-id="'+$(n.target).data("target")+'"]');var i=r.closest("select");i.length&&(r=i);r.removeClass("highlight_yellow_bg")};var B=function t(){var n=e.find(".edit_team_profile_lazy_filter_select");if(!n.length)return;var r="USLACKBOT";TS.boot_data.feature_deprecate_get_member_by_name||(r=TS.interop.members.getMemberByName("slackbot").id);var i={append:true,classes:"disabled",preselected_ids:[r]};TS.ui.people_picker.make(n,i)};var j=function t(){e.find("#edit_team_profile_list_drag_and_drop_area").sortable({items:".visible_row[data-id]",handle:".ts_icon_grabby_patty",forcePlaceholderSize:true}).on("sortupdate",function(e){e.stopPropagation();var t=[];$(this).find(".row[data-id]").each(function(e){var n=TS.team.getTeamProfileFieldById($(this).data("id"));if(n&&n.ordering!=e){n.ordering=e;t.push({id:n.id,ordering:e})}});var n=TS.team.sortTeamProfileFieldsByOrdering(TS.model.team.profile.fields);TS.teams.upsertTeam(_.assign({},TS.model.team,{profile:{fields:n}}));g("team.profile.reorder",t)})};var R=function e(){if(!TS.model.team.profile.fields.length)return 0;return _.max(TS.model.team.profile.fields.map(function(e){return e.ordering}))+1};var L=function e(t){t.stopPropagation();var n=$(t.target).closest("[data-id]").get(0);var r={};r.is_scim=$(t.target).closest("[data-is-scim]").data("is-scim");var i=jQuery.Event("click",{target:n,currentTarget:n});TS.menu.startWithEditTeamProfileListActions(i,N,r)};var N=function e(t){t.preventDefault();var n=$(t.target).closest("[data-id]");n.is('[data-action="edit_team_profile_to_show"]')?f(t):n.is('[data-action="edit_team_profile_to_hide"]')?y(t):n.is('[data-action="edit_team_profile_to_delete"]')&&w(t);TS.menu.end()};var U=function t(r){var i=["#edit_team_profile_loading","#edit_team_profile_list","#edit_team_profile_add","#edit_team_profile_custom","#edit_team_profile_edit","#edit_team_profile_hide","#edit_team_profile_delete"].filter(function(e){return e!==r}).join(", ");e.find(i).addClass("hidden");e.find(r).removeClass("hidden");n=r};var q=function e(){var t=TS.team.getVisibleTeamProfileFields();return t.length?t:null};var G=function e(){var t=TS.team.getHiddenTeamProfileFields();return t.length?t:null};var W=function e(){return TS.model.team.profile.fields.reduce(function(e,t){e[t.label.toLowerCase()]=true;return e},{})};var z=function e(){var t=W();var n=[{type:"text",label:TS.interop.i18n.t("Address","team_profile")()},{type:"date",label:TS.interop.i18n.t("Birthdate","team_profile")()},{type:"user",label:TS.interop.i18n.t("Direct Reports","team_profile")()},{type:"link",label:TS.interop.i18n.t("Facebook","team_profile")()},{type:"link",label:TS.interop.i18n.t("Flickr","team_profile")()},{type:"link",label:TS.interop.i18n.t("GitHub","team_profile")()},{type:"link",label:TS.interop.i18n.t("Instagram","team_profile")()},{type:"link",label:TS.interop.i18n.t("LinkedIn","team_profile")()},{type:"user",label:TS.interop.i18n.t("Manager","team_profile")()},{type:"link",label:TS.interop.i18n.t("Pinterest","team_profile")()},{type:"text",label:TS.interop.i18n.t("Skype","team_profile")()},{type:"link",label:TS.interop.i18n.t("SoundCloud","team_profile")()},{type:"date",label:TS.interop.i18n.t("Start Date","team_profile")()},{type:"link",label:TS.interop.i18n.t("Tumblr","team_profile")()},{type:"link",label:TS.interop.i18n.t("Twitter","team_profile")()},{type:"link",label:TS.interop.i18n.t("YouTube","team_profile")()}].filter(function(e){return!t[e.label.toLowerCase()]});return n.length?n:[]};var K=function t(n){var r=n?"[data-id="+n+"]":".visible_row[data-id]";var i=e.find("#edit_team_profile_list").find(r).last();var a=-2*i.outerHeight();i.highlight(1500,"",null,0);i.scrollintoview({duration:200,px_offset:a,direction:"y"})};var V=function t(){$("#edit_team_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e.find("#edit_team_profile_edit"),{quiet:true,fast:true}))}})()},11258:function(e,t){(function(){TS.registerModule("ui.edit_member_profile",{onStart:function e(){TS.members.changed_profile_sig.add(pe);TS.view&&TS.view.resize_sig.add(Te);$("body").on("click",'[data-action="edit_member_profile_modal"]',function(e){e.preventDefault();TS.ui.edit_member_profile.start();TS.interop.clog.track("USER_PROFILE_CLICK")})},start:function e(){d()},handleDrag:function e(t){TS.boot_data.feature_take_profile_photo&&(t?K():V())},handleDrop:function e(t){if(TS.boot_data.feature_take_profile_photo){V();O(t)}},_registerCurrentStatusInput:function e(){TS.ui.edit_member_profile._unregisterCurrentStatusInput();if(TS.boot_data.feature_m11n_custom_status_input){TS.interop.mountCustomStatusInput(TS.boot_data.team_id,document.getElementsByClassName("edit_member_profile_custom_status_input")[0],{inputType:"edit_profile"});return}TS.ui.edit_member_profile._current_status_input=new TS.ui.CurrentStatusInput({$parent:$("#edit_member_profile_container"),has_presets_menu:true,has_form_context:true})},_unregisterCurrentStatusInput:function e(){if(TS.boot_data.feature_m11n_custom_status_input){TS.interop.unmountCustomStatusInput(document.getElementsByClassName("edit_member_profile_custom_status_input")[0]);return}if(TS.ui.edit_member_profile._current_status_input){TS.ui.edit_member_profile._current_status_input.destroy();TS.ui.edit_member_profile._current_status_input=null}}});var e;var t;var n;var r;var i;var a;var s;var o=[];var l;var u;var d=function e(){var t={};t.custom_username_policy=TS.prefs.getTeamPref("username_policy");var n={body_template_html:TS.templates.edit_member_profile_modal(t),onShow:c,onGo:ae,onCancel:m,go_button_text:TS.interop.i18n.t("Save Changes","edit_profile")(),go_button_class:"edit_member_profile_confirm_edit_btn ladda-button",modal_class:"fs_modal_header fs_modal_footer",title:TS.interop.i18n.t("Edit your profile","edit_profile")()};TS.ui.fs_modal.start(n)};var c=function n(){e=$("#edit_member_profile_container");t=$("body");be()&&$("#fs_modal_footer").prepend(TS.templates.edit_member_profile_footer({can_edit_team_profile:true}));TS.boot_data.feature_take_profile_photo&&h();e.on("click",'[data-action="edit_member_profile_cancel_photo"]',G);e.on("click",'[data-action="edit_member_profile_confirm_photo_delete"]',P);e.on("click",'[data-action="edit_member_profile_confirm_photo_crop"]',F);e.on("click",'[data-action="edit_member_profile_photo_menu"]',le);e.on("click",'[data-action="edit_member_profile_upload_image"]',ue);e.on("click",'[data-action="edit_member_profile_to_delete"]',de);e.on("click",'[data-action="edit_member_profile_take_photo"]',Z);e.on("click",'[data-action="edit_member_profile_capture_photo"]',x);t.on("change.photo",'[data-action="edit_member_profile_upload_photo"]',O);t.on("keydown.member_submit",f);e.on("input","input",me).on("change","select",me).on("keyup","#custom_status_input_for_edit_profile",me);e.on("input",'[data-plastic-type="date"]',ve);e.on("dragenter",".member_image_upload",Y);e.on("dragleave",".member_image_upload",J);p().then(G).catch(TS.error)};var m=function a(){U();v();e=null;n=null;r=null;i=null;o=[];s=null;u=null;if(t){t.off("change.photo");t.off("keydown.member_submit");t=null}TS.client&&TS.ui.edit_member_profile._unregisterCurrentStatusInput();TS.web&&TS.web.account_profile&&TS.web.account_profile.render()};var f=function e(t){if(t.which==TS.utility.keymap.enter){var n=$(s).find('button[type="submit"]');n.length?n.trigger("click"):ae();return false}};var p=function e(){return TS.team.ensureTeamProfileFields()};var h=function e(){if(!TS.boot_data.feature_take_profile_photo)return;var t=g();u={};u.is_supported=!!t;u.is_accepted=true;u.is_enabled=false;u.video_el=null;u.video_stream=null;u.get_media=t};var g=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;if(t)return function(e){return new Promise(function(n,r){t.call(navigator,e,n,r)})};return null};var S=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(u.is_enabled){$(u.video_el).removeClass("no_opacity");return}var t=true;var n=700;var r=$("#edit_member_profile_photo_preview_overlay");r.addClass("no_opacity");l=function e(){t=false;r.addClass("no_opacity")};var i=function e(){t=false;r.addClass("no_opacity");$(u.video_el).removeClass("no_opacity")};var a=function e(){t&&r.removeClass("no_opacity")};setTimeout(a,n);var s={video:{width:1280,height:720}};u.get_media(s).then(T).then(i).catch(y)};var T=function e(t){return new Promise(function(e){var n=t;var r=window.URL||window.webkitURL;r&&(n=r.createObjectURL(t));u.video_el=$("#edit_member_profile_photo_preview_video").get()[0];u.is_accepted=true;u.is_enabled=true;u.video_stream=t;$(u.video_el).attr("src",n);u.video_el.addEventListener("loadeddata",e)})};var v=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(!u||!u.is_enabled)return;b();u.video_el.pause();u.video_el.src="";u.video_el=null;u.video_stream.getVideoTracks()[0].stop();u.video_stream=null;u.is_enabled=false};var b=function e(){u.video_el&&$(u.video_el).addClass("no_opacity");var t=$("#edit_member_profile_photo_preview_overlay");t.addClass("no_opacity");var n=$("#edit_member_profile_photo_capture_button");n.removeClass("hidden");var r=$("#edit_member_profile_photo_capture_countdown");r.addClass("hidden")};var y=function e(t){switch(t.name){case"PermissionDeniedError":u.is_accepted=false;w();break;case"PermissionDismissedError":u.is_accepted=false;w();break;case"NotFoundError":k();break;default:q()}};var w=function e(){return TS.generic_dialog.alert(TS.interop.i18n.t("It looks like you\u2019ve blocked Slack from accessing your camera. Just change your browser\u2019s settings to allow Slack to take a photo now.","edit_profile")(),TS.interop.i18n.t("Please enable your camera","edit_profile")()).then(G)};var k=function e(){return TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Your camera could not be found!","edit_profile")()).then(G)};var x=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(!u.is_enabled)return;C().then(I).then(A).then(E).then(B).then(j).then(R).then(L).catch(N)};var C=function e(){if(!TS.boot_data.feature_take_profile_photo)return;return new Promise(function(e,t){if(!u.is_enabled){TS.warn("Camera not enabled");t()}TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Smile for the camera!","edit_profile")());var n=$("#edit_member_profile_photo_capture_button");n.addClass("hidden");var r=$("#edit_member_profile_photo_capture_countdown");r.removeClass("hidden");M(3,false,e,t)})};var M=function e(t,n,r,i){if(!TS.boot_data.feature_take_profile_photo)return;l=function e(){n=true};if(n){TS.info("Profile photo capture aborted");i(new Error("abort"));return}if(0===t){r();return}var a=$("#edit_member_profile_photo_countdown_progress");var s=$("#edit_member_profile_photo_countdown_text");a.circleProgress({value:1,size:64,animation:{duration:1e3},fill:{gradient:["#50acf4","#41a6f5"]},startAngle:Math.PI/-2}).on("circle-animation-progress",function(){s.html(parseInt(t,10))});setTimeout(function(){t-=1;e(t,n,r,i)},1e3)};var I=function e(){b();te();ge(0)};var A=function e(){if(!TS.boot_data.feature_take_profile_photo)return;return new Promise(function(e){var t=document.createElement("canvas");var n=t.getContext("2d");t.width=u.video_el.videoHeight;t.height=u.video_el.videoHeight;var r=(u.video_el.videoWidth-t.width)/-2;n.translate(t.width,0);n.scale(-1,1);n.drawImage(u.video_el,r,0,u.video_el.videoWidth,u.video_el.videoHeight);var i=t.toDataURL("image/png",1);e(i)})};var E=function e(t){if(!TS.boot_data.feature_take_profile_photo)return;var n;n=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);var r=t.split(",")[0].split(":")[1].split(";")[0];var i=new Uint8Array(n.length);for(var a=0;a<n.length;a+=1)i[a]=n.charCodeAt(a);var s=new Blob([i],{type:r});s.lastModifiedDate=new Date;s.name="camera_photo";var o={file:s,src:t};return o};var P=function e(){$("#edit_member_profile_cancel_photo_delete_btn").addClass("disabled");$("#fs_modal").addClass("stop_pointer_events");t.on("keydown.deletePhoto",function(e){e.stopPropagation()});TS.api.call("users.deletePhoto").then(function(){if(TS.web)return TS.api.call("users.info",{user:TS.model.user.id,_x_reason:"web_edit_member_profile"}).then(function(e){delete e.data.ok;var t=$.extend(true,TS.model.user,e.data.user);TS.members.legacyUpsertMember(t);pe();G()},G);G()}).catch(function(e){TS.warn("Unable to delete profile photo");TS.error(e);return q()}).finally(function(){Ladda.stopAll();t.off("keydown.deletePhoto");$("#fs_modal").removeClass("stop_pointer_events");$("#edit_member_profile_cancel_photo_delete_btn").removeClass("disabled")})};var F=function e(){r&&r.disable();$("#edit_member_profile_cancel_photo_crop_btn").addClass("disabled");$("#edit_member_profile_retake_photo_crop_btn").addClass("disabled");$("#fs_modal").addClass("stop_pointer_events");t.on("keydown.uploadPhoto",function(e){e.stopPropagation()});var n=$("#edit_member_profile_photo");var i=$("#cropbox");var a=i.data("dimensions");a.id=n.data("src_id");TS.api.call("users.setPhoto",a).then(function(e){if(TS.web){delete e.data.ok;var t=$.extend(true,TS.model.user,e.data);TS.members.legacyUpsertMember(t);pe()}G()}).catch(function(e){TS.warn("Unable to upload cropped profile photo");TS.error(e);return q()}).finally(function(){Ladda.stopAll();t.off("keydown.uploadPhoto");$("#fs_modal").removeClass("stop_pointer_events");$("#edit_member_profile_cancel_photo_crop_btn").removeClass("disabled");$("#edit_member_profile_retake_photo_crop_btn").removeClass("disabled");i.removeData("dimensions")})};var O=function t(n){var r="change"===n.type?$(this):void 0;if(r){if(!r.val()){TS.model.is_iOS&&TS.menu.end();return}n=r.get(0).files}if(n){TS.model.is_iOS&&TS.menu.end();if(!n.length)return;te();ge(0);D(n[0]).then(H).then(B).then(j).then(R).then(L).catch(N);e.find('[data-action="edit_member_profile_upload_photo"]').val("")}};var D=function e(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(n){e({file:t,src:n.target.result})};r.onabort=function(){TS.info("Profile photo file read aborted");n(new Error("abort"))};r.onerror=function(e){TS.warn("Unable to read profile photo file");TS.error(e);n(e)};l=function e(){try{r.abort()}catch(e){TS.error(e)}};r.readAsDataURL(t)})};var H=function e(t){return t.file.type.match(/image\/(?:gif|png|jpeg)/i)?Promise.resolve(t):Promise.reject(new Error("format"))};var B=function e(t){return new Promise(function(e,n){i=new Image;i.onload=function(){e(t)};i.onerror=function(e){TS.warn("Unable to set profile photo file image src");TS.error(e);n(e)};i.src=t.src})};var j=function e(t){var n=TS.model.api_url+"users.preparePhoto";var r=new FormData;r.append("image",t.file);r.append("token",TS.model.api_token);return new Promise(function(e,t){var i=$.ajax({url:n,data:r,dataType:"json",cache:false,contentType:false,processData:false,type:"POST",xhr:function e(){var e=jQuery.ajaxSettings.xhr();e.upload&&e.upload.addEventListener("progress",function(e){if(e.lengthComputable)ge(e.loaded/e.total);else{TS.info("Upload length not computable");ge(1)}},false);return e}}).fail(function(e,n,r){l=null;t(new Error(r))}).done(function(n){l=null;n.ok?e(n):t(new Error(n.error))});l=i.abort})};var R=function e(t){return new Promise(function(e,n){var r=$("#edit_member_profile_photo");var a=r.get(0);var s=function n(){i.src=t.url;$("#edit_member_profile_photo_preview").css("background","url("+t.url+")");r.css("opacity",0);ee();u();e()};var o=function e(t){TS.warn("Unable to set crop photo file image src");TS.error(t);u();n(t)};var u=function e(){a.removeEventListener("load",s);a.removeEventListener("error",o)};l=function t(){u();e()};r.attr("src",t.url).data("src_id",t.id);a.addEventListener("load",s);a.addEventListener("error",o)})};var L=function e(){function t(e){if(!i)return;var t=o.width();var n=t*i.width/e.crop_w;var r=t*i.height/e.crop_w;var a=n*e.crop_x*-1/i.width;var s=r*e.crop_y*-1/i.height;o.css({"background-size":n+"px","background-position":a+"px "+s+"px"})}function n(e){if(!i)return;var n={crop_x:Math.round(e.x),crop_y:Math.round(e.y),crop_w:Math.min(Math.round(e.w),i.height)};s.data("dimensions",n);t(n)}function a(){r.animateTo(c,function(){var e=this.tellSelect();e.w=i.width;n(e)});r.focus()}var s=$("#cropbox");var o=$("#edit_member_profile_photo_preview");var l=$("#edit_member_profile_photo");var u=l.width();var d=l.height();var c;if(!i)return;var _=Math.min(i.width,i.height);t({crop_x:(i.width-_)/2,crop_y:(i.height-_)/2,crop_w:_});$("#edit_member_profile_photo").css("opacity",0);l.Jcrop({aspectRatio:1,allowSelect:false,boxWidth:u,boxHeight:d,onSelect:n,onRelease:a,bgColor:"white",trueSize:[i.width,i.height]},function(){r=this;var e=this.getBounds();var t=Math.min(e[0],e[1]);var n=(e[0]-t)/2;var i=(e[1]-t)/2;c=[n,i,t,t];a()})};var N=function e(t){switch(t&&t.message){case"abort":break;case"format":case"bad_image":case"too_many_frames":re();break;case"too_large":ie();break;default:return q()}};var U=function e(){if(l){l();l=null}};var q=function e(){return TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")()).then(G)};var G=function t(){o.length=0;o.push({back:t});Se();U();v();i=null;var n=!e.find("#edit_member_profile_list").children().first().length;if(n){var r={member:TS.model.user,team:TS.model.team,team_member_profile_fields:TS.team.getVisibleTeamProfileFieldsForMember(TS.model.user,true)};var a=[];_.each(TS.boot_data.slack_timezones,function(e){a.push({label:e[0],val:e[1]})});r.timezone_options=a;r.member_tz=TS.model.user.tz||TS.boot_data.default_tz;r.custom_username_policy=TS.prefs.getTeamPref("username_policy");r.lock_display_name=false;"normal"!==TS.prefs.getTeamPref("auth_mode")&&false===TS.prefs.getTeamPref("sso_choose_username")&&(r.lock_display_name=true);var s=TS.templates.edit_member_profile_list(r);e.find("#edit_member_profile_list").html(s);TS.client&&TS.ui.edit_member_profile._registerCurrentStatusInput();TS.ui.validation.validate(e,{fast:true})}ce("#edit_member_profile_list");TS.ui.fs_modal.showFooter();TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Edit your profile","edit_profile")());Ladda.bind(".edit_member_profile_confirm_edit_btn");me();fe();oe();_e(true);if(TS.boot_data.feature_take_profile_photo){z();Q()}};var W=function e(){return true===TS.model.user.profile.is_custom_image};var z=function t(){var n=e.find(".show_delete");if(W()){n.removeClass("hidden");e.find(".member_image_wrapped_no_photo").addClass("hidden");e.find(".member_image_wrapped").removeClass("hidden")}else{n.addClass("hidden");e.find(".member_image_wrapped_no_photo").removeClass("hidden");e.find(".member_image_wrapped").addClass("hidden")}};var K=function t(){W()?e.find(".member_image_wrapped").addClass("hidden"):e.find(".member_image_wrapped_no_photo").addClass("hidden");e.find(".edit-profile-drop-overlay").removeClass("hidden");e.find(".member_image_upload").removeClass("hidden");$(".file_drop_icon").fadeIn({queue:false,duration:"slow"});$(".file_drop_icon").animate({top:"20px"},"slow")};var V=function t(){W()?e.find(".member_image_wrapped").removeClass("hidden"):e.find(".member_image_wrapped_no_photo").removeClass("hidden");e.find(".member_image_upload").addClass("hidden");e.find(".edit-profile-drop-overlay").addClass("hidden");e.find(".file_drop_icon").css("top","-20px")};var Y=function t(){e.find(".member_image_upload").addClass("hovered")};var J=function t(){e.find(".member_image_upload").removeClass("hovered")};var Q=function t(){var n=e.find(".show_take");u.is_supported?n.removeClass("hidden"):n.addClass("hidden")};var X=function t(){var n=e.find("#edit_member_profile_retake_photo_crop_btn");u.is_supported&&u.is_enabled&&u.is_accepted?n.removeClass("hidden"):n.addClass("hidden")};var Z=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(!u||!u.is_supported)return;o.push({back:G});i=null;Se();S();ce("#edit_member_profile_photo_take");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Take a profile photo","edit_profile")());oe();_e()};var ee=function e(){o.push({back:G});TS.boot_data.feature_take_profile_photo&&X();ce("#edit_member_profile_photo_crop");TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Crop your photo","edit_profile")());Ladda.bind("#edit_member_profile_confirm_photo_crop_btn");oe();_e()};var te=function e(){o.push({back:G});n||he();ce("#edit_member_profile_photo_upload");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Uploading your photo\u2026","edit_profile")());oe();_e()};var ne=function e(){o.push({back:e});ce("#edit_member_profile_photo_delete");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Remove profile photo","edit_profile")());Ladda.bind("#edit_member_profile_confirm_photo_delete_btn");se();_e()};var re=function e(){o.push({back:G});ce("#edit_member_profile_photo_format_error");TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Oh cripes","edit_profile")());oe();_e()};var ie=function e(){o.push({back:G});ce("#edit_member_profile_photo_oversize_error");TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Dang","edit_profile")());oe();_e()};var ae=function t(){if(!TS.ui.validation.validate(e,{quiet:true,fast:true})){TS.ui.validation.validate(e);Ladda.stopAll();$(".edit_member_profile_confirm_edit_btn").addClass("disabled");return false}var n=["real_name","display_name","title","phone"];TS.client&&(n=n.concat(["status_emoji","status_text"]));TS.boot_data.feature_custom_status_expiry&&n.push("status_expiration");var r={};n.forEach(function(t){var n;var i;if("status_text"!==t||TS.boot_data.feature_m11n_custom_status_input){n=e.find('input[name="'+t+'"]');i=n.val()}else{n=e.find("#current_status_for_edit_profile");i=TS.utility.contenteditable.value(n)}r[t]=i&&i.trim()});if(TS.client){var i=TS.ui.edit_member_profile._current_status_input;i&&i.isEdited()&&i.clogStatusChange(r.status_text,r.status_emoji,"EDIT_PROFILE")}(TS.model.team.profile.fields||[]).filter(function(e){return!e.is_hidden}).forEach(function(t){var n=TS.model.user.profile.fields||{};var i=ye(n[t.id]);var a=ye(i.value);var s=ye(i.alt);var o=e.find('input[name="'+t.id+'"], select[name="'+t.id+'"]');var l=e.find('input[name="'+t.id+'_alt"]');var u=ye(o.val());var d=ye(l.val());r.fields=r.fields||{};a===u&&s===d||(r.fields[t.id]={value:u&&u.trim(),alt:d&&d.trim()});"text"===t.type&&"skype"===t.label.toLocaleLowerCase()&&(r.skype=u&&u.trim());o.val("").val(u);l.val("").val(d)});var a=[];_.each(r.fields,function(e,t){e.value&&e.value.length||a.push(t)});a.length&&TS.warn("EVALUE-1371: Calling users.profile.set with emptied fields: "+a.join(" "));var s={profile:JSON.stringify(r)};var o=e.find('[name="tz"]').val();if(o!==TS.model.user.tz){if(TS.web){TS.model.user.tz=o;TS.model.user.tz_offset=TS.boot_data.dst_offsets[o].tz_offset}TS.prefs.setPrefByAPI({name:"tz",value:o})}TS.api.call("users.profile.set",s).then(function(e){$(".edit_member_profile_confirm_edit_btn").addClass("disabled");if(TS.web){TS.model.user.profile=e.data.profile;TS.members.legacyUpsertMember(TS.model.user)}TS.client&&TS.ui.edit_member_profile._unregisterCurrentStatusInput();TS.ui.fs_modal.close()}).catch(function(t){$(".edit_member_profile_confirm_edit_btn").addClass("disabled");if("ratelimited"===t.data.error)return TS.generic_dialog.alert(TS.interop.i18n.t("You\u2019re changing your profile too often! You might have better luck if you try again in a few minutes.","edit_profile")());t.data.error=TS.ui.validation.maybeConvertNameErrorCode(t.data.error);var n=TS.ui.validation.getErrorMessage(t.data.error,{maxlength:80});if("real_name"===t.data.field){TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),n,{custom_for:"real_name_profile_field_warnings",should_truncate:false});return false}if("display_name"===t.data.field){TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),n,{custom_for:"display_name_profile_field_warnings",should_truncate:false});return false}TS.ui.fs_modal.close();TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")())}).finally(Ladda.stopAll);return false};var se=function t(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh");e.css({margin:"auto 0",height:"auto","padding-top":0})};var oe=function t(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height","");e.css({margin:"",height:"","padding-top":""})};var le=function t(n){n.stopPropagation();W()&&!$(n.target).is(".btn")||TS.model.is_iOS?TS.menu.member.startWithEditMemberProfilePhotoActions(n,ue):e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click")};var ue=function t(n){var r;r=TS.boot_data.feature_take_profile_photo?$(n.target).closest("ts-icon"):$(n.target).closest("li");if(r.is('[data-action="edit_member_profile_upload_image"]')){if(!TS.model.is_iOS){n.preventDefault();e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click");TS.menu.end()}}else if(r.is('[data-action="edit_member_profile_to_delete"]')){n.preventDefault();ne();TS.menu.end()}};var de=function e(t){var n=TS.boot_data.feature_take_profile_photo?$(t.target).closest("ts-icon"):$(t.target).closest("li");if(n.is('[data-action="edit_member_profile_to_delete"]')){t.preventDefault();ne();TS.menu.end()}};var ce=function t(n){var r=["#edit_member_profile_loading","#edit_member_profile_list","#edit_member_profile_photo_upload","#edit_member_profile_photo_crop","#edit_member_profile_photo_delete","#edit_member_profile_photo_take","#edit_member_profile_photo_size_error","#edit_member_profile_photo_format_error","#edit_member_profile_photo_oversize_error"].filter(function(e){return e!==n}).join(", ");e.find(r).addClass("hidden");e.find(n).removeClass("hidden");s=n};var _e=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(function(){o.pop();var e=o.pop();e.back()});TS.ui.fs_modal.showBackButton()}};var me=function t(){$(".edit_member_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e,{quiet:true,fast:true}))};var fe=function t(){e.find(".edit_member_profile_lazy_filter_select").each(function(e,t){var n=$(t);var r=n.val().split(/\s*,\s*/);TS.ui.people_picker.make(n,{preselected_ids:r});n.on("change",function(){var e=TS.ui.people_picker.value(n).map(function(e){return e.member.id}).join(",");n.val(e);me()})})};var pe=function t(){if(!e)return;$("#edit_member_profile_photo_container .member_image").replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user.id,192,false,true))};var he=function e(){n=$("#edit_member_profile_progress_circle").circleProgress({value:0,size:64,fill:{gradient:["#50acf4","#41a6f5"]},startAngle:Math.PI/-2})};var ge=function e(t){var r=parseFloat(t);isNaN(r)||n.circleProgress({value:r.toFixed(2)})};var Se=function e(){if(!r)return;r.destroy();r=null;$("#edit_member_profile_photo").css({width:"auto",height:"auto",display:"block",visibility:"visible",opacity:1})};var Te=function e(){if(r&&r.getOptions().disabled)return;Se();a&&clearTimeout(a);a=setTimeout(function(){i&&!r&&L()},300)};var ve=function e(t){var n=$(t.target);var r=$('input[name="'+n.attr("name")+'_alt"]');var i=n.val();i&&(i=i.trim());TS.ui.validation.validate(n,{quiet:true,fast:true})&&r.val(TS.interop.datetime.convertISOtoUTCReadableDate(i))};var be=function e(){if(!TS.model.team.plan)return false;var t=TS.model.user;if(!t)return false;if(TS.model.user.enterprise_user)return TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner;if("admin"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_admin;if("owner"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_owner;return true};var ye=function e(t){return _.isUndefined(t)?"":t}})()},11259:function(e,t){(function(){TS.registerModule("enterprise.workspaces",{onStart:function e(){TS.boot_data.feature_single_user_workspace_pagination&&(r.response_key="items")},showList:function e(t,n,r,i){var s=TS.enterprise.workspaces.getList(n,i);var o=$(".more_teams_available");var l="";if(s.length){if(TS.boot_data.feature_invite_only_workspaces){b(a);y(a,s)}else s.forEach(function(e){l+=TS.enterprise.workspaces.getTeamCardHTML(e,r,true)});var u=TS.enterprise.workspaces.getList("workspaces_not_on",i);"teams_on"!==n&&"workspaces_on"!==n||!u.length?o.attr("data-has-more","").addClass("hidden"):o.attr("data-has-more","yes").removeClass("hidden")}else{l+="teams_on"===n||"workspaces_on"===n?TS.templates.not_on_any_workspaces():TS.templates.no_workspaces_to_join();o.attr("data-has-more","").addClass("hidden")}TS.boot_data.feature_invite_only_workspaces||t.html(l);t.attr("data-list",n);M(t,n,r);return Promise.resolve(!!s.length)},getList:function e(t,n,r,i,a){n||(n="teams_not_on"===t||"workspaces_not_on"===t?"members":"join");r||(r="");r=r.toLowerCase();void 0===i&&(i=false);var s=[];i&&(s=TS.model.is_our_app?_.difference(TS.model.user.enterprise_user.teams,TSSSB.call("getSignedInTeamIds")):_.difference(TS.model.user.enterprise_user.teams,[TS.model.team.id]));var o={workspaces_on:[],workspaces_not_on:[]};a=a||TS.teams.getAllEnterpriseTeams();_.each(a,function(e){_.includes(TS.model.user.enterprise_user.teams,e.id)?s.indexOf(e.id)>-1?o.workspaces_not_on.push(e):o.workspaces_on.push(e):(e.is_open||e.is_closed||e.is_assigned||e.is_invite_only)&&o.workspaces_not_on.push(e)});return o[t].filter(function(e){return e.name.toLowerCase().indexOf(r)>-1||e.description&&e.description.toLowerCase().indexOf(r)>-1}).sort(function(e,t){if("name"===n){var r=e.name.toLowerCase();var i=t.name.toLowerCase();if(r<i)return-1;if(r>i)return 1;return 0}if("creation"===n)return t.created-e.created;if("join"===n)return t.joined_date-e.joined_date;if("members"===n)return parseInt(t.user_counts.active_members,10)-parseInt(e.user_counts.active_members,10);return 0})},joinTeam:function e(t){var n=TS.teams.getTeamById(t);if(!n)return TS.generic_dialog.alert(TS.interop.i18n.t("Invalid workspace","enterprise_dashboard")(),TS.interop.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());if(!n.is_open&&!n.is_assigned)return TS.generic_dialog.alert(TS.interop.i18n.t("This workspace is not available to join.","enterprise_dashboard")(),TS.interop.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());var r={team:n.id};"client"===TS.boot_data.app&&(r.enterprise_token=TS.model.enterprise_api_token);var i=function e(t,n,r){var i=TS.teams.getTeamById(r.team);var a=new Handlebars.SafeString(emoji.replace_colons(":sparkles:")+TS.interop.i18n.t(" You\u2019ve successfully joined <strong>{team_name}</strong>","enterprise_dashboard")({team_name:TS.interop.i18n.safeString(_.escape(i.name))}));if(t){TS.teams.upsertTeam(_.merge({},TS.teams.getTeamById(r.team),{joined_date:n.joined_date}));A("success",a);return true}if("user_already_team_member"===n.error){A("success",a);return true}if("team_is_not_open"===n.error){A("error",TS.interop.i18n.t("This workspace is not open to join.","enterprise_dashboard")());return false}A("error",TS.interop.i18n.t('Joining workspace failed with error "{error}"',"enterprise_dashboard")({error:n.error}));return false};return TS.api.call("enterprise.teams.join",r).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},requestToJoinTeam:function e(t,n){var r={team:t};n&&(r=_.merge({},r,n));"client"===TS.boot_data.app&&(r.enterprise_token=TS.model.enterprise_api_token);var i=function e(t,n,r){var i=TS.teams.getTeamById(r.team);var a=new Handlebars.SafeString(TS.interop.i18n.t("Request to join <strong>{team_name}</strong> sent!","enterprise_dashboard")({team_name:TS.interop.i18n.safeString(_.escape(i.name))}));if(t){TS.teams.upsertTeam(_.merge({},TS.teams.getTeamById(r.team),{has_join_request:true}));A("success",a);return true}A("error",TS.interop.i18n.t("Your request couldn\u2019t be sent. Try again later, or contact the Workspace Admin for help.","enterprise_dashboard")({error:n.error}));return false};return TS.api.call("enterprise.teams.joinrequests.create",r).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},createLogoutURL:function e(t,n){var r=document.createElement("a");r.href=n;var i=r.protocol+"//"+r.host+"/signout/"+t+r.search+r.hash;r=null;return i},createURL:function e(t,n){var r=document.createElement("a");r.href=n;var i=r.protocol+"//"+t.domain+"."+r.host+"/";r=null;return i},getTeamCardHTML:function e(t,n,r){var i=TS.enterprise.workspaces.createURL(t,n);t.launch_url=i+"messages";t.site_url=i+"home";t.signout_url=TS.enterprise.workspaces.createLogoutURL(t.id,n);t.launch_url+=TS.enterprise.signin.maybeGetFinalDestinationURL();var a="enterprise_teams_launch_card";r&&(a="enterprise_teams_launch_card_wrapper");return TS.templates[a]({team:t,user:TS.model.user})},recordPageView:function t(n,r,i){i||(i="");var a={tracking_code:i,target_team_id:0};var s={action:"impression"};s.action_status=r?1:2;switch(n){case"workspaces_on":case"teams_on":a.anchor_page="your_workspaces";a.entity_key="your_workspaces_list";break;case"workspaces_not_on":case"teams_not_on":a.anchor_page="find_workspaces";a.entity_key="workspaces_you_can_join_list";break;default:break}TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamView:function t(n,r,i){i||(i="");var a={entity_key:"workspace_detail",target_team_id:n,tracking_code:i};var s={action:"impression",action_status:1};TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamJoin:function t(n,r,i){i||(i="");var a={anchor_page:r,entity_key:"join_workspace",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamLeave:function t(n,r,i){i||(i="");var a={anchor_page:r,entity_key:"leave_workspace",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamLeaveConfirm:function t(n,r,i){i||(i="");var a={anchor_page:r,entity_key:"leave_workspace_confirm",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamRequestToJoin:function t(n,r,i){i||(i="");var a={anchor_page:r,entity_key:"request_to_join_workspace",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamLaunch:function t(n,r,i){i=i||"";var a={anchor_page:r,entity_key:"launch_workspace",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},showRequestDialog:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.displayModernToast,r=void 0===n?_.noop:n;var i="#generic_dialog";var a=".dialog_go";var s="enterprise.teams.creationrequests.create";var o="#input_ws_team_name";var l="#textarea_ws_team_message";var u;var d;function c(){var e=$(i);var t=e.find(a);if(u&&d){t.removeAttr("disabled");return true}t.attr("disabled",true);return false}TS.generic_dialog.start({title:TS.interop.i18n.t("Request creation of a new workspace","enterprise_workspaces")(),body:TS.templates.ws_request_dialog(),show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Send Request","enterprise_workspaces")(),onGo:function e(){var t=$(i);var n=$(o);var u=n.val();var d=$(l);var c=d.val();var m=t.find(a);m.addClass("ladda-button");m.attr("data-style","expand-right");var f=Ladda.create(m[0]);f.start();var p={name:u,reason:c};"client"===TS.boot_data.app&&(p.enterprise_token=TS.model.enterprise_api_token);TS.api.callImmediately(s,p).then(function(){var e=TS.experiment.getGroup("ibm_workspace_directory_redesign");"redesigned_workspace_directory"===e||TS.boot_data.feature_find_your_workspace?r({type:"success",teamName:u}):TS.ui.toast.show({type:"success",message:TS.interop.i18n.t("Request to create <b>{team_name}</b> sent! You\u2019ll be notified once it\u2019s reviewed.","enterprise_workspaces")({team_name:TS.interop.i18n.safeString(_.escape(u))})});TS.generic_dialog.end();TS.generic_dialog.cancel()}).catch(function(e){if(!e||!e.data){TS.error("WTF: error, but no response or data on "+s+"?",e);return}var t=e.data;var n={name_taken:TS.interop.i18n.t("Request failed: The name <b>{team_name}</b> is already taken by another workspace.","enterprise_workspaces")({team_name:TS.interop.i18n.safeString(_.escape(u))}),name_is_empty:TS.interop.i18n.t("Request failed: A name is required.","enterprise_workspaces")(),name_too_long:TS.interop.i18n.t("Request failed: The name you provided is too long.","enterprise_workspaces")(),reason_too_long:TS.interop.i18n.t("Request failed: The reason you provided is too long.","enterprise_workspaces")(),unknown:TS.interop.i18n.t("Request failed: The response error was <b>{error_message}</b>.","enterprise_workspaces")({error_message:t.error||"unknown"})};var i=TS.experiment.getGroup("ibm_workspace_directory_redesign");"redesigned_workspace_directory"===i||TS.boot_data.feature_find_your_workspace?r({type:"error",errorType:t.error,teamName:u}):TS.ui.toast.show({type:"error",message:n[t.error]||n.unknown});TS.error(s+" failed with error: "+(t.error||"undefined"));f.stop()});return false}});$(o).on("keyup change",function(){u=TS.ui.validation.validate($(o));c()});$(l).on("keyup change",function(){d=TS.ui.validation.validate($(l));c()});$(o).focus();$(i).find(a).attr("disabled",true)},promiseToSearchWorkspaces:function e(t){return Promise.resolve().then(function(){return TS.teams.promiseToSearchTeams(t)}).then(function(e){if(TS.boot_data.feature_invite_only_workspaces){_(e.items).map(TS.teams.upsertTeam).map("team").value();return Promise.resolve(t)}return Promise.resolve(_(e.items).map(TS.teams.upsertTeam).map("team").value())})},buildWorkspaceSearcher:function e(t,n){var r=_.get(n.additional_args,"sort")||_.get(n,"sort");if(!_.get(n,"additional_args.workspaces")){n.additional_args.workspaces=p(i);n.additional_args.user=h(i)}var a=_.assign({},t.additional_args,n.additional_args);var s=_.assign(t,{query:_.get(n,"query",""),sort:r,additional_args:a});return s},getWorkspaces:function e(t,n){l=$(a);u=$("[data-workspace-title-bar]");d=$("[data-workspace-search-input]");c=$("[data-workspace-info]");m=$("[data-workspace-search-spinner]");f=$("[data-workspace-list-spinner]");f.removeClass("hidden");o=!!n;if(t!==i){r.additional_args.workspaces=p(t);r.additional_args.user=h(t)}r.additional_args.search="";return Promise.resolve().then(function(){g(t)}).then(function(){w(r,n)})},setWorkspaceListItems:function e(t,n){var r=n||a;y(r,t)}});var e="ENTERPRISE_DISCOVER_WORKSPACES";var t=1e3;var n;var r={query:"",endpoint:"enterprise.teams.directory",response_key:"teams",additional_args:{sort_by:"name"},sort_dir:"asc",max_api_results:100};var i="workspaces_on";var a="[data-workspace-list-container]";var s="[data-workspace-empty-state]";var o=false;var l;var u;var d;var c;var m;var f;var p=function e(t){switch(t){case"your-workspaces":case"your-teams":case"workspaces_on":case"teams_on":return"user";case"find-workspaces":case"find-teams":case"workspaces_not_on":case"teams_not_on":default:return"all"}};var h=function e(t){var n=["your-workspaces","your-teams","workspaces_on","teams_on"];var r="0";_.includes(n,t)&&(r=_.get(TS.model,"user.id"));return r};var g=function e(t){i=t};var S=function e(i){var a=$(i.target).scrollTop();var s=n-a;s<=t&&a>0&&w(r)};var T=function e(t){var n=t.target.value;var i=_.assign({},r.additional_args,{search:n});var a=_.assign({},r,{additional_args:i});w(a)};var v=function e(t,n){var r=t.target.value;var a=TS.enterprise.workspaces.getList(n,"",r);k(i,a,r)};var b=function e(t){n=$(t).find(".list_items").height()};var y=function e(t,n){$(t).longListView("setItems",n,true);$(t).longListView("resizeImmediately");b(t)};var w=function e(t,n){r=TS.enterprise.workspaces.buildWorkspaceSearcher(r,t);return TS.enterprise.workspaces.promiseToSearchWorkspaces(r).then(function(e){var t=i||"workspaces_on";var r="name";var a="";var s=TS.boot_data.signout_url;var o=TS.enterprise.workspaces.getList(t,r,a,void 0,e.items);o=o.map(function(e){if(e.lfs_id)return e;var t=TS.enterprise.workspaces.createURL(e,s);e.launch_url=t+"messages";e.site_url=t+"home";e.signout_url=TS.enterprise.workspaces.createLogoutURL(e.id,s);e.lfs_id=String(e.id);return e});if(TS.boot_data.feature_invite_only_workspaces)if(n){l.addClass("hidden");u.addClass("hidden");d.addClass("hidden").attr("disabled","disabled");c.removeClass("hidden").attr("data-team-id",n)}else{k(t,o);u.removeClass("hidden");d.removeClass("hidden").removeAttr("disabled");c.addClass("hidden").attr("data-team-id","")}})};var k=function e(t,n,i){if(n.length){C(s,a);y(a,n)}else{var o=i||_.get(r,"additional_args.search",false);x(t,s,a,o)}m.addClass("hidden");f.addClass("hidden")};var x=function e(t,n,r,i){var a="";a=i?TS.templates.no_workspace_results():"teams_on"===t||"workspaces_on"===t?TS.templates.not_on_any_workspaces():TS.templates.no_workspaces_to_join();$(r).addClass("hidden");$(n).html(a).removeClass("hidden");$(n).on("click",".find_teams",function(e){e.preventDefault();I("find-workspaces",true)})};var C=function e(t,n){$(t).html("").addClass("hidden");$(n).removeClass("hidden");$(t).off()};var M=function e(t,n,a){var s=t.parents();var l=s.find('[data-qa="teams_search"]');var u=s.find(".workspace_info");var d=s.find(".more_teams_available");var c=s.find(".title_bar");if(!TS.boot_data.feature_invite_only_workspaces){var f=$(".sort_by_container");var p=f.find('select[data-qa="sort-by-your"]');var h=f.find('select[data-qa="sort-by-find"]')}var g=$(window);t.off();l.off();u.off();d.off();if(!TS.boot_data.feature_invite_only_workspaces){p.off();h.off()}g.off("scroll.workspaces");var b=function e(n){return TS.enterprise.workspaces.joinTeam(n).then(function(e){if(e){var r=_.merge({},TS.model.user);r.enterprise_user.teams=_.uniq(r.enterprise_user.teams.concat(n));"web"===TS.boot_data.app?TS.model.user=r:TS.members.legacyUpsertMember(r);var i=TS.teams.getTeamById(n);t.find('[data-id="'+n+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(i,a))}return e})};l.on("input",function(r){var s=$("#ws_request_create_link");if(TS.boot_data.feature_invite_only_workspaces){m.removeClass("hidden");"workspaces_not_on"===i?T(r):v(r,i);s=$("#ws_request_create_link");r.target.value.length?s.removeClass("hidden"):s.addClass("hidden")}else{var o=$(this).val();var l;l="teams_on"===n||"workspaces_on"===n?p.val():h.val();var u=TS.enterprise.workspaces.getList(n,l,o);var d="";u.length?u.forEach(function(e){d+=TS.enterprise.workspaces.getTeamCardHTML(e,a,true)}):d+=TS.templates.no_workspace_results();s=$("#ws_request_create_link");o.length?s.removeClass("hidden"):s.addClass("hidden");t.html(d).attr("data-list",n);e(t,n,a)}});d.on("click",'[data-qa="find-more-teams"]',function(e){e.preventDefault();$('.enterprise_memberdash_header .menu_item_teams[data-qa="find-teams"]').click()});var y=function r(){var i=$(this).val();var s=l.val();var o=TS.enterprise.workspaces.getList(n,i,s);var u="";o.length?o.forEach(function(e){u+=TS.enterprise.workspaces.getTeamCardHTML(e,a,true)}):u+="teams_on"===n||"workspaces_on"===n?TS.templates.not_on_any_workspaces():TS.templates.no_workspaces_to_join();t.html(u).attr("data-list",n);e(t,n,a)};if(!TS.boot_data.feature_invite_only_workspaces){p.on("change",y);h.on("change",y)}var w=function e(r,i){"string"!==typeof r&&(r=$(this).data("id"));o=true;t.addClass("hidden");c.addClass("hidden");d.addClass("hidden");l.addClass("hidden").attr("disabled","disabled");u.html(TS.templates.team_info({list:n})).removeClass("hidden").attr("data-team-id",r);if(!i){var s=$("title").text();var _="workspaces_not_on"===n?"find-workspaces":"your-workspaces";window.history.pushState(r,s,"/signin/"+_+"/"+r)}var m={top_combined_channels:5,include_admins:true};var f=[];TS.client||f.push(TS.api.call("users.info",{user:TS.boot_data.user_id,_x_reason:"enterprise_workspaces"}).then(function(e){TS.model.user=e.data.user}));f.push(TS.redux.teams.ensureEnterpriseTeamIsKnown(r,m));return Promise.all(f).then(function(){var e=TS.teams.getTeamById(r);if(!e){u.attr("data-team-id","");return}var i=TS.enterprise.workspaces.createURL(e,a);e.launch_url=i+"messages";e.site_url=i+"home";e.launch_url+=TS.enterprise.signin.maybeGetFinalDestinationURL();u.html(TS.templates.team_info({list:n,team:e,user:TS.model.user})).attr("data-team-id",r);t.find('[data-id="'+e.id+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,a));var s;var o;if("teams_on"===n||"workspaces_on"===n){s="your_workspaces";o="your_workspaces_list"}else{s="find_workspaces";o="workspaces_you_can_join_list"}TS.enterprise.workspaces.recordTeamView(e.id,s,o)})};t.on("click",".enterprise_team_card",w);u.on("click",".back_to_teams",function(e){e.preventDefault();window.history.back();if(TS.boot_data.feature_invite_only_workspaces)TS.enterprise.workspaces.getWorkspaces(i);else{t.removeClass("hidden");c.removeClass("hidden");l.removeClass("hidden").removeAttr("disabled");u.addClass("hidden").attr("data-team-id","")}"yes"===d.attr("data-has-more")&&d.removeClass("hidden")});var k=function e(n){var r=n.originalEvent.state;if(r&&"T"===r[0]&&9===r.length){var i=true;w(r,i)}else if(TS.boot_data.feature_invite_only_workspaces)I(r,false);else{t.removeClass("hidden");c.removeClass("hidden");l.removeClass("hidden").removeAttr("disabled");u.addClass("hidden").attr("data-team-id","");"yes"===d.attr("data-has-more")&&d.removeClass("hidden")}};$(window).on("popstate",k);u.on("click",'button[data-qa="join-btn"]',function(){var e=Ladda.create(this);e.start();var t=$(this).data("id");var r=TS.teams.getTeamById(t);b(t).then(function(t){e.stop();if(t){var i=TS.enterprise.workspaces.createURL(r,a);r.launch_url=i+"messages";r.site_url=i+"home";r.launch_url+=TS.enterprise.signin.maybeGetFinalDestinationURL();u.html(TS.templates.team_info({list:n,team:r,user:TS.model.user}));var s;var o="workspace_detail";s="teams_on"===n||"workspaces_on"===n?"your_workspaces":"find_workspaces";TS.enterprise.workspaces.recordTeamJoin(r.id,s,o)}return t})});u.on("click",'[data-qa="leave-btn"]',function(e){e.preventDefault();var t=$(this).data("id");TS.ui.leave_team_dialog.start(t)});u.on("click",'button[data-qa="request-to-join-btn"]',function(e){e.preventDefault();var i=Ladda.create(this);i.start();var s=$(this).data("id");TS.enterprise.workspaces.requestToJoinTeam(s).then(function(){var e=TS.teams.getTeamById(s);t.find('[data-id="'+s+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,a));i.stop();var o=TS.enterprise.workspaces.createURL(e,a);e.launch_url=o+"messages";e.site_url=o+"home";e.launch_url+=TS.enterprise.signin.maybeGetFinalDestinationURL();u.html(TS.templates.team_info({list:n,team:e,user:TS.model.user}));var l;var d="workspace_detail";l="teams_on"===n||"workspaces_on"===n?"your_workspaces":"find_workspaces";E(s,r);TS.enterprise.workspaces.recordTeamRequestToJoin(e.id,l,d)}).catch(function(){i.stop()})});t.on("click",".enterprise_team_card a",function(e){e.stopPropagation()});var x=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";var r=$(t.target).data("id");if(TS.model.is_our_app){t.preventDefault();t.stopPropagation();var a=TSSSB.call("getSignedInTeamIds");if(_.includes(a,r))if(TS.interop.environment.isSSBAndAtLeastVersion("2.8"))TSSSB.call("displayTeamById",r);else{var s=document.createElement("iframe");var o="slack://open?team="+r;s.src=o;document.body.appendChild(s);setTimeout(function(){return s.remove()},1e3)}else{var l=_.map(TS.model.user.enterprise_user.teams,function(e){var t=TS.teams.getTeamById(e);return{name:TS.model.user.name,id:TS.model.user.id,team_id:t.id,team_name:t.name,team_url:TS.utility.enterprise.buildTeamUrl(t.domain)}}).sort(function(e,t){if(e.id===r)return-1;if(t.id===r)return 1;if(e.team_name<t.team_name)return-1;if(e.team_name>t.team_name)return 1;return 0});var u=true;TSSSB.call("didSignIn",l,u)}TS.prefs.removeTeamFromEnterpriseExcluedTeamPref(r)}var d="workspaces_on"===i?"your_workspaces":"find_workspaces";TS.enterprise.workspaces.recordTeamLaunch(r,d,n)};t.on("click",".enterprise_team_card [data-name=launch_team_button]",function(e){return x(e,"workspaces_list")});u.on("click","[data-name=launch_team_button]",function(e){return x(e,"workspace_detail")});t.on("click",".enterprise_team_card .enterprise_team_menu",function(e){e.stopPropagation();var t=$(this).val();var r=$(this).data("id");var i=TS.teams.getTeamById(r);TS.menu.enterprise_team_signin.start(e,$(this),{list:n,team_id:r,team_site_url:t,should_show_leave_team:TS.permissions.enterprise.canUserLeaveTeam(TS.model.user,i)})});t.on("click",".enterprise_team_card .enterprise_team_join",function(e){e.stopPropagation();var t=Ladda.create(this);t.start();var r=$(this).data("id");b(r).then(function(e){t.stop();if(e){var i;var a;if("teams_on"===n||"workspaces_on"===n){i="your_workspaces";a="your_workspaces_list"}else{i="find_workspaces";a="workspaces_you_can_join_list"}TS.enterprise.workspaces.recordTeamJoin(r,i,a)}})});t.on("click",".enterprise_team_card .enterprise_team_request",function(e){e.stopPropagation();var n=Ladda.create(this);n.start();var i=$(this).data("id");TS.enterprise.workspaces.requestToJoinTeam(i).then(function(){var e=TS.teams.getTeamById(i);n.stop();t.find('[data-id="'+i+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,a));E(i,r)}).catch(function(){n.stop()})});TS.boot_data.feature_invite_only_workspaces||t.find(".not_on_any_workspaces").on("click",".find_teams",function(e){e.preventDefault();TS.enterprise.member_header.setPage("teams_not_on");TS.enterprise.signin.loadPage("teams_not_on")});g.on("scroll.workspaces",_.debounce(function(e){r.num_remaining>0&&!o&&S(e)},60))};var I=function e(t,n){var r="find-workspaces"===t?"workspaces_not_on":"workspaces_on";TS.enterprise.member_header.setPage(r);TS.enterprise.signin.loadPage(r);g(r);if(n){var i=$("title").text();window.history.pushState(t,i,"/signin/"+t)}};var A=function e(t,n){TS.ui.toast.show({type:t,message:n})};var E=function e(t,n){if(_.isUndefined(_.get(n,"items")))return;var r=_.find(n.items,function(e){return e.id===t});_.set(r,"has_join_request",true)}})()},11260:function(e,t){(function(){TS.registerModule("help",{issues_sorted_sig:new signals.Signal,issues:[],more_url:null,fake_api_rsps:false,max_title_chars:100,onStart:function e(){if(!TS.client)return;TS.redux.socket.connectedSig.addOnce(function(){TS.api.call("help.issues.list",{}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;TS.help.onListIssues&&TS.help.onListIssues(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;TS.help.onListIssues&&TS.help.onListIssues(i,t,n,r);return{data:t,args:n,request_id:r}})})},getIssueById:function e(t){var n;for(var r=0;r<TS.help.issues.length;r+=1){n=TS.help.issues[r];if(n.id==t)return n}return null},onListIssues:function e(t,n){if(TS.help.fake_api_rsps){TS.help.more_url="/help";TS.help.issues=[{id:"T00001",title:"issue 1",ts:"1111111111",short_text:"blah blah blah blah blah",state:"resolved"},{id:"T00002",title:"issue 2",ts:"1141111111",short_text:"I think this is ok",state:"open"},{id:"T00003",title:"issue 3",ts:"1121111111",short_text:"but I am not so sure abotu this",state:"unread"},{id:"T00004",title:"issue 4",ts:"1161111111",short_text:"what about that?",state:"open"},{id:"T00005",title:"issue 5",ts:"1151111111",short_text:"fuck it all to hell",state:"open"},{id:"T00006",title:"issue 6",ts:"1171111111",short_text:"MORE BATTRY PLZ",state:"read"},{id:"T00007",title:"issue 7",ts:"1191111111",short_text:"halp",state:"unread"},{id:"T00008",title:"issue 8",ts:"191111111",short_text:"halp",state:"unread"},{id:"T00009",title:"issue 9",ts:"181111111",short_text:"halp",state:"unread"},{id:"T000010",title:"issue 10",ts:"171111111",short_text:"halp halp halp halp halp halp halp halp halp halp ...",state:"unread"}]}else t&&(TS.help.issues=n.issues);TS.help.sortIssues();TS.help.updateIcon()},sortIssues:function e(){var t={unread:4,open:3,read:2,resolved:1};var n;for(var r=0;r<TS.help.issues.length;r+=1){n=TS.help.issues[r];n._sorter=parseFloat((t[n.state]||5)+"."+n.ts)}TS.help.issues.sort(function e(t,n){if(t._sorter<n._sorter)return 1;if(t._sorter>n._sorter)return-1;return 0});TS.help.issues_sorted_sig.dispatch()},updateIcon:function e(){var t="normal";var n=0;var r;for(var i=0;i<TS.help.issues.length;i+=1){r=TS.help.issues[i];if("unread"===r.state){t="unread";n+=1}}$("#flex_menu_toggle").removeClass("normal open unread").addClass(t);$("#help_icon_circle_count, .help_icon_circle_count").addClass("hidden");n>9&&(n="9+");n&&$("#help_icon_circle_count, .help_icon_circle_count").removeClass("hidden").text(n)},createIssue:function e(t,n){var r=t.title;var i=t.text;if(!r)return;i=i||"";var a={title:r,text:i};t.tags&&(a.tags=t.tags);var s=function e(t,a){if(!t&&TS.help.fake_api_rsps){var s={id:Date.now(),title:r,ts:Date.now()/1e3,short_text:i.substr(0,50),state:"open"};setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_created",issue:s}))},2e3)}n&&n(t,TS.help.makeErrStr(a))};TS.api.call("help.issues.create",a).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})},fetchIssueDetails:function e(t,n){var r=TS.help.getIssueById(t);if(!r){n&&n(false,r,"unknown issue");return}var i=function e(t,i){var a;if(TS.help.fake_api_rsps){t=true;a=_.cloneDeep(r);a.comments=[{ts:112211111,from:"eeric",text:"comment 1"},{ts:112214444,from:"whoop",text:"comment 2"}]}else t&&(a=i.issue);TS.help.onIssueChange(a);n&&n(t,r,TS.help.makeErrStr(i))};TS.api.call("help.issues.info",{id:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},markIssueRead:function e(t,n){var r=TS.help.getIssueById(t);if(!r){n&&n(false,"unknown issue");return}if("unread"!==r.state){n&&n(true);return}var i=function e(t,i){if(!t&&TS.help.fake_api_rsps){var a=_.cloneDeep(r);a.state="read";setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_change",issue:a}))},2e3)}n&&n(t,TS.help.makeErrStr(i))};TS.api.call("help.issues.markRead",{id:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},replyToIssue:function e(t,n,r){var i=function e(t,n){r&&r(t,TS.help.makeErrStr(n),n&&n.error?n.error:"")};TS.api.call("help.issues.replyTo",{id:t,text:n}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},markIssueResolved:function e(t,n){var r=TS.help.getIssueById(t);if(!r){n&&n(false,"unknown issue");return}var i=function e(t,i){if(TS.help.fake_api_rsps||!t&&i&&"ticket_closed"===i.error){t=true;var a=_.cloneDeep(r);a.state="resolved";setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_change",issue:a}))},1e3)}n&&n(t,TS.help.makeErrStr(i))};TS.api.call("help.issues.markResolved",{id:t}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})},onIssueChange:function e(t){var n=TS.help.getIssueById(t.id);n?TS.help.updateIssue(t,n):TS.help.issues.push(t);TS.help.sortIssues();TS.help.updateIcon()},updateIssue:function e(t,n){_.forOwn(t,function(e,t){n[t]=e});n.comments&&n.comments.sort(function e(t,n){if(t.ts<n.ts)return 1;if(t.ts>n.ts)return-1;return 0})},makeErrStr:function e(t){if(!t)return"missing data";if(t.ok)return null;if(t.error&&t.info&&TS.boot_data.feature_tinyspeck)try{return'api error: "'+t.error+'"<br><br><div class="admin-section" style="word-wrap: break-word; word-break: break-word;">api rsp: '+JSON.stringify(t).replace(/,/g,", ")+"</div>"}catch(e){}if(t.error)return'api error: "'+t.error+'"'}})})()},11261:function(e,t){(function(){TS.registerModule("ui.share_dialog",{div:null,showing:false,delegate:void 0,onStart:function e(){TS.files.team_file_changed_sig.add(i);TS.files.team_file_comment_added_sig.add(a);TS.files.team_file_comment_deleted_sig.add(a)},onKeydown:function e(t){if(!TS.ui.share_dialog.showing)return;if(t.which==TS.utility.keymap.enter){if("BODY"===TS.utility.getActiveElementProp("NODENAME")){TS.ui.share_dialog.go();t.preventDefault()}}else t.which==TS.utility.keymap.esc&&"BODY"===TS.utility.getActiveElementProp("NODENAME")&&TS.ui.share_dialog.cancel()},start:function e(i,a,s,o,l,u){if(TS.client&&TS.client.ui.checkForEditing())return;if(TS.boot_data.feature_file_threads){TS.redux.dispatch(TS.interop.redux.actions.openShareDialog({fileId:i,initialChannelId:r()}));return}n=false;t=i;var d=TS.files.getFileById(i);var c="file";"post"===d.mode?c="file_post":"space"===d.mode?c="file_space":"snippet"===d.mode?c="file_snippet":"docs"===d.mode&&(c="file_arugula");var _=TS.templates.builders.buildFileSharingControls(d,true,null,s);var m=a?"":TS.templates.builders.fileHTML(d,{for_share_dialog:true});var f={type:c,item:d,item_owner:TS.interop.members.getMemberById(d.user),sharing_html:new Handlebars.SafeString(_),file_html:new Handlebars.SafeString(m),show_copy_link:d.permalink&&TS.clipboard.canWriteText()};f.icon_class=TS.utility.getImageIconClass(d,"thumb_80");TS.ui.share_dialog.div||TS.ui.share_dialog.build();var p=TS.templates.share_dialog(f);p=TS.format.replaceHighlightMarkers(p);var h=TS.ui.share_dialog.div;h.html(p);var g=$("#file_comment_textarea");TS.ui.comments.bindInput(g,TS.ui.share_dialog.go);l&&TS.utility.contenteditable.value(g,l);g=null;h.modal("show");h.find(".dialog_cancel").click(TS.ui.share_dialog.cancel);h.find(".dialog_go").click(TS.ui.share_dialog.go);TS.ui.file_share.bindFileShareDropdowns(TS.utility.members.getEntityFromFile(d),{id:o},void 0,u);TS.ui.file_share.bindFileShareShareToggle();TS.ui.file_share.bindFileShareCommentField()},go:function e(){if(n){TS.info("TS.ui.share_dialog stopping because already sharing");return}if(!TS.ui.share_dialog.showing){TS.error("not showing?");return}var r=$("#select_share_channels").lazyFilterSelect("value")[0];var i=_.trim(TS.utility.contenteditable.value($("#file_comment_textarea")));i=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(i,{complete_member_specials:false});i=TS.format.cleanMsg(i);var a=r?r.model_ob||{}:{};TS.interop.utility.looksLikeMemberId(a.id)&&(a=TS.redux.channels.getImByMemberId(a.id)||a);TS.interop.utility.isModelObjectExternal(a)&&(i="");var s=function e(){TS.shared.legacyGetShareModelObId(u,function(e){var n=false;TS.files.shareFile(t,e,i,n).then(function(){t=null;if(!TS.client)return;var n=TS.redux.channels.getEntityById(e);if(!n)return;var r=TS.shared.legacyGetActiveModelOb();if(!r||r.id!==n.id)return TS.client.displayModelOb(n);TS.useReactMessages()||TS.client.ui.instaScrollMsgsToBottom()})})};if(r&&r.model_ob&&r.model_ob.create_channel){var o=t;TS.ui.new_channel_modal.start(r.model_ob.name).then(function(e){t=o;u=e.id;s();return null}).catch(function(){TS.ui.share_dialog.start(o,false,false,false,i);return null});TS.ui.share_dialog.cancel();return false}if(!TS.interop.utility.isModelObjectExternal(a)&&TS.ui.file_share.shouldBlockUploadDialogSubmission())return;var l=$("#share_dialog");var u=l.find("#share_model_ob_id").val();u||r&&(u=r.model_ob.id);if(!u){TS.warn("model_ob_id is not set! "+$("#select_share_channels").val());return}TS.ui.share_dialog.delegate&&"function"===typeof TS.ui.share_dialog.delegate.submit?TS.ui.share_dialog.delegate.submit(l,s):s();n=true;TS.ui.share_dialog.div.modal("hide")},cancel:function e(){t=null;TS.ui.share_dialog.div.modal("hide")},end:function t(){e&&e.detachEvents&&e.detachEvents();e=null;TS.model.dialog_is_showing=false;TS.ui.share_dialog.showing=false;TS.ui.share_dialog.div.empty();$(window.document).unbind("keydown",TS.ui.share_dialog.onKeydown)},build:function t(){$("body").append('<div id="share_dialog" tabindex="-1" class="modal hide fade"></div>');TS.ui.share_dialog.div=$("#share_dialog");var n=TS.ui.share_dialog.div;n.on("hidden",function(e){if(e.target!=this)return;TS.ui.share_dialog.end()});n.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.share_dialog.showing=true});n.on("shown",function(t){if(t.target!=this)return;var n=$("#select_share_channels").lazyFilterSelect("value");n.length<1?$("#select_share_channels").lazyFilterSelect("getInstance").$input.focus():TS.utility.contenteditable.focus($("#file_comment_textarea"));$(window.document).bind("keydown",TS.ui.share_dialog.onKeydown);e=TS.ui.share_dialog.div.find("img.lazy").lazyload()})}});var e=null;var t;var n=false;var r=function e(){if(!TS.boot_data.feature_file_threads)return null;if(!TS.web||!TS.web.space)return null;var t=TS.web.space.getOriginChannel();if(!t)return null;return t};var i=function e(n){if(TS.ui.share_dialog.showing&&t===n.id){var r=TS.interop.files.fileNeedsUpdate(n.id);if(r){TS.interop.files.fileIsUpdating(n.id)||TS.files.fetchFileInfo(n.id,null,"TS.ui.shared_dialog._teamFileChanged needs updated files.info");return}s(n);o(n)}};var a=function e(n){TS.ui.share_dialog.showing&&t===n.id&&o(n)};var s=function e(t){TS.templates.builders.updateFileShareLabels(t);$("#select_share_at_channel_list").html(TS.templates.builders.makeFileCommentHelpHTML(t))};var o=function e(t){var n=TS.templates.makeFileDomId(t);$("#"+n).replaceWith(TS.templates.builders.fileHTML(t,{for_share_dialog:true}));var r=$("#"+n).find("img.lazy");r.removeClass("lazy").attr("src",r.attr("data-original"))}})()},11262:function(e,t){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};(function(){TS.registerModule("pins",{pins_fetched_sig:new signals.Signal,pinned_status_changed_sig:new signals.Signal,pinned_message_changed_sig:new signals.Signal,pinned_message_deleted_sig:new signals.Signal,onStart:function e(){TS.files.team_file_comment_deleted_sig.add(h);TS.files.team_file_deleted_sig.add(g);TS.redux.socket.connectedSig.add(S);TS.channels.left_sig.add(T)},fetchPins:function e(n){if(!n)return;t[n.id]=true;if(TS.isPartiallyBooted())return new Promise(function(e){TS.redux.socket.connectedSig.addOnce(function(){e(TS.pins.fetchPins(n))})});return TS.api.call("pins.list",{channel:n.id}).then(function(e){TS.pins.onFetchPins(e,n)}).catch(function(e){TS.logError("Failed to fetch pins for model ob: "+n.id,e)}).finally(function(){delete t[n.id]})},onFetchPins:function t(n,r){var i=n.data.items;TS.pins.upsertPinnedItems(i);r.pinned_items=i;r.pinned_items_count=i.length;r.has_pins=!!r.pinned_items_count;r.is_channel&&!r.is_member||(e[r.id]=true);TS.pins.pins_fetched_sig.dispatch(r,i)},arePinsCurrentlyBeingFetched:function e(n){return!!t[n.id]},havePinsBeenFetched:function t(n){return!!e[n.id]},clearHavePinsBeenFetched:function n(r){if(r&&r.id){r.pinned_items=[];delete e[r.id];delete t[r.id]}},startPinFile:function e(t,n){var r=TS.files.getFileById(t);if(!r)return;d("file",n,{file:r,type:"file"})},unPinFile:function e(t,n){var r=a(t,n);if(!r)return;var i={file:r,type:"file"};p(i,n,function(){m(n,i)})},startPinFileComment:function e(t,n,r){var i=TS.files.getFileById(n);if(!i)return;var a=TS.files.getFileCommentById(i,t);if(!a)return;d("comment",r,{file:i,comment:a,type:"file_comment"})},unPinFileComment:function e(t,n,r){var i=s(t,n,r);var a=TS.files.getFileById(n);if(!i||!a)return;var o={file:a,comment:i,type:"file_comment"};p(o,r,function(){m(r,o)})},startPinMessage:function e(t,n){t=t.toString();var r=TS.utility.msgs.findMsg(t,n.id);r&&("file_comment"===r.subtype?TS.pins.startPinFileComment(r.comment.id,r.file.id||r.file,n):r.file?TS.pins.startPinFile(r.file.id||r.file,n):d("message",n,{message:r,type:"message"}))},unPinMessage:function e(t,n){t=t.toString();var r=o(t,n);if(r)if("file_comment"===r.subtype)TS.pins.unPinFileComment(r.comment.id,r.file.id||r.file,n);else if(r.file)TS.pins.unPinFile(r.file.id||r.file,n);else{var i={message:r,type:"message"};p(i,n,function(){m(n,i)})}},isMessagePinned:function e(t,n){if("file_comment"===t.subtype){if(!t.comment)return false;return!!s(t.comment.id,t.file.id||t.file,n)}if(t.file)return!!a(t.file.id||t.file,n);return!!o(t.ts,n)},pinStatusHasChanged:function e(t,r,a,s,o){var d;var c;var _;var m;var f;var p;if("message"===a&&s){d=TS.utility.msgs.findMsg(r.message.ts,s.id);if(d){r.message=d;m=l(t,d,s)}}else if("file_comment"===a){p=TS.files.upsertFile(r.file);if(TS.boot_data.feature_no_files_info){var h=r.file&&r.file.id;i(h,r);_=TS.files.getFileCommentById(r.file,r.comment.id)}else{c=TS.files.getFileById(r.file.id);r.file=c;_=TS.files.getFileCommentById(c,r.comment.id)}if(_){r.comment=_;m=l(t,_,s)}else{_=TS.files.addCommentToFile(r.comment,c);r.comment=_}m=m||"CHANGED"===p.status}else if("file"===a){p=TS.files.upsertFile(r.file);if(TS.boot_data.feature_no_files_info){var g=r.file&&r.file.id;i(g,r);m=l(t,r.file,s)}else{c=TS.files.getFileById(r.file.id);r.file=c;m=l(t,c,s)}m=m||"CHANGED"===p.status}f=u(t,r,a,s,o);(m||f)&&TS.pins.pinned_status_changed_sig.dispatch(s,r,t);if(TS.useReactMessages()&&m&&"message"===a){d=n({},d);TS.redux.messages.replaceMessage(d)}},upsertPinnedItems:function e(t){if(_.isEmpty(t))return;t.forEach(function(e){if("file"===e.type||"file_comment"===e.type){var t=e.file&&e.file.id;if(TS.boot_data.feature_no_files_info){TS.files.upsertFile(e.file);i(t,e)}else{TS.files.upsertFile(e.file);e.file=TS.files.getFileById(t)}}if("file_comment"===e.type){var n=TS.files.getFileCommentById(e.file,e.comment.id);n||(n=TS.files.addCommentToFile(e.comment,e.file));e.comment=n}})},replaceMsg:function e(t,n){if(!n.pinned_items)return;n.pinned_items.forEach(function(e){if("message"===e.type&&e.message.ts===t.ts){e.message=t;TS.pins.pinned_message_changed_sig.dispatch(n,e)}})},legacyRemoveMsg:function e(t,n){if(!n.pinned_items)return;u(false,{message:{ts:t}},"message",n);TS.pins.pinned_message_deleted_sig.dispatch(n)},canUserPinHere:function e(t){if(!TS.client||!t)return false;if(!TS.permissions.members.canPostInChannel(t))return false;if(t.is_channel&&!t.is_member)return false;return true},updateCount:function e(t,n){if(!t)return;var r=t.pinned_items_count;t.pinned_items_count=TS.pins.havePinsBeenFetched(t)?_.get(t,"pinned_items.length"):n;if(r===t.pinned_items_count)return;t.has_pins=!!t.pinned_items_count;TS.pins.pinned_status_changed_sig.dispatch(t)},getUnreadPins:function e(t){var n;var r=[];if(!t)return r;var i=t._marked_reason;if("0000000000.000000"===t.last_read&&"back"!==i)return r;if(TS.model.ui.is_window_focused)if("back"===i){var a=TS.utility.msgs.getDisplayedMsgAfterTS(t.last_read,t.msgs);n=a?parseFloat(a.ts)-1:t.last_read}else n=!t._prev_last_read||i&&"viewed"!==i?t.last_read:t._prev_last_read;else n=t.last_read;var s=t.pinned_items;if(_.isEmpty(s))return r;_.forEach(s,function(e){var t=TS.interop.members.getMemberById(e.created_by);if(!t)return;e.created>Math.ceil(n)&&(t.is_self&&"back"===i?r.push(e):t.is_self||r.push(e))});return r},test:function t(){return{fileDeleted:g,fileCommentDeleted:h,have_pins_been_fetched:e}}});var e={};var t={};var r=false;var i=function e(t,n){if(!n||!t||!TS.files.getFileById(t))return;Object.defineProperty(n,"file",{enumerable:true,configurable:true,get:function e(){return TS.files.getFileById(t)},set:function e(){return false}})};var a=function e(t,n){var r=TS.files.getFileById(t);if(!r||!r.pinned_to)return null;var i=-1!==r.pinned_to.indexOf(n.id);return i?r:null};var s=function e(t,n,r){var i=TS.files.getFileById(n);if(!i)return null;var a=TS.files.getFileCommentById(i,t);if(!a||!a.pinned_to)return null;var s=-1!==a.pinned_to.indexOf(r.id);return s?a:null};var o=function e(t,n){if(n.pinned_items){var r;for(var i=0;i<n.pinned_items.length;i+=1){r=n.pinned_items[i];if("message"===r.type&&r.message.ts===t)return r.message}}var o=TS.utility.msgs.findMsg(t,n.id);if(!o)return null;if("file_comment"===o.subtype){if(s(o.comment.id,o.file.id||o.file,n))return o}else if(o.file){if(a(o.file.id||o.file,n))return o}else if(o.pinned_to&&-1!==o.pinned_to.indexOf(n.id))return o;return null};var l=function e(t,n,r){var i=false;n.pinned_to||(n.pinned_to=[]);if(t){if(-1===n.pinned_to.indexOf(r.id)){n.pinned_to.push(r.id);i=true}}else{var a=n.pinned_to.indexOf(r.id);if(-1!==a){n.pinned_to.splice(a,1);i=true}}return i};var u=function e(t,n,r,i,a){var s=false;i.pinned_items||(i.pinned_items=[]);var o=-1;i.pinned_items.some(function(e,t){var i=false;"message"===r&&"message"===e.type?e.message.ts===n.message.ts&&(i=true):"file"===r&&"file"===e.type?e.file.id===n.file.id&&(i=true):"file_comment"===r&&"file_comment"===e.type&&e.comment.id===n.comment.id&&(i=true);i&&(o=t);return i});if(TS.pins.havePinsBeenFetched(i))if(t||-1===o){if(t&&-1===o){i.pinned_items.unshift(n);i.pinned_items_count=i.pinned_items.length;s=true}}else{i.pinned_items.splice(o,1);i.pinned_items_count=i.pinned_items.length;s=true}else{i.pinned_items_count=i.pinned_items_count||0;var l=_.parseInt(a,10);_.isNaN(l)?t?i.pinned_items_count+=1:t||(i.pinned_items_count=Math.max(i.pinned_items_count-1,0)):i.pinned_items_count=l;s=true}i.has_pins=!!i.pinned_items_count;return s};var d=function e(t,n,r){var i="";var a="";var s="";switch(t){case"file":i=TS.interop.i18n.t("Are you sure you want to pin this file to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(n)});a=TS.interop.i18n.t("Pin file","pins")();s=TS.interop.i18n.t("Yes, pin this file","pins")();break;case"comment":i=TS.interop.i18n.t("Are you sure you want to pin this comment to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(n)});a=TS.interop.i18n.t("Pin comment","pins")();s=TS.interop.i18n.t("Yes, pin this comment","pins")();break;case"message":i=TS.interop.i18n.t("Are you sure you want to pin this message to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(n)});a=TS.interop.i18n.t("Pin message","pins")();s=TS.interop.i18n.t("Yes, pin this message","pins")();break;default:break}var o="<p>"+i+"</p>"+TS.client.channel_page.pinnedItemHtml(r,n);TS.generic_dialog.start({title:a,body:o,go_button_text:s,onGo:function e(){c(n,r)}})};var c=function e(t,n){var r=f(t,n);var i=TS.interop.datetime.makeTsStamp(null,{padder:"0"});var a=function e(r,a){if(!r){if("too_many_pins"===a.error){var s="message";"file"===n.type&&(s="file");"file_comment"===n.type&&(s="comment");TS.generic_dialog.start({title:TS.interop.i18n.t("Couldn\u2019t pin {type}","pins")({type:s}),body:"<p>"+TS.interop.i18n.t("Sorry! You\u2019ve hit the limit on how many pins you can have in this channel.","pins")()+"</p>",show_cancel_button:false})}else TS.info("pins.add got a not ok rsp: "+a.error);if("already_pinned"!==a.error)return}if(!TS.pins.havePinsBeenFetched(t))return;n.created=i;n.created_by=TS.boot_data.user_id;TS.pins.pinStatusHasChanged(true,n,n.type,t)};TS.api.call("pins.add",r).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;a(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;a(i,t,n,r);return{data:t,args:n,request_id:r}})};var m=function e(t,n){var r=f(t,n);var i=function e(r,i){if(!r&&"not_pinned"!==i.error)return;if(!TS.pins.havePinsBeenFetched(t))return;TS.pins.pinStatusHasChanged(false,n,n.type,t)};TS.api.call("pins.remove",r).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i(a,t,n,r);return{data:t,args:n,request_id:r}})};var f=function e(t,n){var r={channel:t.id};"message"===n.type?r.timestamp=n.message.ts:"file"===n.type?r.file=n.file.id:"file_comment"===n.type&&(r.file_comment=n.comment.id);return r};var p=function e(t,n,r){TS.client.channel_page.highlightPinnedItemForRemoval(t);var i=TS.client.channel_page.pinnedItemHtml(t,n);TS.generic_dialog.start({title:TS.interop.i18n.t("Remove Pinned Item","pins")(),body:"<p>"+TS.interop.i18n.t("Are you sure you want to remove this pinned item?","pins")()+"</p>"+i,go_button_text:TS.interop.i18n.t("Yes, remove this pinned item","pins")(),onGo:r,onCancel:function e(){TS.client.channel_page.unHighlightPinnedItemForRemoval(t)}})};var h=function e(t,n,r){if(!r||!r.pinned_to)return;r.pinned_to.forEach(function(e){var t=TS.redux.channels.getEntityById(e);if(!t)return;var n=u(false,{comment:r},"file_comment",t);n&&TS.pins.pinned_status_changed_sig.dispatch(t)})};var g=function e(t){if(!t)return;t.pinned_to&&t.pinned_to.forEach(function(e){var n=TS.redux.channels.getEntityById(e);if(!n)return;var r=u(false,{file:t},"file",n);r&&TS.pins.pinned_status_changed_sig.dispatch(n)});t.comments&&t.comments.forEach(function(e){h(t,e.id,e)})};var S=function n(){if(r){e={};t={}}else r=true};var T=function n(r){var i=r||TS.shared.legacyGetActiveModelOb();if(i&&i.id){delete e[i.id];delete t[i.id]}}})()},11263:function(e,t){(function(){TS.registerModule("inline_file_previews",{expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){_();this.collapse_sig.add(a);this.expand_sig.add(s);$("#messages_container").on("keydown",".preview_show_more .preview_show_btn",i);$("#messages_container").on("keydown",".preview_show_less .preview_show_btn",i)},checkForInlineFilePreviewClick:function e(t){var n=$(t.target);var i;var a=n.closest(".message");if(0===a.length)return;if(n.hasClass("service_link")||n.closest(".service_link")>0)return;var s=a.attr("id");var u=n.closest(".msg_inline_file_preview_toggler");if(u.length>0){t.preventDefault();i=u.data("file-id");var c=a.attr("data-ts");u.hasClass("collapsed")?r(s,c,i):o(s,c,i);return true}var _=n.closest(".inline_file_preview_container, .file_container");if(0===_.length)return;var m=n.closest("ts-message");var f=""+m.data("ts");var p=m.data("model-ob-id");var h={message_timestamp:f,channel_id:p,channel_type:p?p.charAt(0):"",member_id:m.data("member-id"),app_id:m.data("app-id"),bot_id:m.data("bot-id")};if(n.closest(".preview_show.preview_show_more").length>0){t.preventDefault();l(t,a,_);TS.interop.clog.track("PREVIEW_EXPAND",h);return true}if(n.closest(".preview_show.preview_show_less .preview_show_btn, .preview_show_less_header").length>0){t.preventDefault();d(t,a,_);TS.interop.clog.track("PREVIEW_COLLAPSE",h);return true}if(n.closest("a").length)return false;i=_.data("file-id");var g=TS.files.getFileById(i);if(!g)return false;if(("space"===g.mode||"post"===g.mode||"docs"===g.mode||"email"===g.mode||"snippet"===g.mode)&&_.hasClass("inline_collapsed")){t.preventDefault();l(t,a,_);return true}return false},shouldTruncate:function e(t){if(!t)return false;if("snippet"===t.mode){if(t.lines_more>0||t.preview_is_truncated)return true}else if("post"===t.mode||"space"===t.mode){if(!t.preview)return false;if(t.preview.length>=400)return true;if(t.preview.split(" ").length>=50)return true;if(t.preview.split("\n").length>=4)return true;var n=t.preview.match(/<\/(?:h\d|p|li|pre|blockquote)>/g)||[];var r=t.preview.match(/<hr>/g)||[];var i=n.concat(r);if(i.length>=4)return true}else if("email"===t.mode)return true;return false},isTruncated:function t(n,r){if(!r)return false;return!e[n+"_"+r.id]},expandableState:function e(t,n){if(TS.model.expandable_state["inline_file_"+t+n])return true;if(false===TS.model.expandable_state["inline_file_"+t+n])return false},shouldExpand:function e(t,n){var r=TS.inline_file_previews.expandableState(t,n);if("boolean"===typeof r)return r;return true},expandAllInCurrent:function e(){t=true;$(".msg_inline_file_preview_toggler").each(function(e,t){var n=$(t);var i=n.data("file-id");var a=n.closest(".message").attr("id");var s=n.closest(".message").attr("data-ts");r(a,s,i)});t=false;TS.client&&TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_file_preview_toggler").each(function(e,t){var n=$(t);var r=n.data("file-id");var i=n.closest(".message").attr("id");var a=n.closest(".message").attr("data-ts");o(i,a,r)})},test:function e(){return{actuallyExpandContent:u}}});var e={};var t=false;var n=false;var r=function e(n,r,i){var a="inline_file_msg_"+r.replace(".","_")+i;TS.model.expandable_state[a]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var s="#"+TS.utility.makeSafeForDomId(n);var o=$(s);if(!o.length)return;var l=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var u=function e(){if(TS.boot_data.feature_file_threads&&$(this).find('a[data-file-id="'+i+'"]').length>0)return true;return $(this).data("file-id")==i};var d=o.find(".inline_file_preview_container, .file_container").filter(u);o.find(".msg_inline_file_title_hider").filter(u).addClass("hidden");o.find('.msg_inline_file_preview_toggler[data-file-id="'+i+'"]').removeClass("collapsed").addClass("expanded");d.removeClass("hidden");TS.client&&TS.client.ui.checkInlineImgsAndIframesEverywhere();d.css("opacity",0).stop().animate({opacity:1},300);if(!t)if(TS.client&&l){TS.client.ui.instaScrollMsgsToBottom(false);d.scrollintoview({duration:0,offset:"top",px_offset:0,direction:"y"})}else d.scrollintoview({duration:200,offset:"bottom",px_offset:0,direction:"y"});TS.inline_file_previews.expand_sig.dispatch(n);TS.client&&TS.ui.utility.updateClosestMonkeyScroller(o)};var i=function e(t){13!=t.which&&32!=t.which||(n=true)};var a=function e(){n&&$(".preview_show_more .preview_show_btn").focus().addClass("focus-ring");n=false};var s=function e(){n&&$(".preview_show_less .preview_show_btn").focus().addClass("focus-ring");n=false};var o=function e(t,n,r){var i="inline_file_msg_"+n.replace(".","_")+r;TS.model.expandable_state[i]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var a="#"+TS.utility.makeSafeForDomId(t);var s=$(a);if(!s.length)return;var o=function e(){if(TS.boot_data.feature_file_threads&&$(this).find('a[data-file-id="'+r+'"]').length>0)return true;return $(this).data("file-id")==r};var l=s.find(".inline_file_preview_container, .file_container").filter(o);s.find(".msg_inline_file_title_hider").filter(o).removeClass("hidden");s.find('.msg_inline_file_preview_toggler[data-file-id="'+r+'"]').removeClass("expanded").addClass("collapsed");l.addClass("hidden");TS.inline_file_previews.collapse_sig.dispatch(t);setTimeout(function(){TS.client&&TS.ui.utility.updateClosestMonkeyScroller(s)},0)};var l=function e(t,n,r){var i=r.data("file-id");var a=TS.files.getFileById(i);if(!a)return;if("post"===a.mode||"space"===a.mode||"snippet"===a.mode){var s=r.find(".preview_show_more .preview_show_btn");s.data("stashed_text",s.html()).empty();var o=new Spinner({lines:9,length:0,width:4,radius:5,corners:1,rotate:0,direction:1,color:"#ffffff",speed:1,trail:25,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"-8px",left:"-4px",opacity:.1});o.spin(s.get(0));r.addClass("loading");TS.files.fetchFileInfo(i,function(e,t){o.stop();s.html(s.data("stashed_text"));r.removeClass("loading");(t.content_html||t.content_highlight_html)&&u(n,t);TS.utility.welcome_post.clogWelcomePostExpand(t)})}else if("email"===a.mode)if(a.simplified_html){TS.view.rebuildMsgFile(n.data(),a);u(n,a)}else{n.find(".email_content").addClass("loading");var l=setTimeout(function(){n.find(".inline_file_preview_container, .file_container").addClass("expanded")},1e3);TS.files.fetchFileInfo(i,function(e,t){clearTimeout(l);TS.view.rebuildMsgFile(n.data(),t);u(n,t);n.find(".email_content").removeClass("loading")})}};var u=function t(n,r){var i=n.attr("id");var a=i+"_"+r.id;e[a]=true;if(!n.parent("body").length){var s=$("#"+i);s.length&&(n=s)}n.find(".inline_file_preview_container, .file_container").removeClass("inline_collapsed").addClass("inline_expanded");TS.inline_file_previews.expand_sig.dispatch(n);TS.client&&TS.ui.utility.updateClosestMonkeyScroller(n)};var d=function n(r,i,a){var s=i.attr("id");var o=a.data("file-id");var l=TS.files.getFileById(o);if(!l)return;var u=s+"_"+o;delete e[u];i.find(".inline_file_preview_container, .file_container").removeClass("inline_expanded").addClass("inline_collapsed");if(!t){var d=i[0].getBoundingClientRect();d.top<0&&i.scrollintoview({duration:0,offset:"top",px_offset:0,direction:"y"})}TS.inline_file_previews.collapse_sig.dispatch(i);TS.client&&TS.ui.utility.updateClosestMonkeyScroller(i)};var c;var _=function e(){c&&clearInterval(c);var t=function e(){var t=$("#msgs_div .file_time_ago");var n=[];t.each(function(){var e=$(this).data("file-id");var t=TS.files.getFileById(e);if(!t){n.push($(this).text());return}n.push(TS.interop.datetime.toTimeAgo(t.updated));t=null});t.each(function(e,t){$(t).text(n[e]);t=null});t=null};t=TS.utility.throttleFunc(t,5e3);c=setInterval(t,6e4)}})()},11264:function(e,t){(function(){TS.registerModule("rxns",{rxn_records_changed_sig:new signals.Signal,member_rxns_fetched_sig:new signals.Signal,member_rxns_being_fetched_sig:new signals.Signal,need_alerts:{},onStart:function e(){if(!TS.client)return;TS.prefs.preferred_skin_tone_changed_sig.add(I);TS.prefs.emoji_mode_changed_sig.add(I);x=function e(){};var t=function e(){};TS.client.login_sig.add(function(){x=TS.utility.throttleFunc(k,100);t=TS.utility.throttleFunc(l,1e3)});u=function e(n,r){t(n,void 0,void 0,r)}},upsertRxnsFromDataAndUpdateUI:function e(t,n){var r=f(t,n);"NOOP"!==r.status&&u(t);return r},getRxnKey:function e(t,n,r){"message"!==t||r||TS.error("getRxnKey: no c_id provided for message rxn_key");"message"!==t&&r&&TS.error("getRxnKey: c_id provided for but this is not a message rxn_key");return t+"-"+n+"-"+(r||"")},getRxnKeyByMsgType:function e(t){var n;if("file_upload"===t.subtype||"file_share"===t.subtype||"file_mention"===t.subtype||"file_reaction"===t.subtype){if(t.file){var r=t.file;_.isString(r)&&(r=TS.files.getFileById(r));n=r&&r._rxn_key}}else"file_comment"===t.subtype?t.comment&&(n=t.comment._rxn_key):n=t._rxn_key;return n},getRxnKeyFromData:function e(t){var n;if("message"===t.type)n=t.ts||t.message.ts;else if("file"===t.type)n=t.file.id||t.file;else{if("file_comment"!==t.type)throw new Error("item.type not handled");n=t.file_comment||t.comment.id}return TS.rxns.getRxnKey(t.type,n,t.channel)},getExistingRxnsByKey:function e(t){return a[t]||null},getRxnRecordByKey:function e(t){if(i[t])return i[t];for(var n=r.length-1;n>-1;n-=1)if(r[n].rxn_key===t){i[t]=r[n];return i[t]}return null},getNextRxnRecordThatNeedsAlert:function e(){var t;for(var n=r.length-1;n>-1;n-=1){if(!TS.rxns.need_alerts[r[n].rxn_key])break;t=r[n]}return t},getRxnsFromData:function e(t){if("message"===t.type)return t.message&&t.message.reactions;if("file"===t.type)return t.file&&t.file.reactions;if("file_comment"===t.type)return t.comment&&t.comment.reactions;return null},doesRxnsHaveRxnFromMember:function e(t,n,r){var i=TS.emoji.nameToCanonicalName(n);if(!t)return false;var a=TS.rxns.getRxnFromRxns(t,n)||TS.rxns.getRxnFromRxns(t,i);if(!a)return false;if(!a.count)return false;if(!a.users)return false;return-1!==a.users.indexOf(r)},doesRxnsHaveRxnFromUser:function e(t,n){return TS.rxns.doesRxnsHaveRxnFromMember(t,n,TS.model.user.id)},doesRxnsHaveRxn:function e(t,n){if(!t)return false;return!!TS.rxns.getRxnFromRxns(t,n)},doesRxnsHaveSkinlessRxn:function e(t,n){if(!t)return false;var r=[n.replace(/(::skin-tone-[2-6])/,"")];TS.emoji.spliceSkinToneVariationsIntoAnArrayOfEmojiNames(r);for(var i=0;i<r.length;i+=1)if(TS.rxns.getRxnFromRxns(t,r[i]))return true;return false},countAllRxns:function e(t){if(!t)return 0;var n=0;t.forEach(function(e){n+=e.count||0});return n},countAllEmoji:function e(t){if(!t)return 0;return t.length},countAllUsersRxns:function e(t,n){if(!t)return 0;var r=0;t.forEach(function(e){e.users.indexOf(n)>-1&&(r+=1)});return r},getAllUniqueRxners:function e(t,n){if(!t)return[];var r=[];t.forEach(function(e){if(!e)return;if(!e.count)return;if(!e.users)return;e.users.forEach(function(e){if(n==e)return;if(-1!=r.indexOf(e))return;r.push(e)})});return r},getRxnFromRxns:function e(t,n){if(!t)return null;return t.filter(function(e){return e.name==n})[0]||null},changeRxnsFromIMsg:function e(t){var n=false;"message"===t.item.type&&t.item.ts?n=true:"file"===t.item.type&&"string"===typeof t.item.file?n=true:"file_comment"===t.item.type&&t.item.file_comment&&"string"===typeof t.item.file&&(n=true);if(!n)return;if(!y(t.item))return;var r=t.user==TS.model.user.id;var i=TS.rxns.getRxnKeyFromData(t.item);var a=TS.rxns.getExistingRxnsByKey(i);var s;var o="reaction_added"===t.type;s=c(o,_.cloneDeep(a)||[],t.reaction,t.user,t.url);var d=f(i,s);TS.has_pri[O]&&TS.dir(O,d,"handleRxnChangeFromMS upsert status:"+d.status);b(t);if("NOOP"===d.status)return;r&&!t._from_evt_log?l(i,t.reaction,t.user,t.item.type):u(i,t.item.type);o?TS.log(2006,"Adding to "+i):TS.log(2006,"Removing from "+i)},changeRxnsFromUserAction:function e(t,n,r){r?TS.log(2006,"Adding rxn to "+t+" from user action"):TS.log(2006,"Removing rxn from "+t+" from user action");var i=TS.emoji.nameToCanonicalName(n);var a=TS.rxns.getExistingRxnsByKey(t);var u=TS.rxns.getRxnFromRxns(a,n);if(!u)if(TS.boot_data.feature_emoji5){var c=TS.emoji.getObsoletedEmojiNameFromModernEmojiName(i);n=TS.rxns.getRxnFromRxns(a,c)?c:i}else n=i;TS.has_pri[O]&&TS.log(O,"changeRxnsFromUserAction rxn_key:"+t+" name:"+n+" adding:"+r);var f=TS.emoji.isValidName(n)||TS.emoji.shouldRenderEmoji5(n);if(r&&!f&&!(u&&u.url)){TS.error('"'+n+'" is not a valid emoji');return}var p=TS.rxns.getExistingRxnsByKey(t)||[];if(r){var T=TS.rxns.countAllEmoji(p);var v=TS.rxns.countAllUsersRxns(p,TS.model.user.id);if(T>=50&&!TS.rxns.doesRxnsHaveRxn(p,n)){M(E);return}if(v>=23){M(A);return}}var b=d(r,_.cloneDeep(p),n);if(TS.has_pri[O]){TS.dir(O,p,"existing_rxns");TS.dir(O,b,"new_rxns")}var y=m(t,b);TS.has_pri[O]&&TS.dir(O,y,"changeRxnsFromUserAction upsert status:"+y.status);if("NOOP"===y.status){TS.error("changeRxnsFromUserAction called but no NOOP?");return}l(t,n,TS.model.user.id);var w=$('[data-rxn-key="'+t+'"]');var k={};var x=w.closest("ts-message");var C=""+x.data("ts");var I=x.data("model-ob-id");k={message_timestamp:C,channel_id:I,channel_type:I?I.charAt(0):"",member_id:x.data("member-id"),app_id:x.data("app-id"),bot_id:x.data("bot-id")};if(_.has(TS,"interop.redux.features.messagePane")){var F=TS.interop.redux.features.messagePane.getChannelSessionId(TS.redux.getState());null!==F&&(k.channel_session_id=F)}var D=r?"REACTION_ADDED":"REACTION_REMOVED";var H=TS.rxns.getRxnKeyParts(t);if(TS.model.unread_view_is_showing&&"message"===H.type&&H.id){_.merge(k,TS.client.ui.unread.getTrackingData(H.id));TS.client.ui.unread.incrementTrackingSeqId()}_.merge(k,TS.ui.thread.getTrackingPayloadForEl(w));"threads_view"===TS.ui.thread.getContextForEl(w)&&TS.client.ui.threads.incrementTrackingSeqId();TS.interop.clog.track(D,k);h(t);var B=function e(i,a,u){g(t);TS.log(2006,(r?"reactions.add":"reactions.remove")+" returned "+i+" for "+t);var c=false;if(i);else if(!r&&a.error&&"no_reaction"===a.error);else{a.error==E||a.error==A?M(a.error):a.error==P&&TS.warn("Attempted to add/remove invalid emoji and the API complained: "+u.name);var f=TS.rxns.getExistingRxnsByKey(t)||[];var p=d(!r,_.cloneDeep(f),n);var h=m(t,p);TS.has_pri[O]&&TS.dir(O,h,"changeRxnsFromUserAction UNDO upsert status:"+h.status);"NOOP"===h.status?TS.has_pri[O]&&TS.log(O,"changeRxnsFromUserAction trying to undo because of API rsp, but no NOOP?"):c=true}var T=function e(){TS.has_pri[O]&&TS.log(O,"maybeUpdateModel pending:"+s[t]+" _pending_last:"+o[t]);if(s[t])return false;if(!o.hasOwnProperty(t))return false;var n=m(t,o[t]);delete o[t];TS.has_pri[O]&&TS.dir(O,n,"maybeUpdateModel status:"+n.status);if("NOOP"===n.status)return false;l(t);S(t);return true};if(!T()&&!c)return;l(t)};return TS.redux.dispatch(TS.interop.reactions.submitAddOrRemoveReaction({reactionKey:t,name:n,add:!!r})).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;B(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;B(i,t,n,r);return{data:t,args:n,request_id:r}})},checkForRxnClick:function e(t){if(!t||!t.target)return;var n=$(t.target);var r=n.closest(".rxn");if(!r.length)return;var i=String(r.data("emoji"));var a=n.closest(".rxn_panel");var s=a.data("rxn-key");var o=r.hasClass("is_handy");var l;if(r.hasClass("menu_rxn"))TS.ui.react_emoji_menu.start({e:t,rxn_key:s});else{l=!r.hasClass("user_reacted");if(!l&&t.shiftKey)F(s);else{var u=o&&TS.emoji.isNameSkinToneModifiable(i)?":"+TS.emoji.getChosenSkinToneModifier():"";TS.rxns.changeRxnsFromUserAction(s,i+u,l)}}},getRxnRecords:function e(){return r},getRxnKeyParts:function e(t){var n=t.split("-");return{type:n[0],id:n[1],c_id:n[2]}},test:function e(){return{updateUI:l,addOrRemoveRxnFromRxns:c,upsertRxnsFromData:f,upsertRxns:p,incrementPendingCnt:h,decrementPendingCnt:g,fetchAndUpdateRxns:S,displayTooManyError:M,TOO_MANY_REACTIONS:A,TOO_MANY_EMOJI:E}},clearHandyRxnsDisplayDataCache:function e(){n=void 0},getMemberRxnsFromMessage:function e(t,n){if(!t||!n)return;var r=TS.rxns.getRxnKeyByMsgType(t);if(!r)return;var i=TS.rxns.getExistingRxnsByKey(r);if(!i)return;var a=i.filter(function(e){return _.includes(e.users,n)});return a},getHandyRxnsDisplayDataByRxnKey:function r(){if(!n){n={items:{}};var i=TS.boot_data.feature_emoji5?t:e;i.forEach(function(e){var t=TS.emoji.isNameSkinToneModifiable(e)?TS.emoji.getChosenSkinToneModifier():"";var r=":"+e+":"+t;n.items[e]={html:new Handlebars.SafeString(TS.emoji.graphicReplace(r,{no_skin_tone_squares:true})),name:r,names:r}})}return n}});var e=["slightly_smiling_face","+1","white_check_mark","heart","eyes"];var t=["slightly_smiling_face","+1","heavy_check_mark","heart","eyes"];var n;var r=[];var i={};var a={};var s={};var o={};var l=function e(t,n,r,i){var a;var s=TS.rxns.getRxnKeyParts(t);if(s&&s.c_id){var o=TS.shared.legacyGetActiveModelOb();o&&o.id!==s.c_id&&(a=true)}var l;var u=0;a||(l=TS.client&&TS.client.ui&&TS.client.ui.areMsgsScrolledToBottom(u));TS.templates.builders.updateRxnPanels(t,n,r);if("file"===i){TS.log("(Temporary) Rebuilding mentions due to file reaction.");TS.view.rebuildMentions()}TS.client&&l&&TS.client.ui.instaScrollMsgsToBottom(true)};var u=function e(t,n){l(t,void 0,void 0,n)};var d=function e(t,n,r){return c(t,n,r,TS.model.user.id)};var c=function e(t,n,r,i,a){var s=TS.rxns.getRxnFromRxns(n,r);if(t)s?TS.utility.ensureInArray(s.users,i)&&(s.count+=1):n.push({users:[i],count:1,name:r,url:a});else if(s){var o=s.users.indexOf(i)>=0;if(o){_.pull(s.users,i);s.count-=1;(s.count<1||0===s.users.length)&&_.pull(n,s);n.length||(n=null)}}return n};var m=function e(t,n){return p(t,n,true)};var f=function e(t,n){return p(t,n,false)};var p=function e(t,n,r){var i={status:"NOOP",what_changed:[],rxns:n};if(!r&&s[t]){o[t]=_.cloneDeep(n);TS.has_pri[O]&&TS.log(O,"_upsertRxns call ignored because !force && _pending_counts["+t+"]:"+s[t]);return i}var l=TS.rxns.getExistingRxnsByKey(t);if(n)if(l){if(!TS.utility.areSimpleObjectsEqual(l,n,"rxn_key:"+t)){i.status="CHANGED";a[t]=n}}else{i.status="ADDED";a[t]=n}else if(l){i.status="CHANGED";delete a[t]}i.rxns=a[t]||null;TS.useReactMessages()&&(TS.redux.reactions.isInBulkUpsertMode()?TS.redux.reactions.addToBulkUpsertPayload(t,n):TS.redux.reactions.updateReaction(t,n));TS.has_pri[O]&&TS.dir(O,i,t);return i};var h=function e(t){if(!t)return;s[t]=s[t]||0;s[t]+=1;TS.has_pri[O]&&TS.log(O,"_incrementPendingCnt "+t+": "+s[t])};var g=function e(t){if(!s[t]){TS.has_pri[O]&&TS.log(O,"_decrementPendingCnt "+t+": "+s[t]);return}s[t]-=1;0===s[t]&&delete s[t];TS.has_pri[O]&&TS.log(O,"_decrementPendingCnt "+t+": "+s[t])};var S=function e(t){h(t);TS.redux.dispatch(TS.interop.reactions.fetchReactions({reactionKey:t})).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.data;g(t);var r=TS.rxns.getRxnsFromData(n);var i=f(t,r);TS.has_pri[O]&&TS.dir(O,i,"_fetchAndUpdateRxns upsert status:"+i.status);if("NOOP"===i.status)return;l(t)}).catch(function(){g(t);TS.error("_fetchAndUpdateRxns got an err")})};var T=function e(t,n,r){if(!t)return null;if(!t.emoji)return null;if(!t.emoji.hasOwnProperty(n))return null;for(var i=0;i<t.emoji[n].length;i+=1)if(t.emoji[n][i].id===r)return t.emoji[n][i];return null};var v=function e(t){if(!TS.client)return false;if(t.user==TS.model.user.id)return false;if("message"===t.item.type&&"undefined"!==typeof t.item.message&&t.item.message.user!=TS.model.user.id)return false;if("file"===t.item.type&&"undefined"!==typeof t.item.file&&t.item.file.user!=TS.model.user.id)return false;if("file_comment"===t.item.type&&"undefined"!==typeof t.item.comment&&t.item.comment.user!=TS.model.user.id)return false;return true};var b=function e(t){if(!v(t))return;var n=TS.rxns.getRxnKeyFromData(t.item);if("reaction_added"===t.type){if("message"===t.item.type)var r=t.item.channel;var i=!t._from_evt_log&&"message"===t.item.type;w(t.reaction,n,t.user,t.event_ts,i,r,t.url)}else C(t.reaction,n,t.user)};var y=function e(t){if(!t)return false;if("message"===t.type){var n=TS.utility.msgs.findMsg(t.ts,t.channel);if(!n)return false;t.message=n;return true}if("file"===t.type||"file_comment"===t.type){var r=TS.files.getFileById(t.file);if(!r)return false;t.file=r;if("file_comment"===t.type){var i=TS.files.getFileCommentById(r,t.file_comment);if(!i)return false;t.comment=i}return true}return false};var w=function e(t,n,a,s,o,l,u){s=s||TS.interop.datetime.makeTsStamp();o=!!o;var d=false;var c=i[n];if(!c){d=true;r[r.length]={rxn_key:n};i[n]=r[r.length-1];c=i[n]}c.last_update=s;o&&(TS.rxns.need_alerts[n]=TS.rxns.need_alerts[n]||s);c.emoji=c.emoji||{};c.source=l||"";c.url=u;c.emoji[t]=c.emoji.hasOwnProperty(t)&&c.emoji[t]||[];var _=c.emoji[t];var m=T(c,t,a);if(!m){_[_.length]={id:a};m=_[_.length-1]}m.when=s;TS.dir(877,r,t+" "+n+" "+a);var f=r.length;d&&f>1&&r[f-1].last_update<r[f-2].last_update&&r.sort(function e(t,n){if(t.last_update<n.last_update)return-1;if(t.last_update>n.last_update)return 1;return 0});x(o)};var k=function e(t){TS.rxns.rxn_records_changed_sig.dispatch(t)};var x=function e(){k()};var C=function e(t,n,a){var s=TS.rxns.getRxnRecordByKey(n);var o=T(s,t,a);if(o&&s){_.pull(s.emoji[t],o);s.emoji[t].length||delete s.emoji[t];if(!Object.keys(s.emoji).length){delete i[n];_.pull(r,s)}}TS.rxns.rxn_records_changed_sig.dispatch()};var M=function e(t){var n=TS.interop.i18n.t("You\u2019ve reached the reaction limit","rxns")();var r=[TS.interop.i18n.t("For reasons of performance and productivity and brevity being the soul of wit, you can add up to 23 emoji to a message, but no more.","rxns")(),TS.interop.i18n.t("Well done! You\u2019ve added the maximum amount of emoji one person can add to one message. For reasons of performance, productivity and sharpened creative thinking, we cap the number of individual reacji to 23.","rxns")(),TS.interop.i18n.t("Emotions! We all have them \u2014 but on Slack, you\u2019re limited to 23 reactions per message.","rxns")()];var i=[TS.interop.i18n.t("The human heart is a powerful thing; its capacity to feel is limitless! A message\u2019s capacity is 50.","rxns")(),TS.interop.i18n.t("Alas! Slack only allows each message a grand total of 50 emoji reactions.","rxns")(),TS.interop.i18n.t("A single message can\u2019t have more than 50 unique reactions. When we asked the engineers why they said, \u201cwe have to set limits somewhere,\u201d and then we tried to frown but this error popped up. So that\u2019s where we\u2019re at.","rxns")()];if(t==A){var a=_.sample(r);TS.generic_dialog.alert('<p class="no_bottom_margin">'+a+"</p>",n)}else if(t==E){var s=_.sample(i);TS.generic_dialog.alert('<p class="no_bottom_margin">'+s+"</p>",n)}};var I=function e(){$(".msgs_holder").find("ts-message").each(function(){var e=$(this);TS.ui.messages.maybeUpdateMessageHoverContainer(e)})};var A="too_many_reactions";var E="too_many_emoji";var P="invalid_name";var F=function e(t){var n=TS.rxns.getExistingRxnsByKey(t);if(!n)return;n.forEach(function(e){if(!TS.rxns.doesRxnsHaveRxnFromUser(n,e.name))return;TS.rxns.changeRxnsFromUserAction(t,e.name,false)})};var O="888"})()},11265:function(e,t){(function(){TS.registerModule("ui.new_channel_modal",{start:function t(n,r,i){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;var a=TS.boot_data.feature_accessible_fs_dialogs?TS.interop.i18n.t("Create a channel","new_channel")():"";TS.ui.fs_modal.start({title:a,body_template_html:'<div id="new_channel_modal_container"></div>',onEnd:T});e=$("#new_channel_modal_container");TS.prefs.getPref("lessons_enabled")&&TS.lessons&&TS.lessons.inOnboarding()&&TS.lessons.new_channel_modal_opened_sig.dispatch(true);return TS.ui.new_channel_modal.startInContainer(e,n,r,i)},startInContainer:function i(a,s,o,l){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;e=a;n=false!==o;TS.permissions.members.canCreateChannels()||(n=false);TS.permissions.members.canCreateGroups()||(n=true);var u=TS.permissions.members.canCreateChannels()&&TS.permissions.members.canCreateGroups();s=TS.utility.cleanChannelName(s||"");l=l||[];var c;c=TS.prefs.getPref("lessons_enabled")&&TS.lessons&&TS.lessons.inOnboarding()?TS.templates.channel_new_simplified_for_onboarding_modal:TS.templates.channel_new_modal;e.html(c({title:s,is_public:n,can_toggle_private:u,compliance_exports_enabled_for_team:!!TS.prefs.getTeamPref("compliance_export_start"),is_ra:TS.model.user.is_restricted,can_create_shared_channel:TS.permissions.members.canRequestSharedChannel()}));t=Ladda.create(e.find(".new_channel_go")[0]);d(l);setTimeout(function(){g()},500);return new Promise(function(e,t){r={resolve:e,reject:t}})},go:function r(){var i=e.find(".title_input").val();var a=$("#invite_members_container").lazyFilterSelect("value");var s=[];var o=[];a&&a.forEach(function(e){e.member?s.push(e.member.id):o.push(e)});var l=_.trim(TS.utility.contenteditable.value(e.find("#channel_purpose_input")));t&&t.start();n?m(i,l,s,o):f(i,l,s,o)},end:function e(){v()},test:function e(){return{createPublicChannel:m,createPrivateChannel:f}}});var e;var t;var n;var r;var i=function t(){var n=e.find("#invite_members_container").find("input")[0];var r=e.find("#channel_purpose_input");e.on("keydown",function(e){if(e.which!==TS.utility.keymap.enter||document.activeElement==n||TS.utility.contenteditable.hasFocus(r)){if(e.which===TS.utility.keymap.esc){TS.ui.fs_modal.close();TS.boot_data.feature_lesson_onboarding&&TS.prefs.getPref("lessons_enabled")&&TS.lessons&&TS.lessons.inOnboarding()&&TS.lessons.new_channel_modal_closed_sig.dispatch(true);e.preventDefault()}}else{TS.ui.new_channel_modal.go();e.preventDefault()}})};var a=function t(){var r=$("#channel_public_private_toggle");r.togglify();r.bind("change",function(){n=r.is(":checked");if(r.is(":checked")){e.find(".private_channel_item").addClass("hidden");e.find(".public_channel_item").removeClass("hidden")}else{e.find(".public_channel_item").addClass("hidden");e.find(".private_channel_item").removeClass("hidden")}})};var s=function e(){return new Promise(function(e){TS.model.user.is_admin?TS.api.call("users.admin.invited").then(function(t){var n=TS.pending_users.filterOutURAs(t.data.pending);if(n.length){n.forEach(function(e){TS.pending_users.sanitizeNameFields(e)});e(n)}else e([])}):e([])})};var o=function e(t){var n=true;var r=s();return function(e,i){"@"===e.charAt(0)&&(e=e.substring(1));var a;var s=false;if(n){n=false;_.get(t,"length")&&(s=true)}if(s){var o=_.compact(t.map(TS.interop.members.getMemberById));var u=o.map(function(e){return{member:e,lfs_id:String(e.id),preselected:true}});return Promise.resolve({items:u})}if(i>0)return Promise.resolve({items:[]});a=l(e);return Promise.all([a,r]).then(function(t){var n=t[0];var r=t[1];if(_.isUndefined(r)||0===r.length)return n;var i=new RegExp("^"+TS.utility.regexpEscape(e),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(e),"i");r=r.filter(function(e){return TS.pending_users.checkUserMatch(e,i)||TS.pending_users.checkUserMatch(e,a)});n=n.concat(r).sort(function(e,t){return TS.pending_users.usersSorterByName(e,t)});return n})}};var l=function e(t){var n={query:t,filter:"everyone"};return TS.members.fetchAndUpsertMembersWithQuery(n).then(function(e){var n=[];var r=TS.members.getMembersForUser();var i=r.map(function(e){return e.id});n=""===t?r:e.objects;n=_.filter(n,function(e){if(e.is_self)return false;if(e.is_slackbot)return false;if(-1===_.indexOf(i,e.id))return false;return true});return n.filter(function(e){return!(e.is_ultra_restricted||e.deleted||!e._is_local||e.is_app_user)}).map(function(e){return{member:e,lfs_id:String(e.id)}})})};var u=function e(t){var n;var r;var i;var a={append:true,per_page:50,max_selected_items:1e3,approx_item_height:36,placeholder_text:TS.interop.i18n.t("Search by name","new_channel")(),template:function e(t){var n;n=t.member?TS.templates.channel_invite_member_small({member:t.member}):TS.templates.channel_invite_pending_user_small({invitee:t});return new Handlebars.SafeString(n)},tokenTemplate:function e(t){var n;n=t.member?TS.templates.channel_invite_member_token({member:t.member}):TS.templates.channel_invite_pending_user_token({invitee:t});return new Handlebars.SafeString(n)},tokenClass:function e(t){if(t.member)return TS.templates.builders.getMemberTypeClass(t.member);return"lfs_token_pending_user"},filter:function e(t,a){var s=t.member;if(n!==a){r=new RegExp("^"+TS.utility.regexpEscape(a),"i");i=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(a),"i");n=a}var o=true;if(s)return TS.utility.members.checkMemberMatch(s,r,o)||TS.utility.members.checkMemberMatch(s,i,o);return TS.pending_users.checkUserMatch(t,r)||TS.pending_users.checkUserMatch(t,i)},noResultsTemplate:function e(t){if(!t)return TS.interop.i18n.t("No one found","new_channel")();return TS.interop.i18n.t("No one found matching <strong>{query}</strong>","new_channel")({query:TS.interop.i18n.safeString(TS.utility.truncateAndEscape(t,50))})}};a.data_promise=o(t);$("#invite_members_container").lazyFilterSelect(a)};var d=function t(n){u(n);e.find(".lfs_input").attr("id","invite_members_input");e.find(".new_channel_go").click(TS.ui.new_channel_modal.go);e.find(".create_share_channel").click(function(){TS.ui.new_channel_modal.end();TS.ui.share_channel_dialog.start({channel_name:$("#channel_create_title").val(),is_private:$("#channel_public_private_toggle").length&&!$("#channel_public_private_toggle").is(":checked"),element:"shared_channels_new_channel_modal_share_btn"})});i();a();e.find(".title_input").keydown(function(){e&&e.find(".modal_input_note.mustard_yellow").each(function(){$(this).addClass("hidden")})});$("#channel_create_title").focus();e.find(".new_channel_cancel_btn").on("click",function(){var e=r&&r.reject;e&&e();TS.ui.fs_modal.close();TS.boot_data.feature_lesson_onboarding&&TS.prefs.getPref("lessons_enabled")&&TS.lessons.inOnboarding()&&TS.lessons.new_channel_modal_closed_sig.dispatch(true)});var s=$("#save_channel");var o=$("#channel_create_title");function l(){var e=o.val();e&&e.length?TS.utility.disableElement(s,false):TS.utility.disableElement(s,true)}if(s.length&&o.length){o.on("input",l);l()}var d=e.find("#channel_purpose_input");TS.utility.contenteditable.create(d,{ariaLabel:TS.interop.i18n.t("Channel purpose","new_channel")(),singleLineInput:true,modules:{tabcomplete:{positionMenu:function e(t){t.style.width=d.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,d)},searchOptions:{complete_member_specials:false},completers:["channels","emoji","members"]}},onTab:function e(){return true},onEnter:function e(){return false},onEscape:function e(){TS.ui.fs_modal.close()}});TS.utility.contenteditable.enable(d)};var c=function e(t){var n=r&&r.resolve;n&&n(t)};var m=function n(r,i,a,s){TS.redux.dispatch(TS.interop.channels.submitCreate(r)).then(function(e){TS.client&&TS.channels.legacyDisplayChannel({id:e.id});p(e.id,a);i&&TS.interop.channels.submitChannelPurpose(e.id,i).catch(TS.channels.legacyAlertSetPurposeError);h(e.id,s);c(e);TS.ui.fs_modal.close()}).catch(function(n){t&&t.stop();var i=TS.ui.validation.getErrorMessage(_.get(n,"data.error")||n.message,{name:r});TS.ui.validation.showWarning(e.find(".title_input"),i,{custom_for:"channel_create_title"})})};var f=function n(r,i,a,s){TS.redux.dispatch(TS.interop.channels.submitCreate(r,{isPrivate:true})).then(function(e){TS.client&&TS.groups.legacyDisplayGroup({id:e.id});p(e.id,a);i&&TS.interop.channels.submitChannelPurpose(e.id,i).catch(TS.channels.legacyAlertSetPurposeError);h(e.id,s);c(e);TS.ui.fs_modal.close()}).catch(function(n){t&&t.stop();var i=TS.ui.validation.getErrorMessage(_.get(n,"data.error")||n.message,{name:r});TS.ui.validation.showWarning(e.find(".title_input"),i,{custom_for:"channel_create_title"})})};var p=function e(t,n){if(!t||!n||!n.length)return;_.pull(n,TS.model.user.id);n.length&&TS.api.call("conversations.invite",{channel:t,users:n.join(","),just_created:true,force:true})};var h=function e(t,n){t&&n&&n.length&&TS.pending_users.invitePendingUsersToChannel(n,t)};var g=function e(){var t=new Date("March 17, 2017 10:00:00");var n=Math.floor(t.getTime()/1e3);if(TS.prefs.getPref("seen_intl_channel_names_coachmark"))return;if("en-US"===TS.boot_data.browser_lang||"en-us"===TS.boot_data.browser_lang)return;if(TS.model.user.created>n)return;TS.prefs.setPrefLocal("seen_intl_channel_names_coachmark",true);TS.prefs.setPrefByAPI({name:"seen_intl_channel_names_coachmark",value:true},function(){TS.coachmark.start(TS.coachmarks.coachmarks.intl_channel_names)})};var S=function t(){if(e){e.find(".new_channel_go").off("click");e.find("#channel_public_private_toggle").off("change");e.off("keydown")}};var T=function e(){v()};var v=function n(){S();e=null;t=null;r=null}})()},11266:function(e,t){(function(){TS.registerModule("ui.lazy_filter_select",{STYLES:{default:"default",filter_in_list:"filter_in_list",normal:"normal",small:"small"},onStart:function e(){$("select[data-lazy-filter-select], label[data-lazy-filter-select] select").addClass("hidden").lazyFilterSelect({use_data_attributes:true})},create:function t(n,r){if(r.use_data_attributes){var a=Object.keys(n.data());a.forEach(function(e){if(e.indexOf("lazyFilterSelect")>-1&&"TS-lazyFilterSelect"!==e&&""!==n.data(e)){var t=n.data(e);"true"!==t&&"false"!==t||(t="true"===t);r[e.replace("lazyFilterSelect","").toLowerCase()]=t}})}"SELECT"===n.prop("tagName")&&"undefined"===typeof r.single&&(r.single=!n.prop("multiple"));var s=$.extend({},e,r);void 0===r.approx_divider_height&&(s.approx_divider_height*=1);void 0===r.approx_item_height&&(s.approx_item_height*=1);var o=$('<div class="lazy_filter_select">');s.classes&&o.addClass(s.classes);n.prop("disabled")&&(s.disabled=true);s.disabled&&o.addClass("disabled");s.style=_.get(TS.ui.lazy_filter_select.STYLES,s.style,TS.ui.lazy_filter_select.STYLES.default);if(ne(s)&&!s.single){TS.warn("Multi-select lazyFilterSelect instances can't use the 'filter_in_list' style. Using 'default' style instead.");s.style=TS.ui.lazy_filter_select.default}var l=TS.templates.lazy_filter_select_container({instance:s,aria_labelledby:n.attr("aria-labelledby"),STYLES:TS.ui.lazy_filter_select.STYLES});o.html(l);s.append?o.appendTo(n):o.insertAfter(n);o.addClass(s.style+"_style");s.single&&o.addClass("single");s.width&&o.css("width",s.width);s.css&&o.css(s.css);s.$container=o;s.$select=n;s.$input_container=o.find(".lfs_input_container");s.$lfs_value=o.find(".lfs_value");s.$input=o.find(".lfs_input");s.$list_container=o.find(".lfs_list_container");s.$list=o.find(".lfs_list");s.$status=o.find(".lfs_status");s.$status_loading_indicator=s.$status.find(".lfs_status_loading_indicator");s.$status_content=s.$status.find(".lfs_status_content");ne(s)?s.$filter_input=o.find(".lfs_filter_input"):s.$filter_input=s.$input;s._page_number=1;s._slug_id_counter=1;s.run=O;if(s.data_promise){B(s)&&s._running_promise.cancel("Uhhh...");s._running_promise=H(s,"").then(function(e){s.data=e;s.run();i(s)},function(e){i(s);TS.console.logError(e,"LFS error");ie(s,e,"Something failed while trying to return the initial data for lazyFilterSelect.")})}else{s.data&&(s.data=s.data.slice());_.forEach(s.data,function(e,t,n){e&&e._is_interop_channel_object&&(n[t]=_.assign({},e))});s.run();i(s)}s.current_items_in_view_signal=new signals.Signal;return s},convertHTMLDataToRLFSData:x,is_list_open:false});var e={allow_item_unselect:false,allow_list_position_above:false,always_visible:false,append:false,approx_divider_height:28,approx_item_height:30,data_promise:null,data_qa:"lfs",disabled:false,filter:function e(t,n){var r=t.toString();n=n.toLowerCase();if(t instanceof jQuery||t instanceof HTMLElement){r=$(t).text();var i=$(t).attr("data-additional-search-field");if(i&&i.toLowerCase().indexOf(n)>-1)return true}return r.toLowerCase().indexOf(n)>-1},input_debounce_wait_time:void 0,listItemClass:null,max_selected_items:Infinity,min_query_length:0,monkey_scroll:true,no_default_selection:false,noResultsTemplate:function e(t){if(re(this)&&t.length<this.min_query_length)return TS.interop.i18n.t("{query_length, plural, =0 {Start typing to see results\u2026} other {Keep typing to see results\u2026}}","lazy_filter_select")({query_length:t.length});return TS.interop.i18n.t("No items matched {query}","lazy_filter_select")({query:TS.interop.i18n.safeString("<strong>"+_.escape(t)+"</strong>")})},errorTemplate:function e(t){return t||TS.interop.i18n.t("Couldn't load results.","lazy_filter_select")()},onInputBlur:_.noop,onInputFocus:_.noop,onReady:function e(){},onItemAdded:function e(){},onItemRemoved:function e(){},onKeyDown:function e(){},onMaxItemsSelected:function e(){},onListShown:_.noop,onListHidden:_.noop,adjustAvailableSpaceAbove:_.identity,adjustAvailableSpaceBelow:_.identity,placeholder_text:TS.interop.i18n.t("Choose an option\u2026","lazy_filter_select")(),filter_placeholder_text:TS.interop.i18n.t("Search","lazy_filter_select")(),renderDividerFunc:null,render_item_func:null,restrict_input_container_height:false,restrict_preselected_item_removal:false,scroll_threshold:1e3,set_height:true,should_graphic_replace_emoji:false,single:false,sluggify:{enabled:false,delimiter:null,key_name:null,validator:null},style:TS.ui.lazy_filter_select.STYLES.default,template:function e(t){var n=t.toString();var r;var i;if(t instanceof jQuery||t instanceof HTMLElement){n=$(t).text();r=Z($(t).attr("data-additional-search-field"),this);i=Z($(t).attr("data-ts-icon"),this)}n=Z(n,this);r&&(n+=' <span class="addl_text">'+r+"</span>");i&&(n+=' <ts-icon class="addl_icon '+i+'"></ts-icon>');return new Handlebars.SafeString(n)},tokenClass:null,tokenTemplate:null,tokenTemplateSingle:null,use_data_attributes:false,_$active:null,_all_done_fetching:false,_list_built:false,_list_visible:false,_mouse:{},_page_number:1,_prevent_blur:false,_previous_val:"",_running_promise:null,_scroll_callback_was_called:false,_selected:[],_showing_status:false};$.widget("TS.lazyFilterSelect",{_create:function e(){this.instance=TS.ui.lazy_filter_select.create(this.element,this.options)},_destroy:function e(){this.instance.$container.remove();delete this.instance},blur:function e(){this.instance.$filter_input.blur()},clearValue:function e(){if(this.instance.single){if(this.instance._selected.length){var t=this.instance.$input_container.find(".lfs_item");P(this.instance,t)}}else A(this.instance)},container:function e(){return this.instance.$container},disable:function e(){c(this.instance)},disabled:function e(){return this.instance.disabled},enable:function e(){f(this.instance)},focus:function e(){this.instance.$filter_input.focus()},getInstance:function e(){return this.instance},hideList:function e(){T(this.instance,{force:true});le(this.instance)},recomputeHeight:function e(){Q(this.instance)},setValue:function e(t){var n=this.element[0].selectedIndex;this.element.val(t);this.element[0].selectedIndex<0&&(this.element[0].selectedIndex=0);var r=this.element[0].options[this.element[0].selectedIndex];if(this.instance.single){if(this.element[0].selectedIndex==n)return}else A(this.instance);var i=g(this.instance,$(r));L(this.instance,i)},forceSelectItem:function e(t){this.instance.$lfs_value.html(a(this.instance,t,{force_selected:true}));this.instance.$container.addClass("value")},showList:function e(){W(this.instance)},update:function e(t){J(this.instance,t)},updatePlaceholder:function e(t){this.instance.placeholder_text=t;this.instance.$input.prop("placeholder",t)},updateFilterPlaceholder:function e(t){if(!ne(this.instance))return;this.instance.filter_placeholder_text=t;this.instance.$filter_input.prop("placeholder",t)},value:function e(){return this.instance._selected}});var t=function e(t,r){if(!v(t))return;if(!r.trim())return;if(!d(t))return;var i={};i[t.sluggify.key_name]=r.trim();i.lfs_id=null;i.lfs_slug_id=t._slug_id_counter;t._slug_id_counter+=1;t._selected.push(i);var a=TS.templates.lazy_filter_select_item({content:t.tokenTemplate(i),applied_classes:"lfs_token",slug_id:i.lfs_slug_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"");var s=$(a);s.insertBefore(t.$input);t.sluggify.validator&&t.sluggify.validator(s);C(t,t.data);W(t);t.$filter_input.val("");t._previous_val="";n(t);t.onItemAdded(i);d(t)||t.onMaxItemsSelected()};var n=function e(t){if(!t.single){t.$input.prop("size",t.$filter_input.val().length+1);if(t.$filter_input.val().length+t._selected.length===0)G(t);else{t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}}};var r=function e(t){t.data_promise&&t.$list.on("scroll",function(){var e=$(this).scrollTop();var n=t.$list.height();var r=t.$list.find(".list_items").height();var i=r-e-n;if(i<=t.scroll_threshold&&!t._scroll_callback_was_called&&!t._all_done_fetching){u(t,t._previous_val,t._page_number+1);t._scroll_callback_was_called=true}else if(i>t.scroll_threshold&&t._scroll_callback_was_called){B(t)&&t._running_promise.cancel("User scrolled back and we do not need to add more data");t._scroll_callback_was_called=false}})};var i=function e(t){t.$container.on("mouseleave",ue.bind(null,t));t.$container.on("click",de.bind(null,t));t.$container.parents("label").on("click",ce.bind(null,t));t.$input_container.on("focus",_e.bind(null,t));t.$input.on("focus",me.bind(null,t));var n;n=_.isUndefined(t.input_debounce_wait_time)?fe:_.debounce(fe,t.input_debounce_wait_time);t.$filter_input.on("input",n.bind(null,t));t.$filter_input.on("keydown",pe.bind(null,t));t.$filter_input.on("blur",he.bind(null,t));t.$lfs_value.on("click",be.bind(null,t));t.$lfs_value.on("mousedown",ye.bind(null,t));t.$input_container.on("click",".lfs_token",we.bind(null,t));t.$input_container.on("mousedown",".lfs_token",ke.bind(null,t));t.$list_container.on("mousedown",xe.bind(null,t));t.$list_container.on("mouseup",Ce.bind(null,t));t.$list_container.on("mousemove",".lfs_item",Me.bind(null,t));t.$list_container.on("mouseleave",".lfs_item.active",Ie.bind(null,t));var r=null===_.get(TSSSB,"env.desktop_app_version")?"click":"mousedown";t.$list_container.on(r,".lfs_item",Ae.bind(null,t));t.onReady()};var a=function e(t,n,r){var i=$(n);r=r||{};var a=r.force_selected||b(t,n);var s=n.disabled||n.lfs_disabled;t.restrict_preselected_item_removal&&n.preselected&&(s=true);var o;o=r.should_tokenize&&_.isFunction(t.tokenTemplate)?t.tokenTemplate(n):t.single&&_.isFunction(t.tokenTemplateSingle)?t.tokenTemplateSingle(n):t.template(n);var l=Z(i.data("lfs-item-desc"),t);var u={active:""!==t._previous_val&&!a&&!s,disabled:s,lfs_token:r.should_tokenize,selected:a,single:t.single,group_item:i.hasClass("group_item")};_.isFunction(t.tokenClass)&&(u[t.tokenClass(n)]=true);return TS.templates.lazy_filter_select_item({content:o,icon:i.data("lfs-item-icon"),desc:new Handlebars.SafeString(l),applied_classes:TS.utility.getAppliedClasses(u),lfs_id:n.lfs_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"")};var s="position_above";var o="show_status";var l=function e(t){if(!t._list_built&&!t._showing_status)return;t.$list_container.removeClass(s);var n=t.$list.css("max-height");t.$list.css({"max-height":0});var r=t.$list[0].scrollHeight;var i=parseInt(t.$list_container.css("padding-top"),10)+parseInt(t.$list_container.css("padding-bottom"),10)+parseInt(t.$list_container.css("border-top-width"),10)+parseInt(t.$list_container.css("border-bottom-width"),10)+parseInt(t.$list_container.css("margin-top"),10)+parseInt(t.$list_container.css("margin-bottom"),10);ne(t)&&(i+=t.$filter_input.outerHeight()+parseInt(t.$filter_input.css("margin-bottom"),10));var a=parseInt(t.$list_container.css("max-height"),10);var o=2*t.approx_item_height+i;var l=Math.min(r+i,a);var u=$(window).height();var d=t.$input_container[0].getBoundingClientRect().bottom+parseInt(t.$input_container.css("margin-bottom"),10);var c=t.adjustAvailableSpaceBelow(u-d);if(t.allow_list_position_above){var _=t.$input_container[0].getBoundingClientRect().top+parseInt(t.$input_container.css("margin-top"),10);var m=t.adjustAvailableSpaceAbove(_);var f=m>=l;var p=c>=l&&c>o;if(f&&!p){c=m;t.$list_container.addClass(s)}}var h=Math.floor(Math.min(c,l)-i);t.$list.css({"max-height":h||n})};var u=function e(t,n,r){B(t)&&t._running_promise.cancel("Scrolling happened");if(t._all_done_fetching)return;t._running_promise=t.data_promise(n,r).then(function(e){var n=e;n.items&&(n=n.items);if(n&&n.length){t._page_number+=1;t._current_data||(t._current_data=t.data.slice());"undefined"!==typeof e.all_items_fetched&&(t._all_done_fetching=!!e.all_items_fetched);"undefined"!==typeof e.num_remaining&&0===e.num_remaining&&(t._all_done_fetching=true);var r;var i=parseInt(e.num_new,10)||0;r=n.slice(-i);if(r.length){e._replace_all_items||e.replace_all_items?t._current_data=r:t._current_data=t._current_data.concat(r);m(t,t._current_data)}else t._all_done_fetching=true}else t._all_done_fetching=true},function(e){TS.console.logError(e,"LFS error");ie(t,e,"Something failed while trying to return the next batch of data for lazyFilterSelect.")})};var d=function e(t){return t._selected.length<t.max_selected_items};var c=function e(t){if(t.disabled)return;t.disabled=true;t.$container.addClass("disabled");t.$input.prop("disabled",true);t.$filter_input.prop("disabled",true)};var m=function e(t,r){I(t,r);C(t,r);var i=t._list_built&&(!t.data||0===t.data.length||t.always_visible);i&&W(t,true);n(t)};var f=function e(t){if(!t.disabled)return;t.disabled=false;t.$container.removeClass("disabled");t.$input.prop("disabled",false);t.$filter_input.prop("disabled",false)};var p=function e(t,n){var r=t.data;var i=[];for(var a=0;a<r.length;a+=1){var s=r[a];if(s.lfs_group||s.is_divider){var o=[];for(var l=0;l<s.children.length;l+=1){var u=s.children[l];t.filter(u,n)&&o.push(u)}o.length>0&&i.push({is_divider:true,lfs_group:true,label:s.label,children:o})}else t.filter(s,n)&&i.push(s)}return i};var h=function e(t){return t.attr("data-lfs-id")||t.prop("lfs_id")||null};var g=function e(t,n,r){var i=h(n);var a;if(r)a=t._selected;else{a=t.data_promise&&t._current_data?t._current_data:t.data;if(-1!==i.indexOf(".")){var s=parseInt(i.split(".")[0],10);a=a[s]?a[s].children:a[0].children}}var o=a.filter(function(e){return e.lfs_id===i});if(o.length)return o[0];return null};var S=function e(t,n){var r=parseInt(n.attr("data-lfs-slug-id"),10);var i=t._selected;var a=i.filter(function(e){return e.lfs_slug_id===r});if(a.length)return a[0];return null};var T=function e(t,n){n=n||{};var r=!t._list_visible||t.always_visible||t.disabled;if(r&&!n.force)return;t._list_visible=false;t.$list_container.removeClass("visible");t.$container.removeClass("list_visible");t.$input_container.removeClass("active");t._list_built&&t.$list.longListView("setHidden",true);t._$active=null;t.onListHidden()};var v=function e(t){if(!t.sluggify.enabled)return false;if(!t.sluggify.delimiter){TS.error("You must pass a delimiter regular expression to use sluggify with lazyFilterSelect.");return false}if(!t.sluggify.key_name){TS.error("You must pass a key name to use sluggify with lazyFilterSelect.");return false}if(t.single){TS.error("Sluggify only works in multi-select versions of lazyFilterSelect.");return false}return true};var b=function e(t,n){if(!t._selected.length)return false;var r=t._selected.filter(function(e){return e.lfs_id===n.lfs_id});return!!r.length};var y=function e(t){if(t instanceof jQuery)return!!t.attr("data-lfs-slug-id");return void 0!==t.lfs_slug_id};var w=function e(t,r,i){if(!v(t))return;if(!y(r))return;var a=$(r);var s=Z(a.data("lfs-item-desc"),t);t._slug_id_counter=Math.max(r.lfs_slug_id,t._slug_id_counter)+1;t._selected.push(r);var o;var l=TS.templates.lazy_filter_select_item({content:t.tokenTemplate(r),icon:a.data("lfs-item-icon"),desc:new Handlebars.SafeString(s),applied_classes:"lfs_token",slug_id:r.lfs_slug_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"");o=$(l);o.insertBefore(t.$input);n(t);t.sluggify.validator&&t.sluggify.validator(o);t.data=i.filter(function(e){return e.lfs_slug_id!==r.lfs_slug_id});return t.data};var k=function e(t){var n=t.children("option, optgroup");var r=n.length>0?[]:void 0;n.each(function(){if("OPTGROUP"===$(this).prop("tagName")){var e=$(this).children("option").toArray();$(this).prop("disabled")&&(e=e.map(function(e){e.lfs_disabled=true;return e}));r.push({is_divider:true,lfs_group:true,label:$(this).prop("label"),children:e})}else r.push(this)});return r};function x(e){var t=k(e);t=t.map(function(e,t){e instanceof HTMLOptionElement&&(e={id:String(e.lfs_id||t),original_item:e,label:$(e).text(),value:e.value,preselected:e.selected});return e});return t}var C=function e(t,n){n||(n=t.data);if(!n){ie(t);return}if(0===n.length){ae(t);return}le(t,{keep_input_active:true});if(t._list_built){var r=M(n);t.$list.longListView("setItems",r,true);t._current_data=n;Q(t)}else{t.data&&0!==t.data.length||(t.data=n);z(t)}l(t)};var M=function e(t){var n=[];t.forEach(function(e){n.push(e);if(e.children&&e.children.length)for(var t=0;t<e.children.length;t+=1)n.push(e.children[t])});return n};var I=function e(t,n){n||(n=t.data);if(!n)return;var r="";var i=!t.single;var s=0;while(s<n.length){var o=n[s];if(y(o)){n=w(t,o,n);continue}o.children&&o.children.length&&(o.lfs_group=true);if(o.lfs_group||o.is_divider){o.is_divider=true;var l=s;for(var u=0;u<o.children.length;u+=1){var d=o.children[u];d.lfs_id=d.lfs_id||l+"."+u;if((d.selected||d.preselected)&&false===t.no_default_selection){if(t.single&&t._selected.length>0||b(t,d))continue;t._selected.push(d);r+=a(t,d,{should_tokenize:i})}}}else{o.lfs_id=o.lfs_id||String(s);if((o.selected||o.preselected)&&false===t.no_default_selection){if(t.single&&t._selected.length>0||b(t,o)){s+=1;continue}t._selected.push(o);r+=a(t,o,{should_tokenize:i})}}s+=1}if(r.length>0){t.$container.addClass("value");if(t.single)t.$lfs_value.html(r);else{$(r).insertBefore(t.$input);t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}}};var A=function e(t){while(t.$input_container.find(".lfs_token").length>0)E(t)};var E=function e(t){var n=t.$input_container.find(".lfs_token").last();n.length&&P(t,n)};var P=function e(t,n){if(t.disabled)return;if(y(n)){F(t,n);return}var r=g(t,n,true);if(r.disabled||t.restrict_preselected_item_removal&&r.preselected)return;t._selected=t._selected.filter(function(e){return e!==r});var i=t.$list.find('[data-lfs-id="'+r.lfs_id+'"]');i.removeClass("selected");n.remove();X(t);t.$filter_input.val().length+t._selected.length===0&&G(t);0===t._selected.length&&t.$container.removeClass("value");t.onItemRemoved(r)};var F=function e(t,n){if(!v(t))return;var r=S(t,n);t._selected=t._selected.filter(function(e){return e!==r});n.remove();X(t);t.$filter_input.val().length+t._selected.length===0&&G(t);t.onItemRemoved(r)};var O=function e(){this.data&&0===this.data.length&&TS.warn("Data passed to lazyFilterSelect is empty.");J(this,this.data);this.always_visible&&W(this);if(this.restrict_input_container_height){this.$container.addClass("has_restricted_input_container_height");TS.environment.supports_custom_scrollbar||this.$input_container.monkeyScroll()}};var D=function e(t,r,i){if(t.disabled)return;if(r===t._previous_val)return;t._all_done_fetching=false;t._previous_val=r;t._$active=null;n(t);t._page_number=1;t._list_built&&t.$list.longListView("scrollToTop",true);if(t.data_promise){B(t)&&t._running_promise.cancel("User entered more text");t._running_promise=H(t,r).then(function(e){m(t,e);W(t,i)},function(e){TS.console.logError(e,"LFS error");ie(t,e,"Something failed while trying to return the filtered data for lazyFilterSelect.")})}else{W(t,i);var a=p(t,r);C(t,a);n(t)}};var H=function e(t,n){return new Promise(function(e,r){if(n.length<t.min_query_length){t._all_done_fetching=true;e([])}else{_.delay(function(){B(t)&&se(t)},650);t.data_promise(n).then(function(n){n=n||{};_.isUndefined(n.all_items_fetched)||(t._all_done_fetching=!!n.all_items_fetched);0===n.num_remaining&&(t._all_done_fetching=true);var r=(n.items||n).slice();e(r);le(t,{keep_input_active:true})},function(e){r(e);le(t)})}})};var B=function e(t){return t._running_promise&&t._running_promise.isPending()};var j=function e(t,n){if(t.disabled)return;if(!t._list_visible){W(t);return}var r;r=t._$active?t._$active[n](".lfs_item:not(.disabled, .hidden)").first():t.$list.find(".lfs_item:not(.disabled, .hidden)").first();if(r.length){r.scrollintoview({duration:0});t._$active&&t._$active.removeClass("active");r.addClass("active");t._$active=r}};var R=function e(t){return!(t.hasClass("selected")||t.hasClass("disabled"))};var L=function e(t,n){if(!d(t))return;if(t.single&&t._selected.length){var r=t.$list.find('[data-lfs-id="'+t._selected[0].lfs_id+'"]');r.removeClass("selected");t._selected.length=0;t.$lfs_value.empty()}t._selected.push(n);X(t);var i=$(a(t,n,{should_tokenize:!t.single}));_.isFunction(t.tokenClass)&&i.addClass(t.tokenClass(n));if(t.single)t.$lfs_value.html(i);else{i.addClass("lfs_token");i.insertBefore(t.$input)}if(!t.single){t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}t.$container.addClass("value");t.onItemAdded(n);d(t)||t.onMaxItemsSelected();t.single||t.$filter_input.focus()};var N=function e(t){return j(t,"nextAll")};var U=function e(t){if(t.disabled)return;var n=t._$active;if(!n.length)return;if(!R(n))return;if(!d(t))return;n.addClass("selected");n.removeClass("active");t._$active=null;var r=g(t,n);L(t,r)};var q=function e(t){return j(t,"prevAll")};var G=function e(t){t.$input_container.addClass("empty");te(t)};var W=function e(t,n){if(t.disabled)return;TS.utility.rAF(function(){t.$filter_input.focus()});if(t._list_visible)return;if(t._showing_status&&t.always_visible)return;t._list_built||z(t);if(t._list_built||t._showing_status){t._list_visible=true;t.$list_container.addClass("visible");t.$container.addClass("list_visible");ne(t)||t.$input_container.addClass("active");t._list_built&&t.$list.longListView("setHidden",false)}if(t.single&&!n){t.$filter_input.val("");t._previous_val="";t.$filter_input.focus();re(t)&&(t.data=[]);C(t)}if(t.set_height){l(t);t.monkey_scroll&&!TS.environment.supports_custom_scrollbar&&t.$list.monkeyScroll()}t.onListShown()};var z=function e(t){if(!t.data||0===t.data.length)return;var n=M(t.data);t._list_built=true;var i={items:n,approx_item_height:t.approx_item_height,approx_divider_height:t.approx_divider_height,preserve_dom_order:true,calcDividerHeight:function e(t){return t.outerHeight()},makeDivider:function e(){return $('<div class="lfs_group"></div>')},makeElement:function e(){return $(TS.templates.lazy_filter_select_item().replace(/(\r\n|\n|\r)/gm,""))},renderDivider:function e(n,r,i){if(t.renderDividerFunc)return t.renderDividerFunc(n,r,i);n.html(Z(r.label,t))},renderItem:function e(n,r,i){if(t.render_item_func)return t.render_item_func(n,r,i);var a=$(r);var s="active selected disabled single group_item lfs_token";var o={disabled:r.disabled||r.lfs_disabled,selected:b(t,r),single:t.single,group_item:a.hasClass("group_item")};_.isFunction(t.listItemClass)&&(o[t.listItemClass(r)]=true);var l=TS.utility.getAppliedClasses(o);var u={"data-qa":t.data_qa+"-item-"+r.lfs_id,"data-lfs-id":r.lfs_id,title:r.title};n.attr(u).removeClass(s).addClass(l).html(t.template(r).string);if(a.data("lfs-item-icon")){var d="url("+a.data("lfs-item-icon")+")";var c=$('<span class="lfs_item_icon">').css("background-image",d);n.prepend(c)}if(a.data("lfs-item-desc")){var m=Z(a.data("lfs-item-desc"),t);var f=$('<span class="lfs_item_desc">').html(m);n.append(f)}}};t.$list.longListView(i);r(t);t.$list_items=t.$container.find(".list_items");TS.utility.rAF(function(){t.monkey_scroll&&!TS.environment.supports_custom_scrollbar&&t.$list.monkeyScroll();t.$list.longListView("resizeImmediately");TS.utility.rAF(function(){t.current_items_in_view_signal.dispatch(t.$list.longListView("getCurrentItemsInView")||[])})});t.$list.longListView("getCurrentItemsInViewSignal")&&t.$list.longListView("getCurrentItemsInViewSignal").add(function(e){t.current_items_in_view_signal.dispatch(e)})};var K=function e(t){t.stopPropagation();t.preventDefault()};var V=function e(t,n){if(t.single||!t.allow_item_unselect)return;var r=g(t,n,true);n.removeClass("selected");t._selected=t._selected.filter(function(e){return e!==r});t.$input_container.find('.lfs_item[data-lfs-id="'+r.lfs_id+'"]').remove();X(t);t.$filter_input.val().length+t._selected.length===0&&G(t);0===t._selected.length&&t.$container.removeClass("value");t.onItemRemoved(r)};var Y=function e(t,r){if(!v(t)||!y(r))return;var i=r.text().trim();r.length&&F(t,r);t.$filter_input.val(i);n(t);t.$filter_input.select()};var J=function e(t,n){t.data=n||k(t.$select);if(t.data){t._selected=[];I(t);if(t.$filter_input.val().length){var r=t.$filter_input.val();t._previous_val="";D(t,r)}}};var Q=function e(t){t.restrict_input_container_height&&TS.ui.utility.updateClosestMonkeyScroller(t.$input_container,true);if(t.monkey_scroll&&!TS.environment.supports_custom_scrollbar){l(t);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(t.$list,true)})}};var X=function e(t){if(t.append)return;var n=t._selected.filter(function(e){return e instanceof HTMLOptionElement}).map(function(e){return $(e).val()});t.$select.val(n).trigger("change")};var Z=function e(t,n){t=_.escape(t);_.get(n,"should_graphic_replace_emoji")&&(t=TS.emoji.graphicReplace(t));return t};var ee=function e(t){t.$input.attr("placeholder","");ne(t)&&t.$filter_input.attr("placeholder","")};var te=function e(t){t.$input.attr("placeholder",t.placeholder_text);ne(t)&&t.$filter_input.attr("placeholder",t.filter_placeholder_text)};var ne=function e(t){return t.style===TS.ui.lazy_filter_select.STYLES.filter_in_list};var re=function e(t){return _.isFunction(t.data_promise)&&t.min_query_length};var ie=function e(t,n,r){oe(t,t.errorTemplate(n),{internal_error_message:r,clear_active_items:true})};var ae=function e(t){var n=t.noResultsTemplate(t.$filter_input.val());oe(t,n,{clear_active_items:true})};var se=function e(t){var n=TS.interop.i18n.t("Loading results\u2026","lazy_filter_select")();oe(t,n,{show_loading_indicator:true})};var oe=function e(t,n,r){r=r||{};t._showing_status=true;r.internal_error_message&&TS.error(r.internal_error_message);ne(t)||t.$input_container.addClass("active");r.show_loading_indicator&&t.$status_loading_indicator.removeClass("hidden");r.clear_active_items&&(t._$active=null);t.$status_content.html(n);t.$list_container.addClass(o)};var le=function e(t,n){n=n||{};t._showing_status=false;n.keep_input_active||t.$input_container.removeClass("active");t.$status_loading_indicator.addClass("hidden");t.$list_container.removeClass(o)};var ue=function e(t){t._prevent_blur=false};var de=function e(t){if(t.disabled)return;W(t)};var ce=function e(t,n){if(t.disabled)return;n.preventDefault();W(t)};var _e=function e(t){t.$input_container.click();t.$input.focus()};var me=function e(t){if(!t._input_is_focused){t._input_is_focused=true;t.$input_container.click();t.onInputFocus()}t.single||t.$input_container.addClass("active")};var fe=function e(n){var r=n.$filter_input.val();if(v(n)&&r.match(n.sluggify.delimiter)){var i=r.split(n.sluggify.delimiter);i.forEach(function(e){e.length&&t(n,e)})}else D(n,r,true)};var pe=function e(t,n){if(t.disabled)return;switch(n.keyCode){case TS.utility.keymap.down:K(n);N(t);break;case TS.utility.keymap.up:K(n);q(t);break;case TS.utility.keymap.enter:ge(t,n);break;case TS.utility.keymap.del:Se(t,n);break;case TS.utility.keymap.tab:Te(t,n);break;case TS.utility.keymap.esc:ve(t,n);break;default:break}t.onKeyDown(n,n.isDefaultPrevented())};var he=function e(t){if(!t._prevent_blur){T(t);le(t)}t._input_is_focused=false;t.onInputBlur()};var ge=function e(t,n){if(t._$active&&t._$active.length&&t._list_visible){K(n);var r=t._$active;var i=!t.single&&t.allow_item_unselect&&b(t,g(t,r));if(i)V(t,r);else{if(!d(t))return;U(t);var a=$(n.currentTarget);if(""!==a.val()){a.val("");t._previous_val="";C(t)}if(t.single){T(t);le(t)}}}};var Se=function e(t,n){if(""===t.$filter_input.val()){K(n);var r=t.$input_container.find(".lfs_token").last();v(t)&&y(r)?Y(t,r):E(t)}};var Te=function e(n,r){if(n.$filter_input.val().trim()&&v(n)){K(r);t(n,n.$filter_input.val())}else if(n.tab_to_nav){K(r);r.shiftKey?q(n):N(n)}};var ve=function e(t,n){K(n);T(t);le(t);t.$filter_input.blur()};var be=function e(t,n){if(t.disabled)return;n.stopPropagation();W(t);t._prevent_blur=false};var ye=function e(t,n){1===n.which&&(t._prevent_blur=true)};var we=function e(t,n){if(t.disabled)return;P(t,$(n.currentTarget));t._prevent_blur=false};var ke=function e(t,n){1===n.which&&(t._prevent_blur=true)};var xe=function e(t,n){1===n.which&&(t._prevent_blur=true)};var Ce=function e(t){t._prevent_blur&&t.$filter_input.focus()};var Me=function e(t,n){if(t.disabled)return;if(n.clientX==t._mouse.lastX&&n.clientY==t._mouse.lastY)return;var r=$(n.currentTarget);t._$active&&t._$active.removeClass("active");if(!r.hasClass("active")&&R(r)){r.addClass("active");t._$active=r}t._mouse.lastX=n.clientX;t._mouse.lastY=n.clientY};var Ie=function e(t,n){$(n.currentTarget).removeClass("active");t._$active=null};var Ae=function e(t,n){if(t.disabled)return;n.preventDefault();var r=$(n.currentTarget);t._$active=r;var i=!t.single&&t.allow_item_unselect&&b(t,g(t,r));if(i)V(t,r);else{var a=R(r);if(!a&&!t.single)return;if(!d(t))return;if(!a&&t.single){T(t);n.stopPropagation();return}U(t);if(""!==t.$filter_input.val()){t.$filter_input.val("");t._previous_val="";C(t)}if(t.single){T(t);n.stopPropagation()}}t._prevent_blur=false}})()},11267:function(e,t){(function(){TS.registerModule("ui.people_picker",{STYLES:{normal:"normal",small:"small"},onStart:function e(){},preload:function e(n){t(n)("");return n},make:function e(n,r){r=r||{};r.append||n.addClass("hidden");r.style=_.get(TS.ui.people_picker.STYLES,r.style,TS.ui.people_picker.STYLES.normal);n.lazyFilterSelect({append:!!r.append,always_visible:!!r.always_visible,approx_item_height:r.approx_item_height||50,data_promise:t(r),placeholder_text:r.placeholder_text||TS.interop.i18n.t("Search by name","people_picker")(),classes:"people_picker",scroll_threshold:2500,single:!!r.single,style:r.style,sluggify:r.sluggify,disabled:r.disabled,template:r.template||function(e){var t=TS.templates.member_small({member:e.member});return new Handlebars.SafeString(t)},tokenTemplate:r.tokenTemplate||function(e){var t=TS.templates.member_token({member:e.member});return new Handlebars.SafeString(t)},tokenClass:function e(t){return TS.templates.builders.getMemberTypeClass(t.member)},noResultsTemplate:r.noResultsTemplate||function(e){if(!e)return TS.interop.i18n.t("No one found","people_picker")();return TS.interop.i18n.t("No one found matching <strong>{query}</strong>","people_picker")({query:TS.interop.i18n.safeString(_.escape(e))})},onItemAdded:r.onItemAdded,onItemRemoved:r.onItemRemoved})},value:function e(t){return t.lazyFilterSelect("value")},clearValue:function e(t){return t.lazyFilterSelect("clearValue")},recomputeHeight:function e(t){return t.lazyFilterSelect("recomputeHeight")}});var e=["include_slackbot","include_self","include_bots","only_local_team","only_admins"];var t=function e(t){var r={};var i={};t.preselected_ids&&t.preselected_ids.length&&_.forEach(t.preselected_ids,function(e){e&&(i[e]=true)});var a={};t.omitted_ids&&t.omitted_ids.length&&_.forEach(t.omitted_ids,function(e){e&&(a[e]=true)});var s=function e(s,o){"@"===s.charAt(0)&&(s=s.substring(1));if(""===s&&t.empty_query_result){if(o>0)return Promise.resolve([]);return Promise.resolve(t.empty_query_result.map(function(e){return{member:e,lfs_id:String(e.id),preselected:!!i[e.id]}}))}if(""===s&&t.initial_load_promise){if(_.isUndefined(o))return t.initial_load_promise;t.initial_load_promise=n(t.initial_load_promise,i,a);return t.initial_load_promise}if(r.query!==s){r.query=s;r.include_org=TS.boot_data.page_needs_enterprise;r.include_slackbot=!!t.include_slackbot;r.include_self=t.include_self;r.full_profile_filter=false;r.include_bots=!!t.include_bots;r.only_local_team=!!t.only_local_team;r.only_admins=!!t.only_admins}var l=TS.interop.members.ensureMembersArePresent(_.keys(i)).then(function(){return n(r,i,a)});""!==s||t.initial_load_promise||(t.initial_load_promise=l);return l};return s};var n=function t(n,r,i){return Promise.resolve().then(function(){var e=[];var t=_.keys(r);t.forEach(function(t){var n=TS.interop.members.getMemberById(t);n||e.push(t)});if(e.length)return TS.interop.members.ensureMembersArePresent(e).catch(_.noop);return Promise.resolve()}).then(function(){return TS.members.promiseToSearchMembers(n).then(function(t){var a=[];if(""===t.query){var s=_.pick(n,e);a=TS.members.getMembersWithOptions(s)}else a=t.items;t.items=a.filter(function(e){return!i[e.id]}).map(function(e){if(e.member&&"undefined"!==typeof e.preselected)return e;return{member:e,lfs_id:String(e.id),preselected:!!r[e.id]}});return t})})}})()},11268:function(e,t){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};(function(){TS.registerModule("dnd",{dnd_statuses_changed_sig:new signals.Signal,current_user_dnd_status_changed_sig:new signals.Signal,onStart:function e(){if(!TS.client)return;TS.redux.socket.connectedSig.add(g);TS.redux.socket.disconnectedSig.add(S);var t=_.random(a,i);var n=Math.round(t*s);TS.dnd.setApiDelays(t,n);TS.dnd.debouncedCheckForChanges=TS.utility.throttleFunc(TS.dnd.checkForChanges,500,true);f=!!TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(1);TS.presence_manager.sub_list_changed.add(T)},memberDndStatus:function e(){var t=TS.dnd.calculateMemberDndFromTimestamp(TS.model.user);var n=t&&TS.dnd.getSnoozeEnabled();var r=A(TS.model.user);var i;if(r&&n)i=F(r);else if(r){i=TS.interop.datetime.toTime(r,{do24hrTime:TS.utility.date.do24hrTime()});TS.utility.date.do24hrTime()||(i=i.split(":00").join(""))}return{in_dnd:t,snoozed:n,ends:r,readable_end_time:i}},setSnooze:function e(t){var n=function e(n,r){if(!n){TS.warn("dnd.setSnooze failed");return}TS.has_pri[B]&&$("dnd.setSnooze to "+t+" minutes. New end time is "+H(r.snooze_endtime))};return TS.api.call("dnd.setSnooze",{num_minutes:t}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},endSnooze:function e(){var t=function e(t){if(!t){TS.warn("dnd.endSnooze failed");return}TS.has_pri[B]&&$("dnd.endSnooze succeeded")};return TS.api.call("dnd.endSnooze",{}).then(function(e){var n=e.data,r=e.args,i=e.request_id;var a=true;t(a,n,r,i);return{data:n,args:r,request_id:i}}).catch(function(e){var n=e.data,r=e.args,i=e.request_id;var a=false;t(a,n,r,i);return{data:n,args:r,request_id:i}})},endDnd:function e(){var t=function e(t){if(!t){TS.warn("dnd.endDnd failed");return}TS.has_pri[B]&&$("dnd.endDnd succeeded")};return TS.api.call("dnd.endDnd",{}).then(function(e){var n=e.data,r=e.args,i=e.request_id;var a=true;t(a,n,r,i);return{data:n,args:r,request_id:i}}).catch(function(e){var n=e.data,r=e.args,i=e.request_id;var a=false;t(a,n,r,i);return{data:n,args:r,request_id:i}})},calculateMemberDndFromTimestamp:function e(t,n){var r;n||(n=P());var i=I(t);var a=A(t);if(t.is_self&&TS.dnd.getSnoozeEnabled()&&a&&a>n)return true;if(null==i||null==a)return false;r=a>n&&(i<=n||i>a);return r},isMemberInDnd:function e(t){return!!TS.redux.dnd.isMemberInDndById(t.id)},checkForChanges:function e(){if(!TS.redux.socket.isConnected())return;f&&TS.metrics.mark("dnd_check_for_changes");var t=false;var n=P();if(TS.dnd.getSnoozeEnabled()&&n>=TS.dnd.getSnoozeEndtime()){var r=false;var i=null;TS.redux.dnd.updateSnoozeScheduleForCurrentMember(r,i);t=true}if(_.size(TS.redux.dnd.getAllDndSchedules())>o){TS.has_pri[B]&&$("checkForChanges over limit, purging non-relevant dnd data");b()}var a=[];var s=[];var l=function e(r){if(!r||r.deleted)return;var i=TS.dnd.isMemberInDnd(r)||false;var o=TS.dnd.calculateMemberDndFromTimestamp(r,n);if(i!=o){p(r.id,o);r.is_self&&(t=true);s.push(r)}O(r,n)&&a.push(r)};var u=TS.redux.dnd.getAllDndSchedules();_.forOwn(u,function(e,t){var n=TS.interop.members.getMemberById(t);l(n)});t&&!_.includes(s,TS.model.user)&&s.push(TS.model.user);s.length>0&&TS.has_pri[B]&&$("Processing DND status changes for "+s.length+" members");h(s);if(t){TS.dnd.current_user_dnd_status_changed_sig.dispatch();TSSSB.call("dndStatusChanged",TS.dnd.isMemberInDnd(TS.model.user));TS.has_pri[B]&&$("Current user DND status changed")}var d=0;var c=[];a=_.filter(a,function(e){var t=TS.presence_manager.isSubscribedToMember(e.id);if(!t){c.push(e.id);d+=1}return t});TS.redux.dnd.removeDndScheduleForMember(c);d&&TS.has_pri[B]&&$("checkForChanges discarded "+d+" stale members");TS.dnd.kickOffNextEventTimer();f&&TS.metrics.measureAndClear("dnd_check_for_changes_lazy","dnd_check_for_changes");return a},debouncedCheckForChanges:function e(){},kickOffNextEventTimer:function e(){clearTimeout(d);var t=P();var n=y(t);TS.has_pri[B]&&$("next DND tick scheduled for "+H(n));var r=1e3*(n-t);c=n;d=setTimeout(function(){var e=TS.dnd.checkForChanges();if(!e)return;if(e.length>1){TS.dnd.fetchMultipleMembers(e);TS.has_pri[B]&&$("DND refreshing "+e+" members")}else if(1===e.length){TS.dnd.refreshMember(e[0]);TS.has_pri[B]&&$("DND refreshing one member")}},r)},fetchMultipleMembers:function e(t){var n=x(t);if(n)return n.finally(TS.dnd.checkForChanges)},refreshMember:function e(t){var n=M(t);if(n)return n.finally(TS.dnd.checkForChanges)},updateUserPropsAndSignal:function e(t,n){if(!TS.redux.dnd.getDndScheduleByMemberId(t)){TS.has_pri[B]&&$("Ignoring new DND props for "+t);return}w(t,n);t===TS.model.user.id?TS.dnd.checkForChanges():TS.dnd.debouncedCheckForChanges()},dndOverride:function e(t,r){var i=TS.redux.channels.getEntityById(t);if(!i)return;var a=TS.useReactMessages()?TS.redux.messages.getMessageByTimestamp(t,r):TS.utility.msgs.getMsg(r,i.msgs);if(!a)return;if(a._ignore_dnd)return;if(TS.useReactMessages()){TS.redux.messages.replaceMessage(n({},a,{_ignore_dnd:true}));a=TS.redux.messages.getMessageByTimestamp(t,r)}else a._ignore_dnd=true;i.is_im?TS.boot_data.feature_growls_m11n_prod?TS.ui.growls.imMessageReceived(i,a):TS.ui.growls.growlImMessage(i,a):TS.boot_data.feature_growls_m11n_prod?TS.ui.growls.channelOrGroupMessageReceived(i,a):TS.ui.growls.growlChannelOrGroupMessage(i,a)},getSnoozeEnabled:function e(){var t=TS.redux.dnd.getSnoozeScheduleForCurrentUser();if(!t)return false;return t.snoozeEnabled},getSnoozeEndtime:function e(){var t=TS.redux.dnd.getSnoozeScheduleForCurrentUser();if(!t)return null;return t.snoozeEndTs},getNextDndStartTs:function e(t){var n=TS.redux.dnd.getDndScheduleByMemberId(t);if(!n)return null;return n.nextDndStartTs},getNextDndEndTs:function e(t){var n=TS.redux.dnd.getDndScheduleByMemberId(t);if(!n)return null;return n.nextDndEndTs},debugInfo:function e(){var t=["DND debug info:"];t.push("next timer fires at "+H(c));t.push("_team_info_delay: "+l);t.push("_single_user_info_delay: "+u);t.push("_calcNextCheckTime: "+H(y()));var n="\n"+t.join("\n");TS.info(n)},debugMember:function e(t){var n=["DND member debugging:"];n.push("is in DND: "+!!TS.dnd.isMemberInDnd(t)+" ("+TS.dnd.calculateMemberDndFromTimestamp(t)+")");n.push("start: "+H(I(t),true));n.push("end  : "+H(A(t),true));n.push("next : "+H(E(t),true));n.push("stale? "+O(t));var r=A(t);r&&D(r)?n.push("Probably a snooze"):r&&n.push("Probably a scheduled DND");var i="\n"+n.join("\n");TS.info(i)},setApiDelays:function e(t,n){l=t;u=n},test:function e(){return{fetchUsersInfo:x,calcNextCheckTime:y,snoozeReadableCountdown:F,updateUserDndProps:w,timeWasProbablyASnooze:D,memberHasStaleTimes:O,ensureDndTimesForMemberIds:v,purgeNonRelevantData:b,requested_member_ids:m}}});var e=15;var t=300;var r=100;var i=1500;var a=10;var s=.01;var o=1500;var l=i;var u=a;var d;var c;var m={};var f=false;var p=function e(t,n){TS.redux.dnd.updateDndForMember(t,n)};var h=function e(t){t=_.filter(t,function(e){if(e.is_self)return true;return TS.presence_manager.isSubscribedToMember(e.id)});t.length&&TS.dnd.dnd_statuses_changed_sig.dispatch(t)};var g=function e(t){if(!t){b();var n=TS.presence_manager.getSubList();_.includes(n,TS.model.user.id)||n.push(TS.model.user.id);var r=true;v(n,r)}TS.dnd.checkForChanges()};var S=function e(){clearTimeout(d)};var T=function e(){v(TS.presence_manager.getSubList())};var v=function e(t,n){if(!t||!t.length)return Promise.resolve();var r=_.map(t,TS.interop.members.getMemberById);r=_.filter(r,function(e){return e&&!e.is_bot&&!e.deleted&&e._is_local});n||(r=_.filter(r,function(e){return!m[e.id]&&!TS.redux.dnd.getDndScheduleByMemberId(e.id)}));if(!r.length)return Promise.resolve();t=_.map(r,"id");var i=_.groupBy(t);_.forEach(t,function(e){m[e]=true});TS.has_pri[B]&&$("_ensureDndTimesForMemberIds requesting "+t.length);f&&TS.metrics.count("dnd_lookup_lazy",t.length);return TS.api.call("dnd.teamInfo",{users:t.join(",")}).then(function(e){var n=e.data;var r=[];if(n.users){var a=[];var s=true;_.forOwn(n.users,function(e,t){r.push(t);i[t]&&a.push(w(t,e,s))});TS.redux.dnd.updateDndScheduleForMembers(a)}if(TS.boot_data.feature_tinyspeck){var o=[];_.forEach(t,function(e){if(!TS.redux.dnd.getDndScheduleByMemberId(e)){TS.has_pri[B]&&$("dnd lookup failed for "+e);o.push(e)}});if(o.length){TS.metrics.count("dnd_lookup_failed",o.length);var l={requested:t,received:r,missing:o};TS.console.logError(l,"dnd_lookup_failed_members",null,true)}}TS.dnd.checkForChanges()}).catch(function(e){TS.boot_data.feature_tinyspeck&&TS.console.logError(e,"dnd_lookup_request_failed")}).finally(function(){_.forEach(t,function(e){delete m[e]})})};var b=function e(){var t=_.groupBy(TS.presence_manager.getSubList());var n=[];var r=TS.redux.dnd.getAllDndSchedules();_.forOwn(r,function(e,r){if(t[r])return;if(r===TS.model.user.id)return;n.push(r);p(r,false)});var i=_.map(n,TS.interop.members.getMemberById);i=_.compact(i);h(i);TS.redux.dnd.removeDndScheduleForMember(n);TS.has_pri[B]&&$("_purgeNonRelevantData dropped "+n.length)};var y=function n(r){var i;r||(r=P());var a=E(TS.model.user,r);a&&(i=a);var s=function e(t){if(t.id==TS.model.user.id)return;var n=E(t,r);if(!n)return;(!i||n<i)&&(i=n)};var o=TS.redux.dnd.getAllDndSchedules();_.forOwn(o,function(e,t){var n=TS.interop.members.getMemberById(t);n&&s(n)});var l=t+r;(!i||i>l)&&(i=l);var u=e+r;i<u&&(i=u);return i};var w=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t===TS.model.user.id&&("snooze_enabled"in n||"snooze_endtime"in n)&&TS.redux.dnd.updateSnoozeScheduleForCurrentMember(n.snooze_enabled,n.snooze_endtime);if(r){if(n.dnd_enabled)return{memberId:t,nextDndStartTs:n.next_dnd_start_ts,nextDndEndTs:n.next_dnd_end_ts};return{memberId:t,nextDndStartTs:null,nextDndEndTs:null}}n.dnd_enabled?TS.redux.dnd.updateDndScheduleForMember(t,n.next_dnd_start_ts,n.next_dnd_end_ts):TS.redux.dnd.updateDndScheduleForMember(t,null,null)};var k=false;var x=function e(t){if(k)return;k=true;f&&TS.metrics.count("dnd_lookup_lazy",t.length);var n=_.map(t,"id").join(",");var r=function e(t,n){k=false;if(!t){TS.warn("dnd.teamInfo failed for a multi-user request");return}if(n.users){var r=true;var i=_.map(n.users,function(e,t){return w(t,e,r)});TS.redux.dnd.updateDndScheduleForMembers(i)}};return TS.api.call("dnd.teamInfo",{users:n},null,true).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})};var C=[];var M=function e(t){if(-1!==C.indexOf(t.id))return;C.push(t.id);if(C.length>1)return;return new Promise(function(e,t){setTimeout(function(){var n=C;C=[];var i="dnd.info";var a={user:n[0]};if(n.length>1){i="dnd.teamInfo";a=n.length>r?{}:{users:n.join(",")}}f&&TS.metrics.count("dnd_lookup_lazy",n.length);var s=function r(i,a){if(!i){if(n.length>1)TS.warn("dnd.teamInfo failed for a multi-user request (bundled single-user fetches)");else{TS.warn("dnd.info failed for "+n[0]);t(new Error("dnd.info failed for "+n[0]))}return}if(a.users){var s=true;var o=_.map(a.users,function(e,t){return w(t,e,s)});TS.redux.dnd.updateDndScheduleForMembers(o)}else w(n[0],a);e()};TS.api.call(i,a,null,true).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;s(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;s(i,t,n,r);return{data:t,args:n,request_id:r}})},1e3*u)})};var I=function e(t){return TS.dnd.getNextDndStartTs(t.id)};var A=function e(t){if(t.is_self&&TS.dnd.getSnoozeEnabled())return TS.dnd.getSnoozeEndtime();return TS.dnd.getNextDndEndTs(t.id)};var E=function e(t,n){n||(n=P());var r=I(t);var i=A(t);if(r&&i&&r>n&&r<i)return r;if(i){if(i>n)return i;var a=i+l;if(a>=n)return a}return null};var P=function e(){return Math.floor(Date.now()/1e3)};var F=function e(t){var n=t-P();if(n<0)return TS.interop.i18n.t("0s","dnd")();var r;var i;r=n/3600;if(r>=1){r=Math.floor(r);i=(n-3600*r)/60;i=Math.round(i);if(60===i){r+=1;return TS.interop.i18n.t("{dnd_hours}h","dnd")({dnd_hours:r})}if(0===i)return TS.interop.i18n.t("{dnd_hours}h","dnd")({dnd_hours:r});return TS.interop.i18n.t("{dnd_hours}h {dnd_minutes}m","dnd")({dnd_hours:r,dnd_minutes:i})}i=n/60;if(i>=1){i=Math.round(i);if(60===i)return TS.interop.i18n.t("1h","dnd")();return TS.interop.i18n.t("{dnd_minutes}m","dnd")({dnd_minutes:i})}return TS.interop.i18n.t("{dnd_remaining}s","dnd")({dnd_remaining:n})};var O=function e(t,n){n||(n=P());var r=A(t);if(!r||r>n)return false;var i=n-r;if(D(r))return true;return i>=l};var D=function e(t){var n=new Date(1e3*t);var r=n.getSeconds();var i=n.getMinutes();var a=0===r&&(0===i||30===i);return!a};var $=function e(t){TS.log(B,t)};var H=function e(t,n){if(!t)return"<null>";var r=new Date(1e3*t);if(n)return r.toTimeString()+" ("+r.toDateString()+")";return r.toTimeString()};var B=2002})()},11269:function(e,t){(function(){TS.registerModule("ui.messages",{onStart:function t(){var n=$("body");n.on("click.msg_action","ts-message",function(t){if(TS.client&&TS.client.ui.checkForEditing(t))return;e(t)});n.delegate("ts-message.dirty_hover_container","mouseenter",function(e){TS.ui.messages.updateMessageHoverContainer($(e.currentTarget))})},maybeUpdateMessageHoverContainer:function e(t){if(!t.length)return;t.is(":visible")?TS.ui.messages.updateMessageHoverContainer(t):t.addClass("dirty_hover_container")},updateMessageHoverContainer:function e(t){t.removeClass("dirty_hover_container");var n=t.data("model-ob-id");var r=n?TS.redux.channels.getEntityById(n):TS.shared.legacyGetActiveModelOb();if(!r)return;var i=t.attr("data-ts");var a=TS.utility.msgs.getMsg(i,r.msgs);!a&&r._archive_msgs&&(a=TS.utility.msgs.getMsg(i,r._archive_msgs));!a&&TS.model.unread_view_is_showing&&(a=TS.client.unread.getMessage(r,i));a||(a=TS.ui.replies.getActiveMessage(r,i));a||(a=TS.client.threads.getMessage(r,i));if(!a){TS.error(i+" not found in "+n);return}var s=t.find("[data-js=action_hover_container]");var o=t.closest("ts-conversation").length>0;var l=t.closest("#threads_msgs").length>0;var u=t.closest("#sli_briefing").length>0;var d=o||l;var c=!a.thread_ts||a.thread_ts===a.ts;var m="tombstone"===a.subtype&&r.is_channel&&!r.is_member;var f=false;if(TS.boot_data.feature_react_messages&&!a.is_ephemeral&&"tombstone"!==a.subtype){var p="message";a.file&&(p="file_comment"===a.subtype?"file_comment":"file");var h;a.file&&(h=_.isString(a.file)?TS.files.getFileById(a.file):a.file);var g={message:a,file:h,file_comment:a.comment}[p];var S="file_comment"===p?h:r;var T=TS.templates.builders.buildStarComponents(p,g,S,true);var v=T.is_starred?"starred ts_icon_star":"ts_icon_star_o";f={text:T.is_starred?T.unstar_str:T.star_str,classes:"star_link star_"+p+" "+("file_comment"===p?"star_comment":"")+" "+v,attributes:T.html_attrs,starred:T.is_starred}}s.html(TS.templates.action_hover_items({msg:a,actions:TS.utility.msgs.getMsgActions(a,r),ts_tip_delay_class:"ts_tip_delay_60",is_in_threads_view:l,is_in_thread:d,is_root_msg:c,is_briefing_msg:u,hide_actions_menu:m,show_rxn_action:!!s.data("show_rxn_action"),show_reply_action:!!s.data("show_reply_action"),show_comment_action:!!s.data("show_comment_action"),abs_permalink:s.data("abs_permalink"),star:f}));s.toggleClass("narrow_buttons",s.children().length>3)}});var e=function e(t){if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();t.preventDefault();return}var n=$(t.target);var r=n.closest("[data-action]");if(r.length){var i=n.closest("ts-message");var a=i.data("model-ob-id");var s=a?TS.redux.channels.getEntityById(a):TS.shared.legacyGetActiveModelOb();var o=i.attr("data-ts");var l=TS.utility.msgs.getMsg(o,s.msgs);var u=r.data("action");var d=false;if(!l){l=TS.utility.msgs.getMsg(o,s._archive_msgs);l&&(d=true)}l||(l=TS.ui.replies.getActiveMessage(s,o));!l&&TS.model.threads_view_is_showing&&(l=TS.client.threads.getMessage(s,o));if(!l&&TS.model.unread_view_is_showing){l=TS.client.unread.getMessage({id:a},o);if(l){var c=TS.client.unread.getGroup(a);if(c)s=c.model_ob;else if(TS.highlights_briefing){var _=TS.highlights_briefing.getMessageFromCache(a,o);_&&(s=TS.redux.channels.getEntityById(_.channel_id))}}}if(!l){TS.error("WTF no message to click?");return}var m=TS.rxns.getRxnKeyByMsgType(l);var f;switch(u){case"actions_menu":d?TS.menu.startWithMessageActions(t,i.data("ts"),s._archive_msgs,s):TS.menu.startWithMessageActions(t,i.data("ts"),s.msgs,s);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_actions_menu_button"}}});break;case"reaction":TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics()&&TS.metrics.count("unread_view_emoji_reaction");TS.ui.react_emoji_menu.start({e:t,rxn_key:m});TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_reaction_button"}}});break;case"pin":TS.pins.startPinMessage(o,s);break;case"unpin":TS.pins.unPinMessage(o,s);break;case"edit":TS.msg_edit.startEdit(o,s);break;case"delete":TS.msg_edit.startDelete(o,s);break;case"mark_unread":TS.info("_msgActionHandler: setting unread point on "+s.id+", ts = "+o+" (mark_unread)");TS.client.msg_pane.setUnreadPoint(o);break;case"reply":if(i.length){TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics()&&TS.metrics.count("unread_view_reply");f=l.thread_ts||l.ts;TS.boot_data.feature_message_replies_inline?TS.ui.thread.startInlineThread(s,l,i):TS.ui.replies.openConversationFromMessagePane(i,s,f)}TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_reply_button"}}});break;case"open_in_channel":if(TS.web){var p=TS.utility.msgs.constructMsgPermalink(s,o);window.location=p}else if(TS.client){TS.model.threads_view_is_showing&&TS.client.ui.threads.trackThreadsViewClosed("OPEN_IN_CHANNEL");f=l.thread_ts||l.ts;TS.client.ui.tryToJump(s.id,f)}break;case"open_in_channel_from_briefing":TS.highlights_briefing&&TS.highlights_briefing.jumpToMessageInChannel(s.id,l.thread_ts||l.ts);break;case"open_conversation":break;case"copy_link":var h=TS.interop.i18n.t("Copied!","messages_action_items")();TS.tips.updateFloater({title:h,classes_to_add:["success"]});TS.clipboard.writeText(r.data("permalink"));break;case"comment":if(TS.client){t.preventDefault();var g="";var S=null;TS.client.ui.files.previewFile(l.file.id,g,false,true,S)}break;case"share_message":TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics()&&TS.metrics.count("unread_view_share_message");TS.ui.share_message_dialog.start(l.ts,s);TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_share_button"}}});break;case"add_handy_rxn":var T=r.data("name");var v=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(m),T);v&&i.addClass("just_added_handy_rxn_from_actions");TS.rxns.changeRxnsFromUserAction(m,T,v);break;case"share_file":var b=l.file;if(!b)return;TS.client?TS.view.files.shareInCurrentChannelOrIM(b.id,a):TS.ui.share_dialog.start(b.id);break;case"star":TS.stars.checkForStarClick(t);break;default:TS.error("WTF no action?");break}}}})()},11270:function(e,t){(function(){TS.registerModule("click",{onStart:function e(){n();t()},addHandler:function t(n,r,i){if(_.isFunction(n)){i=r;r=n;n=null}e.push({selector:n,fn:r,prevent_on_drag:i||false})},addClientHandler:function e(){if(!TS.client)return;return TS.click.addHandler.apply(this,arguments)},addWebHandler:function e(){if(!TS.web)return;return TS.click.addHandler.apply(this,arguments)},test:function r(){return{addAll:t,setupBinding:n,handlers:function t(){return e},resetHandlers:function t(){e=[]},unbind:function e(){$("body").off("click.ts_dot_click");$("body").off("mousedown.ts_dot_click_mousedown")}}}});var e=[];var t=function e(){TS.click.addClientHandler("#archive_msg_lim_btn, #msg_lim_header_btn",function(e,t){TS.interop.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"click",ui_element:t.data("data-clog-ui-element")}}})});TS.useReactMessages()||TS.click.addClientHandler(function(e){TS.client.ui.checkForEditing(e)&&e.preventDefault()});TS.click.addWebHandler("#msgs_div",function(e){TS.utility.isSpaceClickEventSafe(e)||e.preventDefault()});var t=["[data-ts]","[data-member-id]","[data-channel-id]","[data-user-group-id]","[data-file-id]"].join(", ");TS.click.addClientHandler(t,function(e){if(!e.altKey||!e.shiftKey)return;var n=$(e.target).closest(t);if(!n.length)return;var r=n.attr("data-ts");if(r){var i=n.attr("data-model-ob-id");var a=TS.utility.msgs.findMsg(r,i);if(a){e.preventDefault();TS.dir(0,a);return}}var s=n.attr("data-member-id");if(s){var o=TS.interop.members.getMemberById(s);if(o){e.preventDefault();TS.dir(0,o);return}}var l=n.attr("data-channel-id");if(l){var u=TS.interop.channels.getChannelById(l);if(u){e.preventDefault();TS.dir(0,u);return}}var d=n.attr("data-user-group-id");if(d){var c=TS.interop.userGroups.getUserGroupById(d);if(c){e.preventDefault();TS.dir(0,c);return}}var _=n.attr("data-file-id");if(_){var m=TS.files.getFileById(_);if(m){e.preventDefault();TS.dir(0,m)}}});TS.click.addClientHandler("#msgs_div .message[data-ts]",function(e){var t=$(e.target);var n=t.closest(".message").data("ts");n&&(n=n.toString());var r=TS.shared.legacyGetActiveModelOb();if(!n)return;if(e.altKey){e.preventDefault();TS.info("setting unread point on "+r.id+" due to alt+click on message with ts = "+n);TS.client.msg_pane.setUnreadPoint(n);return}if(TS.utility.cmdKey(e)&&e.shiftKey){e.preventDefault();var i=TS.utility.msgs.getMsg(n,r.msgs);TS.dir(0,i);r.is_im?TS.ui.growls.growlImMessage(r,i,false,true):TS.ui.growls.growlChannelOrGroupMessage(r,i,false,true)}});TS.click.addClientHandler("ts-message .resend_temp_msg, ts-message .remove_temp_msg",function(e,t){var n=t.closest("ts-message");var r=n.attr("data-ts");if(!r)return;var i=n.attr("data-model-ob-id");var a=TS.redux.channels.getEntityById(i);if(!a)return;e.preventDefault();var s=t.hasClass("resend_temp_msg");TS.utility.msgs.handleFailedMsgSend(r,a,s)});TS.click.addClientHandler(".top_results_search_message_result",function(e,t,n){var r=$(e.target);var i=r.closest(".search_message_result");var a=i.data("module-name")||"score_top_results";var s=i.data("module-order")||0;var o=r.closest("ts-message");var l=o.data("iid")||"";if(r.attr("href"))return;if(r.parents(".rxn").length)return;var u=r.closest(".top_results_search_message_result");var d=u.find(".search_message_result__jump");var c=d.attr("href");if(!d.length||!c)return;var _=TS.search.view.getMatchForSearchResult(t);if(!_)return;var m=_.match;e.preventDefault();var f={click_target_type:"top_results_jump_body",click_position:_.index,click_user_id:m.user,click_channel_id:m.channel.id,click_timestamp:m.ts,click_module_name:a,click_module_position:s,click_sort:TS.search.sort,click_filter_name:TS.search.filter,search_session_id:TS.search.getSearchSessionIdForResults(),client_request_id:TS.search.getQuerySessionIdForResults()};TS.search.last_request_id&&(f.request_id=TS.search.last_request_id);l&&(f.click_iid=l);TS.interop.clog.track("SEARCH_CLICK",f);TS.client.archives.maybeHandleArchiveLink(d,n)});TS.click.addClientHandler(".search_message_result a, .search_message_result button",function(e,t){var n=$(e.target);var r=TS.search.view.getMatchForSearchResult(t);if(!r)return;var i=r.match;var a;var s;var o;var l=n.closest(".search_message_result");var u=l.data("module-name")||"messages";var d=l.data("module-order")||0;var c=l.data("iid")||"";var _=n.closest("ts-message");var m=_.data("iid")||c;var f;if(n.hasClass("jump")||n.hasClass("search_message_result__jump"))a="top_results_jump";else if(n.hasClass("search_jump")||n.hasClass("new_jump_link"))a="jump";else if(n.hasClass("archive"))a="archive";else if(n.is(".channel_link, .internal_im_link, .mpim_link, .group_link"))a="channel";else if(n.hasClass("message_sender")){a="sender";f=n.closest("ts-message");s=f.data("memberId");o=""+f.data("ts")}else if(n.hasClass("timestamp")){a="timestamp";f=n.closest("ts-message");s=f.data("memberId");o=""+f.data("ts")}else if(n.hasClass("star")){a="star";f=n.closest("ts-message");s=f.data("memberId");o=""+f.data("ts")}else(n.attr("href")||n.attr("onclick"))&&(a="link");if(a){var p={click_target_type:a,click_position:r.index,click_user_id:i.user,click_channel_id:i.channel.id,click_timestamp:i.ts,click_target_user_id:s,click_target_timestamp:o,click_module_name:u,click_module_position:d,click_sort:TS.search.sort,click_filter_name:TS.search.filter,search_session_id:TS.search.getSearchSessionIdForResults(),client_request_id:TS.search.getQuerySessionIdForResults()};TS.search.last_request_id&&(p.request_id=TS.search.last_request_id);m&&(p.click_iid=m);TS.interop.clog.track("SEARCH_CLICK",p)}});TS.click.addClientHandler(".search_message_result .sli_feedback",function(e,t){e.preventDefault();var n=$(e.target);var r=TS.search.view.getMatchForSearchResult(t);if(!r)return;var i={};var a="";var s={plus:TS.interop.i18n.t('Search result is relevant<br><span class="subtle_silver">(query string will be logged!)</span>',"clicks")(),circle:TS.interop.i18n.t('Search result is somewhat relevant<br><span class="subtle_silver">(query string will be logged!)</span>',"clicks")(),minus:TS.interop.i18n.t('Search result is not relevant<br><span class="subtle_silver">(query string will be logged!)</span>',"clicks")()};if(n.is(".selected")){i.undo=true;n.is(".sli_feedback_plus")?a=s.plus:n.is(".sli_feedback_circle")?a=s.circle:n.is(".sli_feedback_minus")&&(a=s.minus)}else a=TS.interop.i18n.t('oops!<br><span class="subtle_silver">remove my feedback</span>',"clicks")();TS.tips.updateTipTitle(n,a);n.toggleClass("selected");n.siblings(".sli_feedback").each(function(){$(this).removeClass("selected");var e="";$(this).is(".sli_feedback_plus")?e=s.plus:$(this).is(".sli_feedback_circle")?e=s.circle:$(this).is(".sli_feedback_minus")&&(e=s.minus);TS.tips.updateTipTitle($(this),e)});n.is(".sli_feedback_plus")?i.value=5:n.is(".sli_feedback_circle")?i.value=1:n.is(".sli_feedback_minus")&&(i.value=-5);i.channel_id=r.match.channel.id;i.message_id=r.match.ts;i.permalink=r.match.permalink;i.query=TS.search.view.latest_msg_search_results.query;i.search_sort=TS.search.sort;i.search_exclude_bots=TS.prefs.getPref("search_exclude_bots");i.search_only_current_team=TS.prefs.getPref("search_only_current_team");i.search_exclude_channel=TS.prefs.getPref("search_exclude_channels");i.search_only_my_channels=TS.prefs.getPref("search_only_my_channels");TS.api.call("search.feedback",i)});var n=["ts-message .message_body a","ts-message .message_body .btn_attachment_link","ts-message .file_container a"].join(", ");TS.click.addClientHandler(n,function(e,t){var n;var r;var i;var a;var s;var o;var l;var u;var d;var c;var m;var f=$(e.target);n=t.closest("ts-message");r=""+n.data("ts");i=n.data("model-ob-id");var p=r&&i?TS.utility.msgs.findMsg(r,i):null;a=n.data("member-id");s=n.data("app-id");o=n.data("bot-id");l=t.data("referer-original-href")||t.attr("href")||t.data("url");u={message_timestamp:r,channel_id:i,channel_type:i?i.charAt(0):"",member_id:a,app_id:s,bot_id:o,url:l||""};if(_.has(TS,"interop.redux.features.messagePane")){var h=TS.interop.redux.features.messagePane.getChannelSessionId(TS.redux.getState());null!==h&&(u.channel_session_id=h)}var g=TS.utility.msgs.extractMsgDisplayContext(n);if(g){u.link_origin=g;var S=null;"briefing"==g&&TS.highlights_briefing?S=TS.highlights_briefing.last_request_id:"all_unreads"==g&&TS.client.unread&&(S=TS.client.unread.last_request_id);S&&(u.request_id=S)}var T=TS.utility.msgs.isRawLink(f,l);T&&(u.link_is_raw=true);var v=TS.utility.msgs.extractLinkType(t,f,l);u.link_type=v;var b=TS.utility.msgs.extractLinkAction(t,f);b&&(u.link_action=b);var y=TS.utility.msgs.extractLinkItemId(t,f,v);if(y){u.item_id=y;u.item_type=y.charAt(0);if("channel"===v){var w=TS.interop.channels.getChannelById(y);w&&null!==w.is_member&&(u.is_member=w.is_member)}}var k=p&&p.attachments;if(k){var x=t.closest(".attachment_group").length>0;if(x){u.link_is_attachment=true;var C=TS.utility.msgs.extractLinkAttachmentField(t);C&&(u.link_attachment_field=C)}}if(TS.model.unread_view_is_showing){_.merge(u,TS.client.ui.unread.getTrackingData(r));TS.client.ui.unread.incrementTrackingSeqId()}d=t.closest(".msg_inline_img_holder").length>0;c=t.attr("data-file-id");c||(c=t.closest("[data-file-id]").attr("data-file-id"));m=c?TS.files.getFileById(c):null;if("gdrive"===_.get(m,"external_type")){u.contexts||(u.contexts={});u.contexts.platform||(u.contexts.platform={});u.contexts.platform.service_type="GSUITE";u.contexts.platform.app_id=9;u.contexts.platform.has_rich_preview=TS.files.fileHasRichPreview(m)}(d||m&&TS.files.fileIsImage(m))&&TS.interop.clog.track("MSG_PHOTO_EXPAND",u);TS.interop.clog.track("MSG_LINK_CLICKED",u);var M=TS.interop.url.urlQueryStringParse(l).state;M=M?M.match(/(\{.*\})/g):null;M=M?M[0]:null;M=M?JSON.parse(M):null;if(M&&M.is_external_auth_url){var I="auto"===M.ask?"PLATFORM_APPS_TARGETED_SUGGESTIONS_SELECTED":"PLATFORM_APPS_TARGETED_SUGGESTIONS_JUST_THIS_ONCE_SELECTED";TS.interop.clog.track(I,{app_id:M.service_type_id})}});TS.click.addClientHandler("ts-message .msg_inline_video_buttons_div .msg_inline_video_play_button",function(e,t){var n=t.closest("ts-message");var r=""+n.data("ts");var i=n.data("model-ob-id");var a=n.data("member-id");var s=n.data("app-id");var o=n.data("bot-id");var l=n.find(".msg_inline_video_new_window_button");var u=l.data("referer-original-href");var d=u||l.attr("href");var c={message_timestamp:r,channel_id:i,channel_type:i?i.charAt(0):"",member_id:a,app_id:s,bot_id:o,url:d||""};TS.interop.clog.track("MSG_VIDEO_PLAY",c)});TS.click.addClientHandler(".member_preview_link, .member_preview_image",function(e,t,n){e.preventDefault();var r=t.closest("#member_preview_scroller");var i=t.data("member-id");if(i){if(e.shiftKey){e.preventDefault();var a=TS.interop.members.getMemberById(i);TS.dir(0,a)}if(r.length&&i==TS.model.previewed_member_id)TS.menu.member.startWithMember(e,i);else if(r.length)TS.menu.member.startWithMember(e,i,true);else if("mentions"===n||"search_results"===n||"conversation"===n||"threads"===n){"search_results"===n&&t.closest('[data-expert-search-module-name="experts"]').length&&TS.sli_expert_search.handleExpertsClick(e,"experts","user");TS.menu.member.startWithMember(e,i)}else{var s=t.closest("#msgs_div, #archives_msgs_div, #unread_msgs_div, #sli_briefing");var o=t.closest("#all_members_container").length>0;TS.ui.share_dialog.showing&&TS.ui.share_dialog.div.modal("hide");s.length||o?TS.menu.member.startWithMember(e,i):TS.client.ui.previewMember(i,n||"team_list")}var l=t.closest("ts-message");var u=""+l.data("ts");var d=l.data("model-ob-id");i=l.data("member-id");var c=l.data("app-id");var _=l.data("bot-id");var m={message_timestamp:u,channel_id:d,channel_type:d?d.charAt(0):"",member_id:i,app_id:c,bot_id:_};TS.interop.clog.track("USERNAME_CLICK",m)}else TS.warn("hmmm, no data-member-id?")});TS.click.addClientHandler(".app_profile a, .app_profile_slash_command",function(e,t){var n=t.closest(".app_profile");TS.interop.clog.track("USER_PROFILE_CLICK",{app_id:n.data("app_id"),bot_id:n.data("bot_id")})});TS.click.addClientHandler(".member_details a",function(e,t){t.hasClass("member_preview_menu_target")||TS.interop.clog.track("USER_PROFILE_CLICK")});TS.click.addClientHandler(".member",function(e,t){e.preventDefault();var n=t.data("member-id");n?TS.menu.member.startWithMember(e,n):TS.warn("hmmm, no data-member-id?")});TS.click.addClientHandler(".theme_installer_btn",function(e,t){e.preventDefault();var n=t.data("theme");var r=false;if(n){n=n.replace(/ /g,"");n=n.replace(/,$/g,"");var i=n.split(",");n={column_bg:i[0],menu_bg:i[1],active_item:i[2],active_item_text:i[3],hover_item:i[4],text_color:i[5],active_presence:i[6],badge:i[7]};TS.sidebar_themes.setLastThemeSelectedInUI("custom_theme");TS.prefs.setMultiPrefsByAPI({sidebar_theme:TS.prefs.last_theme_selected_in_UI,sidebar_theme_custom_values:JSON.stringify(n)});TS.prefs.setPrefLocal("sidebar_theme",TS.prefs.last_theme_selected_in_UI);TS.prefs.setSidebarThemeCustomValues(n);TS.view.prefs.sidebarThemePrefChanged(r)}});TS.click.addClientHandler(".internal_im_link",function(e,t){e.preventDefault();TS.ims.legacyStartImByMemberId(t.data("member-id"))});TS.click.addClientHandler(".group_link, .internal_group_link",function(e,t){e.preventDefault();TS.view.onGroupReferenceClick(e,t.data("group-id"))});TS.click.addClientHandler(".internal_im_call_link",function(e,t){if(!TS.utility.calls.isEnabled())return;e.preventDefault();TS.utility.calls.startCallInModelOb(TS.interop.members.getMemberById(t.data("member-id")))});TS.click.addClientHandler(".file_viewer_link",function(e,t,n){e.preventDefault();if(t.hasClass("file_viewer_channel_link"))if(TS.boot_data.feature_file_threads){var r=t.data("file-id");var i=function e(){var i=TS.files.getFileById(r);if(!i)return false;TS.interop.files.isTombstone(i)?TS.client.ui.files.previewFile(r,n):TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:r,show_control_btns:false});return true};i()||TS.files.fetchFileInfo(r,i)}else TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:t.data("file-id"),show_control_btns:!t.closest("#file_preview_container").length})});TS.click.addClientHandler(".file_viewer_external_link",function(e,t){e.preventDefault();TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:t.data("file-id"),current_external_link:t[0]})});TS.click.addHandler(".inline_attachment.clickable, .inline_attachment.clickable + .reply_broadcast_rule",function(e,t){var n=["a",".media_caret",".delete_attachment_link",".msg_inline_video_buttons_div"].join(",");if($(e.target).closest(n).length)return;var r;r=t.is(".reply_broadcast")||t.closest(".reply_broadcast_rule").length?t.closest(".message_body").find('[data-action="open_conversation"]'):t.find(".attachment_from_url_link");r[0]&&r[0].click()},true);TS.click.addClientHandler(".internal_file_list_filter",function(e,t){e.preventDefault();TS.client.ui.files.showFileList();TS.client.ui.files.toggleFileList(t.data("file-list-filter"))});TS.click.addClientHandler("[data-expert-search-module-name] .channel_link",function(e,t){var n=t.parents("[data-expert-search-module-name]").data("expert-search-module-name");TS.sli_expert_search.handleExpertsClick(e,n,"channel")});TS.click.addClientHandler(".channel_link, .internal_channel_link",function(e,t){e.preventDefault();TS.view.onChannelReferenceClick(e,t.data("channel-id"))});TS.click.addClientHandler(".channel_link_unfurl_footer",function(e,t){var n=t.data("channel-id");var r=TS.interop.channels.getChannelById(n);if(!r)return;e.preventDefault();TS.channels.legacyDisplayChannel({id:r.id})});TS.click.addClientHandler(".internal_member_link:not(.plastic_contenteditable_element)",function(e,t){e.preventDefault();t.data("member-id")&&TS.view.onMemberReferenceClick(e,t.data("member-id"))});TS.click.addClientHandler(".internal_user_group_link",function(e,t){e.preventDefault();TS.view.onUserGroupReferenceClick(e,t.data("user-group-id"))});TS.click.addClientHandler(".file_preview_link, .file_details_container .file_comment_btn, .back_from_file_comments",function(e,t,n){e.preventDefault();TS.ui.share_dialog.showing&&TS.ui.share_dialog.div.modal("hide");var r=t.closest("[data-model-ob-id]").attr("data-model-ob-id");if(TS.boot_data.feature_file_threads){var i=t.closest("[data-ts]").attr("data-ts");var a=TS.utility.msgs.findMsg(i,r);var s=TS.redux.channels.getEntityById(r);var o=true;if(a&&TS.replies.canReplyToMsg(s,a,o)){TS.ui.replies.openConversation(r,i);return}}var l=t.attr("data-file-id");l||(l=t.closest("[data-file-id]").attr("data-file-id"));var u=TS.files.getFileById(l);if(u&&u.is_deleted){TS.generic_dialog.alert("<p>"+TS.interop.i18n.t("This file has been deleted.","clicks")()+"</p>");return}if("search_results"===n&&TS.files.fileIsImage(u)&&!TS.boot_data.feature_file_threads){TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:l,show_control_btns:false});return}var d=t.hasClass("file_comment_link");var c=t.hasClass("file_force_flexpane");if(!c){var _=d?"?comments=1":"";if(TS.client.windows.openFileWindow(l,_))return}TS.client.ui.files.previewFile(l,n||"file_list",false,d,r)});TS.click.addClientHandler('#share_dialog [data-action="copy_link"]',function(e,t){var n=t.data("link");if(!n||!TS.clipboard.canWriteText())return;TS.tips.updateFloater({title:TS.interop.i18n.t("Copied!","share_dialog")(),classes_to_add:["success"]});TS.clipboard.writeText(n)});TS.click.addClientHandler(".msg_actions",function(e,t){var n=t.data("msg-ts");if(t.is(t)||t.closest(".msg_cog").length){e.preventDefault();if(TS.model.archive_view_is_showing){var r=TS.client.archives.getCurrentModelOb()||{};TS.menu.startWithMessageActions(e,n,r._archive_msgs)}else TS.menu.startWithMessageActions(e,n,TS.shared.legacyGetActiveModelOb().msgs)}});TS.click.addClientHandler(".comment_actions",function(e,t){var n=$(e.target);if(n.hasClass("comment_cog")){e.preventDefault();TS.menu.startWithCommentActions(e,t.data("file-id"),t.data("comment-id"))}});TS.click.addHandler(".file_actions",function(e,t){e.preventDefault();TS.menu.file.startWithFileActions(e,t.data("file-id"))});TS.click.addClientHandler(".file_ssb_download_link",function(e,t){var n=!(TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing);var r=TS.files.getFileById(t.data("file-id"));var i={is_successful:false};if(r){i.is_successful=true;var a=TS.interop.members.getMemberById(r.user);if(a&&a.is_bot){var s=a.profile.bot_id;var o=TS.interop.bots.getBotById(s);i.app_id=o?o.app_id:"";i.bot_id=s}}TS.interop.clog.track("FILE_DOWNLOAD",i);r&&TS.client.downloads.startDownload(r,n)&&e.preventDefault()});TS.click.addClientHandler(".msg_jump, .star_jump",function(e,t,n){e.preventDefault();var r=""+t.closest("[data-ts]").data("ts");if(!r){TS.error("error no msg_id to jump to?");return}var i=t.data("cid");var a=TS.redux.channels.getEntityById(i);var s=t.closest("[data-thread-ts]").attr("data-thread-ts");if(s&&s!=r){TS.ui.replies.openConversation(a,s,r,n);return}TS.client.ui.tryToJump(i,r)});TS.click.addClientHandler(".search_message_result .search_jump",function(e,t,n){var r=TS.search.view.getMatchForSearchResult(t);if(!r)return;var i=r.match;e.preventDefault();var a=TS.search.view.firstResultWithExtracts(i);var s=i.channel&&i.channel.id?i.channel.id:i.channel;var o=TS.redux.channels.getEntityById(s);var l=a.thread_ts;if(l&&l!=a.ts){TS.ui.replies.openConversation(o,l,a.ts,n);return}TS.client.ui.tryToJump(s,a.ts)});TS.click.addWebHandler("#msgs_div.selecting_messages ts-message",function(e){var t=$(e.target);if(t.attr("href")||t.hasClass("star"))return;var n=t.closest("ts-message");var r=n.find(".msg_select_cb");t.is("input")||r.prop("checked",!r.prop("checked"));TS.msg_edit.batchDeleteSelectionChanged(r,e.shiftKey)});TS.click.addHandler(TS.rxns.checkForRxnClick);TS.click.addHandler(TS.stars.checkForStarClick);TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_imgs.checkForInlineImgClick(e,t&&t.match);t&&TS.client&&TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_videos.checkForInlineVideoClick(e,t&&t.match);t&&TS.client&&TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_audios.checkForInlineAudioClick(e,t&&t.match);t&&TS.client&&TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_others.checkForInlineOtherClick(e,t&&t.match);t&&TS.client&&TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_attachments.checkForInlineAttachmentClick(e,t&&t.match);t&&TS.client&&TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(TS.inline_file_previews.checkForInlineFilePreviewClick);TS.click.addHandler(TS.inline_room_previews.checkForInlineRoomPreviewClick);TS.click.addClientHandler(".file_list_item",function(e,t,n){var r;var i=$(e.target);var a=t.data("file-id");var s=t.parent().children().index(t);var o={click_target_type:"file",click_position:s,click_file_id:a,click_module_name:"all"==TS.search.filter?"top_files":"files",click_module_position:0,click_sort:TS.search.getSort("search.files"),request_id:TS.search.last_files_request_id,click_filter_name:TS.search.filter,search_session_id:TS.search.getSearchSessionIdForResults(),client_request_id:TS.search.getQuerySessionIdForResults()};TS.interop.clog.track("SEARCH_CLICK",o);r=!TS.menu.file.file_list_menu_up&&!i.is(".star")&&!i.closest("a").length&&!i.closest("button").length;if(r){e.preventDefault();if(!TS.boot_data.feature_file_threads&&TS.files.fileIsImage(a)){TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:a,show_control_btns:false});return}TS.ui.share_dialog.showing&&TS.ui.share_dialog.div.modal("hide");TS.client.ui.files.previewFile(t.data("file-id"),n||"file_list",false)}});TS.click.addClientHandler("a.file_share, button.file_share",function(e,t){e.preventDefault();TS.view.files.shareInCurrentChannelOrIM(t.data("file-id"))});TS.click.addClientHandler(".snippet_edit_dialog_link",function(e,t){var n=TS.files.getFileById(t.data("file-id"));if(!n.is_truncated){e.preventDefault();TS.ui.snippet_dialog.startEdit(n.id)}});TS.click.addClientHandler(".file_new_window_link",function(e,t){TS.client.windows.openFileWindow(t.data("file-id"),"")?e.preventDefault():TS.utility.welcome_post.clogWelcomePostOpen(t)});TS.click.addClientHandler("a.show_parent_replies, a.show_replies, .reply_bar",function(e,t,n){e.preventDefault();var r=t.closest("ts-message");var i=r.attr("data-thread-ts");if(!i)return;var a=r.attr("data-model-ob-id");var s=TS.redux.channels.getEntityById(a);if(!s)return;TS.ui.replies.openConversationFromMessagePane(r,s,i,null,n)});TS.click.addWebHandler(".reply_bar",function(e,t){var n=$(e.target);if(!n.is("a")){var r=t.closest("ts-message");var i=r.attr("data-thread-ts");if(!i)return;var a=r.attr("data-model-ob-id");var s=TS.redux.channels.getEntityById(a);if(!s)return;var o=TS.utility.msgs.constructConversationPermalink(s,i);window.open(o)}});TS.click.addClientHandler('[data-action="open_conversation"]',function(e,t,n){e.preventDefault();var r=t.attr("data-model-ob-id");var i=TS.redux.channels.getEntityById(r);if(!i)return;var a=t.attr("data-thread-ts");if(!a)return;var s=t.attr("data-ts");TS.ui.replies.openConversation(i,a,s,n)});TS.click.addClientHandler("#mentions_clear_notifications",function(e){e.preventDefault();TS.replies.markAllThreads()});TS.click.addClientHandler("#reply_container .reply_send, #file_reply_container .reply_send",function(e,t){e.preventDefault();TS.ui.replies.submitReply(e,t)});TS.click.addClientHandler("#threads_msgs .reply_send",function(e,t){e.preventDefault();TS.ui.thread.submitReply(e,t)});TS.click.addClientHandler("#reply_container .join_channel_from_thread",function(e,t){e.preventDefault();TS.ui.replies.joinChannelFromThread(e,t)});TS.click.addClientHandler("#threads_msgs .join_channel_from_thread",function(e,t){e.preventDefault();TS.ui.thread.joinChannelFromThread(e,t)});TS.click.addClientHandler(".thread_error_state_refresh_button",function(e){e.preventDefault();TS.client.threads.maybeReloadThreadsView()});TS.click.addClientHandler(".thread_flexpane_retry_button",function(e){e.preventDefault();TS.ui.replies.reloadConversation()});TS.click.addClientHandler("#thread_notification_banner .banner_buttons .btn",function(e,t){e.preventDefault();var n=t.data("turn-on-pref");var r=$("#thread_notification_banner");var i=r.height();r.height(i);r.addClass("show_confirmation");r.height(92);TS.prefs.setPrefByAPI({name:"seen_threads_notification_banner",value:true});var a=TS.prefs.getPref("threads_everything")!==n;if(a){TS.prefs.setPrefByAPI({name:"threads_everything",value:n});TS.interop.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{threads_everything:n.toString()}})}});TS.click.addClientHandler("#thread_notification_banner .close",function(e){e.preventDefault();var t=$("#thread_notification_banner");var n=t.height();t.height(n);t.height(0);TS.prefs.getPref("seen_threads_notification_banner")||TS.prefs.setPrefByAPI({name:"seen_threads_notification_banner",value:true})});TS.click.addClientHandler("#thread_notification_banner_pref_link",function(e){e.preventDefault();TS.ui.prefs_dialog.start("notifications","#prefs_threads_everything","prefs_notifications")});TS.click.addClientHandler("a.see_all_pins",function(e){if(TS.client&&TS.client.channel_page){e.preventDefault();TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showPinsSection();$("#channel_page_scroller .channel_page_pinned_items").highlight(null,"channel_page_pinned_items_highlighter")}});TS.click.addClientHandler("ts-thread .new_reply_indicator",function(e,t){var n=t.closest("ts-thread");if(!n.length)return;e.preventDefault();var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");TS.client.threads.showNewRepliesAndMarkThread(r,i)});TS.click.addClientHandler("ts-thread .view_all_replies_container",function(e,t){var n=t.closest("ts-thread");if(!n.length)return;e.preventDefault();if(t.hasClass("active"))return;t.addClass("active");var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");TS.client.threads.showPreviousReplies(r,i).finally(function(){t.removeClass("active")})});TS.click.addClientHandler("#msgs_div ts-thread .expand_inline_thread",function(e,t){e.preventDefault();var n=t.closest("ts-thread");if(!n.length)return;TS.ui.thread.expandInlineThread(n)});TS.click.addClientHandler("#msgs_div ts-thread .collapse_inline_thread",function(e,t){e.preventDefault();var n=t.closest("ts-thread");if(!n.length)return;TS.ui.thread.collapseInlineThread(n)});TS.click.addClientHandler(".thread_comments_toggle_container",function(e,t){e.preventDefault();t.closest(".thread_comments_holder").toggleClass("expanded")});TS.click.addClientHandler("a[href]",function(e,t,n){var r;var i;var a=t.attr("href");TS.utility.isSlackUrl(a)&&(a=a.toLowerCase());var s=a.indexOf("?")>-1;if(s){r=a.indexOf("?");i=a.slice(0,r)}var o={"/account/settings":true,"/admin":true,"/admin/billing":true,"/admin/settings":true,"/apps":true,"/apps/manage":true,"/apps/new":true,"/customize":true,"/files":true,"/pricing":true,"/stats":true,"/help":true};if(o[a]||o[i]){e.preventDefault();TS.utility.openAuthenticatedInBrowser(a);return}if(TS.client.archives.maybeHandleArchiveLink(t,n)){TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing&&TS.ui.fs_modal.close();e.preventDefault();return}if(TS.utility.calls.maybeHandleCallLink(t)){e.preventDefault();return}if(TS.utility.calls.maybeEnterMasToDdlFlow(a)){e.preventDefault();return}if(!t.attr("target")&&0!==a.indexOf("skype:")){e.preventDefault();TS.utility.openInNewTab(a,TS.templates.builders.newWindowName());return}var l=TS.utility.getFileIDFromURL(a);if(l&&TS.client.windows.openFileWindow(l,"")){e.preventDefault();return}TS.ui.replies.maybeOpenConversationLink(t,n)&&e.preventDefault()});TS.click.addClientHandler(".search_message_result",function(e,t){var n=$(this);var r=$(e.target);if(r.attr("href")||r.attr("onclick"))return;if(r.parents().attr("href"))return;if(r.parents(".message").length&&window.getSelection&&window.getSelection().toString())return;if(t.hasClass("top_results_search_message_result"))return;var i=TS.search.view.getMatchForSearchResult(t);if(!i)return;if(n.hasClass("no_extracts"))return;e.preventDefault();TS.search.view.toggleExtractsForMatch(e,i)});TS.click.addClientHandler(".attachment_show_more",function(e,t){var n=TS.shared.legacyGetActiveModelOb();var r=t.data("msg-ts").toString();var i=TS.utility.msgs.findMsg(r,n.id);var a=i._shown_attachments;Number.isInteger(a)&&a+20<=i.attachments.length?i._shown_attachments+=20:i._shown_attachments=i.attachments.length;r==TS.interop.rules.channels.getLatestMsgTs(n)&&TS.shared.legacyMarkReadMsg(n.id,r,TS.model.marked_reasons.viewed);TS.client.msg_pane.rebuildMsgsWithReason("show more attachments")});TS.click.addClientHandler(".attachment_actions_interactions .btn",function(e){e.preventDefault();var t=TS.attachment_actions.handleActionEventAndGetContext($(e.target));if(t){var n=TS.attachment_actions.client_buttons.fetchClientButtonData(t.message);if(n){TS.attachment_actions.client_buttons.handleClick(n,t);return}t.action.confirm?TS.attachment_actions.confirmAction(t.action,function(){TS.attachment_actions.action_triggered_sig.dispatch(t)}):TS.attachment_actions.action_triggered_sig.dispatch(t);var r=["Create a channel","Edit messages","Upload files"];var i=_.startsWith(t.action.name,"slackbot_help");(_.includes(r,t.action.name)||i)&&TS.interop.clog.track("GROWTH_HELP_SLACKBOT_V2",{action:"click",click_target:t.action.name,button_position:t.action.id,button_text:t.action.text,locale:TS.interop.i18n.locale})}});TS.click.addClientHandler("#threads_view_banner .clear_unread_messages",function(e){e.preventDefault();TS.client.threads.markAllNewThreads()});TS.click.addClientHandler("#threads_view_banner",function(e){e.preventDefault();if(TS.client.ui.threads.isAlternativeThreadsViewShowing()){TS.client.threads.maybeReloadThreadsView();return}TS.client.ui.threads.jumpToTop()});TS.click.addClientHandler(".app_preview_link",function(e,t){e.preventDefault();var n=t.closest("[data-bot-id]");var r=n.data("bot-id");var i=n.data("team-id");var a=""+n.data("ts");var s=n.data("model-ob-id");var o=n.data("member-id");var l=n.data("app-id");if(r&&!i)if(o)i=_.get(TS.interop.members.getMemberById(o),"team_id",null);else{var u=TS.shared.legacyGetActiveModelOb();var d=TS.utility.msgs.getMsg(a,u.msgs);i=_.get(d,"bot_profile.team_id",null)}var c={message_timestamp:a,channel_id:s,channel_type:s?s.charAt(0):"",member_id:o,app_id:l,bot_id:r};TS.interop.clog.track("USERNAME_CLICK",c);if(r)if(t.closest(".dm_badge").length>0&&t.hasClass("member_image")){var m=o||_.get(TS.apps.getAppById(l),"bot_user.id");TS.ims.legacyStartImByMemberId(m).then(function(){TS.client.ui.app_space.toggleView("about")})}else TS.menu.app.startWithApp(e,r,i,true);else TS.warn("hmm, no data-bot-id?")});TS.click.addClientHandler(".attachment_attribution a",function(e,t){var n=t.data("attribution-bot-id");var r=t.data("attribution-team-id");if(n){e.preventDefault();r?TS.menu.app.startWithApp(e,n,r):TS.menu.app.startWithApp(e,n)}else TS.warn("hmm, no data-bot-id?")});TS.click.addHandler("[data-slash-command-autofill]",function(e,t){var n=TS.client.msg_input.$input;var r=TS.utility.contenteditable.value(n);var i=t.data("slash-command-autofill");var a;var s;var o;if(t.data("app_space_profile_slash_command")){a="APP_SPACE_ABOUT_SLASH_COMMAND_CLICK";s=_.get(TS.client.ui.app_space,"active_app.id");o=TS.client.ui.app_space.app_bot_id}else{a="APP_PROFILE_SLASH_COMMAND_CLICK";s=_.get(TS.client.ui.app_profile,"active_app.id");o=null}TS.interop.clog.track(a,{app_id:s,bot_id:o,contexts:{core:{app_id:s,bot_id:TS.client.ui.app_space.app_bot_id}}});TS.interop.apps.isAppSpaceEnabled()&&"messages"!==TS.client.ui.app_space.active_view&&TS.client.ui.app_space.toggleView("messages");if(!r){TS.utility.contenteditable.clear(n);TS.utility.contenteditable.insertTextAtCursor(n,i)}TS.utility.contenteditable.value(n,i+" "+r);TS.utility.contenteditable.cursorPosition(n,i.length+1,r.length);TS.utility.contenteditable.focus(n)});if(TS.boot_data.feature_tinyspeck){TS.click.addClientHandler(".c-channel_insights__top-contributors-debug",function(){var e=TS.client.ui.channel_insights.last_details_response;var t=_.get(e,"response.data.top_contributors.debug",{});TS.client.ui.debugger_flexpane.printJSON(t)});TS.click.addClientHandler(".c-channel_insights__similar-channels-debug",function(){var e=TS.client.ui.channel_insights.last_details_response;var t=_.get(e,"response.data.similar_channels.debug",{});TS.client.ui.debugger_flexpane.printJSON(t)});TS.click.addClientHandler(".c-channel_insights__top-messages-debug",function(){var e=TS.client.ui.channel_insights.last_highlights_response;var t=_.get(e,"response.data.top_messages.debug",{});TS.client.ui.debugger_flexpane.printJSON(t)})}TS.boot_data.feature_tinyspeck&&TS.click.addClientHandler(".recap_highlight_debug",function(e){if("sli_debug_info"===TS.client.highlights.sli_recaps_debug_group){var t;if(TS.model.unread_view_is_showing){var n=$(e.target).parents("ts-message").data("model-ob-id");t=TS.redux.channels.getEntityById(n)}else t=TS.shared.legacyGetActiveModelOb();var r=$(e.target).parents("ts-message").data("ts");var i=TS.client.highlights.getHighlight(t.id,r);TS.client.ui.debugger_flexpane.printJSON(i)}});TS.click.addClientHandler("[data-highlight-feedback]",function(e){var t=$(e.target).data("highlight-feedback");var n=$(e.target).closest("ts-message");var r=n.data("model-ob-id");var i=n.data("ts");TS.client.highlights.setDefaultFeedbackForHighlight(r,i,{feedback:t},TS.model.unread_view_is_showing?"all-unreads":"in-channel");$("#ts_tip_float_floater .ts_tip_tip").text(TS.interop.i18n.t("Thank you!","highlights")())});TS.click.addClientHandler('[data-js="highlights_feedback_dropdown"]',function(e){var t=$(e.target).closest("ts-message");var n=t.data("model-ob-id");var r=t.data("ts");var i=TS.model.unread_view_is_showing?"all-unreads":"in-channel";TS.client.ui.highlights.openNegativeFeedbackMenu(e,n,r,i)});TS.click.addClientHandler('[data-js="sli_briefing_back_button"]',function(){TS.client.unread.showUnreadView();TS.highlights_briefing.clogBackButton()});TS.click.addClientHandler("[data-js=sli_expert_search_toggle]",function(e){TS.sli_expert_search&&TS.sli_expert_search.toggleExpand(e)});TS.click.addClientHandler(".channel_page_highlights ts-message",function(e){var t=$(e.target).closest("ts-message");var n=t.data("ts");var r=t.data("model-ob-id");TS.client.ui.tryToJump(r,n);var i={channel_id:r,channel_type:r[0]||"",message_timestamp:n,request_id:TS.client.ui.channel_insights.last_highlights_response.response.request_id};TS.interop.clog.track("CHANNEL_INSIGHTS_JUMP_TO_MESSAGE",i)});TS.click.addClientHandler("#search_file_list_heading",function(e){e.preventDefault();TS.menu.file.startWithFileFilter(e,true)});TS.click.addClientHandler("#search_file_list_clear_filter",function(e){e.stopPropagation();TS.search.view.clearFiletypeFilter()});TS.click.addClientHandler("[data-js=mount-connected-workspaces]",function(){TS.interop.mountConnectedWorkspaces(TS.boot_data.team_id,{referringUiElement:"WHATS_NEW_PRIV_ESC_ANNOUNCEMENT_MANAGE_SHARED_CHANNELS_LINK"})})};var n=function t(){var n={};$("body").on("mousedown.ts_dot_click_mousedown",function(e){n.x=e.clientX;n.y=e.clientY});$("body").on("click.ts_dot_click",function(t){if(t.isDefaultPrevented())return;if(TS.view&&TS.view.maybeFollowLink(t))return;if(TS.isPartiallyBooted()){t.preventDefault();return}var a=$(t.target);if(a.parents("[data-reactroot]").length)return;var s=r(t);var o;var l;for(var u=0;u<e.length;u+=1){o=e[u];l=null;if(o.prevent_on_drag&&(t.clientX!=n.x||t.clientY!=n.y))continue;if(o.selector){l=a.closest(o.selector);if(!l.length)continue;o.fn(t,l,s);t.isDefaultPrevented()&&TS.has_pri[i]&&TS.log(i,"click on "+o.selector)}else o.fn(t,s);if(t.isDefaultPrevented())return}})};var r=function e(t){var n=$(t.target);if(n.closest("#search_results_container").length)return"search_results";if(n.closest("#member_stars_list").length)return"starred_items";if(n.closest("#member_mentions").length)return"mentions";if(n.closest("#file_list").length)return"file_list";if(n.closest("#file_preview_scroller").length)return"file_preview";if(n.closest("#member_preview_scroller").length)return"member_preview";if(n.closest("#convo_scroller").length)return"conversation";if(n.closest("#groups_tab").length)return"groups";if(n.closest("#threads_msgs_scroller_div").length)return"threads";if(n.closest("#channel_page_scroller").length){var r=TS.shared.legacyGetActiveModelOb();var i="channel_page";r.is_group&&!r.is_mpim?i="group_page":(r.is_im||r.is_mpim)&&(i="im_page");return i}return null};var i=2003})()},11271:function(e,t){(function(){TS.registerModule("sorter",{onStart:function e(){},search:function e(t,n,r){return c(t,n,r)},printTest:function e(t,n){var r=TS.members.getActiveMembersWithSelfAndSlackbot();var i=_.partition(TS.interop.redux.models.channels.getUnarchivedPublicAndPrivateChannels(TS.redux.getState()),"is_group");var a=i[0];var s=i[1];var o=TS.redux.channels.dangerouslyGetMpims().filter(TS.interop.rules.channels.isVisibleMpim);var l=_.values(TS.boot_data.other_accounts);var u=TS.interop.userGroups.getActiveUserGroups();var d=TS.model.emoji_map;var c=TS.utility.members.getBroadcastKeywordsForUser();var m=TS.model.NAMED_VIEWS;var f={members:r,channels:s,groups:a,mpims:o,teams:l,usergroups:u,emoji:d,broadcast_keywords:c,views:m};TS.sorter.search(t,f,_.extend({print:true},n))},scoreEmoji:function e(t,n){return s(t,n)},test:function e(){var t={sortFuzzy:g,frecencyBonusPoints:S,getFilteredMatchesForFrecency:m,scoreMember:l,_scoreUserGroup:u,getSubQueryMatchers:o,_scoreEmoji:s};Object.defineProperty(t,"_meta_fields",{get:function e(){return n},set:function e(t){n=t}});return t}});var e=function e(t,n){n=n||{};var i=null!=n.fuzzy_limit?n.fuzzy_limit:10;t=TS.interop.i18n.deburr(t.toLocaleLowerCase());var a=t;var c="@"===t.charAt(0);var m="#"===t.charAt(0);var f=":"===t.charAt(0);var p=false;TS.interop.apps.isGlobalActionsEnabled()&&(p="/"===t.charAt(0));(c||m||f||p)&&(t=t.substring(1));var h={fuzzy_limit:i};var g={fuzzy_limit:i,search_forward_only:true};var S=TS.fuzzy.makeFuzzyMatcher(t,h);var T=TS.fuzzy.makeFuzzyMatcher(a,h);var v=TS.fuzzy.makeFuzzyMatcher(t,g);var b=o(t,g);return{query:t,full_query:a,only_channels:m,only_members:c,only_emoji:f,only_app_actions:p,matchesChannel:function e(a){if(c||f||p)return false;if((n.allow_empty_query||m)&&!t){r(a.id,"jumper_score",0);return true}var s=S.score(a.name_normalized||a.name);r(a.id,"jumper_score",s);if(n.search_previous_channel_names&&a.previous_names&&a.previous_names.length){var o=_.map(a.previous_names,function(e){return{score:S.score(e),name:e}});r(a.id,"jumper_previous_name_scores",o);var l=_.some(o,function(e){return e.score<=i});var u=l&&s>i;if(u){var d=_.minBy(o,"score");a._jumper_previous_name_match=d&&d.name}else a._jumper_previous_name_match=null;return s<=i||l}return s<=i},matchesGroup:function e(a){if(m||c||f||p)return false;if(n.allow_empty_query&&!t){r(a.id,"jumper_score",0);return true}var s=S.score(a.name_normalized||a.name);r(a.id,"jumper_score",s);return s<=i},matchesMember:function e(a){if(a.isNonExistent||a.is_non_existent)return;if(m||f||p)return false;if((n.allow_empty_query||c)&&!t){r(a.id,"jumper_score",0);return true}var s=l(a,v,t);r(a.id,"jumper_score",s);return s<=i},matchesMpim:function e(a){if(m||c||f||p)return false;if(n.allow_empty_query&&!t){r(a.id,"jumper_score",0);return true}var s=TS.mpims.legacyGetMembersInDisplayOrder(a);s=_.chain(s).reject(function(e){return!e||e.is_non_existent||e.isNonExistent||e.is_unknown||e.isUnknown}).value();var o=b.map(function(e){var t=s.map(function(t){return l(t,e)});return _.min(t)});var u=_.sum(o);r(a.id,"jumper_score",u);return u<=i},matchesTeam:function e(t){var n=t.team_name||t.name;var a=T.score(n.toLocaleLowerCase());r(t.id,"jumper_score",a);return a<=i},matchesUserGroup:function e(a){if(m||f||p)return false;if((n.allow_empty_query||c)&&!t){r(a.id,"jumper_score",0);return true}var s=u(a,S);r(a.id,"jumper_score",s);return s<=i},matchesEmoji:function e(i){if(m||c||p)return false;if(n.allow_empty_query&&!t){r(i.id,"emoji_score",0);return true}var a=TS.interop.i18n.deburr(i.display_name||i.name);var o;var l;o=s(a,t);if(i.display_name&&i.display_name!==i.name){l=s(i.name,t);if(Infinity!==l&&l<o){o=l;a=i.name}}if(Infinity!==o){r(i.id,"emoji_score",o);return true}return false},matchesBroadcastKeyword:function e(a){if(m||f||p)return false;if((n.allow_empty_query||c)&&!t){r(a.id,"jumper_score",0);return true}var s=d(a,S);r(a.id,"jumper_score",s);return s<=i},matchesView:function e(t){if(m||f||p)return false;var n=S.score(t.name.toLocaleLowerCase());Infinity===n&&t.alt_names&&(n=_.reduce(t.alt_names,function(e,t){return Math.min(e,S.score(t.toLocaleLowerCase()))},n));r(t.id,"jumper_score",n);return n<=i},matchesAppAction:function e(a){if(!TS.interop.apps.isGlobalActionsEnabled())return false;if(m||f||c)return false;if((n.allow_empty_query||p)&&!t){r(a.id,"jumper_score",0);return true}var s=S.score(a.name.toLocaleLowerCase());r(a.id,"jumper_score",s);return s<=i}}};var t=/\s+/g;var a=/[-]+/g;var s=function e(n,r){var i=2;var s=6;if(TS.boot_data.feature_emoji_substr_search_tweaks)if(r.length<3){i=0;s=0}else if(3===r.length){i=1;s=1}else 4===r.length?i=1:s=5;if("ok_hand"===n&&"ok"===r)return 0;var o=Infinity;var l=n.indexOf(r);-1===l&&(l=n.indexOf(r[0]));if(-1!==l){r=r.replace(t,"").replace(a,"_");n=n.replace(a,"_");var u=r.split("");var d=0;var c=0;var _=0;var m=true;for(var f=l;f<n.length;f++){if(n[f]===u[0]){m=true;u.shift();_>c&&(c=_);_=0;if(0===u.length)break}else{m&&(d+=1);m=false;_+=1}if(d>i)return o;if(_>s)return o}if(u.length>0)return o;o=1-r.length/n.length;d>0&&(o+=d)}return o};var o=function e(t,n){var r=t.split(/[,| ]/).filter(function(e){return!!e});return r.map(function(e){e="@"===e.charAt("0")?e.substring(1):e;return TS.fuzzy.makeFuzzyMatcher(e,n)})};var l=function e(t,n,r){var i;if(TS.utility.queryIsMaybeSelf(r)&&t.is_self)return 0;var a=Infinity;var s=Infinity;var o=Infinity;var l=Infinity;a=n.score(t._real_name_lc);t._real_name_lc!==t._real_name_normalized_lc&&(s=n.score(t._real_name_normalized_lc));if(t._display_name_lc){o=n.score(t._display_name_lc);t._display_name_lc!==t._display_name_normalized_lc&&(l=n.score(t._display_name_normalized_lc))}i=Math.min(a,s,o,l);return i};var u=function e(t,n){var r=Infinity;var i=Infinity;r=n.score(t.name);i=n.score(t.handle);var a=Math.min(r,i);return a};var d=function e(t,n){var r=Infinity;var i=Infinity;r=n.score(t.name);t.ms_name!==t.name&&(i=n.score(t.ms_name));if(!t.alias)return Math.min(r,i);var a=Infinity;a=n.score(t.alias);var s=Math.min(r,i,a);return s};var c=function t(n,a,o){var l=e(n,o||{});var u=[];var d=[];var c=[];var f=[];var p=[];var h=[];var T=[];var v=[];var b=[];var y=[];var w=[];var k=[];var x=[];var C=o.match_emoji_keywords?TS.emoji.findByKeyword(n):[];var M=[];a.members=a.members||[];a.channels=a.channels||[];a.groups=a.groups||[];a.mpims=a.mpims||[];a.teams=a.teams||[];a.usergroups=a.usergroups||[];a.emoji=a.emoji||[];a.broadcast_keywords=a.broadcast_keywords||[];a.views=a.views||[];a.enterprise_channels=a.enterprise_channels||[];a.enterprise_groups=a.enterprise_groups||[];a.app_actions=a.app_actions||[];if(!l.only_channels&&!l.only_emoji&&!l.only_app_actions){d=a.members.filter(function(e){_.isString(TS.interop.members.getMemberProfileFieldDisplayName(e))||TS.console.logError(e.id+": memberProfileFieldDisplayName is not a string.");_.isString(TS.interop.members.getMemberRealName(e))||TS.console.logError(e.id+": memberRealName is not a string");if(o.prefer_exact_match&&l.query&&(TS.interop.members.getMemberProfileFieldDisplayName(e)&&_.isString(TS.interop.members.getMemberProfileFieldDisplayName(e))&&TS.interop.members.getMemberProfileFieldDisplayName(e).toLocaleLowerCase()===l.query||TS.interop.members.getMemberRealName(e)&&_.isString(TS.interop.members.getMemberRealName(e))&&TS.interop.members.getMemberRealName(e).toLocaleLowerCase()===l.query)){r(e.id,"jumper_exact_match",true);u.push(e);return false}r(e.id,"jumper_exact_match",false);return l.matchesMember(e)});y=a.usergroups.filter(function(e){if(o.prefer_exact_match&&e.handle===l.query||e.name_lc===l.query){u.push(e);return false}return l.matchesUserGroup(e)});k=a.broadcast_keywords.filter(function(e){if(o.prefer_exact_match&&e.name===l.query){u.push(e);return false}return l.matchesBroadcastKeyword(e)})}if(!l.only_members&&!l.only_emoji&&!l.only_app_actions){var I=function e(t){if(o.prefer_exact_match&&t.name===l.query){r(t.id,"jumper_exact_match",true);u.push(t);return}r(t.id,"jumper_exact_match",false);var n=l.matchesChannel(t);if(!n)return;t.is_member?c.push(t):t.is_archived?p.push(t):f.push(t)};a.channels.forEach(I);a.enterprise_channels.forEach(I)}if(!l.only_channels&&!l.only_members&&!l.only_emoji&&!l.only_app_actions){var A=function e(t){if(o.prefer_exact_match&&t.name===l.query){r(t.id,"jumper_exact_match",true);u.push(t);return}r(t.id,"jumper_exact_match",false);var n=l.matchesGroup(t);if(!n)return;t.is_archived?T.push(t):h.push(t)};a.groups.forEach(A);a.enterprise_groups.forEach(A);v=a.mpims.filter(function(e){return l.matchesMpim(e)})}b=a.teams.filter(function(e){if(!_.isObject(e))return false;var t=e.team_name||e.name;if(o.prefer_exact_match&&t.toLocaleLowerCase()===l.full_query){r(e.id,"jumper_exact_match",true);u.push(e);return false}r(e.id,"jumper_exact_match",false);var n=l.matchesTeam(e);return n});l.only_channels||l.only_members||l.only_app_actions||(w=a.emoji.filter(function(e){if(o.prefer_exact_match&&((e.display_name||e.name)===l.query||"ok_hand"===e.name&&"ok"===l.query)){r(e.id,"jumper_exact_match",true);r(e.id,"emoji_exact_match",true);u.push(e);return false}r(e.id,"jumper_exact_match",false);if(o.match_emoji_keywords&&C.length){var t=TS.emoji.nameToBaseName(e.display_name||e.name);if(-1!==C.indexOf(t)){r(e.id,"emoji_score",s(t,n));return true}}return l.matchesEmoji(e)}));TS.client&&a.views&&(l.only_channels||l.only_members||(x=a.views.filter(function(e){if(o.prefer_exact_match&&e.name===l.query){u.push(e);return false}return l.matchesView(e)})));l.only_channels||l.only_emoji||l.only_members||(M=a.app_actions.filter(function(e){if(!_.isObject(e))return false;var t=e.name;if(o.prefer_exact_match&&t.toLocaleLowerCase()===l.full_query){r(e.id,"jumper_exact_match",true);u.push(e);return false}r(e.id,"jumper_exact_match",false);var n=l.matchesAppAction(e);return n}));var E;var P;var F;E=d.concat(c,h,v,w,y,k,x,M);o.flat||E.sort(_.partial(g,true));P=f.concat(b);o.flat||P.sort(_.partial(g,true));F=T.concat(p);o.flat||F.sort(_.partial(g,true));var O=E.concat(P,F);o.flat&&O.sort(_.partial(g,true));var D=O;if(o.prefer_exact_match&&u.length>0)for(var $=0;$<u.length;$+=1)D.unshift(u[$]);if(o.frecency){o.normalize=true;D=TS.ui.frecency.query(D,n,S,o)}o.limit&&(D=_.take(D,o.limit));o.frecency&&(D=m(D));if(o.print){var H="\n";_.forEach(D,function(e){var t=o.frecency?e.model_ob:e;o.frecency&&(H+="["+e.score+"] ");null!=i(t.id,"jumper_score")&&(H+="["+i(t.id,"jumper_score")+"] ");t.is_mpim?H+=TS.mpims.legacyGetDisplayName(t):t.is_channel?H+="#"+t.name:t.is_group?H+=t.name:t.team_name?H+=t.team_name:t.is_usergroup?H+="@"+t.name:t.presence?H+="@"+t.name:H+=e.model_ob?e.model_ob.name:e.name;H+="\n"});TS.info(H)}return D};var m=function e(t){var n=[];TS.boot_data.page_needs_enterprise&&(t=_.uniqBy(t,function(e){return e.id}));_.forEach(t,function(e){var t;if(TS.interop.utility.looksLikeMemberId(e.id)){var r=TS.interop.members.getMemberById(e.id);r&&n.push({model_ob:r,score:e.score});return}var i=0===e.id.indexOf("BK");var a=0===e.id.indexOf("V");var s=false;TS.interop.apps.isGlobalActionsEnabled()&&(s=TS.interop.utility.looksLikeGlobalActionFrecencyId(e.id));t=i?TS.model.getBroadcastKeywordById(e.id):a?TS.model.getViewById(e.id):s?p(e.id):f(e.id);t&&n.push({model_ob:t,score:e.score})});return n};var f=function e(t){if("E"===t[0])return TS.emoji.getEmojiById(t);if("S"===t[0])return TS.interop.userGroups.getUserGroupById(t);if("T"===t[0])return TS.redux.teams.getTeamById(t);return TS.boot_data.page_needs_enterprise?TS.enterprise.getModelObById(t):TS.redux.channels.getEntityById(t)};var p=function e(t){var n=TS.interop.utility.decodeGlobalActionFrecencyId(t);if(!n)return null;var r=TS.interop.redux.models.appActions.selectGlobalActionsCache(TS.redux.getState());var i=r[n];return i?TS.interop.utility.getGlobalActionForFrecency(i):null};var h=function e(t){var n;n=t.is_mpim?_.toLower(TS.mpims.legacyGetDisplayName(t)):t.is_usergroup?t.handle:t._name_lc?t._name_lc:t.team_name?t.team_name.toLocaleLowerCase():t.name;return n};var g=function e(t,n,r){if(n.is_mpim&&!r.is_mpim)return 1;if(r.is_mpim&&!n.is_mpim)return-1;if(!n.is_mpim&&!r.is_mpim){var a=i(n.id,"jumper_score")-i(r.id,"jumper_score");if(0!==a)return a}if(n.is_mpim&&r.is_mpim){var s=i(n.id,"jumper_score")-i(r.id,"jumper_score");if(0!==s)return s;var o=TS.mpims.getMemberCount(n)-TS.mpims.getMemberCount(r);if(0!==o)return o}var l=h(n);var u=h(r);if(t)return TS.interop.i18n.sorter(l,u);if(l>u)return 1;if(u>l)return-1;return 0};var S=function e(t,n){if(t.is_mpim)return 0;var r=0;if(i(t.id,"jumper_exact_match")){r+=TS.ui.frecency.bonus_points.exact_match;i(t.id,"emoji_exact_match")&&(r+=TS.ui.frecency.bonus_points.exact_match)}else i(t.id,"emoji_score")?r+=T(t,"emoji_score",TS.ui.frecency.bonus_points.emoji_match):r+=T(t,"jumper_score",TS.ui.frecency.bonus_points.fuzzy_match);i(t.id,"jumper_previous_name_scores")&&(r+=TS.ui.frecency.bonus_points.matches_previous_name);n.prefer_channel_members&&t.presence&&n.model_ob&&v(t.id,n.model_ob)&&(r+=TS.ui.frecency.bonus_points.member_of_this_channel);t.is_starred&&(r+=TS.ui.frecency.bonus_points.starred_channel);t.is_emoji&&("thumbsup"!==t.name&&"point_up"!==t.name||(r+=1));n.self_first&&t.is_self&&(r=Infinity);if(t.is_channel||t.is_group){t.is_archived&&(r+=TS.ui.frecency.bonus_points.archived_channel_or_group);t.is_channel&&n.prefer_channels_user_belongs_to&&(t.is_archived||v(TS.model.user.id,f(t.id))||(r+=TS.ui.frecency.bonus_points.not_in_channel));(t.is_channel&&TS.enterprise.getChannelById(t.id)||t.is_group&&TS.enterprise.getGroupById(t.id))&&(r+=TS.ui.frecency.bonus_points.foreign_channel_or_group)}(t.is_usergroup||t.is_broadcast_keyword)&&(r+=TS.ui.frecency.bonus_points.usergroup_or_keyword);return r};var T=function e(t,n,r){var a=i(t.id,n);if(!_.isFinite(a))return 0;var s=Math.pow(.5,a);return Math.round(r*s)};var v=function e(t,n){if(n.is_channel&&t===TS.model.user.id)return n.is_member;var r=TS.interop.membership.getCachedChannelMembershipInfoForUser(n.id,t);return r.is_known&&r.is_member}})();var n={};var r=function e(t,r,i){if(!t||!r)return;n[t]||(n[t]={});n[t][r]=i};var i=function e(t,r){if(!t||!r)return;if(!t||!n[t])return;return n[t][r]}},11272:function(e,t){(function(){TS.registerModule("ui.enterprise_shared_channels_invites",{onStart:function e(){TS.ui.validation.register("valid_invite",He)},start:function e(){TS.boot_data.page_needs_enterprise&&we()}});var e;var t;var n;var r=[];var i;var a=false;var s;var o=false;var l=[];var u=[];var d=[];var c=[];var m;var f;var p=false;var h=function e(n){if(!n)return;var r=H(n,W(n));if(!r)return;t.find('.sci_send_email_container [data-action="replace_sent_emails"]').replaceWith(TS.templates.shared_channels_invites_sent_emails(r))};var g=1e3;var S;var T;var v=1e3;var b;var y=function e(n,r){n||(n=false);r||(r=false);t.find("#sci_channels_create .input_wrapper .spinner").toggleClass("hidden",n);r&&w(!n)};var w=function e(n){if(T){clearTimeout(T);T=null}n||(n=false);var r=t.find("#sci_channels_create .input_wrapper .available");r.toggleClass("hidden",n);n||(T=setTimeout(function(){r.addClass("hidden")},v))};var k=function r(){TS.kb_nav.start(i.find(".list_items"),".channel_browser_row",i,{use_data_ordering:true,px_offset:35,scrollToStartImmediately:function e(){i.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){i.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){p&&ee($(this),e)});i.find(".list_items").on("click",".channel_browser_row",function(e){ee($(this),e)});t.on("click",'[data-action="sci_to_create"]',xe);t.on("click",'[data-action="sci_channels_create"]',A);t.on("click",'[data-action="sci_cancel"]',Ce);t.on("change",'[type="radio"][name="share_with"]',Fe);t.on("click",'[data-action="sci_show_action"]',Se);var s='#sci_channels_create input[name="channel_name"]';var o=_.debounce(function(e){if(b&&b.isPending()){if(S){clearTimeout(S);S=null}S=setTimeout(function(e){o(e)},g,e);return}$(".validation_message").remove();$('label[for="channel_name"]').removeClass("validation_warning");e.removeClass("validation_warning");var t=false;var n=true;var r=true;var i=false;var a=$('#sci_channels_create [data-action="sci_channels_create"]');y();Ie(null,a,t,n);var s=TS.ui.validation.validate(e);if(s){var l=e.val().trim();var u=function s(o,u){if(o){if(u.name_taken){r=true;i=false;y(r,i);n=true;Ie(null,a,t,n);TS.ui.validation.showWarning(e,'"'+_.escape(l)+'" is already taken by a channel, username, or user group.',{});return}b=null;r=true;i=true;y(r,i);n=false;t=true;Ie(null,a,t,n)}else{r=true;i=false;y(r,i);TS.generic_dialog.alert("Something failed! "+u.error)}return null};b=TS.api.callImmediately("enterprise.nameTaken",{name:l,ignore_local_team:false}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;u(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;u(i,t,n,r);return{data:t,args:n,request_id:r}})}else{r=true;y(r)}},g,{leading:false,trailing:true});t.on("input",s,function(e){e.preventDefault();e.stopPropagation();o($(this))});t.on("input",'#sci_channels_create [data-validation]:not([name="channel_name"])',function(){var e=t.find("#sci_channels_create");Ie(e.find(F()),e.find('[data-action="sci_channels_create"]'),true)});n.on("textchange",function(){if(!a)return;E()}).on("keydown",function(e){e.which===TS.utility.keymap.esc&&TS.ui.fs_modal.close()});var l={classes:"channel_browser_sort",onItemAdded:function e(t){if(!a)return;var n=$(t);var r=n.val();if(TS.model.ui_state){TS.model.ui_state.sort_shared_channel_browser_by=r;TS.storage.storeUIState(TS.model.ui_state)}be(r);E()},styling:"normal",template:function e(t){var n=$(t);return new Handlebars.SafeString(n.text())},tokenTemplateSingle:function e(t){var n=$(t);var r;r=TS.boot_data.feature_channel_browser_dropdown?TS.interop.i18n.t('<span class="bold">Sort:</span> {value}',"channel_browser")({value:n.text()}):TS.interop.i18n.t('<span class="greigh">Sort:</span> {value}',"channel_browser")({value:n.text()});return new Handlebars.SafeString(r)}};m.hide().lazyFilterSelect(l);f=$(".channel_browser_sort");if(TS.boot_data.feature_channel_browser_dropdown){f.find(".lfs_input").attr("size","auto");Be();m.on("change",function(){Be()})}t.on("click",".clear_filter_icon",function(){n.val("").trigger("textchange").focus()});e.on("keyup.sci",X);t.on("click",'[data-action="sci_toggle_contents"]',Ae);t.on("click",'[data-action="sci_toggle_send_email"]',Pe);t.on("click",'[data-action="sci_toggle_copy_link"]',Ee);t.on("click",'[data-action="sci_send"]',me);t.on("click",'[data-action="sci_copy"]',K);t.on("click",'[data-action="sci_revoke"]',_e);t.on("input","input[data-invite-id]",function(e){var t=$(e.target).parent();var n=true;Ie(t,t.find('[data-action="sci_send"]'),n)})};var x=function e(){t.find(".showing_sci_action").removeClass("showing_sci_action")};var C=function e(t){$(t.target).closest(".sci_invite_container").find(".sci_copy_link_mini_container").addClass("hidden")};var M=function e(t){$(t.target).closest(".sci_invite_container").find(".sci_send_email_mini_container").addClass("hidden")};var I=function e(t,n){var r=[];if(t.length>0){r.push({is_divider:true,name:TS.interop.i18n.t("Channels you can join","shared")()});r=r.concat(t)}if(n.length>0){r.push({is_divider:true,name:TS.interop.i18n.t("Channels you belong to","shared")()});r=r.concat(n)}return r};var A=function e(){var n=t.find("#sci_channels_create");var r=n.find(F());if(!TS.ui.validation.validate(r,{quiet:true,fast:true})){TS.ui.validation.validate(r);Ladda.stopAll();n.find('[data-action="sci_channels_create"]').addClass("disabled");return}var i={};var a=!n.find('[name="access"]').prop("checked");if(G())switch(n.find('[name^="share_with"]:checked').val()){case"specific":i.target_domains=n.find('[name="domains"]').val();break;case"external":i.target_domain=n.find('[name="domain"]').val();break;case"all":i.all_teams=true;break;default:break}else i.target_domain=n.find('[name="domain"]').val();var s=n.find('[name="channel_name"]').val();s&&(i.channel_name=s);var o=n.find('[name="purpose"]').val();o&&(i.purpose=o.trim());if(i.target_domain){i.is_private=a;ne(i).then(function(e){var t=e.data.invite_id;Me(e.data);return ie().then(function(e){pe(e.data.invites,a);ue(t)})}).catch(L).finally(Ladda.stopAll)}else te(i,a).then(function(e){var t;if(e.data.group){t=e.data.group.id;TS.groups.legacyDisplayGroup({id:t})}else{t=e.data.channel.id;TS.channels.legacyDisplayChannel({id:t})}TS.ui.fs_modal.close()}).catch(L).finally(Ladda.stopAll)};var E=function e(){var t=$.trim(n.val());if(""!==t&&-1!==t.indexOf("#")){t=t.replace("#","","g");t=$.trim(t)}if(t){n.closest(".channel_browser_filter_container").addClass("active");r=O(t)}else{n.closest(".channel_browser_filter_container").removeClass("active");r=O()}if(0===r.length){De(t);U("#sci_no_shared_channels")}else U("#sci_channels_container");i.longListView("scrollToTop",true);i.longListView("setItems",r);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(i);i.longListView("resizeImmediately")});t?TS.kb_nav.highlightFirstItem():TS.kb_nav.clearHighlightedItem()};var P=function e(t,n){return _.find(B(),function(e){return e.team.domain===t&&e.channel_name===n})||_.find(B(true),function(e){return e.team.domain===t&&e.channel_name===n})};var F=function e(){var n=['[name="channel_name"]','[name="purpose"]'];if(G())switch(t.find('[name^="share_with"]:checked').val()){case"specific":n.push('[name="domains"]');break;case"external":n.push('[name="domain"]');break;default:break}else n.push('[name="domain"]');return n.join(", ")};var O=function e(t){var n=D();var r=D(true);var i=!(n.length||r.length);if(i)return;var a=Y(n,r);var s=[];var o=[];var l={};var u;var d;if(t){t=TS.utility.regexpEscape(t);d=new RegExp(t,"i")}a.forEach(function(e){var n=l.hasOwnProperty(e.id);if(n)return;if(!e.hasOwnProperty("name"))return;n||(l[e.id]=true);if(t){if(e.name.toLowerCase()===t.toLowerCase()){u=e;return}if(!e.name.match(d))return}e.is_member?o.push(e):s.push(e)});u&&(u.is_member?o.unshift(u):s.unshift(u));return I(s,o)};var D=function e(t){return t?l:d};var H=function e(t,n){return _.find(B(n),function(e){return e.invite_id==t})};var B=function e(t){return t?u:c};var j=function e(){var n=TS.interop.i18n.t("Anyone in your workspace can join","shared")();if(G()){var r=TS.interop.i18n.safeString(_.escape(TS.redux.enterprise.getEnterpriseOrgName()));switch(t.find('[name^="share_with"]:checked').val()){case"specific":n=TS.interop.i18n.t("Specific workspaces at {name} can join","shared")({name:r});break;case"all":n=TS.interop.i18n.t("Anyone at {name} can join","shared")({name:r});break;default:break}}return n};var R=function e(){var n=TS.interop.i18n.t("Restricted to invited members","shared")();if(G()){var r=TS.interop.i18n.safeString(_.escape(TS.redux.enterprise.getEnterpriseOrgName()));switch(t.find('[name^="share_with"]:checked').val()){case"specific":n=TS.interop.i18n.t("Restricted to invited members on specific {name} workspaces","shared")({name:r});break;case"all":n=TS.interop.i18n.t("Restricted to invited members at {name}","shared")({name:r});break;default:break}}return n};var L=function e(t){var n;switch(t.data.error){case"invalid_target_domain":n=TS.interop.i18n.t("Darn&mdash;we couldn\u2019t find a workspace with that domain. Try again?","shared")();break;case"name_taken":n=TS.interop.i18n.t("Darn&mdash;that channel name is already taken. Try another?","shared")();break;case"invite_exists":n=TS.interop.i18n.t("An invitation already exists for that workspace and channel.","shared")();break;case"shared_channel_exists":n=TS.interop.i18n.t("Good news! That workspace has already joined the shared channel.","shared")();break;case"not_paid":n=TS.interop.i18n.t("Darn&mdash;that workspace has to upgrade to a paid Slack plan to join a shared channel.","shared")();break;default:return N(t)}return TS.generic_dialog.alert(n)};var N=function e(t){var n=t.message||"";t.data&&t.data.error&&(n+=": "+t.data.error);TS.error(n);var r=TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","shared")();return TS.generic_dialog.alert(r)};var U=function e(n){var r=["#sci_loading","#sci_no_shared_channels","#sci_channels_container","#sci_channels_create","#sci_send","#sci_invites_container"].filter(function(e){return e!==n}).join(", ");t.find(r).addClass("hidden");t.find(n).removeClass("hidden")};var q=function e(){o=false;a&&i.longListView("setHidden",true)};var G=function e(){return TS.boot_data.page_needs_enterprise};var W=function e(t){return!!H(t,true)};var z=function e(){var n=t.find("#sci_channels_create");if(TS.useReactLFS()){var r=document.getElementById("sci_teams_picker");var i=true;TS.ui.team_picker.make(r,{omitted_ids:[TS.model.team.id],onValueChange:function e(t){var r=t.map(function(e){return e.team.domain}).join(",");n.find('[name="domains"]').val(r);var i=true;Ie(n.find(F()),n.find('[data-action="sci_channels_create"]'),i)}},i)}else n.find('[name="domains"]').each(function(e,t){var r=$(t);TS.ui.team_picker.make(r,{omitted_ids:[TS.model.team.id]});r.on("change",function(){var e=TS.ui.team_picker.value(r).map(function(e){return e.team.domain}).join(",");r.val(e);var t=true;Ie(n.find(F()),n.find('[data-action="sci_channels_create"]'),t)})})};var K=function e(t){var n=$(t.target);var r=n.parent();var i=r.find("input");var a=r.find("label > span");var s=i.get(0);var o=i.val();TS.clipboard.canWriteText()?TS.clipboard.writeText(o):Te(a);s&&s.setSelectionRange(0,o.length)};var V=function e(){B().length||D().length||B(true).length||D(true).length||Ce()};var Y=function e(t,n){return t.concat(n)};var J=function e(t){if("num_members"in t)return t.num_members||0;return t.active_members?t.active_members.length:0};var Q=function n(){Oe(true);t=null;e.off("keyup.sci");e=null;TS.kb_nav.end();o=false;a=false;fe([]);fe([],true)};var X=function e(t){if(t.which!==TS.utility.keymap.enter)return;var n=$(t.target);if(n.is("input[data-invite-id]"))me(t);else if(n.is('input[name="domain"], input[name="channel_name"]')){TS.ui.startButtonSpinner($('#sci_channels_create [data-action="sci_channels_create"]').get(0));A(t)}};var Z=function r(){t=$("#sci_container");e=$("body");s=t.find(".list_container");i=s.find(".list");n=t.find("#channel_browser_filter");m=t.find("#channel_browser_sort");TS.model.ui_state&&TS.model.ui_state.sort_shared_channel_browser_by&&m.find('option[value="'+TS.model.ui_state.sort_shared_channel_browser_by+'"]').attr("selected",true);oe().then(Ce).catch(L)};var ee=function e(t,n){if(t.hasClass("channel_link")){var r=t.data("channel-id");TS.view.onChannelReferenceClick(n,r)}else{var i=t.data("group-id");TS.view.onGroupReferenceClick(n,i)}TS.ui.fs_modal.close()};var te=function e(t,n){return TS.api.call(n?"enterprise.groups.createShared":"enterprise.channels.createShared",t)};var ne=function e(t){return TS.api.call("conversations.inviteShared",t)};var re=function e(t){return TS.api.call(t?"groups.listShared":"channels.listShared")};var ie=function e(){return TS.api.call("channels.listSharedInvites")};var ae=function e(t){return TS.api.call("channels.revokeSharedInvite",t)};var se=function e(t){return TS.api.call("channels.sendSharedInvite",t)};var oe=function e(){var t=[re().reflect(),re(true).reflect()];return Promise.all(t).then(function(e){var t=[];e.forEach(function(e){if(e.isFulfilled())return;t.push(e.reason())});if(t.length)return Promise.reject(new Error("Some shared channels start APIs failed:\n"+t.join("\n")));fe(e[0].value().data.channels);fe(e[1].value().data.channels,true)})};var le=function e(n){if(!n)return;var r=H(n,W(n));if(!r)return;t.find("#sci_invite_container_"+n+' [data-action="replace_emailed_invites"]').replaceWith(TS.templates.shared_channels_invites_emailed_invitations(r))};var ue=function e(n){if(!n)return;var r=H(n,W(n));if(!r)return;var i=t.find("#sci_invite_container_"+n);i.length?i.replaceWith(TS.templates.shared_channels_invites_invite(r)):t.find("#sci_invites_container .sci_list_header").after(TS.templates.shared_channels_invites_invite(r));t.find("#sci_invites_container").removeClass("hidden")};var de=function e(n){if(!n)return;t.find("#sci_invite_container_"+n).remove();var r=t.find("#sci_invites_container");1===r.children().length&&r.addClass("hidden")};var ce=function e(t,n){_.remove(B(n),function(e){return e.invite_id==t})};var _e=function e(t){var n=$(t.target);var r=n.data("invite-id");var i=W(r);ae({invite_id:r}).then(function(){ce(r,i);de(r);V()}).catch(L)};var me=function e(t){var n=$(t.target);var r=n.parent();if(!TS.ui.validation.validate(r,{quiet:true,fast:true})){TS.ui.validation.validate(r);r.find('[data-action="sci_send"]').addClass("disabled");return}var i=n.data("invite-id");var a=r.find("input");var s=a.val();if(!s)return;var o=W(i);var l={invite_id:i,email:s};se(l).then(function(){a.val("");return ie().then(function(e){pe(e.data.invites,o);le(i);h(i)})}).catch(L)};var fe=function e(t,n){t.length&&(t=t.map(function(e){var t=TS.redux.channels.getEntityById(e.channel);return $.extend({},e,t)}));n?l=t:d=t};var pe=function e(t,n){n?u=t:c=t};var he=function e(){var n=t.find("#sci_channels_create .placeholder_overlay");t.find('#sci_channels_create input[name="domain"]').on("input",function(e){n.toggleClass("hidden",!!$(e.target).val())})};var ge=function e(){t.find('#sci_channels_create [name="access"]').togglify({on_text:TS.interop.i18n.t("Public","shared")(),off_text:TS.interop.i18n.t("Private","shared")(),label:j(),off_label:R(),off_class:"ts_toggle_orange",initial_state:true})};var Se=function e(t){x();var n=$(t.currentTarget).addClass("showing_sci_action");n.is(".sci_send_email_container")&&n.find("input").focus()};var Te=function e(t){var n=t.data("timeout");clearTimeout(n);t.removeClass("hidden").data("timeout",setTimeout(function(){t.addClass("hidden")},3e3))};var ve=function e(){if(o)return;if(!a){ke();o=true;return}if(a){o=true;i.longListView("setHidden",false);i.longListView("setItems",O(),true);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(i)})}};var be=function e(t){var n=["name","creator","created","members_high","members_low"];var r="name";-1!==n.indexOf(t)&&(r=t);ye(D(),r);ye(D(true),r)};var ye=function e(t,n){"name"===n?t.sort(function(e,t){if(e._name_lc>t._name_lc)return 1;if(t._name_lc>e._name_lc)return-1;return 0}):"creator"===n?t.sort(function(e,t){var n;var r;n=TS.interop.members.getMemberById(e.creator);r=TS.interop.members.getMemberById(t.creator);if(n&&r){if(n._name_lc>r._name_lc)return 1;if(r._name_lc>n._name_lc)return-1;return 0}if(n&&!r)return-1;if(!n&&r)return 1;return 0}):"created"===n?t.sort(function(e,t){if(e.created<t.created)return 1;if(t.created<e.created)return-1;return 0}):"members_high"===n?t.sort(function(e,t){var n=J(e);var r=J(t);if(n<r)return 1;if(r<n)return-1;return 0}):"members_low"===n&&t.sort(function(e,t){var n=J(e);var r=J(t);if(n>r)return 1;if(r>n)return-1;return 0})};var we=function e(){var t=TS.permissions.members.canCreateConvertOrgSharedChannels();var n={body_template_html:TS.templates.shared_channels_invites_modal({show_create_shared_channel_btn:t}),onShow:Z,onCancel:Q,modal_class:"fs_modal_internal_scroll convert_to_shared_dialog"};TS.ui.fs_modal.start(n)};var ke=function e(){a=true;var t=O();var n={items:t,approx_item_height:60,preserve_dom_order:true,approx_divider_height:35,pin_dividers:true,makeElement:function e(t){var n=$(TS.templates.channel_browser_row({is_shared:true}));t.$icon=n.find(".channel_browser_type_icon");t.$created_info=n.find(".channel_browser_channel_created_info");t.$name=n.find(".channel_browser_channel_name");t.$purpose=n.find(".channel_browser_channel_purpose");t.$member_count_container=n.find(".channel_browser_member_count_container");t.$member_count=n.find(".channel_browser_member_count");t.$open=n.find(".channel_browser_open");t.$preview=n.find(".channel_browser_preview");t.$joined=n.find(".channel_browser_joined");t.$shared_channel_icon=n.find(".shared_channel_icon");return n},makeDivider:function e(){return $("<div>").addClass("channel_browser_divider")},renderItem:function e(t,n,r){TS.interop.rules.channels.isOrgShared(n)?r.$shared_channel_icon.removeClass("hidden"):r.$shared_channel_icon.addClass("hidden");n.is_channel?r.$icon.removeClass("ts_icon_lock").addClass("ts_icon_channel_pane_hash"):r.$icon.removeClass("ts_icon_channel_pane_hash").addClass("ts_icon_lock");r.$name.text(n.name?n.name:"");var i=TS.interop.members.getMemberById(n.creator);i?r.$created_info.html(TS.interop.i18n.t("Created by {user} on {date}","channel_browser")({user:"<strong>"+TS.interop.members.getPrefCompliantMemberName(i)+"</strong>",date:TS.interop.datetime.toCalendarDate(n.created)})):r.$created_info.html(TS.interop.i18n.t("Created on {date}","channel_browser")({date:TS.interop.datetime.toCalendarDate(n.created)}));var a=J(n);r.$member_count.text(a);if(n.purpose&&n.purpose.value){var s=TS.utility.formatTopicOrPurpose(n.purpose.value);s=s.replace(/<a .*?>(.*?)<\/a>/g,"$1");r.$purpose.removeClass("hidden").html(s)}else r.$purpose.text("").addClass("hidden");var o=n.is_member||n.is_group;if(o){r.$open.removeClass("hidden");r.$preview.addClass("hidden");r.$joined.removeClass("hidden")}else{r.$open.addClass("hidden");r.$preview.removeClass("hidden");r.$joined.addClass("hidden")}if(n.is_group){t.removeClass("channel_link").removeAttr("data-channel-id");t.addClass("group_link").attr("data-group-id",n.id)}else{t.removeClass("group_link").removeAttr("data-group-id");t.addClass("channel_link").attr("data-channel-id",n.id)}},renderDivider:function e(t,n){t.text(n.name)},calcItemHeight:function e(t){return t.outerHeight()}};i.longListView(n);k();TS.utility.rAF(function(){i.monkeyScroll()})};var xe=function e(){p=false;var n=G();var r={reserved_domain:TS.model.team.domain};n&&(r.enterprise_info=TS.redux.enterprise.getEnterprise());var i=TS.templates.shared_channels_invites_create(r);var a=t.find("#sci_channels_create");a.html(i).find("textarea").autogrow();U("#sci_channels_create");q();$("#fs_modal.convert_to_shared_dialog").toggleClass("fs_modal_internal_scroll",false);t.find("#sci_header_wrapper").addClass("hidden");he();ge();n&&z();t.find('#sci_channels_create [name="domain"]').focus();Ladda.bind('#sci_channels_create [data-action="sci_channels_create"]');Oe()};var Ce=function e(){p=true;t.find("#sci_header_wrapper").removeClass("hidden");var n=D();var r=D(true);var i=!(n.length||r.length);if(i){De();U("#sci_no_shared_channels");q();k();return null}U("#sci_channels_container");$("#fs_modal.convert_to_shared_dialog").toggleClass("fs_modal_internal_scroll",true);TS.model.ui_state&&TS.model.ui_state.sort_shared_channel_browser_by?be(TS.model.ui_state.sort_shared_channel_browser_by):be(m.val());ve();Oe(true)};var Me=function e(n){p=false;var r=TS.templates.shared_channels_invites_send(n);t.find("#sci_send").html(r);U("#sci_send");q();Oe()};var Ie=function e(t,n,r,i){if(r&&t){var a=$(_.find(t,["nodeName","TEXTAREA"]));var s=a.val();s&&s.length?a.attr("data-validation","maxlength=250"):a.removeAttr("data-validation");i=!TS.ui.validation.validate(t,{quiet:true,fast:true})}n.toggleClass("disabled",i)};var Ae=function e(t){if($(t.target).is("a, input, .btn"))return;var n=$(t.currentTarget);var r=n.hasClass("showing_contents");n.toggleClass("showing_contents",!r);n.find(".sci_toggle_icon").toggleClass("ts_icon_caret_right",r).toggleClass("ts_icon_caret_down",!r)};var Ee=function e(t){var n=$(t.target).closest(".sci_invite_container").find(".sci_copy_link_mini_container");n.toggleClass("hidden",!n.hasClass("hidden"));M(t)};var Pe=function e(t){var n=$(t.target).closest(".sci_invite_container").find(".sci_send_email_mini_container");n.toggleClass("hidden",!n.hasClass("hidden")).find("input").focus();C(t)};var Fe=function e(n){var r=$(n.target);var i=t.find("#sci_channels_create");var a=r.val();var s="specific"===a;var o="external"===a;$("#sci_specific_team").toggleClass("hidden",!s);$("#sci_external_team").toggleClass("hidden",!o);i.find('[for="share_with_specific"]').toggleClass("hidden",!s);i.find('[for="share_with_external"]').toggleClass("hidden",!o);"specific"===a&&i.find('[name="team_list"]').focus();"external"===a&&i.find('[name="domain"]').focus();var l=true;Ie(i.find(F()),i.find('[data-action="sci_channels_create"]'),l);$e()};var Oe=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(Ce);TS.ui.fs_modal.showBackButton()}};var De=function e(n){var r=t.find("#sci_no_shared_channels");var i=r.find(".sci_no_shared_note");var a=TS.interop.i18n.t("You don\u2019t have any shared channels yet.","shared")();if(n){var s=TS.interop.i18n.t("No matches found for <strong> {escaped_query_string} </strong>","shared")({escaped_query_string:TS.utility.truncateAndEscape(n,50)});i.html(s)}else i.text(a)};var $e=function e(){t.find(".ts_toggle_on_label").text(j());t.find(".ts_toggle_off_label").text(R())};var He=function e(n,r){if(!t)return true;if(!n.is("input"))return true;var i=$("#sci_channels_create");var a=n.is('[name="domain"]')?n:i.find("[name=domain]");var s=n.is("[name=channel_name]")?n:i.find("[name=channel_name]");var o=a.val();var l=s.val();if(!o)return true;o=o.trim();l=l.trim();if(P(o,l)){r.quiet||n.addClass("invalid_invite");var u=TS.interop.i18n.t("This invite already exists. Try a different workspace or channel!","shared")();TS.ui.validation.showWarning(n,u,r);return}if(a===n){if(l&&!r.quiet&&s.hasClass("invalid_invite")){s.removeClass("invalid_invite");TS.ui.validation.validate(s)}}else if(o&&!r.quiet&&a.hasClass("invalid_invite")){a.removeClass("invalid_invite");TS.ui.validation.validate(a)}r.quiet||n.removeClass("invalid_invite");return true};var Be=function e(){if(TS.boot_data.feature_channel_browser_dropdown){var t=TS.interop.i18n.t("Sort:","channel_browser")();$("#temp_option_width").text(t+" "+$("#channel_browser_sort option:selected").text());var n=Math.min($("#temp_select_width").outerWidth(),300);f.css("width",n)}}})()},11273:function(e,t){(function(){TS.registerModule("user_groups",{updated_sig:new signals.Signal,updated_info_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,is_in_bulk_upsert_mode:false,promiseToGetUserGroupMembers:function e(t){return TS.api.call("subteams.users.list",{subteam:t,include_disabled:1}).then(function(e){var n=e.data;var r=s(t,n);return r})},getUserGroupMembers:function e(t,n){var r=function e(r,i){if(r&&i){var a=s(t,i);a&&n&&n(a)}};TS.api.call("subteams.users.list",{subteam:t,include_disabled:1}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},legacyNeedsToFetchMembership:function e(t){return void 0===t.users||_.size(t.users)!==t.user_count},getUserGroupMembersNotInModelObCount:function e(t,n){var r=TS.interop.userGroups.getUserGroupById(t);var i=_.get(r,"users.length");var a=TS.interop.channels.getChannelById(n)||TS.interop.channels.getGroupById(n);if(!r||!a)return 0;if(_.isUndefined(r.users))return 0;var s=r.users.some(function(e){return!TS.interop.redux.models.membership.isMembershipKnownForUser(TS.redux.getState(),a.id,e)});if(s)return 0;var o=r.users.filter(function(e){var t=TS.interop.membership.getCachedChannelMembershipInfoForUser(a.id,e);return t.is_known&&t.is_member});return i-o.length},upsertUserGroup:function e(t){if(TS.model.user&&TS.model.user.is_restricted)return false;var n=TS.interop.userGroups.getUserGroupById(t.id);t._name_lc=t.name.toLowerCase();if(n){TS.has_pri[a]&&TS.log(a,'updating existing User Group "'+t.id+'"');n=_.assign({},n);var i=TS.model.your_user_group_regex[t.id];i&&TS.user_groups.removeSelfUserGroup(n.id);for(var s in t)n[s]!=t[s]&&(n[s]=t[s]);if(!t.date_delete&&t.users&&-1!==t.users.indexOf(TS.model.user.id)){TS.user_groups.upsertSelfUserGroup(n.id);r(t);TS.user_groups.legacy_is_in_bulk_upsert_mode?TS.redux.user_groups.addToBulkUpsertPayload(n):TS.redux.user_groups.addUserGroup(n)}}else if(!t.date_delete){TS.has_pri[a]&&TS.log(a,'Adding user group "'+t.id+'"');r(t);TS.user_groups.legacy_is_in_bulk_upsert_mode?TS.redux.user_groups.addToBulkUpsertPayload(t):TS.redux.user_groups.addUserGroup(t)}TS.user_groups.legacy_is_in_bulk_upsert_mode||TS.user_groups.updated_sig.dispatch()},legacyStartBatchUpsert:function e(){if(TS.user_groups.legacy_is_in_bulk_upsert_mode)return false;TS.user_groups.legacy_is_in_bulk_upsert_mode=true;return true},legacyFinishBatchUpsert:function e(){if(!TS.user_groups.legacy_is_in_bulk_upsert_mode)return false;TS.user_groups.legacy_is_in_bulk_upsert_mode=false;TS.user_groups.batch_upserted_sig.dispatch();TS.user_groups.updated_sig.dispatch();return true},upsertUserGroupAndSignal:function e(t){TS.user_groups.upsertUserGroup(t);TS.user_groups.updated_sig.dispatch(t.id)},userGroupMembersChanged:function e(t){TS.info("TS.user_groups.userGroupMembersChanged");var n=TS.interop.userGroups.getUserGroupById(t.subteam_id);if(!n)return;if(n.users){t.added_users&&(n.users=_.union(n.users,t.added_users));t.removed_users&&(n.users=_.difference(n.removed_users,t.removed_users))}n.user_count=parseInt(n.user_count,10)||0;n.user_count+=parseInt(t.added_users_count,10)||0;n.user_count=Math.max(0,n.user_count-(t.removed_users_count||0));n.date_previous_update=_.assign(n,_.pick(t,["date_update","date_previous_update"]))},removeUserGroup:function e(t){var n=TS.interop.userGroups.getUserGroupById(t.id);if(n){TS.user_groups.removeSelfUserGroup(n.id);i(n);n.date_delete=-1}},removeUserGroupAndSignal:function e(t){TS.user_groups.removeUserGroup(t);TS.user_groups.updated_sig.dispatch(t.id)},upsertSelfUserGroup:function e(t){var n=TS.model.your_user_group_regex[t];n&&TS.user_groups.removeSelfUserGroup(t);var r=TS.interop.userGroups.getUserGroupById(t);if(r&&!r.date_delete){var i=new RegExp("<!subteam\\^("+r.id+(r.handle?"|"+r.handle:"")+")\\b");TS.model.your_user_group_regex[r.id]=i;if(r.handle){var a="@"+r.handle+">";TS.model.highlight_words.push(a);TS.model.highlight_words_regex=null}TS.redux.dispatch(TS.interop.redux.models.userGroups.addMemberToGroup({groupId:r.id,memberId:TS.model.user.id}))}},removeSelfUserGroup:function e(t){TS.model.your_user_group_regex[t]=null;delete TS.model.your_user_group_regex[t];var n=TS.interop.userGroups.getUserGroupById(t);if(n){n.handle&&_.pull(TS.model.highlight_words,"@"+n.handle+">");i(n);TS.model.highlight_words_regex=null;TS.user_groups.updated_sig.dispatch(n.id);TS.redux.dispatch(TS.interop.redux.models.userGroups.removeMemberFromGroup({groupId:n.id,memberId:TS.model.user.id}))}},test:function e(){return{clearUseGroupMaps:n}}});var e={};var t={};var n=function n(){e={};t={}};var r=function n(r){if(!r)return;if(r.handle){e[r.handle]=r;e["@"+r.handle]=r}t[r.id]=r};var i=function n(r){if(!r)return;if(r.handle){delete e[r.handle];delete e["@"+r.handle]}delete t[r.id]};var a=4;var s=function e(t,n){var r=TS.interop.userGroups.getUserGroupById(t);if(!r)return;r.users=n.users;r.user_count=n.users.length;TS.user_groups.upsertUserGroupAndSignal(r);return TS.interop.userGroups.getUserGroupById(t)}})()},11274:function(e,t){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};(function(){TS.registerModule("ui.admin_user_groups",{user_groups_fetched:new signals.Signal,onStart:function e(){$("body").on("click",'[data-action="admin_user_groups_modal"]',function(){u()});$("body").on("click",'[data-action="admin_user_groups_modal_new"]',function(){TS.ui.admin_user_groups.add()})},start:function e(){u()},add:function e(){u();o=true;w()},editInfo:function e(t){u();o=true;w(t)},editMembers:function e(t){u();o=true;A(t,false)},disable:function e(t){u();o=true;b(t,"disable_user_group")},enable:function e(t){u();o=true;b(t,"enable_user_group")},remove:function e(t){u();o=true;b(t,"delete_user_group")},test:function e(){var t={_isFullLocalMember:B};Object.defineProperty(t,"_isFullLocalMember",{get:function e(){return B},set:function e(t){B=t}});return t}});var e;var t;var r;var i;var a=true;var s=[];var o=false;var l=[];var u=function e(){var t=TS.templates.user_group_modal({show_info_pane:!TS.prefs.getPref("hide_user_group_info_pane"),show_user_groups_add:TS.permissions.members.canCreateAndDeleteUserGroups()});var n={body_template_html:t,onShow:d,onCancel:c};TS.ui.fs_modal.start(n)};var d=function n(){e=$("#user_groups_container");t=$("#all_user_groups");r=$("#user_groups_form_div");i=$("#user_groups_toggle_div");T();e.find('[data-action="open_form"]').on("click",function(e){e.preventDefault();var t=$(this).closest(".user_group_item").data("user-group-id");var n=j(t);w(n)})};var c=function n(){a=true;e=null;t=null;r=null;i=null;o=false;U=null;q=null;$(window).off("resize",S);TS.ui.admin_user_groups.user_groups_fetched.dispatch(s);R(TS.model.user_groups);L(l,TS.model.user_groups)};var m=function e(t){t&&t.preventDefault();if(o){TS.ui.fs_modal.close();U=null}else T();R(TS.model.user_groups);L(l,TS.model.user_groups)};var f=function e(){if(o){TS.ui.fs_modal.close();U=null}else{a=true;T()}TS.ui.admin_user_groups.user_groups_fetched.dispatch(s);R(TS.model.user_groups);L(l,TS.model.user_groups)};var p=function e(){if(!o){TS.ui.fs_modal.bindBackButton(T);TS.ui.fs_modal.showBackButton()}};var h=function e(t){if(!s||!t)return false;for(var n=0,r=s.length;n<r;n+=1)if(s[n].auto_type===t)return s[n];return false};var g=function e(t,n){if(!t){var r=$("#user_group_name_input").val()||"";var i=$("#user_group_handle_input").val()||"";n.group_name=r;n.group_handle=i;if(n.error&&("forbidden_handle"===n.error||"forbidden_name"===n.error)){var a=r+i;if(a){var s=h("owner");var o=h("admin");var l=!!a.match(/admins/i);var u=!!a.match(/owners/i);n.suggest_auto_group=true;n.can_create_auto_owners=u&&TS.model.user.is_admin&&!s;n.can_enable_auto_owners=u&&s&&s.date_delete;n.can_create_auto_admins=l&&TS.model.user.is_admin&&!o;n.can_enable_auto_admins=l&&o&&o.date_delete}}$("#user_group_alerts").html(TS.templates.user_group_alerts(n));return true}return false};var S=function e(){var t=$("#user_groups_header");if(!t.length)return;var n=$("#user_groups_list_div");if(!n.length)return;var r=parseInt(t.css("padding-top"),10);var i=t[0].offsetHeight;var a=$(window).height();var s=250;var o=Math.max(s,a-i-r);n.css("height",o)};var T=function e(n){if(a){var o=$("#user_groups_list_div");o.html(Handlebars.helpers.loadingHTML());var u=function e(t,r){if(g(t,r))return;s=r.subteams;for(var i=0,a=s.length;i<a;i+=1)s[i]._name_lc=s[i].name.toLowerCase();s.sort(TS.interop.i18n.mappedSorter("_name_lc"));TS.ui.admin_user_groups.user_groups_fetched.dispatch(s);H();v();if(n){$('#fs_modal [data-user-group-id="'+n+'"]').addClass("highlight_yellow");$("#fs_modal").animate({scrollTop:$(".highlight_yellow").offset().top},500)}l=r.subteams};TS.api.call("subteams.list",{include_disabled:1,include_users:1}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var i=true;u(i,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var i=false;u(i,t,n,r);return{data:t,args:n,request_id:r}});a=false}t.removeClass("hidden");r.addClass("hidden");i.addClass("hidden");TS.ui.fs_modal.hideBackButton()};var v=function n(){$(window).on("resize",S);S();$("#user_groups_list_div").monkeyScroll();U=$("#user_groups_list_div").data("monkeyScroll");$("#user_group_modal_search").on("keydown keyup change",O);q=$("#user_groups_header .user_groups_search .icon_close");q.off("click").on("click",D);t.off("click");t.on("click",'[data-action="open_form"]',function(e){e.preventDefault();var t=$(e.target);var n=t.closest(".user_group_item").data("user-group-id");var r=j(n);w(r)});t.on("click",'[data-action="edit_members"]',function(e){e.preventDefault();var t=$(e.target);var n=t.closest(".user_group_item").data("user-group-id");var r=j(n);A(r)});t.on("click",'[data-action="hide_info_pane"]',function(t){t.preventDefault();TS.prefs.setPrefByAPI({hide_user_group_info_pane:true},function(t,n){if(g(t,n))return;e.find(".info_panel").addClass("hidden")})});t.on("click",".user_group_toggle_btn",function(e){e.preventDefault();var t=$(e.target).closest("button, a");var n=t.closest(".user_group_item").data("user-group-id");var r=t.data("action");var i=j(n);b(i,r)});t.on("click",".clear_members_filter",D);var i=function e(t,n){if(t){a=true;o=false;T(n.subteam&&n.subteam.id?n.subteam.id:null)}};var s={owners:{create:function e(){TS.api.call("subteams.createAuto",{type:"owner"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i&&i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i&&i(a,t,n,r);return{data:t,args:n,request_id:r}})},enable:function e(){var t=h("owner");if(!t)return;TS.redux.dispatch(TS.interop.userGroups.enableUserGroup({subteam:t.id})).then(function(e){var t=e.data;i(true,t)})}},admins:{create:function e(){TS.api.call("subteams.createAuto",{type:"admin"}).then(function(e){var t=e.data,n=e.args,r=e.request_id;var a=true;i&&i(a,t,n,r);return{data:t,args:n,request_id:r}}).catch(function(e){var t=e.data,n=e.args,r=e.request_id;var a=false;i&&i(a,t,n,r);return{data:t,args:n,request_id:r}})},enable:function e(){var t=h("admin");if(!t)return;TS.redux.dispatch(TS.interop.userGroups.enableUserGroup({subteam:t.id})).then(function(e){var t=e.data;i(true,t)})}}};r.off("click").on("click","a.user_group_auto_action",function(e){var t=$(e.target);var n=t.data("auto-type");var r=t.data("auto-action");if(s[n]&&s[n][r]){s[n][r]();e.preventDefault();return false}})};var b=function e(n,r){if(!n){TS.warn("Cannot switch toggle view to undefined User Group");return}i.html(TS.templates.user_group_toggle({action:r,user_group:n}));i.find('[data-action="cancel"]').on("click",m);i.find(".user_group_toggle_btn").on("click",function(){var e=$(this).data("action");if(!_.includes(["enableUserGroup","disableUserGroup","deleteUserGroup"],e))return;TS.redux.dispatch(TS.interop.userGroups[e]({subteam:n.id})).then(function(){"enableUserGroup"===e&&y(n);f()}).catch(function(e){var t=e.data;return g(false,t)})});i.find('[data-action="switch_delete_user_group"]').on("click",function(t){t.preventDefault();e(n,"delete_user_group")});t.addClass("hidden");i.removeClass("hidden");p()};var y=function e(t){var n=TS.interop.userGroups.getUserGroupById(t.id);n||TS.user_groups.upsertUserGroup(_.cloneDeep(t))};var w=function e(i){r.html(TS.templates.user_group_settings_form(i));if(TS.boot_data.feature_lazy_channels)$("#user_group_default_channels").lazyFilterSelect(M(i));else{var a=TS.interop.redux.models.channels.getUnarchivedPublicAndPrivateChannels(TS.redux.getState()).map(function(e){return n({},e)});if(i){var s=i.prefs.channels.concat(i.prefs.groups);s.forEach(function(e){for(var t=0;t<a.length;t+=1)if(e==a[t].id){a[t].selected=true;break}})}var o={data:a,template:function e(t){var e;e=t.is_group||t.is_private?'<ts-icon class="ts_icon_lock ts_icon_inherit"></ts-icon>':"#";e+=_.escape(t.name);TS.interop.rules.channels.isOrgShared(t)?e+=' <ts-icon class="ts_icon_shared_channel ts_icon_inherit"></ts-icon>':TS.interop.utility.isModelObjectExternal(t)&&(e+=TS.templates.shared_channels_icon({model_ob:t,tooltip:true,shared_team_ids:TS.interop.rules.channels.isPendingExternallySharedChannel(t)?t.pending_shared:t.shared_team_ids,inherit:true}));return new Handlebars.SafeString(e)},placeholder_text:"",filter:function e(t,n){var r=new RegExp("^"+TS.utility.regexpEscape(n),"i");var i=new RegExp("^"+TS.utility.regexpEscape(n.replace("#","")),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|#)"+TS.utility.regexpEscape(n),"i");return t.name.match(i)||t.name.match(r)||t.name.match(a)}};$("#user_group_default_channels").lazyFilterSelect(o)}I(i);t.addClass("hidden");r.removeClass("hidden");p()};var k=function e(t,n){if(!t||!n)return false;var r=t&&t.id;var i=n.prefs.channels.concat(n.prefs.groups);return _.includes(i,r)};var x=function e(t,n){var r=_.get(n,"prefs.channels",[]);var i=r.length?TS.shared.ensureModelObsArePresent(r):Promise.resolve();var a={prefer_exact_match:false,frecency:false,allow_empty_query:true,prefer_channels_user_belongs_to:false,flat:true};var s={channels:{include_archived:false},groups:{include_archived:false},sort:!!t&&a};return i.then(function(){return TS.searcher.search(t,s)}).then(function(e){return t?e:TS.sorter.search(t,e,a)})};var C=function e(t){return function(e){return x(e,t).then(function(e){var n=_.map(e,function(e){var n=e.id;var r=k(e,t);return{model_ob:e,lfs_id:n,preselected:r}});return{replace_all_items:true,all_items_fetched:true,items:n}})}};var M=function e(t){return{data_promise:C(t),template:function e(t){var n=t.model_ob;var e="";e+=TS.interop.rules.channels.isPublicChannel(n)?"#":'<ts-icon class="ts_icon_lock ts_icon_inherit"></ts-icon>';e+=_.escape(n.name);TS.interop.rules.channels.isOrgShared(n)?e+=' <ts-icon class="ts_icon_shared_channel ts_icon_inherit"></ts-icon>':TS.interop.utility.isModelObjectExternal(n)&&(e+=TS.templates.shared_channels_icon({model_ob:n,tooltip:true,shared_team_ids:TS.interop.rules.channels.isPendingExternallySharedChannel(n)?t.pending_shared:t.shared_team_ids,inherit:true}));return new Handlebars.SafeString(e)},placeholder_text:""}};var I=function e(t){var n;var i;var a;if(t){n=TS.interop.userGroups.updateUserGroup;i=false;a=t.id}else{n=TS.interop.userGroups.createUserGroup;i=true}var s=$("#user_group_handle_input");s.on("input",function(){$(this).closest(".handle_input").toggleClass("empty",!this.value.length)});r.find(".user_group_settings_form").on("submit",function(e){e.preventDefault();var t=$('input[name="name"]').val();var r=$('input[name="handle"]').val();var s=$('input[name="description"]').val();var o=$("#user_group_default_channels").lazyFilterSelect("value");o=_.map(o,TS.boot_data.feature_lazy_channels?"model_ob.id":"id");var l={name:t,handle:r,description:s,channels:o};a&&(l.subteam=a);TS.redux.dispatch(n(l)).then(function(e){var t=e.data;y(t.subteam);i?A(t.subteam,i):f();TS.user_groups.updated_info_sig.dispatch(t.subteam.id)}).catch(function(e){var t=e.data;return g(false,t)})});r.find(".user_group_settings_form").on("reset",m);var o=$("#save_user_group");var l=$("#user_group_name_input");function u(){var e=l.val();e&&e.length?o.removeAttr("disabled"):o.attr("disabled",true)}if(o.length&&l.length){l.on("change",u);l.on("keyup",u);u()}};var A=function e(n,i){var a=!!n.is_external||!!n.auto_type;var s=function e(){r.html(TS.templates.user_group_members_form({is_new:i,is_locked:a,user_group:n}))};var o=function e(){var a=$("#member_count");var s=n.user_count||0;var o=function e(){var t=$(i?"#create_group":"#save_group");t.length&&(s<1?t.prop("disabled",true):t.prop("disabled",false))};var l={approx_item_height:36,template:function e(t){var n=TS.templates.user_group_invite_member_small(t);return new Handlebars.SafeString(n)},onItemAdded:function e(){s+=1;a.html(s);o()},onItemRemoved:function e(){s-=1;a.html(s);o()},filter:function e(t,n){var r=t.member;"@"===n.charAt(0)&&(n=n.substr(1));var i=new RegExp("^"+TS.utility.regexpEscape(n),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(n),"i");return TS.utility.members.checkMemberMatch(r,i)||TS.utility.members.checkMemberMatch(r,a)},disabled:!!n.is_external||!!n.auto_type,data_promise:E(n)};$("#user_group_members_select").lazyFilterSelect(l);F(n);t.addClass("hidden");r.removeClass("hidden");o()};if(i){s();TS.ui.fs_modal.hideBackButton();o()}else{var l=function e(){s();p();o()};if(!TS.user_groups.legacyNeedsToFetchMembership(n))return l();TS.user_groups.getUserGroupMembers(n.id,function(e){if(e&&e.users){n=e;return l()}})}};var E=function e(t){var n=true;return function(e,r){"@"===e.charAt(0)&&(e=e.substring(1));var i=false;if(n){n=false;_.get(t,"users.length")&&(i=true)}if(i){var a=t.users.map(TS.interop.members.getMemberById);a.sort(TS.interop.members.memberSorterByName);var s=a.map(function(e){return{member:e,lfs_id:String(e.id),preselected:true}});return Promise.resolve(s)}if(r>0)return Promise.resolve([]);var o={query:e,include_org:false,include_slackbot:false,include_self:true,full_profile_filter:false,include_bots:true};var l=P(o);return l}};var P=function e(t){return Promise.resolve().then(function(){return TS.members.promiseToSearchMembers(t).then(function(e){var t=[];t=""===e.query?TS.utility.teams.getMembersForTeam(TS.model.team):e.items;e.items=t.filter(B).map(function(e){return{member:e,lfs_id:String(e.id)}});return e})})};var F=function e(t){r.find(".user_group_members_form").on("submit",function(e){e.preventDefault();var n=$("#user_group_members_select").lazyFilterSelect("value");n=n.map(function(e){return e.member.id});TS.redux.dispatch(TS.interop.userGroups.updateMembersOfUserGroup({subteam:t.id,users:n})).then(function(e){var t=e.data;f();TS.user_groups.updated_info_sig.dispatch(t.subteam.id)}).catch(function(e){var t=e.data;g(false,t)})});r.find(".user_group_members_form").on("reset",function(e){e.preventDefault();a=true;m(e)})};var O=function e(t){var n=$(t.target);var r=n.val();if(r!==N){N=r;q.toggleClass("hidden",""===r);H()}};var D=function e(){var t=$("#user_group_modal_search");N="";t.val("");setTimeout(function(){t.focus()},0);q.addClass("hidden");H()};var H=function e(){var t=$("#user_groups_list_div");var n=N;var r;$("#user_groups_header .user_groups_search").toggleClass("hidden",!s.length);if("string"===typeof n&&n.length){var i=s.filter(function(e){return-1!==e.handle.indexOf(n)||-1!==e._name_lc.indexOf(n)||e.description&&-1!==e.description.toLowerCase().indexOf(n)});if(i.length){t.html(TS.templates.builders.buildUserGroupListHTML(i));U&&U.updateFunc();return}var a={query:n,tab:{label:TS.interop.i18n.t("User Groups","pages_admin")()}};r='<div class="no_results top_margin">'+TS.templates.team_list_no_results(a)+"</div>"}else r=TS.templates.builders.buildUserGroupListHTML(s);t.html(r);U&&U.updateFunc()};var B=function e(t){if(!t)return false;if(t._is_local&&!t.deleted&&!t.is_ultra_restricted&&!t.is_restricted&&!(t.is_bot||t.is_slackbot))return true;return false};var j=function e(t){if(t)for(var n=0;n<s.length;n+=1)if(s[n].id==t)return s[n]};var R=function e(t){var n=$("#user_groups_tab .count");n.html(t.length)};var L=function e(t,n){0===t.length&&n.length>0&&TS.reload()};var N;var U;var q})()},11275:function(e,t){(function(){TS.registerModule("utility.search",{test:function e(){return{_fetchMembersFromFlannel:r}},makeClause:function t(n,r,i){if(e(n,r,i))return;var a={type:n.toLowerCase(),value:r};i&&(a.field_id=i);return a},makeConjunction:function e(n,r){if(t(n,r))return;return{type:n.toLowerCase(),clauses:r}},promiseToSearch:function e(t){if(!t)return Promise.reject(new Error("Cannot search without arguments."));if(t.all_of_org&&!TS.boot_data.page_needs_enterprise)return Promise.reject(new Error("cannot search an org when not an enterprise team"));if(!t.solr&&TS.interop.Flannel.useSocket()){if(!t.hasOwnProperty("raw_query"))return Promise.reject(new Error("Flannel searches require a `raw_query` to be provided"));var a=t.raw_query;var s=t.count||Infinity;var o;if(_.isEmpty(t.raw_query)&&!t.only_admins)o=Promise.resolve([]);else{var l={};t.only_admins?l.filter="admins":t.only_local_team&&(l.filter="team");o=r(t.raw_query,s,t.determine_membership_for_channel,l)}return o.then(function(e){var n=e.objects;if(!t.include_bots){var r=_.remove(n,{is_bot:true});r.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed these bots from results:",r)}if(t.exclude_slackbot&&t.include_bots){var o=_.remove(n,{is_slackbot:true});o.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed slackbot from results:",o)}if(TS.boot_data.page_needs_enterprise&&!t.all_of_org){var l=_.remove(n,function(e){var t=_.get(e,"enterprise_user.teams",[]);var n=_.includes(t,TS.model.team.id);return!n});l.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed these org members from results:",l)}if(!t.include_deleted){var u=_.remove(n,{deleted:true});u.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed these deleted members from results:",u)}n=_.intersectionBy(TS.members.getMembersForUser(),n,"id");return{ok:true,data:{items:n.slice(0,s),next_cursor_mark:null,num_found:n.length,teams:[TS.model.team]},args:{query:a}}})}if(!t.query)return Promise.reject(new Error("Cannot search without a query."));var u={query:JSON.stringify(t.query)};["sort","sort_direction","count","cursor_mark","include_bots","include_deleted","exclude_slackbot","ignore_guest_accounts"].forEach(function(e){t.hasOwnProperty(e)&&(u[e]=t[e])});var d=t.endpoint;d||(d=t.all_of_org?"search.enterprise":"search.team");return TS.api.call(d,u).catch(n)}});var e=function e(t,n,r){if(!t){TS.error("cannot make a clause without a type");return}if(!n){TS.error("cannot make a clause without a value");return}"custom"!==t||r||TS.error("cannot make a custom type clause without a field id")};var t=function e(t,n){if(!t){TS.error("cannot make a conjunction without an 'and' or 'or' type");return}(!n||n.length<2)&&TS.error("cannot make a conjunction without at least two clauses")};var n=function e(t){TS.error(t.data.error+" error occured while searching");TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","utility_search")());throw t};var r=function e(t,n,r,i){i=i||{};var a={query:t,count:n};i.filter&&(a.filter=i.filter);var s=TS.members.fetchAndUpsertMembersWithQuery(a);if(!r)return s;var o=_.assign({channels:[r]},a);var l=TS.members.fetchAndUpsertMembersWithQuery(o);return Promise.join(s,l).then(function(e){var t=e[0];var n=e[1];var i=_.map(t.objects,"id");var a=_.map(n.objects,"id");var s={};a.forEach(function(e){s[e]=true});_.difference(i,a).forEach(function(e){s[e]=false});TS.redux.dispatch(TS.interop.redux.models.membership.setChannelMembershipInfoForUsers({channelId:r,membershipInfo:s}));return t})};var i=1989})()},11276:function(e,t){(function(){TS.registerModule("utility.calls",{share_url_prefix:document.location.origin+"/call/",calls_window_changed_sig:new signals.Signal,room_id_sig:new signals.Signal,started_platform_call_sig:new signals.Signal,window_types:{call_window:"call_window",mini_panel:"mini_panel",incoming_call:"incoming_call"},messages_to_call_window_types:{invite_response:"invite_response",invite_cancel:"invite_cancel",start_call:"start_call",caller_id:"caller_id",mini_panel_action:"mini_panel_action",did_close_window:"did_close_window",ping:"ping",ms_msg:"ms_msg",reachability:"reachability",calls_status:"calls_status",regions:"regions",got_server:"got_server",got_server_error:"got_server_error"},messages_to_mini_panel_types:{update_state:"update_state"},messages_from_call_window_types:{update_mini_panel:"update_mini_panel",set_call_window_loaded:"set_call_window_loaded",set_call_window_busy:"set_call_window_busy",show_growl_notification:"show_growl_notification",set_is_publisher_screensharing:"set_is_publisher_screensharing",pong:"pong",close:"close",restart_cursors_window_if_open:"restart_cursors_window_if_open",hide_call_window:"hideCallWindow",get_calls_status:"get_calls_status",force_janus_disconnect:"force_janus_disconnect",get_regions:"get_regions",get_server:"get_server",get_member_data:"get_member_data",play_sound:"play_sound",launch_dev_tools_mini_panel:"launch_dev_tools_mini_panel",launch_dev_tools_cursors:"launch_dev_tools_cursors",send_interactive_mas_migration_slackbot_message_after_call:"send_interactive_mas_migration_slackbot_message_after_call",update_injection_urls:"update_injection_urls",dm_call_is_usable:"dm_call_is_usable"},messages_from_incoming_call_types:{user_clicked_accept_or_reject:"user_clicked_accept_or_reject"},messages_from_mini_panel_types:{user_clicked_action:"user_clicked_action"},invite_response_types:{accept:"accept",reject:"reject",on_call:"on_call",dnd:"dnd",hangup:"hangup"},invite_cancel_types:{cleanup:"cleanup",timeout:"timeout",inviter_cancel:"inviter_cancel",accepted_timeout:"accepted_timeout",caller_hangup:"caller_hangup"},invite_unsupported_types:{platform:"platform",client_version:"client_version",offline:"offline",max_teams:"max_teams"},openMasMigrationDialog:function e(){"enabled"===TS.experiment.getGroup("calls_interactive_ss")&&TS.generic_dialog.start({title:TS.interop.i18n.t("Close Slack to download the app?","calls")(),body:TS.interop.i18n.t("We'll close Slack for you, and open the downloads page on our website. The app will download automatically \u2014 just follow the three quick installation steps listed at the end!","calls")(),show_cancel_button:true,go_button_text:TS.interop.i18n.t("Start Download Now","calls")(),onGo:function e(){TS.utility.openInNewTab("https://slack.com/downloads/instructions/osx?ddl=1","_blank");_.delay(function(){return _.invoke(desktop.app,"quit")},2e3)}})},onStart:function t(){e=TS.calls&&TS.calls.api?TS.calls.api:TS.api;l.in_slack_app=!!TS.client;l.in_call_window=!!TS.calls;l.calls_url_prefix=document.location.origin+"/call/";l.send_interactive_mas_migration_slackbot_message_after_call=false;if(l.in_slack_app){TS.redux.socket.connectedSig.add(c);TS.redux.socket.disconnectedSig.add(m);TS.redux.socket.socketMessageReceivedSig.add(d);TSSSB.call("setCallWindowBusy",{is_busy:false});window.addEventListener("online",f);window.addEventListener("offline",f);window.addEventListener("message",ae);TS.model.is_our_app&&TS.client.login_sig.add(p);if(TS.client.windows){TS.client.windows.win_finished_loading_sig.add(h);TS.client.windows.win_will_close_sig.add(g);TS.client.windows.win_crashed_sig.add(S);TS.client.windows.win_became_key_sig.add(T);TS.client.windows.win_resigned_key_sig.add(v)}TS.ui&&TS.ui.window_unloaded_sig.add(b);TS.model.is_our_app?l.call_window_loaded=false:l.call_window_loaded=true;l.is_ms_connected=false;l.is_reachability_online=true;TS.experiment.loadUserAssignments().then(function(){l.screen_sharing_enabled=TS.model.supports_screen_sharing;"enabled"===TS.experiment.getGroup("calls_better_regions")&&(l.calls_better_regions_expt=true)})}},startCallInModelOb:function e(t,n,r){var i;var a=!n&&"Slack"!==TS.prefs.getTeamPref("calling_app_name");if(TS.interop.utility.looksLikeMemberId(t.id)){var s=t.id;t=TS.redux.channels.getImByMemberId(s);if(!t){TS.ims.promiseToStartImByMemberId(s,true,false).then(function(){t=TS.redux.channels.getImByMemberId(s);i={id:t.id,is_dm:t.is_im,is_mpdm:t.is_mpim,is_video_call:r};a?TS.utility.calls.launchPlatformCalls(i):TS.utility.calls.launchVideoCall(i)});return}}i={id:t.id,is_dm:t.is_im,is_mpdm:t.is_mpim,is_video_call:r};a?TS.utility.calls.launchPlatformCalls(i):TS.utility.calls.launchVideoCall(i)},getCallsUrlPrefix:function e(){return l.calls_url_prefix},isEnabled:function e(){if(!TS.model||!TS.model.team)return false;return TS.prefs.getTeamPref("allow_calls")},isCallWindowReady:function e(){return l.is_reachability_online&&l.is_ms_connected},isMultiPartyEnabled:function e(){return TS.utility.calls.isEnabled()&&TS.utility.calls.isPaidTeam()},isPaidTeam:function e(){return""!==TS.model.team.plan},isCurrentContextMultiParty:function e(){if(TS.model.active_channel_id||TS.model.active_group_id||TS.model.active_mpim_id)return true;return false},launchPlatformCalls:function t(n){if(!n)return;if(!n.id)return;var r=null!=TSSSB.env.desktop_app_version;TS.utility.calls.started_platform_call_sig.dispatch({is_loading:true});e.call("calls.request",{channel:n.id,app:TS.prefs.getTeamPref("calling_app_id")}).then(function(e){if(!e.data.ok){u(e);return}var t=window.open(encodeURI(e.data.url),TS.prefs.getTeamPref("calling_app_name"));try{t.focus()}catch(e){if(!r){var n=bowser.name;var i;i=n?TS.interop.i18n.t("Please allow pop-ups in {browser} to make a call. You can <http://my.slack.com/help/requests/new|contact Slack> if you need help.","utility")({browser:n}):TS.interop.i18n.t("Please allow pop-ups in your browser to make a call. You can <http://my.slack.com/help/requests/new|contact Slack> if you need help.","utility")();var a={text:i,ephemeral_type:"enable_popups",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(a)}}}).catch(function(e){u(e)}).finally(function(){TS.utility.calls.started_platform_call_sig.dispatch({is_loading:false})})},isInteractiveScreenShareHostingSupported:function e(){return TS.model.supports_screen_sharing&&!TS.model.is_lin&&!TS.utility.calls.isInteractiveDisabledByMas()&&!TS.utility.isAppVersionBefore("2.8.0")},isInteractiveDisabledByMas:function e(){return TS.model.is_our_app&&TS.model.is_mac&&TSSSB.call("isAppStoreBuild")},launchVideoCall:function e(t){if(!TS.model.supports_voice_calls&&!TS.utility.calls.platformHasCallsCode()){y();return}if(!t)return;if(!t.id)return;if(!TS.utility.calls.isCallWindowReady())return;if(l.incoming_caller_info){var n=TS.redux.channels.getImByMemberId(l.incoming_caller_info.user_id);n&&n.id===t.id&&H().then(function(e){if(e){TS.utility.calls.closeIncomingCallWindow();TS.utility.calls.sendInvitationResponseToCaller({user_id:l.incoming_caller_info.user_id,room_id:l.incoming_caller_info.room_id,response:TS.utility.calls.invite_response_types.accept,did_choose_video:false})}})}U().then(function(e){if(e){z();return}TS.utility.calls_log.logEvent({event:o.log_events.start_call,value:t});ne("call_initiated_by_user",t.id);q(l.calls_url_prefix+t.id,t.id,{start_with_video:t.is_video_call})})},sendInvitationResponseToCaller:function t(n){if(!n||!n.user_id||!n.room_id||!n.response||!TS.utility.calls.invite_response_types[n.response]){TS.utility.calls_log.logError("sendInvitationResponseToCaller: invalid args: ",n);return}TS.utility.calls.room_id_sig.dispatch({room_id:n.room_id});if(n.response){var r=function e(t,n){t||TS.utility.calls_log.logError("inviteResponse API failed with: ",n)};e.callImmediately("screenhero.rooms.inviteResponse",{caller:n.user_id,room:n.room_id,response:n.response}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}});if(n.response===TS.utility.calls.invite_response_types.accept){l.accepted_caller_id=n.user_id;n.currently_calling_caller||G(n.room_id,n.did_choose_video)}}Promise.join(U(),H(),function(e,t){TS.utility.calls_log.logEvent({event:o.log_events.invite_response_send,value:{response_type:n.response,user_id:n.user_id,room_id:n.room_id,is_call_window_busy:e,is_in_incoming_call:t}});return null})},closeIncomingCallWindow:function e(t){TS.utility.calls_log.logEvent({event:o.log_events.close_incoming_call});if(TS.model.is_our_app){if(window.winssb&&l.incoming_call_token){TSSSB.call("closeWindow",l.incoming_call_token);delete l.incoming_call_token}}else H().then(function(e){e&&TS.incoming_call.timeout()});delete l.incoming_caller_info;if(t){TS.sounds.stop("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{ignore_mute:true});ie()}else D()},maybeEnterMasToDdlFlow:function e(t){if(!TS.utility.calls.isInteractiveDisabledByMas())return false;t=TS.utility.normalizeDevHost(t);if(-1===t.indexOf("slack.com/downloads")||-1===t.indexOf("?ddl=1"))return false;if("enabled"===TS.experiment.getGroup("calls_interactive_ss")){TS.utility.calls.openMasMigrationDialog();return true}return false},maybeHandleCallLink:function e(t){if(!l.in_slack_app)return false;t=$(t);if(!t||!t.length)return false;if(!t.is("a"))return false;var n=t.attr("href");if(!n)return false;n=TS.utility.normalizeDevHost(n);n=n.replace("https://","").replace("http://","");var r=TS.utility.normalizeDevHost(l.calls_url_prefix);r=r.replace("https://","").replace("http://","");0===n.indexOf(r)&&(n=n.replace(r,"call/"));while(0===n.indexOf("/"))n=n.substr(1);if(0!==n.indexOf("call/"))return false;var i=n.split("/");if(i.length<2)return false;var a=i[1];if(!a)return false;if(!TS.utility.calls.isCallWindowReady())return true;H().then(function(e){if(e){TS.utility.calls_log.logEvent({event:o.log_events.call_object_click_in_incoming_call});return}TS.utility.calls.room_id_sig.dispatch({room_id:a});G(a)});return true},getParentWindow:function e(){if(window.winssb&&!(window.parentInfo||window.parentBrowserWindowId))TS.utility.calls_log.logWarn("WinSSB: Trying to get parent window before browser window ID is initialized");else if(window.opener)return window.opener},promiseToGetRegions:function e(r){if(t)return t;var i=void 0;var s="https://universal.slack-core.com/region.json";t=new Promise(function(e){r&&"R"===r.charAt(0)?e(""):$.ajax({type:"GET",url:s,async:true,cache:false,timeout:2e3,success:function t(n){TS.utility.calls_log.logEvent({event:"Regions",value:n.region_text});i=n.region_text;"dev"===TS.boot_data.version_ts&&(i="dev");e(i)},error:function t(n,r,a){TS.utility.calls_state_logging.error("CALLS_REGION_REQUEST_ERROR",{error:r,error_msg:a});i="";"dev"===TS.boot_data.version_ts&&(i="dev");e(i)}})});clearTimeout(n);n=_.delay(function(){t=void 0},a);return t},promiseToGetServer:function t(n,s){if(r[s])return r[s];var o;var l={regions:n,protocol:"1.0"};if("R"===s.charAt(0)){o="screenhero.rooms.join";l.room=s}else{o="screenhero.rooms.create";l.channel=s;var u=TS.storage.fetchCallsState();if(u.call_server_override){l.call_server=u.call_server_override;u.call_server_override=null;TS.storage.storeCallsState(u)}}r[s]=e.callImmediately(o,l);clearTimeout(i[s]);i[s]=_.delay(function(){TS.utility.calls.clearServerPromise(s)},a);return r[s]},clearServerPromise:function e(t){delete r[t]},dummyMediaServerRequest:function e(t,n){$.ajax({type:"HEAD",url:"https://"+t+":"+n+"/janus",async:true,timeout:1e3,success:function e(){},error:function e(t,n,r){}})},getCallActive:function e(){return U()},isScreenSharing:function e(){return l.is_publisher_screensharing},isSupportedMessage:function e(t){var n=["user_change","pref_change","team_join","channel_created","channel_deleted","channel_archive","channel_unarchive","channel_rename","channel_joined","channel_left","group_deleted","group_archive","group_unarchive","group_rename","group_joined","group_left","im_open","mpim_joined","mpim_open","mpim_close"];return-1!==n.indexOf(t)},getPlatformErrorMessageForModalNew:function e(){if(TS.boot_data.feature_calls_unsupported_client_strings){if(TS.model.is_our_app)return TS.interop.i18n.t("Unfortunately, this version of Slack is out of date. Update your Slack app for access to calls &mdash; as well as bug fixes and an all-around smoother experience.","utility")();return TS.utility.calls.getPlatformErrorMessageForCallWindowNew()}},getPlatformErrorMessageForCallWindowNew:function e(){if(TS.boot_data.feature_calls_unsupported_client_strings){if(TS.model.is_our_app)return TS.interop.i18n.t("To join or start calls, you'll need to use the latest version of the Slack app.","utility")();return TS.interop.i18n.t("Unfortunately, Slack calls aren't available in this browser. We recommend downloading the Slack desktop app, or you can switch to Chrome.","utility")()}},getPlatformErrorTitleNew:function e(){if(TS.boot_data.feature_calls_unsupported_client_strings){if(TS.model.is_our_app)return TS.interop.i18n.t("To join calls, you\u2019ll need to update Slack","utility")();return TS.interop.i18n.t("Please download the app to use calls","utility")()}},getPlatformErrorForButton:function e(){if(TS.boot_data.feature_calls_unsupported_client_strings){if(TS.model.is_our_app)return TS.interop.i18n.t("Update Slack","utility")();return TS.interop.i18n.t("Download Slack","utility")()}},getPlatformErrorMessage:function e(){if(TS.model.is_our_app){if(TS.model.lin_ssb_version)return TS.interop.i18n.t("Unfortunately, the calls feature is not available on Linux.","utility")();if(window.winssb)return TS.interop.i18n.t("To use the calls feature, please upgrade to the latest version of Slack for Windows.","utility")();return TS.interop.i18n.t("To use the calls feature, please upgrade to the latest version of the Mac app for Slack.","utility")()}if(bowser.mobile&&bowser.ios)return TS.interop.i18n.t("Please update your Slack iOS app to the newest version.","utility")();if(bowser.mobile)return TS.interop.i18n.t("Unfortunately, the calls feature is not available on mobile browsers.","utility")();return TS.interop.i18n.t('Unfortunately, Slack calls aren\'t available in this browser. We recommend <a href="{url}" target="_blank">downloading the Slack desktop app</a>, or you can switch to Chrome.',"utility")({url:"https://slack.com/download"})},getPlatformErrorTitle:function e(){if(TS.model.is_our_app){if(TS.model.lin_ssb_version)return TS.interop.i18n.t("Calls feature is not available on Linux","utility")();if(window.winssb)return TS.interop.i18n.t("Please update your Slack for Windows","utility")();return TS.interop.i18n.t("Please update your Slack for Mac","utility")()}if(bowser.mobile)return TS.interop.i18n.t("Calls feature is not available on mobile browsers","utility")();return TS.interop.i18n.t("Calls feature is not available in this browser","utility")()},platformHasCallsCode:function e(){if(TS.model.is_our_app){if("1.1"==TS.model.mac_ssb_version&&TS.model.mac_ssb_version_minor<8||parseFloat(TS.model.mac_ssb_version)<2)return false;if("1.2"==TS.model.win_ssb_version&&TS.model.win_ssb_version_minor<5||parseFloat(TS.model.win_ssb_version)<1.2)return false}return true},verifyOriginUrl:function e(t){return TS.interop.url.getHostName(t)==window.location.hostname&&_.startsWith(t,"https:")},getUrlForRoom:function e(t){return TS.utility.calls.getUrlForRoomId(t.id)},getUrlForRoomId:function e(t){return TS.utility.calls.share_url_prefix+t},dbg:{getState:function e(){return{config:o,state:l}},isCallWindowBusy:function e(){U().then(function(e){TS.info("_isCallWindowBusy: "+e)})},isIncomingCallWindowBusy:function e(){H().then(function(e){TS.info("_isInIncomingCall: "+e)})}}});var e;var t;var n;var r={};var i={};var a=6e4;var s=[];var o={call_window_dims:{width:1070,height:600,min_width:600,min_height:500},mini_panel_dims:{width:280,height:64,min_width:280,min_height:44,x_offset:50,y_offset:50},incoming_call_window_dims:{width:240,height:373},log_events:{previous_crash:"PreviousCrash",incoming_call:"IncomingCall",invite_response_from_callee:"InviteResponseFromCallee",ms_connected:"MSConnected",ms_disconnected:"MSDisconnected",reachability_changed:"ReachabilityChanged",window_closed:"WindowClosed",window_crashed:"WindowCrashed",call_window_load_timeout:"CallWindowLoadTimeout",call_window_load_start:"CallWindowLoadStart",incoming_call_timeout:"IncomingCallTimeout",send_msg_no_call_window:"SendMsgNoCallWindow",send_msg_no_mini_panel:"SendMsgNoMiniPanel",call_window_loaded:"CallWindowLoaded",call_window_busy:"CallWindowBusy",invalid_msg_from_child_window:"InvalidMsgFromChildWindow",call_window_pong:"CallWindowPong",unknown_msg_from_call_window:"UnknownMsgFromCallWindow",incoming_call_click:"IncomingCallClick",unknown_msg_from_incoming_call_window:"UnknownMsgFromIncomingCallWindow",mini_panel_click:"MiniPanelClick",unknown_msg_from_mini_panel:"UnknownMsgFromMiniPanel",call_object_click_in_incoming_call:"CallObjectClickInIncomingCall",invite_response_send:"InviteResponseSend",close_incoming_call:"CloseIncomingCall",no_mini_panel_in_update:"NoMiniPanelInUpdate",start_call:"StartCall",join_call:"JoinCall"},CALL_WINDOW_LOAD_TIMEOUT_MSECS:3e4,INCOMING_RING_TIMEOUT_MSECS:27e3};var l={};var u=function e(t){var n={text:t.data.response||TS.interop.i18n.t("Darn, that didn\u2019t work. Try your call again or <http://my.slack.com/help.requests/new|contact us> if it\u2019s still not working.","utility")(),ephemeral_type:t.data.error||"uncaught_third_party_call_error",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(n)};var d=function t(n){if(!l.in_slack_app)return;switch(n.type){case"screenhero_invite":TS.utility.calls_log.logEvent({event:o.log_events.incoming_call,value:n});Promise.join(U(),H(),function(e,t){F(e,t,n);return null});break;case"screenhero_invite_cancel":TS.utility.calls.closeIncomingCallWindow();U().then(function(e){e?B({message_type:TS.utility.calls.messages_to_call_window_types.invite_cancel,cancel_type:n.cancel_type,user_id:n.responder,room_id:n.room}):l.cached_invite_cancel={cancel_type:n.cancel_type,user_id:n.responder,room_id:n.room}});break;case"screenhero_invite_response":TS.utility.calls_log.logEvent({event:o.log_events.invite_response_from_callee,value:n});B({message_type:TS.utility.calls.messages_to_call_window_types.invite_response,response_type:n.response,user_id:n.responder,room_id:n.room});e.callImmediately("screenhero.rooms.inviteCancel",{responder:n.responder,room:n.room,cancel_type:TS.utility.calls.invite_cancel_types.cleanup});break;case"sh_room_join":TS.utility.calls_log.logInfo("sh_room_join msg: ",n);break;default:TS.utility.calls.isSupportedMessage(n.type)&&(TS.model.is_our_app||B({message_type:TS.utility.calls.messages_to_call_window_types.ms_msg,msg:n}));break}};var c=function e(){TS.utility.calls_log.logEvent({event:o.log_events.ms_connected});l.is_ms_connected=true;K()};var m=function e(){TS.utility.calls_log.logEvent({event:o.log_events.ms_disconnected});l.is_ms_connected=false;K()};var f=function e(){l.is_reachability_online=window.navigator.onLine;K();R()};var p=function e(){l.did_login=true};var h=function e(t){switch(t){case l.incoming_call_token:TSSSB.call("centerWindow",t);TSSSB.call("showWindow",t);O();break;case l.mini_panel_token:if(window.winssb&&winssb.window&&winssb.window.browserWindows&&winssb.window.browserWindows[t]&&winssb.window.browserWindows[t].setMinimumSize){winssb.window.browserWindows[t].setMinimumSize(o.mini_panel_dims.min_width,o.mini_panel_dims.min_height);winssb.window.browserWindows[t].setSize(o.mini_panel_dims.width,o.mini_panel_dims.height)}break;default:break}};var g=function e(t){TS.utility.calls_log.logEvent({event:o.log_events.window_closed,value:{token:t,cw_token:l.call_window_token,mp_token:l.mini_panel_token,ic_token:l.incoming_call_token}});switch(t){case l.call_window_token:l.last_call_window_token=l.call_window_token;J();l.call_window_token&&delete l.call_window_token;I();A();break;case l.mini_panel_token:l.mini_panel_token&&delete l.mini_panel_token;break;default:break}};var S=function e(t){TS.utility.calls_log.logEvent({event:o.log_events.window_crashed,value:{token:t,cw_token:l.call_window_token,mp_token:l.mini_panel_token,ic_token:l.incoming_call_token}});if(t!==l.last_call_window_token&&t!==l.call_window_token)return;P();J();delete l.call_window_token;TS.utility.calls_log.logEvent({event:o.log_events.previous_crash});I();A()};var T=function e(t){if(t!==l.call_window_token)return;if(l.is_publisher_screensharing)return;TSSSB.call("hideWindow",l.mini_panel_token)};var v=function e(t){if(t!==l.call_window_token)return;U().then(function(e){e&&TSSSB.call("showWindowInactive",l.mini_panel_token)})};var b=function e(){TS.utility.calls_log.logInfo("client window unloaded!");E()};var y=function e(){TS.generic_dialog.start({title:TS.utility.calls.getPlatformErrorTitle(),body:TS.utility.calls.getPlatformErrorMessage(),show_cancel_button:true,go_button_text:TS.interop.i18n.t("Update Slack App","utility")(),onGo:function e(){var t="_"+Math.random();TS.utility.openInNewTab("https://slack.com/downloads",t)}})};var w=function e(){return _.get(window,"winssb.app.areTransparentWindowsSupported",true)};var k=function e(t){var n;if(!TS.utility.calls.isEnabled())return;if(!TS.utility.calls.platformHasCallsCode())return;if(l.call_window_token){B({message_type:TS.utility.calls.messages_to_call_window_types.start_call,args:{url:t}});TSSSB.call("focusWindow",l.call_window_token)}else{TS.metrics.mark("start_loading_call_window");n={url:t||l.calls_url_prefix,title:"",background:true,backgroundColor:"#2c2d30",width:o.call_window_dims.width,height:o.call_window_dims.height,minWidth:o.call_window_dims.min_width,minHeight:o.call_window_dims.min_height,hideMenuBar:true,windowType:"calls",show:true,no_spinner:true,hides_on_close:false};if(window.winssb){var r=TSSSB.call("getAppDisplay");n.x=r.bounds.x+(r.bounds.width-o.call_window_dims.width)/2;n.y=r.bounds.y+(r.bounds.height-o.call_window_dims.height)/2}l.call_window_token=TS.client.windows.openWindow(n);TS.utility.calls_log.logInfo("_startCallWindow: returned token: ",l.call_window_token);l.injection_url_promise=new Promise(function(e){l.injection_url_resolver=e})}l.injection_url_promise.then(function(){C();M()})};var x=function e(){if(!l.call_window_token)return;P();var t=l.call_window_token;delete l.call_window_token;TSSSB.call("closeWindow",t);TS.info("Call window closed after Janus disconnect",t)};var C=function e(){if(!window.winssb||l.mini_panel_token)return;var t=TSSSB.call("getDisplayForWindow",l.call_window_token);var n={x:t.bounds.x+(t.bounds.width-o.mini_panel_dims.x_offset-o.mini_panel_dims.width),y:t.bounds.y+o.mini_panel_dims.y_offset,width:o.mini_panel_dims.width,height:o.mini_panel_dims.height,minWidth:o.mini_panel_dims.min_width,minHeight:o.mini_panel_dims.min_height,hideMenuBar:true,resizable:false,alwaysOnTop:true,frame:false,windowType:"calls_mini_panel",show:false,useContentSize:true,skip_css:true,skipTaskbar:true,fullscreenable:false};TS.model.is_mac&&w()&&(n.transparent=true);n.content_html=TS.templates.calls_minipanel({is_linux:TS.model.is_lin,is_screenhero_disabled_by_admin:!TS.prefs.getTeamPref("allow_calls_interactive_screen_sharing"),locale:TS.interop.i18n.locale,no_border:!TS.model.is_mac,js_urls:l.injection_urls?l.injection_urls.calls_mini_panel.js:[],css_urls:l.injection_urls?l.injection_urls.calls_mini_panel.css:[]});l.mini_panel_token=TS.client.windows.openWindow(n);TSSSB.call("showWindowInactive",l.mini_panel_token);TSSSB.call("hideWindow",l.mini_panel_token)};var M=function e(){if(!l.screen_sharing_enabled||TS.model.is_lin)return;if(l.injection_urls)var t=l.injection_urls.calls_cursors.js;var n=TS.templates.calls_cursors({locale:TS.interop.i18n.locale,js_urls:t,css_urls:l.injection_urls?l.injection_urls.calls_cursors.css:[]});var r={width:0,height:0,windowType:"calls_cursors",transparent:true,alwaysOnTop:true,hideMenuBar:true,resizable:false,frame:false,useContentSize:true,skip_css:true,content_html:n,fullscreenable:false,enableLargerThanScreen:true,hasShadow:false,focusable:false,show:false,skipTaskbar:true};l.cursors_window_token=TS.client.windows.openWindow(r)};var I=function e(){if(!l.mini_panel_token)return;var t=l.mini_panel_token;delete l.mini_panel_token;TSSSB.call("closeWindow",t);TS.info("Mini panel window closed after call",t)};var A=function e(){if(!l.screen_sharing_enabled)return;if(!l.cursors_window_token)return;var t=l.cursors_window_token;delete l.cursors_window_token;TSSSB.call("closeWindow",t);TS.info("Cursors window closed after call",t)};var E=function e(){if(l.mini_panel_token){TSSSB.call("closeWindow",l.mini_panel_token);delete l.mini_panel_token}if(l.call_window_token){B({message_type:TS.utility.calls.messages_to_call_window_types.did_close_window});P();TSSSB.call("closeWindow",l.call_window_token);J();delete l.call_window_token}if(l.window_handle){l.window_handle.close();delete l.window_handle}};var P=function e(){L(false);N(false);if(l.send_interactive_mas_migration_slackbot_message_after_call&&"enabled"===TS.experiment.getGroup("calls_interactive_ss")){var t="TS.utility.calls.openMasMigrationDialog()";TS.client.msg_pane.addMaybeClick(t,TS.utility.calls.openMasMigrationDialog.bind(Object.create(null)));var n=TS.interop.i18n.t("To share control of your screen, you'll need to <javascript:{open_dialog_fn}|download the Slack app> directly from our website.","calls")({open_dialog_fn:t});TS.client.ui.addEphemeralBotMsg({text:n,type:"interactive_mas_migration"});l.send_interactive_mas_migration_slackbot_message_after_call=false}};var F=function t(n,r,i){if(!TS.utility.calls.isEnabled())return;var a=TS.shared.isRelevantTeam();if(!a)return;var s=false;var u=TS.redux.channels.getImByMemberId(i.caller);u&&u.id===l.call_channel&&(s=true);if(n||r||s){TS.utility.calls.sendInvitationResponseToCaller({user_id:i.caller,room_id:i.room,response:s?TS.utility.calls.invite_response_types.accept:TS.utility.calls.invite_response_types.on_call,currently_calling_caller:s});return}if(TS.dnd.isMemberInDnd(TS.model.user)){TS.utility.calls.sendInvitationResponseToCaller({user_id:i.caller,room_id:i.room,response:TS.utility.calls.invite_response_types.dnd});return}var d=TS.interop.members.getMemberById(i.caller);var c=Promise.resolve(d);d||(c=e.call("users.info",{user:i.caller,_x_reason:"incoming_calls"}).then(function(e){TS.members.legacyUpsertMember(e.data.user);d=TS.interop.members.getMemberById(i.caller)}));c.then(function(){var e=TS.interop.members.getPrefCompliantMemberName(d);ne("incoming_call_window_shown",i.room);if(TS.model.is_our_app){if(window.winssb){var t={width:o.incoming_call_window_dims.width,height:o.incoming_call_window_dims.height,hideMenuBar:true,resizable:false,alwaysOnTop:true,frame:false,windowType:"calls_incoming_call",show:false,skip_css:true,fullscreenable:false};TS.model.is_mac&&w()&&(t.transparent=true);var n=TS.templates.calls_incoming_call({caller:d,name:e,is_video_call:TS.model.supports_video_calls&&i.cameras_on>0,team:TS.model.team.name});t.content_html=TS.templates.calls_incoming_call_window({locale:TS.interop.i18n.locale,incoming_call_div:n,room_id:i.room,user_id:i.caller,no_border:!TS.model.is_mac,css_urls:TS.boot_data.electron_window_injection_urls?TS.boot_data.electron_window_injection_urls.calls_incoming_call.css:[]});l.incoming_call_token=TS.client.windows.openWindow(t)}}else TS.incoming_call.start({caller:d,name:e,is_video_call:TS.model.supports_video_calls&&i.cameras_on>0,onAccept:function e(t){TS.utility.calls.sendInvitationResponseToCaller({user_id:i.caller,room_id:i.room,response:TS.utility.calls.invite_response_types.accept,did_choose_video:t})},onReject:function e(){TS.utility.calls.sendInvitationResponseToCaller({user_id:i.caller,room_id:i.room,response:TS.utility.calls.invite_response_types.reject})},onTimeout:function e(){},onShow:function e(){O()},onEnd:function e(){D()}});l.incoming_caller_info={user_id:i.caller,room_id:i.room}})};var O=function e(){TS.sounds.play("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{should_loop:true,ignore_mute:true});l.incoming_ring_timer=setTimeout(function(){TS.utility.calls_log.logEvent({event:o.log_events.incoming_call_timeout});TS.utility.calls.closeIncomingCallWindow()},o.INCOMING_RING_TIMEOUT_MSECS);l.in_incoming_call=true;Q()};var D=function e(){TS.sounds.stop("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{ignore_mute:true});if(l.incoming_ring_timer){clearTimeout(l.incoming_ring_timer);delete l.incoming_ring_timer}delete l.in_incoming_call;delete l.incoming_caller_info;ie();X()};var H=function e(){if(!TS.model.is_our_app||!TSSSB.call("supportsIncomingCallWindowStatus"))return Promise.resolve(!!l.in_incoming_call);return TSSSB.call("isIncomingCallWindowBusy")};var B=function e(t){if(TS.model.is_our_app){var n=l.call_window_token;if(!n){TS.utility.calls_log.logEventWarn({event:o.log_events.send_msg_no_call_window,value:t});return}window.winssb&&window.winssb.window&&window.winssb.window.postMessage(t,n)}else if(l.window_handle)try{l.window_handle.postMessage(t,"*")}catch(e){"DataCloneError"==e.name?l.window_handle.postMessage(_.cloneDeep(t),"*"):TS.error("Unexpected failure in sending a post message:",e.name)}};var j=function e(t){if(!l.mini_panel_token){TS.utility.calls_log.logEventWarn({event:o.log_events.send_msg_no_mini_panel,value:t});return}window.winssb&&window.winssb.window&&window.winssb.window.postMessage(t,l.mini_panel_token)};var R=function e(){if(!l.call_window_loaded)return;B({message_type:TS.utility.calls.messages_to_call_window_types.reachability,online:l.is_reachability_online})};var L=function e(t){TS.utility.calls_log.logEvent({event:o.log_events.call_window_loaded,value:{is_loaded:t}});l.call_window_loaded=t;K();t&&TS.metrics.getLatestMark("start_loading_call_window")&&TS.metrics.measureAndClear("calls_desktop_window_loading_time","start_loading_call_window");R()};var N=function e(t){TS.utility.calls_log.logEvent({event:o.log_events.call_window_busy,value:{is_busy:t}});l.is_call_window_busy=t;if(t){Y();l.accepted_caller_id&&B({message_type:TS.utility.calls.messages_to_call_window_types.caller_id,args:{caller_id:l.accepted_caller_id}});l.cached_invite_cancel&&B({message_type:TS.utility.calls.messages_to_call_window_types.invite_cancel,cancel_type:l.cached_invite_cancel.cancel_type,user_id:l.cached_invite_cancel.user_id,room_id:l.cached_invite_cancel.room_id})}else{ie();J();l.call_channel=void 0;l.is_publisher_screensharing=false;l.is_publisher_screenhero=false}l.accepted_caller_id&&delete l.accepted_caller_id;l.cached_invite_cancel&&delete l.cached_invite_cancel};var U=function e(){if(!TS.model.is_our_app||!TSSSB.call("supportsCallWindowStatus"))return Promise.resolve(!!l.is_call_window_busy);return TSSSB.call("isCallWindowBusy")};var q=function e(t,n,r){r=r||{};t+="?_fast_members=1&_end_call_sound=1"+(r.start_with_video?"&_start_with_video=1":"");TS.pri&&(t+="&pri="+TS.pri);TS.qs_args._calls_halt_at_loading_screen&&(t+="&_calls_halt_at_loading_screen=1");TS.qs_args.locale&&(t+="&locale="+TS.qs_args.locale);TS.qs_args.js_path&&(t+="&js_path="+encodeURIComponent(TS.qs_args.js_path));TS.utility.calls.promiseToGetRegions(n).then(function(e){TS.utility.calls.promiseToGetServer(e,n).then(function(e){TS.utility.calls.dummyMediaServerRequest(e.data.hostname,e.data.port)})});TS.model.is_our_app?k(t):l.window_handle=window.open(t,n);l.call_channel=n};var G=function e(t,n){if(!TS.model.supports_voice_calls&&!TS.utility.calls.platformHasCallsCode()){y();return}if(!TS.utility.calls.isCallWindowReady())return;U().then(function(e){if(e){z();return}TS.utility.calls_log.logEvent({event:o.log_events.join_call,value:{room_id:t,start_with_video:n}});ne("call_accepted_by_user",t);re("incoming_call_window_shown_to_accepted_time","incoming_call_window_shown",t);q(l.calls_url_prefix+t,t,{start_with_video:n})})};var W=function e(t){var n;n=t?TS.interop.i18n.t("You\u2019re already in a call on another workspace ({team_name})","utility")({team_name:t}):TS.interop.i18n.t("You\u2019re already in a call on another workspace","utility")();TS.generic_dialog.start({title:n,body:'<p class="no_bottom_margin">'+TS.interop.i18n.t("You can only be in one call at a time. Please end that call and try again.","utility")()+"</p>",go_button_text:TS.interop.i18n.t("OK","utility")(),show_cancel_button:false})};var z=function e(){TS.utility.calls_log.logInfo("_handleAlreadyInCall");if(!TS.model.is_our_app){l.window_handle.focus();return}if(!TSSSB.call("supportsCallWindowStatus")){TSSSB.call("focusWindow",l.call_window_token);return}TSSSB.call("getCallWindowTeamId",{cb:function e(t){t===TS.model.team.id?TSSSB.call("focusWindow",l.call_window_token):TSSSB.call("getCallWindowTeamName",{cb:function e(t){W(t)}})}})};var K=function e(){TS.utility.calls.platformHasCallsCode()?TS.client.msg_pane.setCallButtonState(TS.utility.calls.isCallWindowReady()):TS.client.msg_pane.setCallButtonState(true)};var V=function e(t){if(!l.mini_panel_token){TS.utility.calls_log.logEventWarn({event:o.log_events.no_mini_panel_in_update});return}j({message_type:TS.utility.calls.messages_to_mini_panel_types.update_state,mini_panel_state:t})};var Y=function e(){if(!TS.model.is_our_app)return;TSSSB.call("setCallWindowBusy",{is_busy:true});TSSSB.call("setCallWindowToken",{token:l.call_window_token});TSSSB.call("setCallWindowTeamId",{team_id:TS.model.team.id});TSSSB.call("setCallWindowTeamName",{team_name:TS.model.team.name})};var J=function e(){if(!TS.model.is_our_app)return;if(!TSSSB.call("supportsCallWindowStatus"))return;var t=String(l.call_window_token);TSSSB.call("getCallWindowToken",{cb:function e(n){if(n!==t)return;TSSSB.call("setCallWindowBusy",{is_busy:false});TSSSB.call("clearCallWindowToken");TSSSB.call("clearCallWindowTeamId");TSSSB.call("clearCallWindowTeamName")}})};var Q=function e(){if(!TS.model.is_our_app)return;if(!TSSSB.call("supportsIncomingCallWindowStatus"))return;TSSSB.call("setIncomingCallWindowBusy",{is_busy:true});l.incoming_call_token&&TSSSB.call("setIncomingCallWindowToken",{token:l.incoming_call_token});TSSSB.call("setIncomingCallWindowTeamId",{team_id:TS.model.team.id});TSSSB.call("setIncomingCallWindowTeamName",{team_name:TS.model.team.name})};var X=function e(){var t=function e(){TSSSB.call("setIncomingCallWindowBusy",{is_busy:false});TSSSB.call("clearIncomingCallWindowToken");TSSSB.call("clearIncomingCallWindowTeamId");TSSSB.call("clearIncomingCallWindowTeamName")};if(!TS.model.is_our_app)return;if(!l.incoming_call_token){t();return}var n=String(l.incoming_call_token);TSSSB.call("getIncomingCallWindowToken",{cb:function e(r){if(r!==n)return;t()}})};var Z=function e(t,n,r,i){$.ajax({timeout:2e3,type:"POST",url:t+"/"+n,async:true,cache:false,contentType:"application/json",headers:{Authorization:"Basic "+btoa(":"+r)},data:JSON.stringify({janus:"destroy",transaction:i}),dataType:"json"})};var ee=function e(t){_(window.desktop.window.state.windows).filter({subType:t}).map("id").each(function(e){return desktop.window.toggleDevTools({window_token:e})})};var te=function e(t){re("dm_call_initiated_to_usable_time","call_initiated_by_user",t);re("dm_call_accepted_to_usable_time","call_accepted_by_user",t)};var ne=function e(t,n){TS.metrics.mark(t);s[t]=n};var re=function e(t,n,r){if(s[n]==r){TS.metrics.measureAndClear(t,n);s[n]=void 0}};var ie=function e(){TS.metrics.clearMarks("call_initiated_by_user");TS.metrics.clearMarks("call_accepted_by_user");TS.metrics.clearMarks("incoming_call_window_shown");TS.metrics.clearMarks("start_loading_call_window")};var ae=function e(t){if(!t||!t.data||!t.data.message_type){TS.utility.calls_log.logEvent({event:o.log_events.invalid_msg_from_child_window,value:t});return}if(!TS.model.is_our_app&&!TS.utility.calls.verifyOriginUrl(t.origin))return;if(t.data.origin_window_type===TS.utility.calls.window_types.call_window)switch(t.data.message_type){case TS.utility.calls.messages_from_call_window_types.update_mini_panel:V(t.data.mini_panel_state);t.data.mini_panel_state.hidden&&TSSSB.call("hideWindow",l.mini_panel_token);break;case TS.utility.calls.messages_from_call_window_types.set_call_window_loaded:L(t.data.is_loaded);R();break;case TS.utility.calls.messages_from_call_window_types.set_call_window_busy:N(t.data.is_busy);break;case TS.utility.calls.messages_from_call_window_types.show_growl_notification:"nothing"!==TS.notifs.getGlobalNotificationSetting()&&TS.ui.growls.show(t.data.title,t.data.txt,null,{subtitle:t.data.subtitle,sound_name:"none",channelId:t.data.channel,is_call_notification:true});break;case TS.utility.calls.messages_from_call_window_types.set_is_publisher_screensharing:l.is_publisher_screensharing=t.data.is_enabled;l.is_publisher_screenhero=t.data.is_screenhero;l.is_publisher_screensharing&&TSSSB.call("showWindowInactive",l.mini_panel_token);break;case TS.utility.calls.messages_from_call_window_types.close:x();I();A();break;case TS.utility.calls.messages_from_call_window_types.restart_cursors_window_if_open:if(l.cursors_window_token){A();M()}break;case TS.utility.calls.messages_from_call_window_types.hide_call_window:TSSSB.call("hideWindow",l.call_window_token);break;case TS.utility.calls.messages_from_call_window_types.get_calls_status:U().then(function(e){TSSSB.call("getCallWindowTeamName",{cb:function t(n){B({message_type:TS.utility.calls.messages_to_call_window_types.calls_status,is_busy:e,team_name:n})}})});break;case TS.utility.calls.messages_from_call_window_types.force_janus_disconnect:Z(t.data.server,t.data.session_id,t.data.token,t.data.transaction_id);break;case TS.utility.calls.messages_from_call_window_types.get_regions:TS.utility.calls.promiseToGetRegions(t.data.id).then(function(e){B({message_type:TS.utility.calls.messages_to_call_window_types.regions,regions:e})});break;case TS.utility.calls.messages_from_call_window_types.get_server:var n=t.data.id;var r=t.data.regions;TS.utility.calls.promiseToGetServer(r,n).then(function(e){B({message_type:TS.utility.calls.messages_to_call_window_types.got_server,data:e.data});TS.utility.calls.clearServerPromise(n)}).catch(function(e){TS.utility.calls.clearServerPromise(n);B({message_type:TS.utility.calls.messages_to_call_window_types.got_server_error,error:e.data?e.data.error:null})});break;case TS.utility.calls.messages_from_call_window_types.get_member_data:TS.interop.members.ensureMembersArePresent([t.data.user_id]).then(function(){B({reply_to:t.data.message_id,message_type:t.data.message_type,message:{user_id:t.data.user_id,member:TS.interop.members.getMemberById(t.data.user_id)}})});break;case TS.utility.calls.messages_from_call_window_types.play_sound:TS.sounds.play("call/"+t.data.sound+"_"+TS.boot_data.call_sounds_version+".mp3");break;case TS.utility.calls.messages_from_call_window_types.launch_dev_tools_mini_panel:TS.model.is_our_app&&ee("calls_mini_panel");break;case TS.utility.calls.messages_from_call_window_types.launch_dev_tools_cursors:TS.model.is_our_app&&ee("calls_cursors");break;case TS.utility.calls.messages_from_call_window_types.send_interactive_mas_migration_slackbot_message_after_call:l.send_interactive_mas_migration_slackbot_message_after_call=true;break;case TS.utility.calls.messages_from_call_window_types.update_injection_urls:l.injection_urls=t.data.urls;l.injection_url_resolver();break;case TS.utility.calls.messages_from_call_window_types.dm_call_is_usable:te(t.data.id);break;default:TS.utility.calls_log.logEvent({event:o.log_events.unknown_msg_from_call_window,value:t});break}else if(t.data.origin_window_type===TS.utility.calls.window_types.incoming_call)switch(t.data.message_type){case TS.utility.calls.messages_from_incoming_call_types.user_clicked_accept_or_reject:TS.utility.calls_log.logEvent({event:o.log_events.incoming_call_click,value:t.data});TS.utility.calls.sendInvitationResponseToCaller({user_id:t.data.user_id,room_id:t.data.room_id,response:t.data.did_accept?TS.utility.calls.invite_response_types.accept:TS.utility.calls.invite_response_types.reject,did_choose_video:t.data.did_choose_video});var i=true;TS.utility.calls.closeIncomingCallWindow(i);break;default:TS.utility.calls_log.logEvent({event:o.log_events.unknown_msg_from_incoming_call_window,value:t});break}else if(t.data.origin_window_type===TS.utility.calls.window_types.mini_panel)switch(t.data.message_type){case TS.utility.calls.messages_from_mini_panel_types.user_clicked_action:TS.utility.calls_log.logEvent({event:o.log_events.mini_panel_click,value:t.data});"mute"===t.data.action||"leave"===t.data.action||"screenhero"===t.data.action||"stop_screenshare"===t.data.action||"doodle"===t.data.action?B({message_type:TS.utility.calls.messages_to_call_window_types.mini_panel_action,action:t.data.action}):"activate"===t.data.action&&TSSSB.call("showWindow",l.call_window_token);break;default:TS.utility.calls_log.logEvent({event:o.log_events.unknown_msg_from_mini_panel,value:t});break}}})()},11277:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("utility.contenteditable",{create:function e(t,n){n||(n={});t=d(t);if(!t)return;if(c(t))return;if(f(t))return;var r={modules:{tabcomplete:{searchOptions:{complete_member_specials:true},appendMenu:function e(t){$("body").prepend(t)},render:TS.tabcomplete.render,trailingPunctuationChars:TS.interop.texty.TRAILING_PUNCTUATION_CHARACTERS,shouldCompleteOnTab:function e(){return!TS.i18n.sendButtonEnabled()},onRender:function e(){TS.tips.texty.hide()}},textsubstitutions:{getTextPreferences:function e(){if($("#chat_input_tab_ui").length)return{substitutions:{}};return TS.interop.utility.getSystemTextPreferences()}},clipboard:{hasTeamClipboardData:function e(t){return t&&t.clipboardData&&t.clipboardData.getData("slack/"+TS.model.team.id)},onPaste:function e(n){var r=TS.utility.contenteditable.paste(t,n);var i=t.id;r?TS.interop.console.info("CONTENTEDITABLE","Did paste in "+i):TS.interop.console.info("CONTENTEDITABLE","Did not paste in "+i);return r}},keyboard:{featureReactMessages:TS.boot_data.feature_react_messages,featureFileThreads:TS.boot_data.feature_file_threads,useFormattingCommands:TS.boot_data.feature_texty_formatting_commands}},onEnter:function e(){if(TS.boot_data.feature_file_threads)return false;return true},onEscape:function e(){if(TS.boot_data.feature_file_threads)return false;return true},onTab:function e(){return true},singleLineInput:false,inlineEmojiIsEnabled:TS.utility.contenteditable.inlineEmojiIsEnabled,convertEmoticonsIsEnabled:function e(){return TS.prefs.getPref("convert_emoticons")},isJumbomojiEnabled:false,onTextChange:_.noop,useTextChangeQueue:TS.boot_data.feature_texty_change_queue,useLists:TS.boot_data.feature_texty_formatting_commands,className:"texty_legacy",attributes:{role:"textbox",tabindex:0,"aria-multiline":true,"aria-autocomplete":"list","aria-expanded":false,"aria-owns":"chat_input_tab_ui"},log:_.partial(TS.log,116),logError:TS.error};var i={complete_member_specials:r.modules.tabcomplete.searchOptions.complete_member_specials,no_model_ob:_.get(n,"modules.tabcomplete.no_model_ob"),model_ob:_.get(n,"modules.tabcomplete.searchOptions.model_ob")};_.get(n,"modules.tabcomplete.searchOptions")&&n.modules.tabcomplete.searchOptions.hasOwnProperty("complete_member_specials")&&(i.complete_member_specials=n.modules.tabcomplete.searchOptions.complete_member_specials);r.modules.slackmention={processPotentialMentions:_.debounce(function(){S(t,i)},100)};_.defaultsDeep(n,r);if(n.modules&&n.modules.tabcomplete){n.modules.tabcomplete.completers||(n.modules.tabcomplete.completers=["channels","commands","emoji","members"]);n.modules.tabcomplete.completers=_.compact(n.modules.tabcomplete.completers.map(function(e){if("channels"===e)return TS.tabcomplete.channels;if("commands"===e)return TS.tabcomplete.commands;if("emoji"===e)return TS.tabcomplete.emoji;if("members"===e)return TS.tabcomplete.members;TS.error("TEXTY","Invalid completer passed to texty");return null}))}var s=n.onEnter;n.onEnter=function(e){if(!n.singleLineInput&&g(e,t))return true;if(_.isFunction(s))return s(e);return false};if(!n.singleLineInput){var o=n.onTextChange;n.onTextChange=function(e){a||TS.tips.texty.hide();o(e)}}var l=new TS.interop.texty.TextyClass(t,n);p(t,l);return l},inlineEmojiIsEnabled:function e(){if(!TS.prefs.prefs_loaded)return"as_text"!==TS.boot_data.pref_emoji_mode;return!TS.interop.rules.emoji.shouldRenderEmojiAsText()},isJumbomojiEnabled:function e(){if(!TS.prefs.prefs_loaded)return TS.utility.contenteditable.inlineEmojiIsEnabled()&&!!TS.boot_data.pref_jumbomoji&&"dense"!==TS.boot_data.pref_messages_theme;return TS.utility.contenteditable.inlineEmojiIsEnabled()&&TS.prefs.getPref("jumbomoji")&&"dense"!==TS.prefs.getPref("theme")},refreshJumbomoji:function e(t){t=d(t);if(!t)return;if(!m(t))return;var n=f(t);n&&n.refreshJumbomoji()},refreshContents:function e(t){t=d(t);if(!t)return;if(!m(t))return;var n=f(t);if(n){var r=TS.utility.contenteditable.value(t);n.refreshContents(TS.interop.texty.convertContentsStringToContents(r,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText()))}},unload:function e(t){t=d(t);if(!t)return;if(!m(t))return;var n=f(t);if(n){n.unload();TS.useReactMessages()&&h(t)}},isActiveElement:function e(t){t=d(t);if(!t)return false;if(c(t))return document.activeElement===t;if(m(t)){var n=f(t);if(n.hasFocus())return true;return document.activeElement&&-1!=document.activeElement.className.indexOf("ql-clipboard")&&document.activeElement.parentNode===t}return false},focus:function e(t){t=d(t);if(!t)return;if(c(t))t.focus();else if(m(t)){var n=f(t);n.focus()}},hasFocus:function e(t){t=d(t);if(!t)return;if(c(t))return $(t).is(":focus");if(m(t)){var n=f(t);return n.hasFocus()}},blur:function e(t){t=d(t);if(!t)return;if(c(t))t.blur();else if(m(t)){var n=f(t);n.blur()}},isContenteditable:function e(t){t=d(t);if(t&&TS.ui&&TS.ui.paste&&TS.ui.paste.catcher_div&&TS.ui.paste.catcher_div===t)return false;if(t.isContentEditable)return true;if(m(t))return true;return false},disable:function e(t){t=d(t);if(!t)return;if(c(t))t.disabled=true;else if(m(t)){var n=f(t);n.disable()}},isDisabled:function e(t){t=d(t);if(!t)return;if(c(t))return true===t.disabled;if(m(t)){var n=f(t);return!n.isEnabled()}return false},enable:function e(t){t=d(t);if(!t)return;if(c(t))t.disabled=false;else if(m(t)){var n=f(t);n.enable();TS.utility.contenteditable.updateSpellCheck(t)}},isEnabled:function e(t){t=d(t);if(!t)return false;if(c(t))return true!==t.disabled;if(m(t)){var n=f(t);return n.isEnabled()}return false},value:function e(t,n){t=d(t);if(!t)return"";if(c(t)){_.isString(n)&&(t.value=n);return t.value}if(m(t)){var r=f(t);if(_.isString(n)){r.setContents(TS.interop.texty.convertContentsStringToContents(n,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText()));TS.utility.contenteditable.clearUnverifiedMentionsCache()}else if(_.isObject(n)){r.setContents(n);TS.utility.contenteditable.clearUnverifiedMentionsCache()}return TS.interop.texty.convertContentsToString(r.getContents())}return""},displayValue:function e(t){t=d(t);if(!t)return"";if(c(t))return t.value;if(m(t))return TS.interop.texty.convertContentsStringToDisplayString(TS.utility.contenteditable.value(t),TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());return""},getContentsForRange:function e(t,n,r){t=d(t);if(!m(t))return;var i=f(t);return i.getContentsForRange({index:n,length:r})},getLength:function e(t){t=d(t);if(!t)return 0;if(c(t))return t.value.length;if(m(t)){var n=f(t);return n.getLength()}return 0},getDisplayValueLength:function e(t){return TS.utility.contenteditable.displayValue(t).length},getTextForRange:function e(t,n,r){t=d(t);if(!t)return"";if(c(t)){var i=TS.utility.contenteditable.value(t);return i.substr(n,r)}if(m(t)){var a=f(t);return a.getTextForRange(n,r)}return""},getDisplayTextForRange:function e(t,n,r){t=d(t);if(!t)return"";if(c(t)){var i=TS.utility.contenteditable.value(t);return i.substr(n,r)}if(m(t)){var a=f(t);return TS.interop.texty.convertContentsToStringForDisplay({contents:a.getContentsForRange(n,r).ops})}return""},insertTextAtCursor:function e(t,n,r){t=d(t);if(!t)return;var i;if(c(t)){if(!_.isString(n))return t.value;i=TS.utility.contenteditable.cursorPosition(t);var a=TS.utility.contenteditable.value(t);var s=a.substr(0,i.start)+n+a.substr(i.start);t.value=s;if(r){TS.utility.contenteditable.focus(t);TS.utility.contenteditable.cursorPosition(t,i.start+n.length,0)}}else if(m(t)){var o=f(t);_.isString(n)&&o.insertTextAtCursor(n,r)}},insertContentsAtCursor:function e(t,n,r){t=d(t);if(!t)return;if(c(t))TS.utility.contenteditable.insertTextAtCursor(t,TS.interop.texty.convertContentsToString(n),r);else if(m(t)){var i=f(t);i.insertContentsAtCursor(n,r)}},updateContents:function e(t,n){t=d(t);if(!t)return;if(c(t))TS.warn("updateContents called on form element");else if(m(t)){var r=f(t);r.updateContents(n)}},paste:function e(t,n){t=d(t);if(!t)return false;if(c(t))return false;if(m(t)){var r;var i;if(n&&n.clipboardData&&n.clipboardData.getData("slack/plain")){n.preventDefault();r=n.clipboardData.getData("slack/plain");var a=n.clipboardData.getData("slack/texty");if(a&&TS.boot_data.feature_clipboard_contents){try{var s=JSON.parse(a);var o=b({contents:s.ops});TS.utility.contenteditable.insertContentsAtCursor(t,o,true)}catch(e){TS.logError("paste: could not insert pasted contents ("+e+")")}return true}if(r.length>l){n.stopPropagation();y(t);return true}i=TS.interop.texty.convertContentsStringToContents(r,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());i=b(i);TS.utility.contenteditable.insertContentsAtCursor(t,i,true);return true}r=TS.ui.paste.getPlainTextFromClipboard(n);if(!_.isEmpty(r)){n.preventDefault();if(r.length>l){n.stopPropagation();y(t);return true}TS.utility.contenteditable.insertTextAtCursor(t,r,true);return true}}return false},getFormats:function e(t,n){t=d(t);if(!t)return{};if(m(t)){var r=f(t);return r.getFormats(n)}return{}},isEmpty:function e(t,n){var r=TS.utility.contenteditable.value(t);r&&n&&(r=r.trim());return 0===r.length},clear:function e(t,n){t=d(t);if(!t)return;if(c(t))t.value="";else if(m(t)){TS.utility.contenteditable.clearUnverifiedMentionsCache();var r=f(t);r.clear({is_silent:!!n})}},placeholder:function e(t,n){t=d(t);if(!t)return"";var r;if(c(t)){_.isString(n)&&(""===n?t.removeAttribute("placeholder"):t.setAttribute("placeholder",n));r=t.getAttribute("placeholder")}else if(m(t)){var i=f(t);i.setPlaceholder(n);r=i.getPlaceholder()}return r||""},ariaLabel:function e(t,n){t=d(t);if(!t)return;if(m(t)){var r=f(t);r.setAriaLabel(n)}},cursorPosition:function e(t,n,r){_.isString(t)&&(t=$(t));var i;var a={start:0,end:0,length:0};t=d(t);if(!t)return a;if(_.isNumber(n)){r||(r=0);a.start=n;a.end=n+r;a.length=r;if(c(t))TS.selection.selectCharacters(t,a.start,a.end);else if(m(t)){i=f(t);i.setSelection(a.start,a.length)}}else{if(!TS.utility.contenteditable.isActiveElement(t)){var s=$(t).data("utility-contenteditable-cursor-position");if(_.isObject(s))return s}if(c(t)){t.focus();a.start=t.selectionStart;a.end=t.selectionEnd;a.length=Math.abs(t.selectionEnd-t.selectionStart)}else if(m(t)){i=f(t);var o=i.getSelection();if(o){a.start=o.index;a.length=o.length;a.end=a.start+a.length}}}return a},setCursorAtEnd:function e(t){var n=TS.utility.contenteditable.getLength(t);TS.utility.contenteditable.cursorPosition(t,n);t=d(t);if(!m(t))return;$(t).find(".ql-editor").get(0).scrollLeft=u},selectAll:function e(t){var n=TS.utility.contenteditable.getLength(t);TS.utility.contenteditable.cursorPosition(t,0,n)},isTextSelected:function e(t){t=d(t);if(!t)return;if(c(t))return!!(window.getSelection&&window.getSelection().toString());if(m(t)){var n=f(t);return n.getSelection().length>0}},deserialize:function e(t,r){if(!r)return;t=d(t);if(!t)return;if(c(t))t.value=r;else if(m(t)){if("object"===("undefined"===typeof r?"undefined":n(r))&&r.hasOwnProperty("contents")){TS.utility.contenteditable.value(t,r);return}if("string"!==typeof r)return;try{var i=JSON.parse(r);if(null!==i&&"object"===("undefined"===typeof i?"undefined":n(i))){TS.utility.contenteditable.value(t,i);return}}catch(e){}TS.utility.contenteditable.value(t,r)}},isCursorInPreBlock:function e(t){t=d(t);if(!t)return false;if(m(t)){var n=f(t);return n.isCursorInPreBlock()}return false},isIndexInCode:function e(t,n){t=d(t);if(!t)return false;if(m(t)){var r=f(t);return r.isIndexInCode(n)}return false},deleteSelection:function e(t){t=d(t);if(!t)return false;if(m(t)){var n=f(t);return n.deleteSelection()}window.getSelection().deleteFromDocument()},deleteText:function e(t,n,r){t=d(t);if(!t)return;if(m(t)){var i=f(t);i.deleteText(n,r)}},clogMentionCounts:function e(t){if(!t)return;var n=TS.interop.texty.convertContentsStringToContents(t,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());var r=0;var i=0;n.contents.forEach(function(e){e.attributes&&e.attributes.slackmention&&(e.attributes.slackmention.unverified?i+=1:r+=1)});(r>0||i>0)&&TS.interop.clog.track("MSG_SUBMITTED_MENTIONS",{num_mentions:r,num_unverified_mentions:i})},clearHistory:function e(t){t=d(t);if(!t)return false;var n=f(t);if(!n)return;n.clearHistory()},updateSpellCheck:function e(t){t=d(t);if(!t)return false;var n=f(t);if(!n)return;$(t).find("[contenteditable=true]").attr("spellcheck",!!(TS.client&&TS.prefs.getPref("webapp_spellcheck")))},synchronouslyReplacePotentialMentions:function e(t,n){n=_.defaults(n||{},{complete_member_specials:true});if(!t.length)return t;var r=[];var i=TS.interop.texty.convertContentsStringToContents(t,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());var a=TS.interop.texty.convertContentsStringToDisplayString(t,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());var s;n.complete_member_specials&&(s=TS.tabcomplete.members.getBroadcastKeywords(n.complete_member_specials));var o={usergroups:TS.interop.userGroups.getActiveUserGroups(),members:TS.members.getActiveMembersWithSelfAndSlackbot()};var l={allow_empty_query:false,frecency:false,limit:20,prefer_exact_match:true};TS.interop.texty.getPotentialMentionMatches(i).forEach(function(e){var t=e.label.replace(/^[@\uff20]/,"");if(!t.length)return;if(TS.interop.texty.isRangeInCode(a.substr(0,e.global_index)))return;var n=TS.interop.texty.getBroadcastMatch(s,t);if(n)r.push(TS.interop.texty.createPotentialMentionObject(e.text,e.label,e.global_index,e.local_index,[n]));else{var i=TS.sorter.search(t,o,l);if(i.length){var u=TS.interop.texty.createPotentialMentionObject(e.text,e.label,e.global_index,e.local_index,i);"UNVERIFIED"!==u.id&&r.push(u)}}});if(r.length){var u=TS.interop.texty.buildPotentialMentionsDelta(r,TS.model.user.id,TS.model.highlight_words);var d=new TS.interop.texty.Delta(i.contents).compose(new TS.interop.texty.Delta(u.contents));return TS.interop.texty.convertContentsToString({contents:d.ops})}return t},clearUnverifiedMentionsCache:function e(){s=[];o=[]},test:function e(){var e={_normalizeInput:d,_isFormElement:c};return e}});var e=["'",".","_","-","\u2018","\u2019"];var t=e.map(function(e){return"\\"+e}).join("");var r=new RegExp("^["+t+"]+$","g");var i=false;var a=null;var s=[];var o=[];var l=5e4;var u=1e4;var d=function e(t){if(!t)return false;t instanceof jQuery&&t[0]&&(t=t[0]);if(t.nodeType!==Node.ELEMENT_NODE)return false;if("textarea"===t.tagName.toLowerCase())return t;if("input"===t.tagName.toLowerCase())return t;if($(t).hasClass("ql-editor"))return t.parentNode;if(t.hasAttribute("contenteditable"))return t;if("DIV"===t.tagName)return t;return false};var c=function e(t){if(!t||!t.tagName)return false;if("textarea"===t.tagName.toLowerCase())return true;if("input"===t.tagName.toLowerCase())return true;return false};var m=function e(t){if(!t)return false;var n=f(t);if(n)return true;return false};var f=function e(t){return $(t).data("__ts_quill")};var p=function e(t,n){$(t).data("__ts_quill",n)};var h=function e(t){$(t).removeData("__ts_quill")};var g=function e(t,n){if(t.metaKey)return false;if(n&&TS.utility.contenteditable.isCursorInPreBlock(n)&&TS.prefs.getPref("enter_is_special_in_tbt"))return!t.shiftKey;if(t.ctrlKey&&!TS.model.is_mac&&TS.i18n.sendButtonEnabled())return false;if(TS.i18n.sendButtonEnabled())return true;if(t.shiftKey&&!(t.ctrlKey||t.altKey))return true;if(!t.shiftKey&&(t.ctrlKey||t.altKey))return true;return false};var S=function e(t,n){if($("#chat_input_tab_ui").length)return;var a=TS.utility.contenteditable.value(t);var s=TS.utility.contenteditable.cursorPosition(t);if(!a.length)return;var o=TS.interop.texty.convertContentsStringToContents(a,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());var l=[];var u=[];var d;n.complete_member_specials&&(d=TS.tabcomplete.members.getBroadcastKeywords(n.complete_member_specials));TS.interop.texty.getPotentialMentionMatches(o).forEach(function(e){var n=e.label.replace(/^[@\uff20]/,"");if(!n.length)return;if(!(s.start>e.global_index&&s.start<=e.global_index+e.match_length)&&-1===n.search(r)&&!TS.utility.contenteditable.isIndexInCode(t,e.global_index)){var i=TS.interop.texty.getBroadcastMatch(d,n);i?l.push(TS.interop.texty.createPotentialMentionObject(e.text,e.label,e.global_index,e.local_index,[i])):u.push(e.label)}});u=_.uniq(u);i=1===u.length;v(t,l);T(t,u,n)};var T=function e(t,n,r){_.pullAll(n,s);_.pullAll(n,o);if(!n.length)return;var l;r.no_model_ob||(l=r.model_ob||TS.shared.legacyGetActiveModelOb());n.forEach(function(e){o.push(e);var n={query:e.replace(/^[@\uff20]/,""),max_api_results:20,include_org:true,include_slackbot:true,include_self:true,full_profile_filter:false,limit_by_model_relevancy:l};TS.members.promiseToSearchMembers(n).then(function(n){var r={usergroups:TS.interop.userGroups.getActiveUserGroups(),members:n&&n.items?n.items:[]};var l={allow_empty_query:false,frecency:false,limit:20,prefer_exact_match:true};var u=TS.sorter.search(e,r,l);if(!u.length){s.push(e);return}var d=[];var c=TS.utility.contenteditable.value(t);var m=TS.utility.contenteditable.cursorPosition(t);var f=TS.interop.texty.convertContentsStringToContents(c,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText());TS.interop.texty.getPotentialMentionMatches(f).forEach(function(n){if(n.label!==e)return;if(!n.label.replace(/^[@\uff20]/,"").length)return;m.start>n.global_index&&m.start<=n.global_index+n.match_length||TS.utility.contenteditable.isIndexInCode(t,n.global_index)||d.push(TS.interop.texty.createPotentialMentionObject(n.text,n.label,n.global_index,n.local_index,u))});v(t,d);var p=o.length;_.pull(o,e);var h=o.length;if(i&&1===p&&0===h&&1===d.length&&"UNVERIFIED"!==d[0].id){var g=$(t).find("ts-mention[data-id="+d[0].id+"]");if(1===g.length&&$(g[0]).offset().top>=$(t).offset().top){TS.tips.texty.show(g[0],true);a=setTimeout(function(){TS.tips.texty.hide();a=null},1500)}}0===h&&(i=false)})})};var v=function e(t,n){if(!n.length)return;var r=TS.interop.texty.buildPotentialMentionsDelta(n,TS.model.user.id,TS.model.highlight_words);TS.utility.contenteditable.updateContents(t,r)};var b=function e(t){t.contents=t.contents.map(function(e){if(e.attributes&&e.attributes.slackmention&&!TS.interop.members.getMemberById(e.attributes.slackmention.id)&&!TS.interop.userGroups.getUserGroupById(e.attributes.slackmention.id)&&-1===TS.interop.constants.MENTION_BROADCAST_KEYWORDS.indexOf(e.attributes.slackmention.id))return{insert:e.insert};return e});return t};var y=function e(t){var n=TS.interop.i18n.t("That\u2019s a bit too long to paste","msg_input")();var r=TS.interop.i18n.t("To keep things running smoothly, there\u2019s a limit on the number of characters you can paste into Slack. If you\u2019d like you could <b>create a snippet</b> instead.","msg_input")();r='<p class="no_bottom_margin">'+r+"</p>";TS.generic_dialog.start({title:n||"",body:r,show_cancel_button:false,esc_for_ok:true,fullscreen:false,go_button_text:TS.interop.i18n.t("OK","msg_input")(),show_secondary_go_button:t===TS.client.msg_input.$input.get(0),secondary_go_button_text:TS.interop.i18n.t("Create a snippet","msg_input")(),secondary_go_button_class:"btn_outline",onSecondaryGo:function e(){TS.ui.snippet_dialog.startCreate()}})}})()},11278:function(e,t){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};(function(){TS.registerModule("utility.attachments",{hasContent:function t(n,r){if(!n)return false;_.isArray(r)||(r=[].concat(r));if(TS.attachment_actions.client_buttons.isClientButtonAttachment(n))return true;var i=_.difference(e,r);return _.some(i,function(e){return!_.isEmpty(n[e])})},getMediaSource:function e(t){if(!t)return;var n=TS.utility.attachments.getMediaType(t);switch(n){case"video":return t.thumb_url;case"audio":return t.audio_html||t.audio_url;case"other":return t.other_html;case"image":return t.image_url;default:break}return t.from_url},getMediaType:function e(t){if(!t)return;if(t.video_html)return"video";if(t.audio_html||t.audio_url)return"audio";if(t.other_html)return"other";if(t.image_url)return"image"},getDecoratedAttachment:function e(t,n){var r=_.cloneDeep(t);r=i(r);r._source=a(r);s(r)?r=o(r,n):"twitter"===r.service_name?r=l(r):"salesforce"===r.service_name&&(r=u(r));if(r.is_app_unfurl&&r.bot_id){var c=TS.interop.bots.getBotById(r.bot_id);if(c){r._attribution=c.name;r._attribution_link="/services/"+r.bot_id}}if(r._source.icon){var m=d(r._source.icon);r._source.icon=m.src;r._source.icon_srcset=m.srcset}if(r.footer_icon){var f=d(r.footer_icon);r.footer_icon=f.src;r.footer_icon_srcset=f.srcset}return r},getSlackMessageFooterText:function e(t,n,r){if(!s(t))return"";var i=t.channel_name;var a=t.channel_id;!a&&t.from_url&&(a=TS.utility.getChannelNameFromUrl(t.from_url));var o=TS.redux.channels.getEntityById(a)||TS.redux.channels.getPublicChannelByName(a);!i&&o&&(i=_.escape(o.name));var l=n.source_team_id&&TS.teams.getTeamNameById(n.source_team_id);var u='<a class="channel_link_unfurl_footer" data-channel-id='+a+" data-channel-name="+i+' target="_blank" href='+t.from_url+">#"+i+"</a>";if(i){if("Direct Message"===i||o&&(o.is_im||o.is_mpim))return TS.interop.i18n.t("Direct message","attachments")();if(TS.interop.messages.isReply(n)||t.is_reply_unfurl){if(r)return TS.interop.i18n.t("From a thread in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(u)});return TS.interop.i18n.t("From a thread in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(i)})}if(n.thread_ts||t.is_thread_root_unfurl){if(r)return TS.interop.i18n.t("Thread in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(u)});return TS.interop.i18n.t("Thread in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(i)})}if(r)return TS.interop.i18n.t("Posted in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(u)});return TS.interop.i18n.t("Posted in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(i)})}if(l)return TS.interop.i18n.t("From {team_name}","attachments")({team_name:l});return TS.interop.i18n.t("From another workspace","attachments")()},getMediaCaretLocation:function e(n){var r=_.find(t,function(e){return _.some(n[e])});return r||"end"},isAutomatedSlackUnfurl:function e(t){return!!t&&s(t)&&TS.interop.rules.messages.isAutomatedSubtype(t.msg_subtype)},formatMessageAttachmentPart:function e(t,n,r,i,a,s){if(n){r&&TS.interop.rules.messages.isAutomatedSubtype(n.subtype)&&(r=false);if(r&&!_.isEmpty(n.attachments)){var o=n.attachments.some(TS.utility.attachments.isAutomatedSlackUnfurl);o&&(r=false)}}true===s&&(t=_.escape(t));var l=TS.format.formatWithOptions(t,n,{no_highlights:true!==r,no_specials:true!==i,enable_slack_action_links:true===a});l=TS.utility.msgs.handleSearchHighlights(l);return l},findAttachment:function e(t){if(!t)return;var n=TS.utility.msgs.findMsg(t.message_ts,t.channel_id);if(!n)return;return _.find(n.attachments,{id:t.attachment_id})},unfurlPlaceholders:function e(t){t.find(".unfurl-placeholder:not(.unfurled)").each(function(e,t){var n=$(t);n.addClass("unfurled");var i=_.uniqueId("pending_unfurl_");n.attr("id",i);try{var a=n.attr("href");TS.api.call("chat.unfurlLink",{url:a}).then(function(e){if(!(e&&e.data&&e.data.attachments&&e.data.attachments[a]))throw new Error("No unfurl data");var t=e.data.attachments[a];var n=$("#"+i);if(!n.length)return;if(false===TS.prefs.getPref("a11y_animations")&&"gif"===t.file_type)return;var s=TS.inline_attachments.renderStandaloneAttachment(t);if(TS.client&&TS.client.ui){var o=TS.client.ui.areMsgsScrolledToBottom();n.replaceWith(s);if(void 0!==o){TS.pri&&TS.log(888,"unfurlPlaceholders: Insta-scrolling back to bottom after unfurl of attachment #"+i);TS.client.ui.instaScrollMsgsToBottom(false)}r()}else{var l=n.closest(".unfurl-container");n.replaceWith(s);l.wrap('<div class="unfurl"></div>');l.removeClass("unfurl-render-pending")}}).catch(function(){$("#"+i).addClass("hidden")})}catch(e){n.addClass("hidden")}});r()},test:function e(){var e={};Object.defineProperty(e,"_isSlackMessageUnfurl",{get:function e(){return s},set:function e(t){s=t}});return e}});var e=["title","text","pretext","video_html","audio_html","audio_url","other_html","from_url","fields","actions","image_url","thumb_url","author_name","service_name","footer","footer_icon","ts"];var t=["ts","footer","fields","text","title","_source"];var r=_.throttle(function(){TS.client&&TS.client.ui&&TS.client.ui.checkInlineImgsAndIframes("file_preview")},150);var i=function e(t){if(t.author_id&&!t.author_name){var n=TS.redux.members.getPotentiallyUnknownMemberById(t.author_id);if(!n||n.is_non_existent){t.author_name=TS.interop.i18n.t("Private user info","member_token")();t.author_icon=cdn_url+"/436da/img/unknown_avatar.png"}else if(n.is_unknown);else{t.author_name=TS.interop.members.getPrefCompliantMemberName(n);t.author_link="/team/"+n.id;n.profile&&(t.author_icon=n.profile.image_24)}}return t};var a=function e(t){var n={};n.icon=t.service_icon||t.author_icon;n.name=t.service_name||t.author_name;n.link=t.service_url||t.author_link;n.author_name=t.author_name==n.name?t.author_subname:t.author_name;n.author_link=t.author_link;return n};var s=function e(t){if(t.is_msg_unfurl)return true;if(t.from_url&&/slack\.com\/archives\/.+\/p.+/.test(t.from_url)){t.is_msg_unfurl=true;return true}};var o=function e(t,n){if(t.author_link){var r=TS.utility.getMemberIdFromURL(t.author_link);var i=TS.interop.utility.getBotIdFromUrl(t.author_link);r&&(t._slack_author_id=r);i&&(t._slack_bot_id=i)}n&&"pinned_item"===n.subtype&&(t.from_url=TS.utility.msgs.constructAbsoluteMsgPermalink(TS.shared.legacyGetActiveModelOb(),t.ts));t._is_automated_unfurl=TS.utility.attachments.isAutomatedSlackUnfurl(t);t.color=null;_.set(t,"mrkdwn_in_hash.text",true);TS.interop.members.shouldDisplayRealNames()?t._source.name=t.author_name||t.author_subname:t._source.name=t.author_subname||t.author_name;t._source.author_name=null;t._source.author_link=null;t._unfurl_type_message=true;if(!t.footer){var a=TS.utility.attachments.getSlackMessageFooterText(t,n);a&&(t.footer=a)}return t};var l=function e(t){t._source.name=t.author_name;t._source.link="https://twitter.com/"+t.author_subname;t._source.author_name=t.author_subname;t._source.author_link=t._source.link;t._unfurl_type_message=true;t.footer||(t.footer=TS.interop.i18n.t("Twitter","attachments")());t.footer_icon||(t.footer_icon=cdn_url+"/6e067/img/services/twitter_pixel_snapped_32.png");return t};var u=function e(t){t._source.name=t.author_name;t._source.author_name=t.author_subname;t._unfurl_type_message=true;t._always_expand=true;return t};var d=function e(t){if(!t)return;if(0===t.indexOf("/img/"))return t;var r={width:16,height:16};"ico"===t.split(".").pop()&&(r.convert_ico=true);var i=TS.utility.getImgProxyURLWithOptions(t,r);var a=TS.utility.getImgProxyURLWithOptions(t,n({},r,{width:2*r.width,height:2*r.height}));return{src:i,srcset:i+" 1x, "+a+" 2x"}}})()},11279:function(e,t){(function(){TS.registerModule("ui.inline_msg_input",{onStart:_.noop,make:function r(i,a){var s=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var o=!!(TS.client&&!a.no_emo);var l=TS.templates.inline_message_input({input_id:_.uniqueId("inline_message_input_"),include_emo:o});var u=$(l);u.appendTo(i);var d=u.find(".message_input");a.placeholder&&TS.utility.contenteditable.placeholder(d,a.placeholder);e(u,d,a);t(u,d);a.scrollIntoView&&n(u,d,s);return u}});var e=function e(t,n,r){var i=r.onSubmit||_.noop;var o=r.onCancel||_.noop;TS.utility.contenteditable.create(n,{modules:{msginput:{onUpArrow:function e(){if(!TS.prefs.getPref("arrow_history"))return s(n,false,r)},onUpArrowCmd:function e(){s(n,true,r)}},tabcomplete:{searchOptions:{complete_member_specials:r.complete_member_specials,model_ob:r.model_ob,in_thread:!!r.in_thread},completers:r.completers,positionMenu:function e(t){var i=n.offset();var a=$(window).width()-i.left-2;t.style.width=Math.min(n.outerWidth(),a)+"px";t.style.minWidth=0;TS.tabcomplete.positionUIRelativeToInput(t,n,r.autocomplete_below_input)}}},placeholder:r.placeholder,ariaLabel:r.aria_label,isJumbomojiEnabled:!!r.jumbomoji&&TS.utility.contenteditable.isJumbomojiEnabled,onEnter:function e(){TS.client.ui.cal_key_checker.prevent_enter||a(n,t,i);r.onEnter&&r.onEnter();return false},onEscape:function e(){r.onEscape&&r.onEscape()},onTab:function e(){r.onTab&&r.onTab();return true},onTextChange:function e(){TS.msg_edit.checkLengthAndUpdateMessage(n);r.onTextChange&&r.onTextChange(n)}});TS.utility.contenteditable.enable(n);t.bind("destroyed",function(){o(t)});t.bind("submit",function(e){e.preventDefault();a(n,t,i)})};var t=function e(t,n){var r=t.find(".emo_menu");r.removeClass("hidden");r.bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:n})})};var n=function e(t,n,r){TS.client&&r&&TS.client.ui.instaScrollMsgsToBottom(false);t.scrollintoview({duration:500,px_offset:100,complete:function e(){TS.utility.contenteditable.focus(n);TS.utility.contenteditable.setCursorAtEnd(n)}})};var r=function e(t,n){var r=t.closest("ts-message");if(n&&r.length){var i=r.data("ts");var a=TS.utility.msgs.getMsg(i,n.msgs);if(a&&TS.interop.messages.canEditMessage(TS.model.user.id,a,n,TS.prefs.getTeamPref("msg_edit_window_mins")))return a}return null};var i=function e(t,n){var r=TS.msg_edit.isMessageTooLong(t);if(r)return false;if(!$.trim(n))return false;return true};var a=function e(t,n,r){var a={complete_member_specials:false};var s=TS.utility.contenteditable.value(t);s=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(s,a);i(t,s)&&r(n,s)};var s=function e(t,n,r){var i=jQuery.Event("keydown",{altKey:false,shiftKey:false,which:TS.utility.keymap.up});n&&(TS.model.is_mac?i.metaKey=true:i.ctrlKey=true);if(!TS.client.ui.shouldEventTriggerMaybeEditLast(i,t))return true;o(t,r)};var o=function e(t,n){var i=n.getMsgDivForEditing||r;var a=n.model_ob;var s=i(t,a);if(s&&s.length){var o=s.data("ts");var l=s.data("model-ob-id");a=TS.redux.channels.getEntityById(l);var u=s.closest("#convo_container").length>0;var d=u?"convo":null;TS.msg_edit.startEdit(o,a,d)}}})()},11280:function(e,t){(function(){TS.registerModule("attachment_actions",{action_triggered_sig:new signals.Signal,action_completed_sig:new signals.Signal,onStart:function e(){TS.attachment_actions.action_triggered_sig.add(t);TS.attachment_actions.action_completed_sig.add(n)},getActionContext:function e(t){var n=a(t);var r=TS.utility.msgs.findMsg(n.message_ts,n.channel_id);if(!r)return;var i=_.find(r.attachments,{id:n.attachment_id});if(!i)return;var s=TS.attachment_actions.client_buttons.fetchClientButtonData(r);if(s)return TS.attachment_actions.client_buttons.getActionContext(s,r,i,n);var o=_.find(i.actions,{id:n.action_id});if(!o)return;return{action:o,attachment:i,channel_id:n.channel_id,message:r}},handleActionEventAndGetContext:function e(t){var n=t.data("url");if(n){var r=n.match(/<(.*?)\|/);var i=r?r[1]:n;if(!i)return;if(0===i.indexOf(TS.utility.msgs.new_api_url_prefix))TS.utility.msgs.doNewApiUrl(i);else{var a=null!==TS.model.desktop_app_version;var s=a&&parseFloat(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor)>=2.6;var o=TS.interop.url.parseUrl(n);TS.interop.url.isValidSlackHostName(o.hostname)&&"/oauth/authorize"===o.pathname&&s?TS.utility.openAuthenticatedInBrowser(o.pathname+o.search):TS.utility.openInNewTab(n,"_blank")}return}var l=TS.attachment_actions.getActionContext(t);(TS.client.activeChannelIsHidden()||l.channel_id!=TS.shared.legacyGetActiveModelOb().id)&&TS.client.ui.tryToJump(l.channel_id,l.message.ts);return l},confirmAction:function e(t,n,r){var i="danger"===t.style?"btn_danger":"btn_primary";var a=_.defaults(t.confirm,{dismiss_text:TS.interop.i18n.t("Cancel","attachment_actions")(),ok_text:TS.interop.i18n.t("OK","attachment_actions")(),text:"",title:""});a.text?a.text=TS.emoji.graphicReplace(a.text):a.title||(a.text=TS.interop.i18n.t("Are you sure?","attachment_actions")());a.title&&(a.title=TS.emoji.graphicReplace(a.title));TS.generic_dialog.start({title:a.title,body:a.text,show_go_button:true,show_cancel_button:true,go_button_text:a.ok_text,go_button_class:i,cancel_button_text:a.dismiss_text,onGo:n,onCancel:r})},render:function e(t,n,r){if(!t||!n)return;var a=i(t,n);if(!a.length)return;if(!r||a.find(".attachment_actions_interactions").hasClass("attachment_pending")){var s=TS.templates.attachment_actions({attachment:t,message_ts:n});a.html(s);TS.attachment_actions.select.decorateNewElements(a)}},test:function t(){var n={};Object.defineProperty(n,"_getActionContextDataFromDOM",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(n,"_getPendingAttachment",{get:function t(){return e},set:function t(n){e=n}});return n}});function e(e,t){if(!e||!t||!t.length)return;var n=_.map(t,"id");var r=_.cloneDeep(e);r.actions.forEach(function(e){e._disabled=true;e._loading=_.includes(n,e.id)});r._pending=true;return r}function t(t){if(!t||!t.message||!t.attachment||!t.action||!t.channel_id){TS.warn("_onActionTriggered: missing message, attachment, action, or channel_id");return}var n=e(t.attachment,[t.action]);n&&TS.attachment_actions.render(n,t.message.ts);var r=_.clone(t.action);delete r.options;var i={actions:[r],attachment_id:t.attachment.id,callback_id:t.attachment.callback_id,channel_id:t.channel_id,is_ephemeral:t.message.is_ephemeral,message_ts:t.message.ts};var a=_.get(t.message,"bot_profile.team_id",false);a&&(i.team_id=a);var s={payload:JSON.stringify(i),client_token:TS.interop.client_action_token.generateAndEnqueue()};t.message.bot_id&&(s.service_id=t.message.bot_id);t.message.user&&(s.bot_user_id=t.message.user);TS.api.call("chat.attachmentAction",s).then(function(e){TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,is_expecting_ms_update:!!(_.get(e,"data.replaced")||_.get(e,"data.deleted"))})}).catch(function(e){TS.error(e);TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,err:e})})}function n(e){if(!e)return;if(e.err){var t=TS.interop.i18n.t("Oh no, something went wrong. Please try that again.","attachment_actions")();var n={text:_.get(e,"err.data.response")||t,ephemeral_type:_.get(e,"err.data.error")||"attachment_action_error",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(n)}e.attachment&&e.message_ts&&e.channel_id&&!e.is_expecting_ms_update&&r(e)}function r(e){TS.utility.rAF(function(){var t=TS.utility.attachments.findAttachment({attachment_id:e.attachment.id,message_ts:e.message_ts,channel_id:e.channel_id});t&&TS.attachment_actions.render(t,e.message_ts,true)})}function i(e,t){var n=TS.templates.makeMsgDomId(t);var r="#"+n+", #"+n+"_conversation";return $(r).find("[data-attachment-id="+e.id+"] .attachment_actions")}function a(e){var t=e.parents("[data-attachment-id]");var n=t.parents("ts-message");var r={action_id:String(e.data("action-id")||""),attachment_id:String(t.data("attachment-id")||""),channel_id:String(n.data("model-ob-id")||""),message_ts:String(n.data("ts")||"")};Object.keys(r).forEach(function(e){if(!r[e])throw new Error('Attachment is missing "'+e+'"')});return r}})()},11281:function(e,t){(function(){TS.registerModule("attachment_actions.select",{onStart:_.noop,decorateNewElements:function e(t){t=t||TS.client.ui.$msgs_div;var n=t.find(".attachment_actions_interactions select:not(.hidden)");n.each(function(){var e=$(this);var t=TS.client?TS.attachment_actions.getActionContext(e):{};var n={adjustAvailableSpaceAbove:d,adjustAvailableSpaceBelow:u,allow_list_position_above:true,classes:"select_attachment",data_promise:m(t),disabled:e.attr("disabled"),errorTemplate:a,filter:o,input_debounce_wait_time:g(t),min_query_length:_.get(t,"action.min_query_length",0),no_default_selection:true,onItemAdded:s,onListShown:l(t),placeholder_text:T(t),filter_placeholder_text:v(t),should_graphic_replace_emoji:true,style:TS.ui.lazy_filter_select.STYLES.filter_in_list,template:S(t)};e.lazyFilterSelect(n).addClass("hidden");y(t,e)})},getActionModel:function e(t,r){var i=n[t.data_source]||n.default;return _.merge({},t,{_disabled:t._disabled||!!r,data_source:i,options:C(t.options),option_groups:x(t.option_groups),text:t.text||b(i)})}});var e={channels:TS.interop.i18n.t("Choose a channel\u2026","attachment_actions")(),conversations:TS.interop.i18n.t("Choose a conversation\u2026","attachment_actions")(),default:TS.interop.i18n.t("Choose an option\u2026","attachment_actions")(),external:TS.interop.i18n.t("Choose an option\u2026","attachment_actions")(),users:TS.interop.i18n.t("Choose a person\u2026","attachment_actions")()};var t={channels:TS.interop.i18n.t("Search channels","attachment_actions")(),conversations:TS.interop.i18n.t("Search conversations","attachment_actions")(),default:TS.interop.i18n.t("Filter options","attachment_actions")(),external:TS.interop.i18n.t("Search options","attachment_actions")(),users:TS.interop.i18n.t("Search people","attachment_actions")()};var n={channels:"channels",conversations:"conversations",default:"default",external:"external",users:"users"};var r=250;function i(e,t){var n=_.find(t.attachment.actions,{id:e});n&&(n.selected_options=[])}function a(e){if(!e)return TS.interop.i18n.t("No results.","lazy_filter_select")();return TS.interop.i18n.t("Couldn\u2019t load results.","lazy_filter_select")()}function s(e){if(!TS.client)return;var t=this.$select;var n=TS.attachment_actions.handleActionEventAndGetContext(t);var r=_.get(e,"model_ob.id",e.value);var a=function t(){n.action.selected_options=[{text:e.text,value:r}];var a=i.bind(null,n.action.id);TS.attachment_actions.action_completed_sig.addOnce(a);_.defer(TS.attachment_actions.action_triggered_sig.dispatch,n)};var s=function e(){t.lazyFilterSelect("clearValue")};n.action.confirm?TS.attachment_actions.confirmAction(n.action,a,s):a()}function o(e,t){return _.isEmpty(t)||TS.fuzzy.score(e.text.toLowerCase(),t.toLowerCase())<Infinity}function l(e){var t=_.get(e,"action.data_source");var n=E(e);return function e(){A(t,n)}}function u(e){var t=$("#footer").height()||0;return e-t}function d(e){var t=$("#client_header").height()||0;return e-t}function c(e){var t=_.get(e,"action.data_source");return n[t]||n.default}function m(e){switch(c(e)){case n.channels:return f({channels:{include_archived:false}},{default_query:"#"});case n.conversations:return p();case n.external:return h(e);case n.users:return f({members:{include_self:true}},{default_query:"@"});default:break}}function f(e,t){e=_.defaults(e,{limit:100,sort:{frecency:true}});t=_.defaults(t,{default_query:""});return function(n){n=n||t.default_query;return new Promise(function(t,r){TS.searcher.search(n,e).then(function(e){t({all_items_fetched:true,items:e,replace_all_items:true})},r)})}}function p(){return function(e){return new Promise(function(t,n){TS.ui.file_share.promiseToGetFileShareSelectOptions(e).then(function(e){t({all_items_fetched:true,items:e,replace_all_items:true})},n)})}}function h(e){return function(t){return new Promise(function(n,r){var i=_.get(e.message,"bot_profile.team_id",false);var a={name:e.action.name,value:t,attachment_id:e.attachment.id,callback_id:e.attachment.callback_id,channel_id:e.channel_id,is_ephemeral:true,message_ts:e.message.ts};i&&(a.team_id=i);TS.api.call("chat.attachmentSuggestion",{service_id:E(e),payload:JSON.stringify(a)}).then(function(e){n({all_items_fetched:true,items:M(e),replace_all_items:true})}).catch(function(e){r(e)})})}}function g(e){if(c(e)!==n.default)return r}function S(e){var t=c(e);if("users"===t)return k;if(_.includes([n.channels,n.conversations],t))return w}function T(e){return _.get(e,"action.text")||b(e)}function v(e){return _.get(t,c(e),t.default)}function b(t){return _.get(e,c(t),e.default)}function y(e,t){if(!$.contains(document,t[0]))return;var r=c(e);var i=_.get(e,"action.selected_options[0]");if(i){var a=_.includes([n.channels,n.conversations,n.users],r);if(a){var s;s=r===n.users?TS.interop.members.getMemberById(i.value):TS.redux.channels.getEntityById(i.value);if(!s)return;i={model_ob:s}}else{i.text=_.unescape(i.text);i.description=_.unescape(i.description);i=I(i)}t.lazyFilterSelect("forceSelectItem",i)}}function w(e){var t=TS.templates.attachment_actions_select_channel_or_conversation_option(e.model_ob);return new Handlebars.SafeString(t)}function k(e){var t=TS.templates.attachment_actions_select_user_option(e.model_ob);return new Handlebars.SafeString(t)}function x(e){if(!e)return;return e.map(function(e){return _.merge({},e,{options:C(e.options),text:e.text&&new Handlebars.SafeString(e.text)})})}function C(e){if(!e)return;return e.map(function(e){return _.merge({},e,{description:e.description&&new Handlebars.SafeString(e.description),text:e.text&&new Handlebars.SafeString(e.text)})})}function M(e){var t=_.get(e,"data.option_groups");if(_.isArray(t))return t.map(function(e){var t=_.get(e,"options",[]).map(function(e){return I(e,{is_group_item:true})});return{lfs_group:true,label:e.text,children:t}});return _.get(e,"data.options",[]).map(I)}function I(e,t){e=_.merge({},e,{is_group_item:_.get(t,"is_group_item")});var n=TS.templates.attachment_actions_select_option(e);var r=$("<div>").html(n);return r.children()[0]}function A(e,t){TS.interop.clog.track("MSG_MENU_OPEN",{data_source:e,service_id:t})}function E(e){if(_.get(e,"attachment.is_app_unfurl"))return e.attachment.bot_id;return _.get(e,"message.bot_id")}})()},11282:function(e,t){(function(){TS.registerModule("attachment_actions.client_buttons",{onStart:function e(){TS.prefs.enable_shared_channels_changed_sig.add(u)},isClientButtonAttachment:function e(t){if(!t.callback_id)return false;var n=t.callback_id.split("_")[0];return _.includes(m,n)},fetchClientButtonData:function e(t){if(!t||t.bot_id!==d||!t.attachments)return false;return _.find(c,function(e){return e.match(t)})},handleClick:function e(t,n){t.onClick(n)},generateActions:function e(t,n){return t.generate(n)},getActionContext:function e(t,n,r,i){r=TS.attachment_actions.client_buttons.generateActions(t,r);var a={action:_.find(r.actions,{id:i.action_id}),attachment:r,channel_id:i.channel_id,message:n};return a},test:function e(){return{_CLIENT_BUTTON_OPTIONS:c,_generateSharedChannelInvitationActions:t,_generateSharedChannelFindAnAdminAction:i,_generateSharedChannelBetaOptInActions:o,_onEnableSharedChannelPrefChange:u}}});var e=function e(t){var n=_.get(t,"attachments[1].callback_id");return!!n&&_.includes(n,this.callback_id_prefix)};var t=function e(t){var n={id:"1",name:"approve",style:"primary",text:TS.interop.i18n.t("View Invitation","shared_channels")(),type:"button",value:"approve"};var r={id:"2",name:"decline",style:"danger",text:TS.interop.i18n.t("Decline","shared_channels")(),type:"button",value:"decline"};return _.assign({},t,{actions:[n,r]})};var n=function e(t){var n=_.get(t,"message.attachments[1].callback_id");if(!_.isString(n)||!_.includes(n,this.callback_id_prefix))return;var r=n.split("_")[1];if(!r)return;if("approve"===t.action.value){TS.interop.clog.trackClickWithContext({event:"SHARED_CHANNELS_SLACKBOT_ADMIN_ACTION",element:"SHARED_CHANNELS_SLACKBOT_INVITE_VIEW_BTN",contexts:{core:{shared_channels_invite_id:r}}});TS.ui.share_channel_dialog.showApproveRequestDialog(r);TS.model.plan||TS.boot_data.page_needs_enterprise||TS.interop.clog.track("UPGRDEXP_FREE_TRIAL_FOR_SC",{contexts:{ui_context:{step:"slackbot_invitation",action:"click",ui_element:"shared_channels_slackbot_invite_view_btn"}}})}else if("decline"===t.action.value){TS.interop.clog.trackClickWithContext({event:"SHARED_CHANNELS_SLACKBOT_ADMIN_ACTION",element:"SHARED_CHANNELS_SLACKBOT_INVITE_DECLINE_BTN",contexts:{core:{shared_channels_invite_id:r}}});TS.api.call("conversations.declineSharedInvite",{invite_id:r});TS.model.plan||TS.boot_data.page_needs_enterprise||TS.interop.clog.track("UPGRDEXP_FREE_TRIAL_FOR_SC",{contexts:{ui_context:{step:"slackbot_invitation",action:"decline",ui_element:"shared_channels_slackbot_invite_decline_btn"}}})}};var r=function e(t){var n=_.get(t,"attachments[0].callback_id");return!!n&&_.includes(n,this.callback_id_prefix)};var i=function e(t){var n={id:"1",name:"find_an_admin",style:"primary",text:TS.interop.i18n.t("Who are my admins?","shared_channels")(),type:"button",value:"find_an_admin"};return _.assign({},t,{actions:[n]})};var a=function e(t){var n=_.get(t,"message.attachments[0].callback_id");if(!_.isString(n)||!_.includes(n,this.callback_id_prefix))return;var r=n.split("_")[1];TS.interop.clog.trackClickWithContext({event:"SHARED_CHANNELS_NONADMIN_ACTION",element:"SHARED_CHANNELS_SLACKBOT_INVITE_FIND_ADMIN_BTN",contexts:{core:{shared_channels_invite_id:r}}});TS.ui.share_channel_dialog.showFindAnAdminDialog()};var s=function e(t){var n=_.get(t,"attachments[0].callback_id");return!!n&&_.includes(n,this.callback_id_prefix)};var o=function e(t){var n={id:"1",name:"opt_in",style:"primary",text:TS.interop.i18n.t("Join the Beta","shared_channels")(),type:"button",value:"opt_in"};var r={id:"2",name:"not_now",style:"default",text:TS.interop.i18n.t("Not Now","web_admin")(),type:"button",value:"not_now"};if(0===TS.prefs.getTeamPref("enable_shared_channels")){t.text=TS.interop.i18n.t(":no_entry_sign: To join later, click on *Shared channels (beta)* in the top-left menu.","shared_channels")();return t}if(1===TS.prefs.getTeamPref("enable_shared_channels")){t.text=TS.interop.i18n.t(":white_check_mark: Your team has joined the Shared Channels beta. To learn more, click on *Shared channels (beta)* in the top-left menu.","shared_channels")();return t}return _.assign({},t,{actions:[n,r]})};var l=function e(t){var n=_.get(t,"message.attachments[0].callback_id");if(!_.isString(n)||!_.includes(n,this.callback_id_prefix))return;"opt_in"===_.get(t,"action.value")?TS.ui.shared_channels_open_beta_modal.showModal():"not_now"===t.action.value&&TS.prefs.setTeamPrefByAPI({enable_shared_channels:0})};var u=function e(){TS.interop.rules.channels.isSlackbot(TS.shared.legacyGetActiveModelOb())&&TS.client.msg_pane.rebuildMsgsWithReason("TS.prefs.enable_shared_channels_changed_sig")};var d="B01";var c={shared_channel_invitation:{callback_id_prefix:"sharedchannelsinvite",match:e,generate:t,onClick:n},shared_channel_find_an_admin:{callback_id_prefix:"sharedchannelsfindanadmin",match:r,generate:i,onClick:a},shared_channel_beta_opt_in:{callback_id_prefix:"sharedchannelsbetaoptin",match:s,generate:o,onClick:l}};var m=_.map(c,"callback_id_prefix")})()},11283:function(e,t){(function(){TS.registerModule("utility.enterprise",{getSelf:function e(){return _.get(TS.enterprise.model.get(),"org.user")},splitQueryIntoTerms:function e(t,n,r){var i=n;var a;t=t.trim();if(t.length>=2){i=_.isArray(n)?_.slice(n):[];a=t.split(/\s+/);_.each(a,function(e){i.push({type:r||"fuzzy_with_email",value:e})})}return i},doFormatSearchQuery:function e(t,n,r){n=n||"";var i=[];switch(t){case"members":i.push({type:"is",value:"user"});r&&!_.isEqual(r,"all")&&i.push(TS.utility.enterprise.doFormatMemberFilterClauses(r));break;case"groups":i.push({type:"is",value:"group"});break;case"teams":i.push({type:"is",value:"team"});break;default:}return{query:TS.utility.enterprise.splitQueryIntoTerms(n,i)}},doFormatMemberFilterClauses:function e(t){switch(t){case"admins":return{type:"or",clauses:[{type:"level",value:"admin"},{type:"level",value:"owner"}]};case"guests":return{type:"or",clauses:[{type:"level",value:"restricted"},{type:"level",value:"ultra_restricted"}]};case"members":default:return{type:"level",value:"regular"}}},getSSOProviderLabel:function e(t,n){if(!t)return n;var r=_.get(t,"type","");var i=_.get(t,"name","");var a=""===r;var s="saml"===r;if(a||s)return n;return i||n},getProviderLabel:function e(t,n){var r=n||"IDP";if(!t)return r;n=_.get(t,"saml_provider")||r;"saml"===n.toLowerCase()&&(n=r);return TS.utility.enterprise.getSSOProviderLabel(_.get(t,"sso_provider"),n)},getWorkspaceVisibilityLabel:function e(t){if(TS.boot_data.feature_invite_only_workspaces)switch(t){case"open":return TS.interop.i18n.t("Open","enterprise_dashboard")();case"unlisted":return TS.interop.i18n.t("Hidden","enterprise_dashboard")();case"closed":return TS.interop.i18n.t("By Request","enterprise_dashboard")();case"invite_only":return TS.interop.i18n.t("Invite Only","enterprise_dashboard")();default:return t}return t},getGroupsTitle:function e(t){var n=TS.utility.enterprise.getProviderLabel(t);if("IDP"===n)return TS.interop.i18n.t("IDP Groups","enterprise_dashboard")();return TS.interop.i18n.t("{provider_label} Groups","enterprise_dashboard")({provider_label:n})},wrapWithStrongTags:_.wrap(_.escape,function(e,t){return"<strong>"+e(t)+"</strong>"}),buildTeamUrl:function e(t){return"https://"+(t||"my")+"."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},buildOrgUrl:function e(t){return"https://"+t+".enterprise."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},getSanitizedIdpLabel:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.locale,i=void 0===r?TS.interop.i18n.locale:r;return{simple:"IDP"!==t&&t?t:"",your:"IDP"!==t&&t?t:TS.interop.i18n.t("your IdP","enterprise_utility")(),possessive:"IDP"!==t&&t?TS.interop.i18n.fullPossessiveString(t,{locale:i}):TS.interop.i18n.t("your IdP\u2019s","enterprise_utility")()}},formatChannelsData:function e(t){var n=[];if(t.private_channels){t.private_channels=_.isArray(t.private_channels)?t.private_channels:[t.private_channels];n=_.map(t.private_channels,function(e){var t=TS.interop.members.getMemberById(e.creator)||{};var n={creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,member_count:e.member_count,purpose:e.purpose.value,topic:e.topic.value,private:true};return _({}).assign(e,n).omit("members").value()})}t.channels&&(n=n.concat(_.map(t.channels,function(e){var t=TS.interop.members.getMemberById(e.creator)||{};var n={creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,member_count:_.get(e,"members.length",0),purpose:_.get(e,"purpose.value",""),topic:_.get(e,"topic.value",""),private:false};return _({}).assign(e,n).omit("members").value()})));return n},pollUntilCondition:function e(t){return new Promise(function(e,n){var r={api_method:null,api_params:{},condition_method:null,interval:5e3,interval_backoff:1e3,attempts_max:10,call_immediately:true};t=_.merge(r,t||{});var i={attempts:0,last_api_response:null,interval:parseInt(t.interval,10)||1e3,interval_backoff:parseInt(t.interval_backoff,10)||0};function a(){if(i.attempts>=t.attempts_max)return n(new Error("Giving up on "+t.api_method+", reached max attempts of "+t.attempts_max));i.attempts+=1;i.interval+=i.interval_backoff;TS.api.call(t.api_method,t.api_params).then(function(n){i.last_api_response=n;if(t.condition_method(n))return e(n);return s()}).catch(function(e){i.last_api_response=e;return s()})}function s(){window.setTimeout(a,i.interval)}if(!t.api_method)return n(new Error("missing required api_method in params"));if(!t.condition_method)return n(new Error("missing required condition_method in params"));t.call_immediately?a():s()})},getUserRoleLabel:function e(t,n){var r;var i;r=n?{primary_owner:TS.interop.i18n.t("Primary Org Owner","enterprise_dashboard")(),owner:TS.interop.i18n.t("Org Owner","enterprise_dashboard")(),admin:TS.interop.i18n.t("Org Admin","enterprise_dashboard")(),single_channel_guest:TS.interop.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.interop.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.interop.i18n.t("Member","enterprise_dashboard")()}:{primary_owner:TS.interop.i18n.t("Primary Owner","enterprise_dashboard")(),owner:TS.interop.i18n.t("Owner","enterprise_dashboard")(),admin:TS.interop.i18n.t("Admin","enterprise_dashboard")(),single_channel_guest:TS.interop.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.interop.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.interop.i18n.t("Member","enterprise_dashboard")()};i=t.is_ultra_restricted?r.single_channel_guest:t.is_restricted?r.multi_channel_guest:t.is_primary_owner?r.primary_owner:t.is_owner?r.owner:t.is_admin?r.admin:r.member;return i},buildAnalyticsApiOptionsFor:function e(t){var n=function e(t){return _.reduce(t,function(e,t,n){var r=TS.enterprise.model.get(["analytics",t]);r&&(e[n]=r);return e},{})};switch(t){case"teams":return n({query:"teams_search_term",sort_prefix:"teams_sort_prefix",sort_dir:"teams_sort_dir",cursor_mark:"teams_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"team_overview":return n({date_range:"current_date_range",start_date:"start_date",end_date:"end_date",team_id:"team_overview_id"});case"members":return n({query:"members_search_term",sort_prefix:"members_sort_prefix",sort_dir:"members_sort_dir",cursor_mark:"members_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"channels":return n({query:"channels_search_term",sort_prefix:"channels_sort_prefix",sort_dir:"channels_sort_dir",cursor_mark:"channels_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});default:return n({date_range:"current_date_range",start_date:"start_date",end_date:"end_date"})}},maybeGetUpdatedAtTime:function e(t){return t?TS.interop.datetime.toTimeAgo(t):null},getObjectsForIds:function e(t,n){if(_.isEmpty(t)||_.isEmpty(n))return[];return _.intersectionWith(t,n,function(e,t){return e.id===t})},getQueryForIds:function e(t){if(_.isEmpty(t))return;if(1===t.length)return{query:{type:"id",value:_.head(t)}};return{query:{type:"or",clauses:_.map(t,function(e){return{type:"id",value:e}})}}},buildApiOptionsForAnalyticsCSVExport:function e(t){var n={};t.type&&(n.type=t.type);t.date_range&&(n.date_range=t.date_range);_.get(t.selected_columns,"length")&&(n.cols=t.selected_columns.join(","));t.team_id&&(n.team_id=t.team_id);if(t.sort_prefix){n.sort_prefix=t.sort_prefix;t.sort_dir&&(n.sort_dir=t.sort_dir)}if(t.search_term){var r=TS.utility.enterprise.splitQueryIntoTerms(t.search_term,[],"fuzzy_with_email");if(r.length){var i=1===r.length?_.head(r):{type:"and",clauses:r};n.query=JSON.stringify(i)}}return n},recordAnalyticsPricingEvents:function e(t,n,r){r=r||{};var i={};switch(n){case"overview_impression":i.action="impression";i.step="team_stats_overview";break;case"coachmark_impression":i.action="impression";i.step="team_stats_overview_"+_.get(r,"callout_module")+"_coachmark";break;case"coachmark_resolve":i.action="click";i.step="team_stats_overview_"+_.get(r,"callout_module")+"_coachmark";i.ui_element="learn_more_btn";break;case"coachmark_reject":i.action="dismiss";i.step="team_stats_overview_"+_.get(r,"callout_module")+"_coachmark";i.ui_element="skip_this";break;case"msg_files_pricing_btn_click":i.action="click";i.step="team_stats_overview";i.ui_element="msg_files_chart_link_btn";break;case"single_callout_upgrade_link_impression":i.action="impression";i.step="team_stats_overview";i.ui_element=_.get(r,"callout_module")+"_upgrade_link";break;case"multi_callout_upgrade_link_impression":i.action="impression";i.step="team_stats_overview";i.ui_element="multi_lim_upgrade_link";break;case"data_table_upsell_banner_impression":i.action="impression";i.step="team_stats_"+_.get(r,"report_name");break;case"data_table_upsell_banner_click":i.action="click";i.step="team_stats_"+_.get(r,"report_name");i.ui_element="see_pricing_plans_btn";break;default:}TS.interop.clog.track(t,{contexts:{ui_context:i}})},recordAnalyticsImpression:function e(t,n,r,i,a){var s="ENTERPRISE_ANALYTICS";var o={};var l={};o.action="impression";o.ui_element=n;l.entity_key=r;l.tracking_code=i;l.anchor_page=t;l.target_team_id=a||(TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id"));TS.interop.clog.track(s,_.assign({},l,{contexts:{ui_context:o}}))},recordAnalyticsTooltipHover:function e(t){var n="ENTERPRISE_ANALYTICS";var r={};var i={};r.action="hover";r.ui_element="NOTING_BADGE";i.entity_key=t;var a=TS.enterprise.model.get("org.enterprise.id");var s=TS.enterprise.model.get("analytics.overview_open");if(a&&!s){i.anchor_page="organization_overview";i.target_team_id=a}else if(s){i.anchor_page="workspace_overview";i.target_team_id=TS.enterprise.model.get("analytics.team_overview_id")}else{i.anchor_page="workspace_overview";i.target_team_id=_.get(TS.boot_data,"team_id")}TS.interop.clog.track(n,_.assign({},i,{contexts:{ui_context:r}}))},recordAnalyticsSearchEvent:function e(t,n,r){var i="ENTERPRISE_ANALYTICS";var a={};var s={};a.action="impression";a.action_status=r?2:1;a.ui_element="SEARCH_BAR";s.entity_key=n;s.anchor_page=t;s.target_team_id=TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id");TS.interop.clog.track(i,_.assign({},s,{contexts:{ui_context:a}}))},convertDateRangeToThriftID:function e(t){switch(t){case"30d":return"FILTER_LAST_30DAYS";case"all":return"FILTER_ALL_TIME";default:}},convertTimeseriesTabToClogKey:function e(t){switch(t){case"active-users_weekly_active_users":return"wau_ts";case"active-users_daily_active_users":return"dau_ts";case"messages-and-files_messages_sent":return"messages_sent_ts";case"messages-and-files_files_uploaded":return"files_uploaded_ts";case"transparency_where_messages_sent":return"transparency_sent_ts";case"transparency_where_messages_read":return"transparency_read_ts";default:}},getNumberAnnotation:function e(t){var n="";if("ja-JP"===TS.interop.i18n.locale)switch(t){case"channels":case"messages":n="\u4ef6";break;case"users":n="\u4eba";break;case"files":case"apps":n="\u500b";break;default:}return n}})})()},11284:function(e,t){(function(){TS.registerModule("replies",{thread_marked_sig:new signals.Signal,thread_subscription_changed_sig:new signals.Signal,sanity_check_failed_sig:new signals.Signal,reply_changed_sig:new signals.Signal,reply_deleted_sig:new signals.Signal,DEFAULT_HISTORY_API_LIMIT:100,onStart:function e(){TS.channels.message_received_sig.add(d);TS.groups.message_received_sig.add(d);TS.ims.message_received_sig.add(d);TS.mpims.message_received_sig.add(d);TS.channels.message_removed_sig.add(u);TS.groups.message_removed_sig.add(u);TS.ims.message_removed_sig.add(u);TS.mpims.message_removed_sig.add(u);TS.channels.message_changed_sig.add(l);TS.groups.message_changed_sig.add(l);TS.ims.message_changed_sig.add(l);TS.mpims.message_changed_sig.add(l);TS.redux.socket.connectedSig.add(o)},canReplyToMsg:function e(t,n,r){if(!TS.client)return false;if(!n)return false;if(TS.interop.rules.messages.isAutomatedSubtype(n.subtype))return false;if(TS.interop.rules.messages.isFile(n))return false;if(TS.interop.rules.messages.isTempMsg(n)||n.is_ephemeral)return false;if(TS.interop.messages.isReply(n))return false;if(TS.interop.channels.isImWithDeletedMember(t.id))return false;if(!r&&t.is_channel&&!t.is_member)return false;return true},getMessage:function e(t,n){var r=TS.utility.msgs.getMsg(n,t.msgs)||TS.utility.msgs.getMsg(n,t._archive_msgs);if(r)return r;if(TS.ui.replies)return TS.ui.replies.getActiveMessage(t,n);return null},getThread:function t(n,r,i){if(!i){var a=c(n,r);if(a){m(n,r)&&f(n,r,a);return Promise.resolve(a)}}var s={channel:n,thread_ts:r};var o={D:"im.replies",C:"channels.replies",G:"groups.replies"};var l=n[0];var u=o[l];if(!u){TS.error("Unable to get thread for message in unsupported model object type with ID"+n);return Promise.reject(new Error("missing api endpoint"))}var d=p(n,r);if(e[d])return e[d];TS.has_pri[T]&&(i?TS.log(T,"Calling "+u+" for "+r+" because always_make_api_call"):TS.log(T,"Calling "+u+" for "+r+" because local history is incomplete"));e[d]=TS.api.call(u,s).then(function(e){var t=e.data.messages.map(function(e){return TS.utility.msgs.processImsgFromHistory(e,n)});h(n,t);var i=TS.redux.channels.getEntityById(n);if(i&&i.msgs&&i.msgs.length){var a=_.filter(i.msgs,function(e){return e.thread_ts===r&&TS.interop.rules.messages.isTempMsg(e)});a.length&&(t=_.sortBy(t.concat(a),"ts"))}g(i,t);return t}).finally(function(){delete e[d]});return e[d]},getThreadLazy:function n(r,i,s,o){if(!o){var l=c(r,i);if(l){m(r,i)&&f(r,i,l,s);var u=_.find(l,{ts:i});return Promise.resolve({root_msg:u,messages:l,has_more_beginning:false,has_more_end:false})}}var d=TS.redux.channels.getEntityById(r);var h=a(d);TS.has_pri[T]&&(o?TS.log(T,"Calling "+h+" for "+i+" because always_make_api_call"):TS.log(T,"Calling "+h+" for "+i+" because local history is incomplete"));var g=p(r,i);if(s){if(t[g])return t[g];t[g]=TS.replies.getThreadBefore(r,i).then(function(e){e.has_more_beginning=e.has_more;e.has_more_end=false;return e}).finally(function(){delete t[g]});return t[g]}if(e[g])return e[g];e[g]=TS.replies.getThreadAfter(r,i).then(function(e){e.has_more_beginning=false;e.has_more_end=e.has_more;return e}).finally(function(){delete e[g]});return e[g]},getThreadBefore:function e(t,n,r,i){var o={channel:t,thread_ts:n,count:TS.replies.DEFAULT_HISTORY_API_LIMIT};if(r){o.latest=r;i&&(o.inclusive=i)}var l=TS.redux.channels.getEntityById(t);var u=a(l);return TS.api.call(u,o).then(function(e){var t=s(l,n,e);t.has_more||t.messages.unshift(t.root_msg);return t})},getThreadAfter:function e(t,n,r,i){var o={channel:t,thread_ts:n,count:TS.replies.DEFAULT_HISTORY_API_LIMIT};var l=false;if(r){o.oldest=r;i&&(o.inclusive=i)}else{l=true;o.oldest=n;o.inclusive=true}var u=TS.redux.channels.getEntityById(t);var d=a(u);return TS.api.call(d,o).then(function(e){var t=s(u,n,e);l&&t.messages.unshift(t.root_msg);return t})},getThreadAround:function e(t,n,r){var i=c(t,n);if(i){var a=false;m(t,n)&&f(t,n,i,a);var s=_.find(i,{ts:n});return Promise.resolve({root_msg:s,messages:i,has_more_beginning:false,has_more_end:false})}var o=TS.replies.getThreadBefore(t,n,r);var l=TS.replies.getThreadAfter(t,n,r,true);return Promise.join(o,l,function(e,t){var n=e.has_more;var r=t.has_more;var i=e.messages.concat(t.messages);n||i.unshift(e.root_msg);return{has_more_beginning:n,has_more_end:r,messages:i,root_msg:e.root_msg}})},getSubscriptionState:function e(t,n){var i=p(t,n);var a=r[i];return a},promiseToGetSubscriptionState:function i(a,s){var o=p(a,s);var l=r[o];if(l)return Promise.resolve(l);var u=e[o]||t[o];if(u)return u.then(function(){return TS.replies.getSubscriptionState(a,s)});if(n[o])return n[o];n[o]=TS.api.call("subscriptions.thread.get",{channel:a,thread_ts:s}).then(function(e){var t=e.data.subscriptions;var n=_.includes(t,s);var i={model_ob_id:a,thread_ts:s,subscribed:n};r[o]=i;return i}).finally(function(){delete n[o]});return n[o]},markThread:function e(t,n,a,s){var o=p(t,n);var l=r[o];if(l&&l.last_read===a)return Promise.resolve();if(l){l._pending||(l._pending={});if(l._pending[a])return;l._pending[a]=true}var u=function e(){TS.has_pri[T]&&TS.log(T,"subscriptions.thread.mark "+n+" -> "+a);return TS.api.call("subscriptions.thread.mark",{channel:t,thread_ts:n,ts:a}).finally(function(){l&&l._pending&&delete l._pending[a]})};if(s){TS.has_pri[T]&&TS.log(T,"Queuing thread mark "+n+" -> "+a);i&&i();i=u}else u()},updateThreadStateReceived:function e(){if(i){i();i=null}},markAllThreads:function e(t){var n={};t&&(n.max_ts=t);return TS.api.call("subscriptions.thread.clearAll",n)},threadMarked:function e(t,n,i,a){var s=p(t,n);var o=r[s];if(o){o.last_read=i;o.unread_count=a}TS.replies.thread_marked_sig.dispatch(t,n,o)},threadSubscribed:function e(t,n,r){var i=S(t,n,true,r);TS.replies.thread_subscription_changed_sig.dispatch(t,n,i)},threadUnsubscribed:function e(t,n,r){var i=S(t,n,false,r);TS.replies.thread_subscription_changed_sig.dispatch(t,n,i)},setSubscriptionState:function e(t,n,i,a){var s=TS.redux.channels.getEntityById(t);if(!s)return;var o=p(t,n);var l=r[o];l&&(l.subscribed=i);var u={channel:t,thread_ts:n};a&&(u.last_read=a);if(i)return TS.api.call("subscriptions.thread.add",u);var d=TS.replies.getMessage(s,n);if(d&&!d.thread_ts){u.preemptive_remove=true;TS.replies.thread_subscription_changed_sig.dispatch(t,n,l)}return TS.api.call("subscriptions.thread.remove",u)},maybeSlurpSubscriptionState:function e(t,n){return h(t,n)},updateThreadBroadcastRoots:function e(t,n){var r=t.msgs;if(!r||!r.length)return;_.forEach(r,function(e){if(e.ts===n.ts)return;if(e.thread_ts!==n.ts)return;if("thread_broadcast"!==e.subtype||!e.root)return;e.root=n;t.is_channel?TS.channels.message_changed_sig.dispatch(t,e):t.is_im?TS.ims.message_changed_sig.dispatch(t,e):t.is_group&&t.is_mpim?TS.mpims.message_changed_sig.dispatch(t,e):t.is_group&&!t.is_mpim&&TS.groups.message_changed_sig.dispatch(t,e)})}});var e={};var t={};var n={};var r={};var i=null;var a=function e(t){if(t.is_channel)return"channels.replies";if(t.is_im)return"im.replies";return"groups.replies"};var s=function e(t,n,r){var i=r.data.messages.map(function(e){return TS.utility.msgs.processImsgFromHistory(e,t.id)});var a=!!r.data.has_more;h(t.id,i);if(t&&t.msgs&&t.msgs.length){var s=_.filter(t.msgs,function(e){return e.thread_ts===n&&TS.interop.rules.messages.isTempMsg(e)});s.length&&(i=_.sortBy(i.concat(s),"ts"))}g(t,i);var o=_.find(i,{ts:n});o&&(i=_.without(i,o));return{messages:i,has_more:a,root_msg:o}};var o=function e(t){if(t)return;r&&_(r).values().forEach(function(e){delete e.sanity_check_status})};var l=function e(t,n){var r=TS.replies.getSubscriptionState(t.id,n.ts);var i=false===_.get(r,"sanity_check_status");if(i){TS.has_pri[T]&&TS.log(T,"Clearing previous sanity check failure for "+n.ts);delete r.sanity_check_status}TS.replies.reply_changed_sig.dispatch(t,n)};var u=function e(t,n){TS.replies.reply_deleted_sig.dispatch(t,n)};var d=function e(t,n){l(t,n)};var c=function e(t,n){var r=TS.redux.channels.getEntityById(t);if(!r)return;if(r.is_channel&&!r.is_member)return;var i=TS.replies.getSubscriptionState(t,n);var a=false===_.get(i,"sanity_check_status");if(a){TS.has_pri[T]&&TS.log(T,"Sanity check for "+n+" failed earlier, not using local messages");return}var s;var o;if(!o){s=r.msgs;o=TS.utility.msgs.getMsg(n,s)}if(!o){s=r._archive_msgs;o=TS.utility.msgs.getMsg(n,s)}if(!o)return;var l=s.filter(function(e){return e.ts==n||e.thread_ts==n});var u=l.filter(function(e){return!e.is_ephemeral&&!TS.interop.rules.messages.isTempMsg(e)});var d=o.reply_count||0;if(u.length<d+1)return;return _.sortBy(l,"ts")};var m=function e(t,n){if(!TS.redux.socket.isConnected()||TS.api.isPaused())return false;var r=TS.replies.getSubscriptionState(t,n);var i=_.get(r,"sanity_check_status",false);if(i){TS.has_pri[T]&&TS.log(T,"Skipping sanity check for "+n+" because it passed previously");return false}return true};var f=function e(t,n,r,i){r=r.filter(function(e){return!e.is_ephemeral&&!TS.interop.rules.messages.isTempMsg(e)});var a=true;TS.replies.getThreadLazy(t,n,i,a).then(function(e){var i=e.messages;e.has_more_beginning?r=_.takeRight(r,i.length):e.has_more_end&&(r=_.take(r,i.length));var a=_.map(r,"ts");var s=_.map(i,"ts");var o=_.map(r,"text");var l=_.map(r,"text");var u=TS.replies.getSubscriptionState(t,n);if(_.isEqual(a,s)&&_.isEqual(o,l)){TS.has_pri[T]&&TS.log(T,"Replies sanity check passed for "+n);u&&(u.sanity_check_status=true);return}var d=_.intersection(a,s);var c=_.difference(s,d);var m=_.difference(a,d);if(0==m.length&&c.length>0){var f=_(i).filter(function(e){return"tombstone"===e.subtype}).map("ts").value();var p=_.isEqual(c.sort(),f.sort());if(p){TS.has_pri[T]&&TS.log(T,"Replies sanity check passed (except tombstones) for "+n);TS.metrics.count("replies_sanity_check_passed_except_tombstones");return}}if(m.length>0&&0==c.length){var h=_.max(s);var g=_.every(m,function(e){return e>h});if(g){TS.has_pri[T]&&TS.log(T,"Replies sanity check passed (except newer local msgs) for "+n);TS.metrics.count("replies_sanity_check_passed_except_newer_local_msgs");return}}var S={version_ts:TS.boot_data.version_ts,channel_id:t,thread_ts:n,messages_from_api:s,messages_from_model_ob:a};TS.warn("Replies sanity check failed. Here's the debug info: "+JSON.stringify(S));TS.metrics.count("replies_sanity_check_failed");u&&(u.sanity_check_status=false);var v=TS.redux.channels.getEntityById(t);if(!v)return;var b=TS.replies.getMessage(v,n);if(!b)return;TS.replies.sanity_check_failed_sig.dispatch(v,b,i,e.has_more_beginning,e.has_more_end);return null});return null};var p=function e(t,n){return t+"_"+n};var h=function e(t,n){n.forEach(function(e){if(!e.hasOwnProperty("_subscribed"))return;var n=p(t,e.ts);r[n]&&r[n].last_read?e._last_read&&e._last_read>r[n].last_read&&(r[n].last_read=e._last_read):r[n]={model_ob_id:t,thread_ts:e.ts,subscribed:e._subscribed,last_read:e._last_read,unread_count:e._unread_count}})};var g=function e(t,n){if(!t||!t.msgs||!TS.useReactMessages()&&!t.msgs.length||!n||!n.length)return;var r=_.find(n,TS.utility.msgs.msgHasReplies);if(!r||r.ts!==r.thread_ts)return;if(!TS.useReactMessages()&&!TS.utility.msgs.getMsg(r.ts,t.msgs))return;var i=_.differenceBy(n,t.msgs,"ts");if(!i.length)return;var a=t.msgs.concat(i);TS.utility.msgs.setMsgs(t,a)};var S=function e(t,n,i,a){var s=p(t,n);var o=r[s];if(o)o.subscribed=i;else{o={subscribed:i,model_ob_id:t,thread_ts:n};r[s]=o}a.last_read&&(o.last_read=a.last_read);a.unread_count&&(o.unread_count=a.unread_count);return o};var T=2004})()},11285:function(e,t){(function(){TS.registerModule("ui.thread",{expanded_threads:{},buildThreadHTML:function e(n,r){try{var i=n.model_ob;var a=n.root_msg;var u=n.replies;var d=[];if(n.max_visible_ts){var c=_.takeWhile(u,function(e){return e.ts<=n.max_visible_ts});d=_.drop(u,c.length);u=c}var m="thread_"+i.id+"_"+n.ts.replace(".","_");var f;i.is_im&&(f=TS.interop.members.getMemberById(i.user));var p=TS.replies.getSubscriptionState(i.id,a.thread_ts);var h=p&&p.subscribed;var g=s(n);var S;var T;if(g>=TS.replies.DEFAULT_HISTORY_API_LIMIT){S=o(n);T=l(n)}var v=TS.templates.thread({id:m,ts:n.ts,model_ob:i,thread:n,root_msg:a,conversation_permalink:TS.utility.msgs.constructConversationPermalink(i,a.ts),channel_msg_permalink:TS.utility.msgs.constructMsgPermalink(i,a.ts),replies:u,new_replies:d,new_replies_count:t(d.length),im_user:f,is_subscribed:h,options:r||{},view_previous_count:g,visible_reply_count:S,total_reply_count:T});return v}catch(e){TS.error("Threads view: error rendering thread");TS.console.logError(e,"threads_view_error");return""}},updateThreadWithMessage:function e(t,s,o,l){var u=t.find('ts-message[data-ts="'+o.ts+'"]');var d;var c={};var _=t.attr("data-context");"inline"===_&&(c.inline=true);d=TS.templates.builders.buildThreadMsgHTML(o,s.model_ob,s,c);var m=$(d);if(u.length){u.hasClass("hidden")&&m.addClass("hidden");u.replaceWith(m)}else if(l){var f=t.find(".thread_replies_container");var p=t.find(".new_replies_container ts-message");f.append(p).append(m);n(t,false)}else{t.find(".new_replies_container").append(m);r(s,t)}if(TS.interop.messages.isReply(o))o.is_ephemeral&&i(s,t,o);else{a(s,t,o);i(s,t,o)}TS.attachment_actions.select.decorateNewElements(t);g(s,t)},removeMessageFromThread:function e(t,n,a){var s=$("#"+TS.templates.makeMsgDomIdInThreadsView(a.ts));if(!s.length)return;a.is_pending?s.remove():s.addClass("delete_mode").slideUp(200,function(){s.remove()});r(n,t);g(n,t);a.is_ephemeral&&i(n,t)},revealNewReplies:function e(t,r){return new Promise(function(e){var s=t.find(".new_reply_indicator");var o=t.find(".thread_replies_container");var l=t.find(".new_replies_container");s.animate({height:0},150,function(){n(t,false);s.css("height","");var r=o.height();o.height(r);o.css("overflow","hidden");var i=l.find("ts-message");i.appendTo(o);o.css("height","auto");var a=o.height();o.height(r).animate({height:a},300,function(){l.css("height","");o.css("height","");o.css("overflow","");e()})});a(r,t,r.root_msg);i(r,t)})},revealPreviousReplies:function e(t,n,r){var o={};var l=t.attr("data-context");"inline"===l&&(o.inline=true);return new Promise(function(e,l){r.then(function(){var r=s(n);var l=t.find(".view_all_replies_container");var u=function s(){if(r){TS.ui.thread.hideThreadLoadingSpinner(t);a(n,t,n.root_msg)}else l.remove();i(n,t);var u=t.find(".thread_replies_container");var d=u.find("ts-message:first");var c=$("<div></div>");d.length?d.before(c):u.append(c);var m=_.takeWhile(n.replies,function(e){return e.ts<n.min_visible_ts});_.forEach(m,function(e){c.append(TS.templates.builders.buildThreadMsgHTML(e,n.model_ob,n,o))});TS.attachment_actions.select.decorateNewElements(t);var f=c.height();c.height(0).animate({height:f},300,function(){var t=c.find("ts-message");d.length?t.insertBefore(d):t.appendTo(u);c.remove();e()})};l.length&&!r?l.animate({height:0},150,u):u()},function(){p(t);l()})})},renderReplyInput:function e(t,n){var r=n.model_ob;var i=n.root_msg.ts;var a=t.find(".reply_input_container");a.empty();var s=TS.permissions.members.canPostInModelOb(TS.model.user,r);TS.boot_data.feature_default_shared_channels&&!s&&(s=TS.permissions.members.canThread(r));if(!s||r.is_archived){c(r,a);return}if(!TS.replies.canReplyToMsg(r,n.root_msg)){r.is_channel&&!r.is_member?m(r,a):t.addClass("no_reply_container");return}TS.ui.inline_msg_input.make(a,{placeholder:TS.interop.i18n.t("Reply...","threads")(),aria_label:TS.interop.i18n.t("Reply...","threads")(),complete_member_specials:false,complete_cmds:true,in_thread:true,model_ob:r,jumbomoji:TS.utility.contenteditable.isJumbomojiEnabled,onSubmit:function e(s,o){if(!TS.redux.socket.isConnected())return;if(r.is_archived){TS.generic_dialog.alert(TS.interop.i18n.t("This channel has been archived; you cannot send messages to it.","threads")());return}var l=_.last(n.replies);n.max_visible_ts&&(l=_.findLast(n.replies,function(e){return e.ts<=n.max_visible_ts}));var d=TS.client.ui.maybeHandleReactionCmd(l,o,function(){u(a,r,i)});if(d)return;if(TS.utility.msgs.shouldSendSlashCommand(o)){u(a,r,i);TS.client.ui.sendSlashCommand(r,o,n.root_msg)}else{TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",r.id,i);var c=a.find(".reply_broadcast_toggle").prop("checked");u(a,r,i);var m=TS.ui.thread.getContextForEl(t);var f=c?"THREADS_REPLY_BROADCAST_CLICKED":"THREADS_REPLY";var p=_.get(n,".root_msg.reply_count",0)+1;TS.ui.thread.trackEvent(r.id,n.root_msg.ts,m,f,{num_msg_in_thread:p});c&&TS.log(2004,"Submitting broadcast from threads view for "+r.id+"-"+n.root_msg.ts);TS.utility.contenteditable.clogMentionCounts(o);TS.client.ui.sendMessage(r,o,n.root_msg,c)}return null},getMsgDivForEditing:function e(){var r=t.closest("ts-thread");var i=n.replies;var a=_.reject(i,function(e){return"tombstone"===e.subtype});"tombstone"!==n.root_msg.subtype&&a.unshift(n.root_msg);_.reverse(a);var s=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,a);if(!s)return null;return r.find('ts-message[data-ts="'+s.ts+'"]')},onTextChange:function e(t){var n=TS.utility.contenteditable.value(t);var s=!n.trim();var o=s?"":n;TS.storage.storeReplyInput(r.id,i,o);f(a)}});var o=a.find(".message_input");o.on("focusin",function(){a.addClass("has_focus")}).on("focusout",function(){var e=TS.utility.contenteditable.isEmpty(o,true);var t=document.activeElement===this;e&&!t&&a.removeClass("has_focus")});d(r,i,a);var l=TS.storage.fetchReplyInput(r.id,i);if(l){TS.utility.populateInput(o,l);a.addClass("has_focus")}},joinChannelFromThread:function e(t,n){var r=n.closest("ts-thread");if(!r.length)return;var i=r.data("model-ob-id");var a=TS.redux.channels.getEntityById(i);if(!a)return;TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:a.id,inBackground:true})).catch(_.noop);r.find(".join_channel_from_thread").addClass("disabled")},submitReply:function e(t,n){if(!n||0===n.length)return;var r=n.closest(".reply_input_container").find("form");if(0===r.length)return;r.submit()},findAndPopulateInput:function e(t,n,r){if(!n||!r)return;var i='ts-thread[data-model-ob-id="'+n+'"][data-thread-ts="'+r+'"]';var a=$(i).find(".message_input");TS.utility.populateInput(a,t);TS.storage.storeReplyInput(n,r,t)},showThreadLoadingSpinner:function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var n=t.find(".view_all_loading_container");n.html(TS.templates.infinite_spinner({size:"small"}))},hideThreadLoadingSpinner:function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var n=t.find(".view_all_loading_container");n.empty()},startInlineThread:function t(n,r){e(n.id,r.ts,true);TS.view.rebuildMsg(r)},expandInlineThread:function t(n){var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");var a=TS.redux.channels.getEntityById(r);if(!a)return;var s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;var o={model_ob:a,root_msg:s,replies:[],ts:s.ts};TS.ui.utility.preventElementFromScrolling(n.find(".message_content"),function(){n.addClass("expanded")});TS.ui.thread.renderReplyInput(n,o);var l=TS.replies.getThread(r,i).then(function(e){var t=Infinity;o.replies&&o.replies.length&&(t=_.first(o.replies).ts);o.min_visible_ts=t;var n=_.filter(e,function(e){return e.ts!==s.ts});o.replies=n});TS.ui.thread.revealPreviousReplies(n,o,l);e(r,i,true);return null},collapseInlineThread:function t(n){var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");var a=TS.redux.channels.getEntityById(r);if(!a)return;var s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;if(!TS.utility.msgs.msgHasReplies(s)){e(r,i,false);TS.view.rebuildMsg(s);return}var o=n.find(".thread_replies_container");o.animate({height:0},300,function(){o.css("height","");o.find("ts-message").remove();TS.ui.utility.preventElementFromScrolling(n.find(".message_content"),function(){n.removeClass("expanded")})});n.find(".reply_input_container").html(TS.templates.thread_inline_input_placeholder({model_ob:a,root_msg:s,conversation_permalink:TS.utility.msgs.constructConversationPermalink(a,s.ts),num_total_threads:s.reply_count}));e(r,i,false)},isThreadExpanded:function e(t,n){return!!TS.ui.thread.expanded_threads[t+n]},isMessageBeingConvertedToThread:function e(t,n){return!TS.utility.msgs.msgHasReplies(n)&&!TS.interop.messages.isReply(n)&&TS.ui.thread.isThreadExpanded(t,n.ts)},makeInlineThread:function e(t,n){var r=TS.redux.channels.getEntityById(t);if(!r)return null;var i=TS.utility.msgs.getMsg(n,r.msgs);if(!i)return null;var a={model_ob:r,root_msg:i,replies:[],ts:i.ts};if(TS.ui.thread.isThreadExpanded(t,n)){var s=_.filter(r.msgs,function(e){return e.ts!==n&&e.thread_ts===n});a.replies=s}return a},trackEvent:function e(t,n,r,i,a){if(!t||!n||!r){TS.error("error collecting clog data for threads");return}var s=h(t,n,r,a);"threads_view"===r&&TS.client.ui.threads.incrementTrackingSeqId();TS.interop.clog.track(i,s)},getTrackingPayloadForEl:function e(t,n){var r={};var i=TS.ui.thread.getContextForEl(t);if("threads_view"!==i&&"convo"!==i)return r;var a=t.closest("ts-thread, ts-conversation");if(!a.length)return r;var s=a.attr("data-model-ob-id");var o=a.attr("data-thread-ts");if(!s||!o)return r;return h(s,o,i,n)},getContextForEl:function e(t){if(t.closest("#threads_msgs").length>0)return"threads_view";if(t.closest("#convo_tab").length>0)return"convo";if(t.closest("#msgs_scroller_div").length>0)return"message_pane";if(t.closest("#unread_msgs_scroller_div").length>0)return"unreads_view";return"other"}});var e=function e(t,n,r){TS.ui.thread.expanded_threads[t+n]=r};var t=function e(t){return TS.interop.i18n.t("{reply_count,plural,=1{{reply_count} new reply}other{{reply_count} new replies}}","threads")({reply_count:t})};var n=function e(t,n){var r=t.find(".thread_messages");var i="show_new_reply_indicator";n?r.addClass(i):r.removeClass(i)};var r=function e(r,i){if(!r||!i||!i.length)return;var a=_.reduce(r.replies,function(e,t){t.ts>r.max_visible_ts&&(e+=1);return e},0);var s=i.find(".new_reply_indicator");var o=s.find(".reveal_new_replies");if(a<=0){n(i,false);o.empty();return}var l=t(a);o.text(l);n(i,true)};var i=function e(t,n){if(!t||!n||!n.length)return;var r=n.find(".visible_reply_count");if(s(t)>=TS.replies.DEFAULT_HISTORY_API_LIMIT){var i=o(t);var a=l(t);var u=TS.interop.i18n.t("{visible_reply_count} of {total_reply_count}","threads")({visible_reply_count:i,total_reply_count:a});r.text(u)}else r.text("")};var a=function e(t,n,r){if(!n||!n.length||!r)return;if(!r.replies&&!r.reply_count)return;var i=n.find(".view_all_replies_container");if(!i.length)return;var a=i.find(".view_all_replies");var o=s(t);if(!o){i.addClass("hidden");return}var l=TS.interop.i18n.t("View {reply_count,plural,=1{{reply_count} previous reply}other{{reply_count} previous replies}}","threads")({reply_count:o});a.text(l)};var s=function e(t){var n=t.root_msg.reply_count;var r=t.replies;if(r&&r.length){var i=_.filter(r,function(e){return!e.is_ephemeral&&!TS.interop.rules.messages.isTempMsg(e)}).length;n=t.root_msg.reply_count-i;n=Math.min(TS.replies.DEFAULT_HISTORY_API_LIMIT,n)}if(n<0){TS.error("Ignoring negative previous reply count for "+t.ts);return 0}return n};var o=function e(t){var n;n=t.max_visible_ts?_.reduce(t.replies,function(e,n){n.ts<=t.max_visible_ts&&(e+=1);return e},0):_.get(t,".replies",[]).length;return n};var l=function e(t){var n=_.filter(t.replies,function(e){return e.is_ephemeral||TS.interop.rules.messages.isTempMsg(e)}).length;var r;r=t&&t.root_msg&&t.root_msg.reply_count?_.get(t,"root_msg.reply_count",0)+n:_.get(t,"root_msg.replies.length",0)+n;return r};var u=function e(t,n,r){var i=t.find(".message_input");TS.utility.populateInput(i,"",0);TS.utility.contenteditable.clearHistory($("#reply_container .message_input"));TS.storage.storeReplyInput(n.id,r,"");t.find(".reply_broadcast_toggle").attr("checked",false)};var d=function e(t,n,r){if(!t||!n||!r||0===r.length)return;var i=TS.permissions.members.canPostInChannel(t);r.append(TS.templates.reply_broadcast_buttons({model_ob:t,label_id:n,view:"threads",can_post_back_to_channel:i}));var a=r.find(".reply_broadcast_label_container, .reply_send");var s=r.find(".message_input");a.mousedown(function(e){e.preventDefault();TS.utility.contenteditable.focus(s)}).click(function(){TS.utility.contenteditable.focus(s)})};var c=function e(t,n){n.html(TS.templates.reply_limited({channel_name:TS.interop.rules.channels.getDisplayNameForChannel(t),is_archived:t.is_archived}))};var m=function e(t,n){n.html(TS.templates.join_channel_from_thread({model_ob_name:t.name,is_threads_view:true}))};var f=function e(t){var n=t.find(".message_input");var r=!!TS.msg_edit.isMessageTooLong(n);t.find(".reply_container_info").toggleClass("hidden",r)};var p=function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var n=t.find(".view_all_replies_container");var r=n.find(".view_all_loading_container");var i=n.find(".view_all_error_msg");var a=n.find(".view_all_replies");r.empty();i.removeClass("hidden");var s=TS.interop.i18n.t("Try Again","threads")();a.removeClass("active").text(s)};var h=function e(t,n,r,i){if(!t||!n||!r){TS.error("error collecting clog data for threads");return}var a={parent_message_id:n,channel_id:t,is_threads_view:"threads_view"===r?1:0,is_flexpane:"convo"===r?1:0};"threads_view"===r&&_.merge(a,TS.client.ui.threads.getTrackingData());i&&(a=_.merge(a,i));return a};var g=function e(t,n){var r=TS.templates.builders.buildThreadParticipantListHTML(t.root_msg);n.find(".thread_participants").html(r)}})()},11286:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("utility.money",{formatMoney:function e(n,a,o){var l={all_digits:false};o=_.defaults(o,l);var u=o.all_digits;if(!a){TS.error("cannot format money: no currency_code specified");return""}n=n?parseInt(n,10):0;var d;if(t){d="JPY"===a?n:n/100;var c=n%100!==0;var m=!u&&!c;var f=s(r,a,m);var p;if(i[f])p=i[f];else if(m){p=new Intl.NumberFormat(r,{style:"currency",currency:a,maximumFractionDigits:0,minimumFractionDigits:0});i[f]=p}else{p=new Intl.NumberFormat(r,{style:"currency",currency:a});i[f]=p}return p.format(d)}return TS.utility.money.formatMoneyWithoutIntl(n,a,o)},formatMoneyWithoutIntl:function t(n,i,a){var s=/^[-]*[0-9]+\.?[0-9]*$/;var o=/\B(?=(\d{3})+(?!\d))/g;var l={all_digits:false};a=_.defaults(a,l);var u=a.all_digits;if(!i){TS.error("cannot format money: no currency_code specified");return""}n=n?parseInt(n,10):0;var d=TS.interop.i18n.locales_number_formatting.default;var c=TS.interop.i18n.locales_number_formatting[r]?TS.interop.i18n.locales_number_formatting[r].decimal_symbol:d.decimal_symbol;var m=TS.interop.i18n.locales_number_formatting[i]?TS.interop.i18n.locales_number_formatting[r].thousands_separator:d.thousands_separator;var f=e[i]?e[i].currency_symbol:i;if(!s.test(n)){TS.warn("Incorrect input passed as parameter: amount should only contain numbers");return n}var p="";var h="";var g;var S="";var T=n<0;if(T){p="-";n=Math.abs(n)}if("JPY"===i)h=n.toString();else{g=n%100!==0;h=n/100;h=u?h.toFixed(2).replace(".",c):g?h.toFixed(2).replace(".",c):h.toFixed(0)}h=h.replace(o,m);switch(r){case"en-US":S=p+f+h;break;case"es-ES":S=p+h+" "+f;break;case"fr-FR":S=p+h+" "+f;break;case"de-DE":S=p+h+" "+f;break;case"ja-JP":S=p+f+h;break;default:S=p+f+h}return S},test:function n(){var o={isInString:a,currencies:e,locales_number_formatting:TS.interop.i18n.locales_number_formatting,locale:r,number_format_cache:i,getNumFormatKey:s,has_Intl:t};Object.defineProperty(o,"isInString",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(o,"currencies",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(o,"locales_number_formatting",{get:function e(){return TS.interop.i18n.locales_number_formatting},set:function e(t){TS.interop.i18n.locales_number_formatting=t}});Object.defineProperty(o,"locale",{get:function e(){return"_locale"},set:function e(t){r=t}});Object.defineProperty(o,"number_format_cache",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(o,"getNumFormatKey",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(o,"has_Intl",{get:function e(){return t},set:function e(n){t=n}});return o}});var e={default:{currency_symbol:"$"},USD:{currency_symbol:"$"},GBP:{currency_symbol:"\xa3"},EUR:{currency_symbol:"\u20ac"},JPY:{currency_symbol:"\xa5"}};var t=window.Intl&&"object"===n(window.Intl);var r=TS.interop.i18n.locale||"en-US";var i={};var a=function e(t,n){if(_.isEmpty(t)||_.isEmpty(n))return false;return t.indexOf(n)>=0};var s=function e(t,n,r){var i=r?"cents":"nocents";return t+"_"+n+"_"+i}})()},11287:function(e,t){(function(){TS.registerModule("ui.react_emoji_menu",{is_showing:false,onStart:function e(){TS.prefs.emoji_mode_changed_sig.add(C);TS.prefs.preferred_skin_tone_changed_sig.add(M)},start:function e(t){m(t)}});var e=15;var t=0;var n=-6;var r="top-left";var i="reactroot_emoji_picker";var a;var s;var o="#msg_input";var l;var u;var d;var c;var m=function e(t){l=t.rxn_key;if(l){g();u=function e(n){var r=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(t.rxn_key),n);TS.rxns.changeRxnsFromUserAction(t.rxn_key,n,r);t.callback&&t.callback()}}else u=t.callback;o=!l&&(t.input_to_fill||o);if(TS.client&&TS.utility.contenteditable.isDisabled(o))return;var n=t.position;var r=TS.client&&o===TS.client.ui.$msg_input;var i=_.get(TS,"model.ui_state.flex_visible");r&&i&&(n="top-right");s=$(t.e&&t.e.target);h({open:true,is_rxn:!!l});TS.tips.hideAll();TS.boot_data.feature_emoji_picker_frecently_used&&TS.emoji.replaceFrecentlyUsed();d=t.target_bounds||s.dimensions_rect();var a=window.pageYOffset;d.top+=a;d.bottom+=a;TS.ui.react_emoji_menu.is_showing=true;var c={};var m={position:n,offset_x:t.offset_x,offset_y:t.offset_y};p(c,m);TS.model.is_our_app&&TSSSB.nodrag.getIsRequired()&&_.get(window,"desktop.app.updateDragRegion")&&window.desktop.app.updateDragRegion([])};var f=function e(){h({open:false,is_rxn:!!l});s=null;o="#msg_input";l=null;u=null;c=null;TS.tips.unhideAll();TS.ui.react_emoji_menu.is_showing=false;p();TS.model.is_our_app&&TSSSB.nodrag.getIsRequired()&&TS.client.channel_header.calculateNoDragRegions()};var p=function e(t,n){var r=b(t);var i=y(n);TS.metrics.mark("react_emoji_menu_render_mark");a||(a=I());TS.interop.mountEmojiPicker(TS.boot_data.team_id,a,r,i)};var h=function e(t){if(t.is_rxn){s.closest(".menu_rxn").toggleClass("active",t.open);s.closest(".rxn_panel").toggleClass("active",t.open);s.closest("ts-message").toggleClass("active",t.open);s.toggleClass("active",t.open)}else{s.closest(".emo_menu").toggleClass("active",t.open);s.closest(".handy_rxns_row").toggleClass("active",t.open);s.closest(".current_status_emoji_picker").toggleClass("active",t.open)}};var g=function e(t){var n=TS.rxns.getHandyRxnsDisplayDataByRxnKey(t);c=_.map(n.items,function(e){return e.name})};var S=function e(){if("google"===TS.interop.rules.emoji.getEmojiMode()&&!TS.boot_data.feature_emoji5)return[];return[":hand:",":hand::skin-tone-2:",":hand::skin-tone-3:",":hand::skin-tone-4:",":hand::skin-tone-5:",":hand::skin-tone-6:"]};var T=function e(t,n){var r=$(o);var i=n.display_name||n.name;var a=!(t&&t.shiftKey);if(TS.utility.contenteditable.isContenteditable(r))TS.utility.contenteditable.inlineEmojiIsEnabled()?setTimeout(TS.utility.contenteditable.insertContentsAtCursor,0,r,TS.interop.texty.convertContentsStringToContents(n.name,TS.model.user.id,TS.model.highlight_words,TS.interop.rules.emoji.shouldRenderEmojiAsText()),a):setTimeout(TS.utility.contenteditable.insertTextAtCursor,0,r,i,a);else{var s=TS.utility.contenteditable.cursorPosition(r).start;var l=s+i.length;var u=TS.utility.contenteditable.value(r);var d=u.substr(0,s)+i+u.substr(s);TS.utility.populateInput(r,d);a&&setTimeout(TS.utility.contenteditable.cursorPosition,0,o,l)}};var v=function e(t,n){var r=_.find(TS.model.emoji_map,{name_with_colons:TS.emoji.stripLocalizedSkinTone(t.name)});n&&(n=n.replace(/^:/,""));r&&TS.ui.frecency.record(r,n)};var b=function e(t){t=t||{};var n={onSkinToneChanged:x,groups:TS.model.emoji_groups,skinToneChoiceNames:S(),activeSkinToneId:t.skin_tone_id||TS.prefs.getPref("preferred_skin_tone"),numBackgroundColors:TS.model.emoji_menu_colors,onSelected:w,onClosed:k,canAddEmoji:!TS.model.user.is_restricted&&(!TS.prefs.getTeamPref("emoji_only_admins")||TS.model.user.is_admin),emojiMap:TS.model.emoji_map,skinToneModifier:TS.emoji.getChosenSkinToneModifier(true),featureEmoji5:TS.boot_data.feature_emoji5,initiallyShowEmojiUpdateOverlay:TS.interop.rules.emoji.shouldShowEmoji5Coachmark({prefName:"seen_emoji_update_overlay_coachmark"}),isMac:!!TS.model.is_mac};l&&(n.handyRxnNames=c);return n};var y=function i(a){a=a||{};return{targetBounds:d,allowanceX:e,allowanceY:e,position:a.position||r,offsetX:_.isUndefined(a.offset_x)?t:a.offset_x,offsetY:_.isUndefined(a.offset_y)?n:a.offset_y,isOpen:TS.ui.react_emoji_menu.is_showing,onClose:k,ariaRole:"dialog"}};var w=function e(t,n,r){v(n,r);if(u){setTimeout(u,0,n.name);return}if(!o)return TS.error("Could not find an _input_to_fill.");T(t,n)};var k=function e(){f()};var x=function e(t){TS.prefs.onPrefChanged({name:"preferred_skin_tone",value:t});TS.prefs.setPrefByAPI({name:"preferred_skin_tone",value:t});l&&g(l);TS.boot_data.feature_emoji_picker_frecently_used&&TS.emoji.replaceFrecentlyUsed();if(TS.ui.react_emoji_menu.is_showing){var n={skin_tone_id:t};p(n)}};var C=function e(){TS.ui.react_emoji_menu.is_showing&&_.defer(p)};var M=function e(){l&&g(l);C()};var I=function e(){if(!document.getElementById(i)){var t=document.createElement("div");t.setAttribute("id",i);document.body.appendChild(t)}return document.getElementById(i)}})()},11288:function(e,t){(function(){var e="reactroot_menu";var t=15;var n;var r;TS.registerModule("ui.react_menu",{is_showing:false,start:function e(n){TS.ui.react_menu.is_showing&&TS.ui.react_menu.end({skip_unmount:true});TS.ui.react_menu.is_showing=true;TS.tips.hideAll();r=n.on_end;var i=$(n.e&&n.e.target);var s=n.target_bounds||i.dimensions_rect();var o={template:n.template,onMenuItemSelected:TS.ui.react_menu.end,onTriggerClose:TS.ui.react_menu.end};var l={targetBounds:s,position:n.position,allowanceX:n.allowance_x||t,allowanceY:n.allowance_y||t,offsetX:n.offset_x,offsetY:n.offset_y,isOpen:TS.ui.react_menu.is_showing,onClose:TS.ui.react_menu.end};a(o,l)},end:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};TS.tips.unhideAll();TS.ui.react_menu.is_showing=false;_.isFunction(r)&&r();r=void 0;var i=Promise.resolve();t.skip_unmount||i.then(function(){if(n){TS.interop.unmountMenu(n);document.body.removeChild(n);n=void 0}});return i}});var i=function t(){if(!document.getElementById(e)){var n=document.createElement("div");n.setAttribute("id",e);document.body.appendChild(n)}return document.getElementById(e)};var a=function e(t,r){n||(n=i());TS.interop.mountMenu(TS.boot_data.team_id,n,t,r)}})()},11289:function(e,t){(function(){TS.registerModule("ui.a11y",{focus_stack:[],unread_message_strings:{},$aria_live_div:null,zoom_level_changed_sig:new signals.Signal,zoomPercentToLevel:function t(n){return e[n]},zoomLevelToPercent:function e(n){return t[n]},onStart:function e(){a();f();h();TS.channels.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.ims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.groups.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.mpims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.prefs.a11y_animations_changed_sig.add(TS.ui.a11y.replaceAnimatedImages);$(document).on("focus","input[placeholder],textarea[placeholder]",function(e){i($(e.target))});$(document).on("blur","input[placeholder],textarea[placeholder]",function(e){i($(e.target))})},focusOnNextMessage:function e(){var t=$(document.activeElement);var r;var i=t.is(n);r=i&&t.next().length?t.next():o();TS.ui.a11y.focusAndAddTabindex(r)},focusOnPreviousMessage:function e(){var t=$(document.activeElement);var r;var i=l();var a=t.is(n);r=a&&t.prev().length?t.prev():a&&TS.model.archive_view_is_showing?o():t.is("#end_display_meta")?o():i.children(n).length&&i.children(n).last()?i.children(n).last():o();TS.ui.a11y.focusAndAddTabindex(r)},focusOnOldestUnreadMessage:function e(){TS.client.ui.$msgs_unread_divider&&TS.client.ui.$msgs_unread_divider.next().length?TS.ui.a11y.focusAndAddTabindex(TS.client.ui.$msgs_unread_divider.next()):TS.ui.a11y.ariaLiveAnnounce(TS.interop.i18n.t("No unread messages.","a11y")(),true)},focusOnMessageInput:function e(){TS.ui.a11y.focusAndAddTabindex(o())},focusAndAddTabindex:function e(t){if(!t)return;t.attr("tabindex")&&t.data("previous-tabindex",t.attr("tabindex"));t.attr("tabindex","0");t.focus()},cleanUpTabindex:function e(t){if(!t)return;t.data("previous-tabindex")?t.attr("tabindex",t.data("previous-tabindex")):t.removeAttr("tabindex")},saveCurrentFocus:function e(){TS.ui.a11y.focus_stack.push(document.activeElement);return document.activeElement},saveCurrentFocusAndFocusOnElement:function e(t){var n=TS.ui.a11y.saveCurrentFocus();TS.ui.a11y.focusAndAddTabindex(t);return n},restorePreviousFocus:function e(){var t=TS.ui.a11y.focus_stack.pop();if(t&&"function"===typeof t.focus){t.focus();return t}},restorePreviousFocusAndCleanUpElement:function e(t){var n=TS.ui.a11y.restorePreviousFocus();TS.ui.a11y.cleanUpTabindex(t);return n},ariaLiveAnnounce:function e(t,n){TS.ui.a11y.$aria_live_div.empty();TS.ui.a11y.$aria_live_div.attr("aria-live",n?"assertive":"polite");TS.ui.a11y.$aria_live_div.text(t)},assembleActiveModelName:function e(){var t=TS.shared.legacyGetActiveModelOb();var n="";TS.model.unread_view_is_showing?n=TS.interop.i18n.t("All unreads","a11y")():TS.model.threads_view_is_showing?n=TS.interop.i18n.t("Threads","a11y")():t.is_channel?n=TS.interop.i18n.t("Channel #{model_name}","a11y")({model_name:t.name}):t.is_im?n=TS.interop.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.interop.members.getPrefCompliantMemberNameById(t.user)}):t.is_mpim?n=TS.interop.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.mpims.legacyGetDisplayName(t)}):t.is_group&&(n=TS.interop.i18n.t("Private Channel {model_name}","a11y")({model_name:t.name}));return n},saveUnreadCountMessage:function e(t,n){if(!t||!t.name||!n)return;TS.ui.a11y.unread_message_strings[t.name]=n},annouceCurrentChannelOrImOrGroup:function e(){var t=TS.ui.a11y.assembleActiveModelName();var n=t;var r=TS.shared.legacyGetActiveModelOb();if(!r)return;if(TS.model.archive_view_is_showing){TS.ui.a11y.focusAndAddTabindex(o());return}if(TS.ui.a11y.unread_message_strings[r.name]){n+=", "+TS.ui.a11y.unread_message_strings[r.name];delete TS.ui.a11y.unread_message_strings[r.name]}TS.ui.a11y.ariaLiveAnnounce(n,true)},resetMessageInput:function e(){TS.client.msg_input.$input.trigger("autosize-resizeIncludeStyle");TS.client.msg_input.resized();TS.view.onResize()},replaceAnimatedImages:function e(){TS.ui.a11y.replaceAnimatedFiles();TS.ui.a11y.replaceEmoji()},replaceAnimatedFiles:function e(){var t=TS.prefs.getPref("a11y_animations");var n;var i;if(r){c();return}var a=TS.utility.msgs.getDisplayedMsgs(TS.shared.legacyGetActiveModelOb().msgs);var s;if(false===t)for(s=0;s<a.length;s+=1)if(a[s].file){n=a[s].file;if("gif"===n.filetype){n.deanimate_gif?i=n.deanimate_gif:n.thumb_160&&(i=n.thumb_160);i&&u(n.id,i)}else"space"===n.filetype&&c(a[s].ts)}else a[s].attachments&&d(a[s].ts,a[s].attachments[0]);else for(s=0;s<a.length;s+=1)if(a[s].file){n=a[s].file;if("gif"===n.filetype){n.thumb_360_gif?i=n.thumb_360_gif:n.thumb_360&&(i=n.thumb_360);i&&u(n.id,i)}else"space"===n.filetype&&c(a[s].ts)}else a[s].attachments&&d(a[s].ts,a[s].attachments[0])},replaceEmoji:function e(){var t=emoji;var n=$(".emoji:not(.stop_animations)");var r;for(var i=0;i<n.length;i+=1){var a=t.replace_colons(n[i].innerText);if(!a){var s=":"+n[i].parentNode.getAttribute("data-emoji")+":";a=t.replace_colons(s)}a&&a.match(/.+background-image:url\((.+)\).*/)&&(r=a.match(/.+background-image:url\((.+)\).*/)[1]);n[i].style.backgroundImage='url("'+r+'")'}TS.emoji.makeMenuLists()},getContrastColor:function e(t){var n=false;t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r){return t+t+n+n+r+r});t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(t){var r=parseInt(t[1],16);var i=parseInt(t[2],16);var a=parseInt(t[3],16);var s=(299*r+587*i+114*a)/1e3;n=s>=128?"#000000":"#FFFFFF"}return n},test:function e(){return{createAriaLiveElement:a,destroyAriaLiveElement:s,getMessageInputElement:o,getMessageDivElement:l}}});var e={70:"-3",80:"-2",90:"-1",normal:"0",110:"1",125:"2",150:"3"};var t=Object.keys(e).reduce(function(t,n){t[e[n]]=n;return t},{});var n=".message, .day_divider, .unread_divider";var r=TS.web&&TS.web.space;var i=function e(t){var n=t.attr("placeholder");var r=t.attr("aria-label")||"";var i=!!r.length;var a=!!t.val().trim().length;if(a&&!i&&n.length){t.attr("aria-label",n);return}!a&&i&&r==n&&t.removeAttr("aria-label")};var a=function e(){TS.ui.a11y.$aria_live_div=$('<div id="aria_live_announcer" role="status"></div>');$("body").append(TS.ui.a11y.$aria_live_div);return TS.ui.a11y.$aria_live_div};var s=function e(){TS.ui.a11y.$aria_live_div.remove();delete TS.ui.a11y.$aria_live_div};var o=function e(){return TS.model.archive_view_is_showing&&TS.client.archives.not_member?$("#footer_archives"):TS.client.ui.$msg_input};var l=function e(){return TS.model.archive_view_is_showing?TS.client.archives.$archives_msgs_div:TS.client.ui.$msgs_div};var u=function e(t,n){var r=$('.image_gif[data-file-id="'+t+'"]');r.attr("data-src",n);r.find(".image_bg").attr("data-real-background-image",n);r.find(".image_bg").css("backgroundImage","url("+n+")");r.find("img").data("real-src",n);r.find("img").attr("src",n)};var d=function e(t,n){if(!n)return;if(n.is_animated||n.image_url&&n.image_url.match(/\.gifv?$/)){var r=$('.message[data-ts="'+t+'"]');var i=r.find(".msg_inline_img img");var a=false===TS.prefs.getPref("a11y_animations")?TS.utility.getImgProxyURL(n.image_url,n.image_width,n.image_height):n.image_url;_(i,a)}};var c=function e(t){var n=r?$("ts-space .msg_inline_img img"):$('.message[data-ts="'+t+'"] .post_container .msg_inline_img img');$.each(n,function(){var e=$(this);var t=TS.utility.getImgProxyURL(e.attr("src"));_(e,t)})};var _=function e(t,n){t.attr({"data-real-src":n,src:n});var r=t.closest(".msg_inline_img");r.attr("data-real-background-image",n);r.css("backgroundImage","url("+n+")")};var m;var f=function e(){if(!TSSSB.supports_zoom_api)return;m=TSSSB.call("getZoom");$(window).on("resize",p)};var p=function e(){var t=TSSSB.call("getZoom");if(m!=t){m=t;TS.ui.a11y.zoom_level_changed_sig.dispatch({zoom_level:t})}};var h=function e(){if(!TSSSB.supports_zoom_api)return;$("body").append('<div class="zoom_level_indicator hidden"></div>');TS.ui.a11y.zoom_level_changed_sig.add(T)};var g=function e(n){var r=t[n]||"100";var i="normal"===r?"100":r;var a=TS.interop.i18n.t("zoom: <strong>{zoom_percentage}%</strong>","a11y")({zoom_percentage:i});$(".zoom_level_indicator").html(a)};var S;var T=function e(t){if(TS._incremental_boot||$("body").hasClass("loading"))return;var n=$(".prefs_modal.active");if(n.length&&n.find(".a11y_pref_zoom").length)return;if(S){clearTimeout(S);S=null}g(t.zoom_level);var r=$(".zoom_level_indicator");r.insertAfter(document.body.lastElementChild);r.removeClass("hidden").show(0);var i=r.outerWidth()/2;var a="calc(50vw - "+i+"px)";r.css("left",a);S=setTimeout(function(){r.fadeOut(100)},1e3)}})()},11290:function(e,t){(function(){var e=10;var t=10;var n=100;var r=100;var i=33;var a=100;TS.registerComponent("SearchableEnterpriseTeamList",{_constructor:function e(t){this.id=t.id;this.triggered_by_user_action=t.triggered_by_user_action;this.$_container=t.$container;this.$_long_list_view;this.$_search_bar;this.$_search_input;this.$_clear_icon;this._team_searcher={};this._have_all_teams=false;this._model_ob_id=t.model_ob_id;this._omit_my_team=!!t.omit_my_team;this._current_query="";this._approx_item_height=30;this._long_list_view_height=0;this._long_list_view_items_height=0;this._long_list_view_initial_height=null;this._fetch_page_p=null;this._resize_sig_handler=null;this.team_clicked_sig=new signals.Signal},destroy:function e(){this._resize_sig_handler&&TS.view&&TS.view.resize_sig.remove(this._resize_sig_handler);this.$_container.off();this.$_long_list_view&&this.$_long_list_view.off();this.$_search_input&&this.$_search_input.off();this.$_clear_icon&&this.$_clear_icon.off();this.$_long_list_view&&this.$_long_list_view.length&&$.data(this.$_long_list_view.get(0),"TS-longListView")&&this.$_long_list_view.longListView("destroy");this.$_search_bar&&this.$_search_bar.remove()},showInitial:function e(){var t=this;this.$_long_list_view=this.$_container.find(".p-searchable_enterprise_team_list__scroller");this._showLoadingState();this._fetchPage().then(function(){t._hideLoadingState()}).then(function(){t._setupLongListView();t._maybeSetupSearchBar();return null})},maybeRerenderLongListView:function e(){this.$_long_list_view&&_.get(this._team_searcher,"items")&&this.$_long_list_view.longListView("setItems",this._team_searcher.items,true,true)},_fetchPage:function e(){if(this._fetch_page_p)return this._fetch_page_p;var t=this;this._setupSearcher();this._fetch_page_p=TS.teams.promiseToSearchTeams(this._team_searcher).then(function(){t._fetch_page_p=null;t._have_all_teams=t._team_searcher.num_remaining<=0});return this._fetch_page_p},_setupSearcher:function e(){this._team_searcher.max_api_results=this._current_query?n:t;var r=TS.interop.utility.looksLikeMemberId(this._model_ob_id)?TS.interop.members.getMemberById(this._model_ob_id):TS.redux.channels.getEntityById(this._model_ob_id);this._team_searcher.included_ids=TS.interop.utility.looksLikeMemberId(_.get(r,"id"))?_.get(r,"enterprise_user.teams",[]):_.get(r,"shared_team_ids",[]);_.get(TS.model.user,"is_restricted")&&(this._team_searcher.included_ids=_.intersection(_.get(TS.model.user,"enterprise_user.teams"),this._team_searcher.included_ids));this._omit_my_team&&(this._team_searcher.omitted_ids=[TS.model.team.id]);this._current_query&&(this._team_searcher.query=this._current_query)},_fetchProcessAndDisplayPage:function e(){var t=this;return this._fetchPage().then(function(){t._maybeHideNoResultsState();_.get(t._team_searcher,"items.length")?t.$_long_list_view.longListView("setItems",t._team_searcher.items,true,true):t._showNoResultsState();return null}).then(function(){TS.utility.rAF(function(){t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height();t._recursivelyFillLongListViewToHeight()});return null})},_maybeSetupSearchBar:function t(){var n=this;if(this.$_search_bar)return;var r=TS.interop.utility.looksLikeMemberId(this._model_ob_id)?TS.interop.members.getMemberById(this._model_ob_id):TS.redux.channels.getEntityById(this._model_ob_id);var i;i=TS.interop.utility.looksLikeMemberId(_.get(r,"id"))?_.get(r,"enterprise_user.teams.length"):_.get(r,"is_global_shared")?Infinity:_.get(r,"shared_team_ids.length");if(i>=e){n.$_long_list_view.before(TS.templates.teams_search_bar());n.$_search_bar=n.$_container.find(".p-searchable_enterprise_team_list__search_bar");n.$_search_input=n.$_search_bar.find(".p-searchable_enterprise_team_list__input");n._setupSearchInput()}},_setupSearchInput:function e(){var t=this;this.$_search_bar.find(".p-searchable_enterprise_team_list__search.loading").replaceWith(TS.templates.teams_search_bar_input());this.$_search_input=this.$_search_bar.find(".p-searchable_enterprise_team_list__input");this.$_clear_icon=this.$_container.find(".icon_close");this.$_search_input.bind("keyup.searchable_enterprise_team_list",this._handleSearchKeyUp.bind(this));this.$_clear_icon.bind("click",function(){t._reset();Promise.resolve().then(function(){t.$_search_input.focus();return null})});this.triggered_by_user_action&&this.$_search_input.focus()},_setupLongListView:function e(){var t=this;var n=TS.interop.utility.looksLikeMemberId(this._model_ob_id);this.$_long_list_view.longListView({items:this._team_searcher.items||[],approx_item_height:this._approx_item_height,approx_divider_height:this._approx_divider_height,calcItemHeight:function e(t){return t.outerHeight()},makeElement:function e(){return $(TS.templates.teams_list_item())},renderItem:function e(r,i){var a=TS.model.team.id!==i.id;var s=n&&a;r.html(TS.templates.teams_team_row({team:i,linked:!!s&&t._buildTeamLink(i),target:s?t._buildTeamLinkTarget(i):""}));TS.utility.makeSureAllLinksHaveTargets(r)}});this.$_long_list_view.on("click","[data-long-list-item]",function(e){t.team_clicked_sig.dispatch(e,TS.teams.getTeamById($(e.target).closest(".p-enterprise_team_item").find("[data-team-id]").data("teamId")))});this._resize_sig_handler=_.throttle(function(){t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height();t._long_list_view_initial_height||(t._long_list_view_initial_height=t._long_list_view_height)},i);TS.view&&TS.view.resize_sig.add(this._resize_sig_handler);this.$_long_list_view.on("scroll",_.debounce(function(e){if(t._current_query)return;var n=t._long_list_view_items_height-($(e.target).scrollTop()+t._long_list_view_height);n<r&&t._fetchProcessAndDisplayPage()},a));TS.utility.rAF(function(){TS.view&&TS.view.resizeManually("TS.SearchableEnterpriseTeamList.showInitial");t._recursivelyFillLongListViewToHeight()})},_recursivelyFillLongListViewToHeight:function e(){var t=this;if(this._current_query)return;this._long_list_view_items_height<=this._long_list_view_height&&!this._have_all_teams&&this._fetchProcessAndDisplayPage().then(function(){t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height()})},_reset:function e(){this._team_searcher={};this._current_query="";this.$_search_input.val("");this.$_clear_icon.addClass("hidden");this._have_all_teams=false;this._maybeHideNoResultsState();this.$_long_list_view.longListView("setItems",[],true,true);this.$_long_list_view.scrollTop(0);this.$_long_list_view.height(this._long_list_view_initial_height);this._fetchProcessAndDisplayPage()},_showLoadingState:function e(){this.$_long_list_view.before(TS.templates.infinite_spinner({color:"white",size:"medium"}))},_hideLoadingState:function e(){this.$_container.find(".infinite_spinner").remove()},_showNoResultsState:function e(){var t=this.$_container.find(".no_results");t.length>0&&t.remove();var n=this;var r={query:this._current_query};var i=TS.templates.teams_searchable_no_results(r);this.$_long_list_view.hide().before(i);this.$_container.delegate(".clear_enterprise_team_filter","click",function(){n._reset()})},_maybeHideNoResultsState:function e(){var t=this.$_container.find(".no_results");if(0==t.length)return;var n=this.$_container.find(".other_matches");n&&n.remove();t.remove();this.$_long_list_view.show()},_handleSearchKeyUp:function e(t){var n=$(t.target).val();if(n.trim()!==this._current_query){if(this._fetch_page_p){this._fetch_page_p.cancel();this._fetch_page_p=null}this._team_searcher={};this._have_all_teams=false;this._current_query=n.trim();this._fetchProcessAndDisplayPage();this.$_long_list_view.scrollTop(0);this.$_clear_icon.toggleClass("hidden",!this._current_query)}},_buildTeamLink:function e(t){return TS.utility.enterprise.buildTeamUrl(t.domain)+(TS.client?"messages":"home")},_buildTeamLinkTarget:function e(t){return TS.client?"_self":TS.utility.enterprise.buildTeamUrl(t.domain)},test:function r(){var i={};Object.defineProperty(i,"MINIMUM_TEAMS_FOR_SEARCH",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(i,"FETCH_PAGE_SIZE",{get:function e(){return t},set:function e(n){t=n}});Object.defineProperty(i,"FETCH_PAGE_SIZE_SEARCH",{get:function e(){return n},set:function e(t){n=t}});return i}})})()},11291:function(e,t){(function(){TS.registerModule("ui.enterprise_teams_dialog",{show:function e(t){a(t)},test:function e(){var t={};Object.defineProperty(t,"_showTeamsDialog",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(t,"_getTeamsDialogChannelTitle",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(t,"_getTeamsDialogMemberTitle",{get:function e(){return o},set:function e(t){o=t}});return t}});var e="p-enterprise_teams_dialog";var t="enterprise_team_dialog";var n=null;function r(e){$(window.document).bind("keydown",i);var n=$(".p-searchable_enterprise_team_list");var r=new TS.SearchableEnterpriseTeamList({$container:n,id:t,model_ob_id:e.id,triggered_by_user_action:true});r.showInitial();n.on("click",".p-enterprise_team_row",TS.generic_dialog.cancel)}var i=function e(t){t.which==TS.utility.keymap.esc&&""===TS.generic_dialog.div.find("input").val()&&TS.generic_dialog.cancel()};var a=function a(l){var u=_.get(l,"id");if(n===u)return;n=u;var d=TS.templates.enterprise_teams_dialog();var c=TS.interop.utility.looksLikeMemberId(_.get(l,"id"));var m;if(c&&!_.get(l,"enterprise_user.teams.length"))return;if(!c&&!l.is_global_shared&&!_.get(l,"shared_team_ids.length"))return;m=c?o(l):s(l);TS.generic_dialog.start({dialog_class:e,title:m,body:d,cancel_button_text:TS.interop.i18n.t("Close","teams")(),hide_footer:true,show_cancel_button:true,show_go_button:false,backdrop_click_to_dismiss:true,onShow:function e(){r(l)},onEnd:function e(){var r=TS.SearchableEnterpriseTeamList.get(t);r&&r.destroy();TS.generic_dialog.div.remove();TS.generic_dialog.div=void 0;$(window.document).unbind("keydown",i);n=null}})};var s=function e(t){return t.is_global_shared?TS.interop.i18n.t("All workspaces in {channel_name}","teams")({channel_name:TS.interop.rules.channels.getDisplayNameForChannel(t)}):TS.interop.i18n.t("{team_count, number} workspaces in {channel_name}","teams")({team_count:_.get(t,"shared_team_ids.length"),channel_name:TS.interop.rules.channels.getDisplayNameForChannel(t)})};var o=function e(t){return TS.interop.i18n.t("Your {enterprise_name} workspaces","teams")({enterprise_name:_.escape(_.get(t,"enterprise_user.enterprise_name"))})}})()},11292:function(e,t){(function(){TS.registerModule("searcher",{search:function t(n,r){r.limit?r.limit_option={limit:r.limit}:r.limit_option={limit:e};var i=h(n,r);if(r.tiered){var s=a(n,r);s.promise=i;return Promise.resolve(s)}return i},test:function e(){return{count:y}}});var e=24;var t={prefer_exact_match:true,frecency:true,prefer_channels_user_belongs_to:true};var n={include_archived:true,only_if_member:false};var r={include_archived:true};var i={include_self:false,include_slackbot:true,include_bots:true,only_local_team:false,only_admins:false};var a=function e(n,r){var i={};r.members&&(i.members=s(r.members));r.channels&&(i.channels=o(r.channels));r.groups&&(i.groups=l(r.groups));r.all_mpims&&(i.all_mpims=TS.redux.channels.dangerouslyGetMpims().filter(TS.interop.rules.channels.isVisibleMpim));r.mpims&&(i.mpims=TS.redux.channels.dangerouslyGetMpims());r.teams&&(i.teams=u(r.teams));r.usergroups&&(i.usergroups=d(r.usergroups));r.views&&(i.views=c(r.views));if(r.enterprise_channels){i.enterprise_channels=m();i.enterprise_groups=f()}r.app_actions&&TS.interop.apps.isGlobalActionsEnabled()&&(i.app_actions=p());r.filter&&(i=r.filter(i));if(false!==r.sort){var a=b(r.sort,r.limit_option,t);return TS.sorter.search(n,i,a)}return i};var s=function e(t){t=b(t,i);return TS.members.getMembersWithOptions(t)};var o=function e(t){t=b(t,n);var r;r=TS.redux.channels.dangerouslyGetPublicChannels();t.include_archived||(r=_.reject(r,"is_archived"));t.exclude_required&&(r=_.reject(r,TS.interop.rules.channels.isRequired));t.only_if_member&&(r=_.filter(r,"is_member"));t.can_post&&(r=_.filter(r,_.curry(TS.permissions.members.canPostInModelOb)(TS.model.user)));TS.boot_data.feature_cross_workspace_quick_switcher_prototype&&(r=_.reject(r,{is_moved:1,is_archived:true}));return r};var l=function e(t){t=b(t,r);var n=TS.redux.channels.dangerouslyGetPrivateChannels();t.include_archived||(n=_.reject(n,"is_archived"));TS.boot_data.feature_cross_workspace_quick_switcher_prototype&&(n=_.reject(n,{is_moved:1,is_archived:true}));return n};var u=function e(){var t=_.map(TS.boot_data.other_accounts,function(e){return TS.teams.getTeamById(e.team_id)});var n=[];!TS.boot_data.page_needs_enterprise||TS.model.is_our_app&&!TS.interop.environment.isSSBAndAtLeastVersion("2.8")||(n=_.values(TS.teams.getEnterpriseTeams({only_member_of:true,exclude_current_team:true})));return _.uniqBy(n.concat(t),"id")};var d=function e(){return TS.interop.userGroups.getActiveUserGroups().slice()};var c=function e(){var t=[];TS.client.unread.isEnabled()&&t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vall_unreads"}));t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vall_threads"}));TS.interop.apps.isAppSpaceEnabled()&&t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vapp_space"}));return t};var m=function e(){return TS.enterprise.getChannels()};var f=function e(){return TS.enterprise.getGroups()};var p=function e(){var t=TS.interop.redux.models.appActions.selectGlobalActions(TS.redux.getState()).actions;return t.map(TS.interop.utility.getGlobalActionForFrecency)};var h=function e(t,n){var r=[];var i=[];if(n.members){var s=g(t,n);(n.members.runaway?i:r).push(s)}if(TS.boot_data.feature_lazy_channels&&n.channels){var o=S(t,n);(n.channels.runaway?i:r).push(o)}if(TS.boot_data.page_needs_enterprise){if(n.enterprise_channels){var l=v(t,n);(n.enterprise_channels.runaway?i:r).push(l)}if(n.teams){var u=T(t,n);(n.teams.runaway?i:r).push(u)}}return Promise.all(r).then(function(){var e=a(t,n);var r=false!==n.sort?!!e.length:_.some(_.values(e),"length");var s=TS.boot_data.feature_runaway_qs&&i.length&&!r;if(!s)return e;return new Promise(function(e){Promise.all(i).then(e)}).then(function(){return a(t,n)})})};var g=function e(t,n){var r=t.charAt(0);if("#"===r)return Promise.resolve();"@"===r&&(t=t.slice(1));if(r&&!t)return Promise.resolve();n=b(n.members,n.limit_option,i);n.max_api_results=n.remote_limit||n.limit;n.query=t;return TS.members.promiseToSearchMembers(n)};var S=function e(t,n){if(!TS.boot_data.feature_lazy_channels)return Promise.resolve();var r=t.charAt(0);if("@"===r)return Promise.resolve();"#"===r&&(t=t.slice(1));if(r&&!t)return Promise.resolve();n=b(n.channels,n.limit_option);n.count=n.remote_limit||n.limit;n.query=t;return TS.interop.channels.fetchAndUpsertChannelsWithQuery(n)};var T=function e(t,n){n=b(n.teams,n.limit_option);n.query=t;n.max_api_results=n.remote_limit||n.limit;return TS.teams.promiseToSearchTeams(n)};var v=function e(t,n){var r=t.charAt(0);if("@"===r)return Promise.resolve();"#"===r&&(t=t.slice(1));if(r&&!t)return Promise.resolve();n=b(n.enterprise_channels,n.limit_option);n.query=t;n.count=n.remote_limit||n.limit;return TS.enterprise.promiseToSearchEnterpriseChannels(n)};var b=function e(t,n){true===t&&(t={});return _.defaultsDeep.apply(null,arguments)};var y=function e(t){return _.size(_.flatten(_.values(t)))}})()},11293:function(e,t){(function(){TS.registerModule("sli_expert_search",{is_expanded:false,last_query:"",last_api_response:{},sli_expert_search_debug_group:null,onStart:function e(){TS.client&&TS.experiment.loadUserAssignments().then(function(){TS.sli_expert_search.sli_expert_search_debug_group=TS.experiment.getGroup("sli_expert_search_debug")})},render:function r(i,a,s,o){TS.sli_expert_search.last_api_response={experts:s,channels:o};if(TS.sli_expert_search.last_query!==i){TS.sli_expert_search.is_expanded=false;TS.sli_expert_search.last_query=i}var l="";var u=_(s).map(function(e){return _.map(e.users,function(e){return TS.interop.members.getMemberById(e.id)})}).flatten().uniqBy("id").value();var d=u.length;var c=u.length>4;u=_.take(u,4);var m=_.map(s,function(r,a){if("order"===a)return;var s=_.map(r.users,function(e){return TS.interop.members.getMemberById(e.id)});var o=_.map(r.channels,function(e){return TS.interop.channels.getChannelById(e.id)});return{users:s,faces:_.take(s,2),description:e(s,o),channels:o,partial_terms:!t(i,r.terms),terms:n(i,r.terms)}});m=_.compact(m);var f=[];if(!_.isEmpty(o)){var p=_.map(o,function(e,t){if("order"===t)return;var n=TS.interop.channels.getChannelById(e.id);if(!n)return;return TS.templates.builders.makeChannelLink(n)});p=_.compact(p);f.push({channels:new Handlebars.SafeString(TS.interop.i18n.listify(p,{noEscape:true}).join(""))})}l+=TS.templates.sli_expert_search_results({query:a,users:u,user_count:d,show_plus_sign_on_last_face:c,terms:i,results:m,channel_matches:f,expanded:TS.sli_expert_search.is_expanded,debug:"sli_expert_search_debug"===TS.sli_expert_search.sli_expert_search_debug_group});return l},toggleExpand:function e(){TS.sli_expert_search.is_expanded=!TS.sli_expert_search.is_expanded;$("[data-js=sli_expert_search]").toggleClass("sli_expert_search--collapsed",!TS.sli_expert_search.is_expanded);TS.interop.clog.track(TS.sli_expert_search.is_expanded?"SEARCH_OPEN":"SEARCH_CLOSE",{request_id:TS.search.last_request_id,client_request_id:TS.search.client_request_id,open_method:TS.sli_expert_search.is_expanded?"experts_expand":"experts_collapse",search_session_id:TS.search.getSearchSessionId()})},handleExpertsClick:function e(t,n,r){var i;var a;var s;a=$(t.target).parents("[data-expert-search-group-index]").data("expert-search-group-index");if("experts"===n)if("user"===r){i=$(t.target).closest(".member").index();s=_.get(TS.sli_expert_search.last_api_response,["experts",a,"users",i,"iid"])}else{i=$(t.target).closest(".channel_link").index();s=_.get(TS.sli_expert_search.last_api_response,["experts",a,"channels",i,"iid"])}else if("channels"===n&&"channel"===r){i=$(t.target).closest(".channel_link").index();s=_.get(TS.sli_expert_search.last_api_response,["channels",i,"iid"])}var o={request_id:TS.search.last_request_id,click_iid:s,click_target_type:"experts_"+r,click_module_name:n,click_module_position:TS.sli_expert_search.last_api_response[n].order,click_sort:"timestamp",click_position:a,search_session_id:TS.search.getSearchSessionIdForResults(),client_request_id:TS.search.getQuerySessionIdForResults()};o["click_"+r+"_id"]=$(t.target).data(("user"===r?"member":"channel")+"-id");s&&TS.interop.clog.track("SEARCH_CLICK",o)}});var e=function e(t,n){var r=_.map(t,TS.templates.builders.makeMemberPreviewLink);var i=TS.interop.i18n.listify(r,{noEscape:true}).join("");var a=_.map(n,function(e){return TS.templates.builders.makeChannelLink(e)});var s=TS.interop.i18n.listify(a,{strong:true,noEscape:true}).join("");return TS.interop.i18n.t("{user_link_text} in {channel_link_text}","search")({user_link_text:i,channel_link_text:s})};var t=function e(t,n){return _(t).split(" ").map(function(e){return n[e]}).every(Boolean)};var n=function e(t,n){return _.map(t.split(" "),function(e){return{word:e,present:n[e]}})}})()},11294:function(e,t){(function(){TS.registerModule("sli_search_facets",{sli_search_facet_debug_group:null,onStart:function e(){TS.client&&TS.experiment.loadUserAssignments().then(function(){TS.sli_search_facets.sli_search_facet_debug_group=TS.experiment.getGroup("sli_debug_facet_suggestions")})},isEnabled:function e(){var t=TS.sli_search_facets.sli_search_facet_debug_group;if(t)return t.startsWith("sli_facet_suggestions");return false},render:function e(t,n){var r=null;t&&(r=_(t).chain().filter(function(e,t){return"order"!==t}).map(function(e){return _.get(TS.interop.channels.getChannelById(e.id),"name")||_.get(TS.interop.channels.getGroupById(e.id),"name")||"???"}).value());var i=null;n&&(i=_(n).chain().filter(function(e,t){return"order"!==t}).map(function(e){return _.get(TS.interop.members.getMemberById(e.id),"name")||_.get(TS.interop.bots.getBotById(e.id),"name")||"???"}).value());var a="";a+=TS.templates.sli_search_facets_results({channel_names:r,user_names:i});return a}})})()},11295:function(e,t){(function(){TS.registerModule("automount",{onStart:function e(){var t=TS.redux.getStoreInstance();TS.interop.automount.mountAllWithStore(t)}})})()},13640:function(e,t){(function(){TS.registerModule("ui.react_message_menu",{onStart:function t(){e=document.getElementById(a)},showMessageMenu:function n(r,i){var a=i.channel,o=i.message;t=$(r&&r.target);var l=TS.interop.mountMessageActionsMenu.itemSets;var u=l.channel;var d="";if(t.closest("ts-conversation").length){u=l.thread;d="convo"}else t.closest("ts-thread").length?u=l.thread:t.closest("#sli_briefing").length&&(u=l.sliBriefing);TS.redux.dispatch(TS.interop.redux.models.messages.addMessages([o]));var c={channelId:a.id,ts:o.ts,itemSet:u,onEdit:function e(){TS.msg_edit.startEdit(o.ts,a,d)},onTriggerClose:TS.ui.react_message_menu.closeMessageMenu,onMenuItemSelected:TS.ui.react_message_menu.closeMessageMenu};var _=s();t.closest("ts-message").addClass("active");TS.interop.mountMessageActionsMenu(TS.redux.getState().teamId,e,c,_)},closeMessageMenu:function n(){if(t){t.closest("ts-message").removeClass("active");t=null}TS.interop.mountMessageActionsMenu(TS.redux.getState().teamId,e,{},{isOpen:false})}});var e=void 0;var t=void 0;var n=15;var r="top-left";var i={x:0,y:-8};var a="message_actions_menu_mount_point";var s=function e(){return{targetBounds:t?t.dimensions_rect():{},position:r,allowanceX:n,allowanceY:n,offsetX:i.x,offsetY:i.y,isOpen:true,onClose:TS.ui.react_message_menu.closeMessageMenu}}})()},13641:function(e,t){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};(function(){TS.registerModule("utility.calls_state_logging",{logState:function t(n,r){switch(n){case"idle":TS.utility.calls_state_logging.transition("CALLS_IDLE");break;case"start_call":TS.utility.calls_state_logging.transition("CALLS_START_CALL");break;case"get_regions":TS.utility.calls_state_logging.transition("CALLS_GET_REGIONS");break;case"get_server":TS.utility.calls_state_logging.transition("CALLS_GET_SERVER");break;case"initialize_janus":TS.utility.calls_state_logging.transition("CALLS_INITIALIZE_JANUS");break;case"join_room":TS.utility.calls_state_logging.transition("CALLS_JOIN_ROOM");break;case"in_room":TS.utility.calls_state_logging.transition("CALLS_IN_ROOM");break;case"disconnect_janus":TS.utility.calls_state_logging.transition("CALLS_DISCONNECT_JANUS");break;case"disconnect_for_reconnect_janus":TS.utility.calls_state_logging.transition("CALLS_DISCONNECT_FOR_RECONNECT_JANUS");break;case"reconnect":e+=1;TS.utility.calls_state_logging.transition("CALLS_RECONNECT");break;case"terminal":TS.utility.calls_state_logging.transition("CALLS_TERMINAL",{terminal_type:r.terminal_type});break;default:break}},transition:function i(a,s){s=s||{};TS.utility.calls_log.logEventInfo({event:"StateTransition",value:n({state:a,reconnect_attempt:e,prev_state:t,reachability:window.navigator.onLine},s)});TS.interop.clog.track(a,n({},r(),s));t=a},error:function i(a,s){s=s||{};TS.utility.calls_log.logEventWarn({event:"StateError",value:n({state:a,reconnect_attempt:e,prev_state:t,reachability:window.navigator.onLine},s)});TS.interop.clog.track(a,n({},r(),s));t=a},event:function i(a,s){s=s||{};TS.utility.calls_log.logEventInfo({event:"StateEvent",value:n({state:a,reconnect_attempt:e,current_state:t,reachability:window.navigator.onLine},s)});TS.interop.clog.track(a,n({},r(),s))}});var e=0;var t="";var r=function n(){return{reconnect_attempt:e,prev_state:t,room_id:TS.calls?TS.calls.getCallState().room_id:"",num_participants:TS.calls?TS.calls.participants.getAllParticipants().length:0,reachability:window.navigator.onLine}}})()}},[11186]);